(function(t,e){"object"===typeof exports&&"object"===typeof module?module.exports=e():"function"===typeof define&&define.amd?define([],e):"object"===typeof exports?exports["CoSimpleRScene"]=e():t["CoSimpleRScene"]=e()})("undefined"!==typeof self?self:this,(function(){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var a=e[s]={i:s,l:!1,exports:{}};return t[s].call(a.exports,a,a.exports,i),a.l=!0,a.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)i.d(s,a,function(e){return t[e]}.bind(null,a));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s="fae3")}({"030e":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{static Initialize(t,e){let i=this;1==t?(i.OES_standard_derivatives=e.getExtension("OES_standard_derivatives"),i.OES_standard_derivatives,i.EXT_shader_texture_lod=e.getExtension("EXT_shader_texture_lod"),i.EXT_shader_texture_lod,i.WEBGL_draw_buffers=e.getExtension("WEBGL_draw_buffers"),i.WEBGL_draw_buffers,i.OES_vertex_array_object=e.getExtension("OES_vertex_array_object"),i.OES_vertex_array_object,i.ANGLE_instanced_arrays=e.getExtension("ANGLE_instanced_arrays"),i.ANGLE_instanced_arrays,i.EXT_color_buffer_float=e.getExtension("EXT_color_buffer_float"),i.EXT_color_buffer_float,i.EXT_color_buffer_half_float=e.getExtension("EXT_color_buffer_half_float"),i.EXT_color_buffer_half_float,i.OES_texture_half_float=e.getExtension("OES_texture_half_float"),i.OES_texture_half_float,i.OES_texture_half_float_linear=e.getExtension("OES_texture_half_float_linear"),i.OES_texture_half_float_linear,i.OES_texture_float=e.getExtension("OES_texture_float"),i.OES_texture_float,i.OES_element_index_uint=e.getExtension("OES_element_index_uint"),i.OES_element_index_uint,i.EXT_blend_minmax=e.getExtension("EXT_blend_minmax"),i.EXT_blend_minmax):(i.EXT_shader_texture_lod=e.getExtension("EXT_shader_texture_lod"),i.EXT_shader_texture_lod,i.EXT_color_buffer_half_float=e.getExtension("EXT_color_buffer_half_float"),i.EXT_color_buffer_half_float,i.OES_texture_half_float_linear=e.getExtension("OES_texture_half_float_linear"),i.OES_texture_half_float_linear,i.EXT_color_buffer_float=e.getExtension("EXT_color_buffer_float"),i.EXT_color_buffer_float),i.OES_texture_float_linear=e.getExtension("OES_texture_float_linear"),i.OES_texture_float_linear,i.WEBGL_depth_texture=e.getExtension("WEBGL_depth_texture"),i.WEBGL_depth_texture,i.WEBGL_debug_renderer_info=e.getExtension("WEBGL_debug_renderer_info"),i.WEBGL_debug_renderer_info}}s.OES_standard_derivatives=null,s.EXT_shader_texture_lod=null,s.WEBGL_draw_buffers=null,s.OES_vertex_array_object=null,s.ANGLE_instanced_arrays=null,s.EXT_color_buffer_float=null,s.EXT_color_buffer_half_float=null,s.OES_texture_float_linear=null,s.OES_texture_half_float_linear=null,s.OES_texture_half_float=null,s.OES_texture_float=null,s.OES_element_index_uint=null,s.EXT_blend_minmax=null,s.WEBGL_depth_texture=null,s.WEBGL_debug_renderer_info=null,e.default=s},"0714":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(t=null){this.m_uid=s.s_uid++,this.m_shaderCode=null,this.m_shaderCodeFlag=!1,this.m_pipeMap=new Map,this.m_keys=[],this.m_sharedUniforms=null,this.m_shaderLib=null,this.m_pipetypes=null,this.m_appendKeyStr="",this.uuid="",this.m_shaderLib=t}getUid(){return this.m_uid}addShaderCodeWithUUID(t,e){null!=this.m_shaderLib&&this.addShaderCode(this.m_shaderLib.getShaderCodeObjectWithUUID(t),e)}addShaderCode(t,e=!1){this.m_shaderCodeFlag=null!=t,(null==this.m_shaderCode||null!=t&&e)&&(this.m_shaderCode=t)}hasShaderCode(){return null!=this.m_shaderCode}addPipe(t){let e=t.getPipeTypes();for(let i=0;i<e.length;++i)this.m_pipeMap.has(e[i])||this.m_pipeMap.set(e[i],t)}getPipeByType(t){return this.m_pipeMap.get(t)}hasPipeByType(t){return this.m_pipeMap.has(t)}createKeys(t){if(this.m_keys=[],null!=t){let e,i,s=t;for(let t=0;t<s.length;++t)i=s[t],this.m_pipeMap.has(i)&&(e=this.m_pipeMap.get(i),this.m_keys.push(e.getPipeKey(i)))}}buildSharedUniforms(t){if(this.m_sharedUniforms=[],this.m_pipetypes=t,null!=t){let e,i,s=t;for(let t=0;t<s.length;++t)i=s[t],this.m_pipeMap.has(i)&&(e=this.m_pipeMap.get(i),e.resetPipe(),this.m_sharedUniforms.push(e.getGlobalUinform()))}}build(t){if(this.m_shaderCodeFlag&&null!=this.m_shaderCode&&t.addShaderObject(this.m_shaderCode),null!=this.m_pipetypes){let e,i,s=this.m_pipetypes;for(let a=0;a<s.length;++a)i=s[a],this.m_pipeMap.has(i)&&(e=this.m_pipeMap.get(i),e.useShaderPipe(t,i))}}getTextures(t,e,i){if(null!=i){let s,a,r=i;for(let i=0;i<r.length;++i)a=r[i],this.m_pipeMap.has(a)&&(s=this.m_pipeMap.get(a),s.getTextures(t,e,a))}}getSharedUniforms(){return this.m_sharedUniforms}getSelfUniformData(){return null}appendKeyString(t){this.m_appendKeyStr+=t}getKeys(){return this.m_keys}getKeysString(){let t="";for(let e=0;e<this.m_keys.length;++e)t+=this.m_keys[e];return t+this.m_appendKeyStr}reset(){this.m_appendKeyStr="",this.m_shaderCodeFlag=!1}clear(){this.m_pipeMap=new Map,this.m_keys=[],this.m_sharedUniforms=null,this.m_shaderCode=null,this.m_shaderLib=null,this.m_pipetypes=null}}s.s_uid=0,e.MaterialPipeline=s},"0851":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i("7918"),r=s(i("8d98")),n=s(i("ffc0")),l=s(i("1f61")),h=s(i("5deb")),_=s(i("6e01")),o=s(i("da6a"));class u{constructor(t,e,i=!1){this.m_uid=-1,this.m_attachCount=0,this.m_renderProxy=null,this.m_slot=null,this.m_miplevel=-1,this.m_texWidth=128,this.m_texHeight=128,this.m_texBufW=128,this.m_texBufH=128,this.m_texTarget=h.default.TEXTURE_2D,this.m_sampler=-1,this.m_haveRData=!1,this.m_type=a.TextureProxyType.Default,this.m_generateMipmap=!0,this.name="TextureProxy",this.internalFormat=n.default.RGBA,this.srcFormat=n.default.RGBA,this.dataType=l.default.UNSIGNED_BYTE,this.wrap_s=r.default.WRAP_CLAMP_TO_EDGE,this.wrap_t=r.default.WRAP_CLAMP_TO_EDGE,this.wrap_r=r.default.WRAP_CLAMP_TO_EDGE,this.mipmapEnabled=!1,this.flipY=!1,this.premultiplyAlpha=!1,this.unpackAlignment=4,this.minFilter=r.default.LINEAR_MIPMAP_LINEAR,this.magFilter=r.default.LINEAR,this.version=0,this.m_slot=o.default.GetInstance(),this.m_uid=this.m_slot.getFreeUid(),t<1&&(t=128),e<1&&(e=128),i?(this.m_texWidth=_.default.CalcNearestCeilPow2(t),this.m_texHeight=_.default.CalcNearestCeilPow2(e)):(this.m_texWidth=t,this.m_texHeight=e),this.m_slot.__$$addTexture(this)}__$$use(t){t.bindToGpu(this.getResUid())}__$setRenderProxy(t){null!=this.m_slot||(this.m_slot=o.default.GetInstance(),this.m_uid=this.m_slot.getFreeUid(),this.m_slot.__$$addTexture(this)),this.m_renderProxy=t}__$attachThis(){-1==this.m_attachCount&&(this.m_slot.removeFreeUid(this.getUid()),this.m_attachCount=0),++this.m_attachCount}__$detachThis(){this.m_attachCount>0&&(--this.m_attachCount,this.m_attachCount<1&&(this.m_attachCount=-1,this.m_slot.addFreeUid(this.getUid())))}getAttachCount(){return this.m_attachCount}isDirect(){return!0}getType(){return this.m_type}getResUid(){return this.m_uid}getUid(){return this.m_uid}setWrap(t){this.wrap_s=this.wrap_t=this.wrap_r=t}isGpuEnabled(){return null!=this.m_renderProxy&&this.m_renderProxy.Texture.hasResUid(this.getResUid())}getSampler(){return this.m_sampler}getTargetType(){return this.m_texTarget}getBufWidth(){return this.m_texBufW}getBufHeight(){return this.m_texBufH}getWidth(){return this.m_texWidth}getHeight(){return this.m_texHeight}isDataEnough(){return this.m_haveRData}uploadFromFbo(t,e,i){throw Error("Illegal operation !!!")}__$buildParam(t){this.m_texBufW=this.m_texWidth,this.m_texBufH=this.m_texHeight,t.texParameteri(this.m_sampler,t.TEXTURE_WRAP_S,r.default.GetConst(t,this.wrap_s)),t.texParameteri(this.m_sampler,t.TEXTURE_WRAP_T,r.default.GetConst(t,this.wrap_t)),t.texParameteri(this.m_sampler,t.TEXTURE_MIN_FILTER,r.default.GetConst(t,this.minFilter)),t.texParameteri(this.m_sampler,t.TEXTURE_MAG_FILTER,r.default.GetConst(t,this.magFilter)),this.m_texTarget==h.default.TEXTURE_3D&&(t.texParameteri(this.m_sampler,t.TEXTURE_WRAP_R,r.default.GetConst(t,this.wrap_r)),t.texParameteri(t.TEXTURE_3D,t.TEXTURE_BASE_LEVEL,0),t.texParameteri(t.TEXTURE_3D,t.TEXTURE_MAX_LEVEL,Math.log2(this.m_texWidth))),this.mipmapEnabled&&this.m_generateMipmap&&t.generateMipmap(this.m_sampler)}enableMipmap(){}disableMipmap(){}generateMipmap(t){if(this.mipmapEnabled&&this.m_generateMipmap){let e=t.getRC();t.bindToGpu(this.getResUid()),this.__$buildParam(e)}}uploadData(t){}__$updateToGpu(t){}updateDataToGpu(t=null,e=!0){null!=t&&(this.m_renderProxy=t),null!=this.m_renderProxy&&this.m_renderProxy.MaterialUpdater.updateTextureData(this,e)}createTexBuf(t){return!t.hasResUid(this.getResUid())&&(this.m_sampler=h.default.GetValue(t.getRC(),this.m_texTarget),t.createResByParams3(this.getResUid(),this.getWidth(),this.getHeight(),this.m_sampler),!0)}__$$upload(t){if(this.m_haveRData&&null!=this.m_slot){let e=this.createTexBuf(t);e&&(this.__$updateToGpuBegin(t),this.uploadData(t),this.__$buildParam(t.getRC()),this.m_generateMipmap=!0)}}dataUploadToGpu(t,e,i,s=!1){this.version=0;let a=n.default.ToGL(t,this.internalFormat),r=n.default.ToGL(t,this.srcFormat),h=l.default.ToGL(t,this.dataType),_=e;if(null==i)(_.status>-1||s)&&_.updateToGpu(t,this.m_sampler,a,r,h,s);else{let e=i;for(let i=0,n=e.length;i<n;++i)_=e[i],null!=_&&(_.status>-1||s)&&_.updateToGpu(t,this.m_sampler,a,r,h,s);this.m_generateMipmap=!1}}__$updateToGpuBegin(t){let e=t.getRC();t.bindToGpu(this.getResUid()),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,this.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,this.unpackAlignment)}__$updateToGpuEnd(t){}isDestroyed(){return this.m_attachCount<-1}__$destroy(){this.getAttachCount()<1&&(this.m_attachCount=-2,this.m_haveRData=!1,this.m_texWidth=1,this.m_texHeight=1,this.m_renderProxy=null)}__$$removeFromSlot(){null!=this.m_slot&&-2==this.getAttachCount()&&(this.m_slot=null,this.m_renderProxy=null,this.m_uid=-1)}toString(){return"[TextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.TextureProxy=u,e.default=u},"0929":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s(i("6e01")),r=s(i("2139"));class n{constructor(t=null){this.m_uid=0,this.m_fs32=null,this.m_invMatEnabled=!1,this.m_rotFlag=!1,this.m_dt=0,this.version=-1,this.updatedStatus=n.UPDATE_POSITION,this.updateStatus=n.UPDATE_TRANSFORM,this.m_omat=null,this.m_localMat=null,this.m_parentMat=null,this.m_toParentMat=null,this.m_toParentMatFlag=!0,this.m_invOmat=null,this.m_uid=n.s_uid++,this.m_dt=null!=t?1:0,this.m_fs32=null!=t?t:new Float32Array(16)}getUid(){return this.m_uid}getFS32Data(){return this.m_fs32}rebuildFS32Data(){this.m_dt>0&&(this.m_dt=0,this.m_fs32=new Float32Array(16))}getRotationFlag(){return this.m_rotFlag}getX(){return this.m_fs32[12]}getY(){return this.m_fs32[13]}getZ(){return this.m_fs32[14]}setX(t){this.updateStatus|=1,this.updatedStatus|=1,this.m_fs32[12]=t}setY(t){this.updateStatus|=1,this.updatedStatus|=1,this.m_fs32[13]=t}setZ(t){this.updateStatus|=1,this.updatedStatus|=1,this.m_fs32[14]=t}setXYZ(t,e,i){this.m_fs32[12]=t,this.m_fs32[13]=e,this.m_fs32[14]=i,this.updateStatus|=1,this.updatedStatus|=1}offsetPosition(t){this.m_fs32[12]+=t.x,this.m_fs32[13]+=t.y,this.m_fs32[14]+=t.z,this.updateStatus|=1,this.updatedStatus|=1}setPosition(t){this.m_fs32[12]=t.x,this.m_fs32[13]=t.y,this.m_fs32[14]=t.z,this.updateStatus|=1,this.updatedStatus|=1}getPosition(t){t.x=this.m_fs32[12],t.y=this.m_fs32[13],t.z=this.m_fs32[14]}copyPositionFrom(t){null!=t&&(this.m_fs32[12]=t.m_fs32[12],this.m_fs32[13]=t.m_fs32[13],this.m_fs32[14]=t.m_fs32[14],this.updateStatus|=n.UPDATE_POSITION,this.updatedStatus|=n.UPDATE_POSITION)}getRotationX(){return this.m_fs32[1]}getRotationY(){return this.m_fs32[6]}getRotationZ(){return this.m_fs32[9]}setRotationX(t){this.m_fs32[1]=t,this.m_rotFlag=!0,this.updateStatus|=n.UPDATE_ROTATION,this.updatedStatus|=n.UPDATE_ROTATION}setRotationY(t){this.m_fs32[6]=t,this.m_rotFlag=!0,this.updateStatus|=n.UPDATE_ROTATION,this.updatedStatus|=n.UPDATE_ROTATION}setRotationZ(t){this.m_fs32[9]=t,this.m_rotFlag=!0,this.updateStatus|=n.UPDATE_ROTATION,this.updatedStatus|=n.UPDATE_ROTATION}setRotationXYZ(t,e,i){this.m_fs32[1]=t,this.m_fs32[6]=e,this.m_fs32[9]=i,this.updateStatus|=n.UPDATE_ROTATION,this.updatedStatus|=n.UPDATE_ROTATION,this.m_rotFlag=!0}getScaleX(){return this.m_fs32[0]}getScaleY(){return this.m_fs32[5]}getScaleZ(){return this.m_fs32[10]}setScaleX(t){this.m_fs32[0]=t,this.updateStatus|=n.UPDATE_SCALE,this.updatedStatus|=n.UPDATE_SCALE}setScaleY(t){this.m_fs32[5]=t,this.updateStatus|=n.UPDATE_SCALE,this.updatedStatus|=n.UPDATE_SCALE}setScaleZ(t){this.m_fs32[10]=t,this.updateStatus|=n.UPDATE_SCALE,this.updatedStatus|=n.UPDATE_SCALE}setScaleXYZ(t,e,i){this.m_fs32[0]=t,this.m_fs32[5]=e,this.m_fs32[10]=i,this.updateStatus|=n.UPDATE_SCALE,this.updatedStatus|=n.UPDATE_SCALE}setScale(t){this.m_fs32[0]=t,this.m_fs32[5]=t,this.m_fs32[10]=t,this.updateStatus|=n.UPDATE_SCALE,this.updatedStatus|=n.UPDATE_SCALE}getRotationXYZ(t){t.x=this.m_fs32[1],t.y=this.m_fs32[6],t.z=this.m_fs32[9]}getScaleXYZ(t){t.x=this.m_fs32[0],t.y=this.m_fs32[5],t.z=this.m_fs32[10]}localToGlobal(t){this.getMatrix().transformVectorSelf(t)}globalToLocal(t){this.getInvMatrix().transformVectorSelf(t)}getInvMatrix(){return null!=this.m_invOmat?this.m_invMatEnabled&&(this.m_invOmat.copyFrom(this.m_omat),this.m_invOmat.invert()):(this.m_invOmat=r.default.GetMatrix(),this.m_invOmat.copyFrom(this.m_omat),this.m_invOmat.invert()),this.m_invMatEnabled=!1,this.m_invOmat}getLocalMatrix(){return this.updateStatus>0&&this.update(),this.m_localMat}getMatrix(t=!0){return this.updateStatus>0&&t&&this.update(),this.m_omat}getToParentMatrix(){return null!=this.m_toParentMat?this.m_toParentMat:this.m_omat}setParentMatrix(t){this.m_parentMat=t,this.m_invMatEnabled=!0,null!=this.m_parentMat&&(this.m_localMat==this.m_omat?(this.updateStatus=n.UPDATE_TRANSFORM,this.updatedStatus=this.updateStatus,this.m_localMat=r.default.GetMatrix()):(this.updateStatus|=n.UPDATE_PARENT_MAT,this.updatedStatus=this.updateStatus))}getParentMatrix(){return this.m_parentMat}updateMatrixData(t){null!=t&&(this.updateStatus=n.UPDATE_NONE,this.m_invMatEnabled=!0,this.m_omat.copyFrom(t))}__$setMatrix(t){null!=t&&(this.updateStatus=n.UPDATE_NONE,this.m_invMatEnabled=!0,this.m_localMat==this.m_omat&&(this.m_localMat=t),null!=this.m_omat&&r.default.RetrieveMatrix(this.m_omat),this.m_omat=t)}destroy(){null!=this.m_invOmat&&r.default.RetrieveMatrix(this.m_invOmat),null!=this.m_localMat&&r.default.RetrieveMatrix(this.m_localMat),null!=this.m_omat&&this.m_omat!=this.m_localMat&&r.default.RetrieveMatrix(this.m_omat),this.m_invOmat=null,this.m_localMat=null,this.m_omat=null,this.m_parentMat=null,this.updateStatus=n.UPDATE_TRANSFORM,this.m_fs32=null}copyFrom(t){this.m_fs32.set(t.m_fs32,0),this.updatedStatus|=1,this.updateStatus|=n.UPDATE_TRANSFORM,this.m_rotFlag=t.m_rotFlag}forceUpdate(){this.updateStatus|=n.UPDATE_TRANSFORM,this.update()}update(){this.updateStatus>0&&(this.m_invMatEnabled=!0,this.updateStatus=this.updateStatus|this.updatedStatus,(this.updateStatus&n.UPDATE_TRANSFORM)>0&&(this.m_localMat.getLocalFS32().set(this.m_fs32,0),this.m_rotFlag&&this.m_localMat.setRotationEulerAngle(this.m_fs32[1]*a.default.MATH_PI_OVER_180,this.m_fs32[6]*a.default.MATH_PI_OVER_180,this.m_fs32[9]*a.default.MATH_PI_OVER_180),null!=this.m_parentMat&&(this.updateStatus=this.updateStatus|n.UPDATE_PARENT_MAT)),this.m_omat!=this.m_localMat&&this.m_omat.copyFrom(this.m_localMat),(this.updateStatus&n.UPDATE_PARENT_MAT)==n.UPDATE_PARENT_MAT&&(null!=this.m_toParentMat||(this.m_toParentMat=r.default.GetMatrix()),this.m_toParentMat.copyFrom(this.m_omat),this.m_toParentMatFlag=!0,this.m_omat.append(this.m_parentMat)),this.updateStatus=n.UPDATE_NONE,this.version++)}getMatrixFS32(){return this.getMatrix().getLocalFS32()}toString(){return"[ROTransform(uid = "+this.m_uid+")]"}static GetFreeId(){return n.m_freeIdList.length>0?n.m_freeIdList.pop():-1}static Create(t=null,e=null){let i=null,s=null!=e?-1:n.GetFreeId();return s>=0?(i=n.m_unitList[s],n.m_unitFlagList[s]=n.s_FLAG_BUSY,i.rebuildFS32Data()):(i=new n(e),n.m_unitList.push(i),n.m_unitFlagList.push(n.s_FLAG_BUSY),n.m_unitListLen++),i.m_omat=null==t?r.default.GetMatrix():t,i.m_localMat=i.m_omat,null==e&&i.m_fs32.set(n.s_initData,0),i}static Restore(t){if(null!=t&&n.m_unitFlagList[t.getUid()]==n.s_FLAG_BUSY){let e=t.getUid();n.m_freeIdList.push(e),n.m_unitFlagList[e]=n.s_FLAG_FREE,t.destroy()}}}n.s_uid=0,n.s_initData=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),n.UPDATE_NONE=0,n.UPDATE_POSITION=1,n.UPDATE_ROTATION=2,n.UPDATE_SCALE=4,n.UPDATE_TRANSFORM=7,n.UPDATE_PARENT_MAT=8,n.s_FLAG_BUSY=1,n.s_FLAG_FREE=0,n.m_unitFlagList=[],n.m_unitListLen=0,n.m_unitList=[],n.m_freeIdList=[],e.default=n},"0fc4":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s(i("9666")),r=s(i("faa5"));class n{constructor(){this.m_shduns="",this.m_shdData=null,this.m_polygonOffset=null,this.m_sharedUniforms=null,this.m_shaderUniformData=null,this.m_pipeLine=null,this.m_uniqueShaderName="",this.__$troMid=-1,this.__$uniform=null,this.pipeTypes=null,this.m_texList=null,this.m_texListLen=0,this.m_texDataEnabled=!1,this.m_attachCount=0}setPolygonOffset(t,e=0){null==this.m_polygonOffset?this.m_polygonOffset=[t,e]:(this.m_polygonOffset[0]=t,this.m_polygonOffset[1]=e)}getPolygonOffset(){return this.m_polygonOffset}setDepthOffset(t){}setMaterialPipeline(t){this.m_pipeLine=t}getMaterialPipeline(){return this.m_pipeLine}getShdUniqueName(){return this.m_shduns}getCodeBuf(){throw Error("Illgel operation !!!")}hasShaderData(){return null!=this.m_shdData&&(!this.m_shdData.haveTexture()||this.texDataEnabled())}initializeByRenderer(t=!1){this.initializeByCodeBuf(t)}initializeByCodeBuf(t=!1){if(t=t||this.getTextureTotal()>0,null==this.m_shdData){let e=this.getCodeBuf();if(null!=e){let i;e.reset(),e.pipeline=this.m_pipeLine,e.pipeTypes=this.pipeTypes,null!=e.pipeline&&e.pipeline.reset(),this.buildBuf();let s=this.m_uniqueShaderName;if(""!=s&&(i=a.default.FindData(s),this.m_shduns=s),null==i?(t=t||this.getTextureTotal()>0,e.initialize(t),s=e.getUniqueShaderName()+e.keysString+e.getShaderCodeBuilder().getUniqueNSKeyString(),this.m_shduns=s,this.__$initShd(this.m_shduns),i=a.default.FindData(s),this.m_uniqueShaderName=this.m_shduns):(t=t||this.getTextureTotal()>0,e.initialize(t)),null==i){null==e.pipeline&&null!=e.getShaderCodeObject()&&e.getShaderCodeBuilder().addShaderObject(e.getShaderCodeObject()),e.buildShader(),e.buildDefine(),null!=e.pipeline&&(null!=e.getShaderCodeObject()?e.pipeline.addShaderCode(e.getShaderCodeObject(),!1):e.pipeline.addShaderCodeWithUUID(e.getShaderCodeObjectUUID(),!1),e.pipeline.build(e.getShaderCodeBuilder()));let t=e.getFragShaderCode(),n=e.getVertShaderCode();i=a.default.CreateShdData(s,n,t,e.adaptationShaderVersion,r.default.GetPreCompileInfo())}null!=this.m_pipeLine&&(this.m_sharedUniforms=this.m_pipeLine.getSharedUniforms()),this.m_shdData=i}}}buildBuf(){}__$initShd(t){}getShaderData(){return this.m_shdData}setTextureList(t){if(this.m_texList!=t){this.m_texDataEnabled=!1,this.m_texListLen=null!=t?t.length:0;let e=0;if(null!=this.m_texList)for(;e<this.m_texList.length;++e)this.m_texList[e].__$detachThis();if(this.m_texDataEnabled=!0,this.m_texList=t,null!=this.m_texList){let t=31;for(e=0;e<this.m_texList.length;++e)t=131*t+this.m_texList[e].getUid(),this.m_texList[e].__$attachThis(),this.m_texList[e].isDataEnough()||(this.m_texDataEnabled=!1);this.__$troMid=t}}}setTextureAt(t,e){if(t>=0&&null!=e){let i=this.m_texList,s=i.length;if(null!=i&&i[t]!=e&&t<s&&s>0){i=i.slice(0),i[t].__$detachThis(),i[t]=e,this.m_texDataEnabled=e.isDataEnough(),e.__$attachThis();let a=31;for(let t=0;t<s;++t)a=131*a+i[t].getUid();this.__$troMid=a,this.m_texList=i}}}getTextureList(){return this.m_texList}getTextureAt(t){return this.m_texList[t]}getTextureTotal(){return this.m_texListLen}getShdTexTotal(){return null!=this.m_shdData?this.m_shdData.getTexTotal():0}texDataEnabled(){if(null!=this.m_texList){if(this.m_texDataEnabled)return!0;let t=!0,e=this.m_texList;for(let i=0;i<this.m_texListLen;++i)if(!e[i].isDataEnough()){t=!1;break}return this.m_texDataEnabled=t,t}return null!=this.m_shdData&&this.m_shdData.getTexTotal(),!1}createSharedUniforms(){return this.m_sharedUniforms}createSharedUniformsData(){return null}createSelfUniformData(){return this.m_shaderUniformData}updateSelfData(t){}hasTexture(){return this.m_shdData.haveTexture()}getBufSortFormat(){return null!=this.m_shdData?this.m_shdData.getLayoutBit():0}getBufTypeList(){return null!=this.m_shdData?this.m_shdData.getLocationTypes():null}getBufSizeList(){return null!=this.m_shdData?this.m_shdData.getAttriSizeList():null}__$attachThis(){++this.m_attachCount}__$detachThis(){--this.m_attachCount,this.m_attachCount<1&&(this.m_attachCount=0)}getAttachCount(){return this.m_attachCount}destroy(){if(this.m_sharedUniforms=null,this.m_shaderUniformData=null,this.pipeTypes=null,this.getAttachCount()<1){if(null!=this.m_texList)for(let t=0;t<this.m_texList.length;++t)this.m_texList[t].__$detachThis();this.m_shdData=null,this.m_texList=null,this.m_texDataEnabled=!1,this.__$troMid=0,null!=this.__$uniform&&(this.__$uniform.destroy(),this.__$uniform=null)}}toString(){return"[MaterialBase()]"}}e.default=n},"11e6":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{static AddContainerFlag(t){return 2147483648|t}static RemoveContainerFlag(t){return-2147483649&t}static AddSpaceUid(t,e){return-1048576&t|e}static RemoveSpaceUid(t){return-1048576&t}static GetSpaceUid(t){return 1048575&t}static AddRendererUid(t,e){return-133169153&t|e<<20}static RemoveRendererUid(t){return 133169152|t}static GetRendererUid(t){return t=(133169152&t)>>20,t<127?t:-1}static TestRendererUid(t){return t=(133169152&t)>>20,t<127}static AddSortEnabled(t){return 1073741824|t}static RemoveSortEnabled(t){return-1073741825&t}static TestSortEnabled(t){return 1073741824==(1073741824&t)}static AddRendererLoad(t){return 805306368|t}static RemoveRendererLoad(t){return-805306369&t}static TestSpaceContains(t){return(1048575&t)>0}static TestSpaceEnabled(t){return(1048575&t)<1}static TestSpaceEnabled2(t){return(1048575&t)<1&&2147483648!=(2147483648&t)}static TestContainerEnabled(t){return 133169152==(133169152&t)&&2147483648!=(2147483648&t)}static TestRendererEnabled(t){return 133169152==(938475520&t)&&2147483648!=(2147483648&t)}}s.DEFAULT=133169152,s.CONTAINER_FLAG=2147483648,s.CONTAINER_NOT_FLAG=-2147483649,s.SPACE_FLAG=1048575,s.SPACE_NOT_FLAG=-1048576,s.RENDERER_UID_FLAG=133169152,s.RENDERER_UID_NOT_FLAG=-133169153,s.RENDERER_UID_INVALID=127,s.SORT_FLAG=1073741824,s.SORT_NOT_FLAG=-1073741825,s.RENDERER_LOAD_FLAG=805306368,s.RENDERER_LOAD_NOT_FLAG=-805306369,s.RENDERER_ADN_LOAD_FLAG=938475520,e.default=s},"12e2":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},"131b":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s(i("faa5")),r=s(i("b3bd")),n=s(i("0fc4"));class l extends a.default{constructor(){super(),this.m_uniqueName="",this.m_fragCode="",this.m_vtxCode="",this.m_flag=!0,this.shaderBuilder=null}initialize(t){super.initialize(t),this.adaptationShaderVersion=!1}buildShader(){this.m_flag=null!=this.shaderBuilder,this.m_flag&&(this.shaderBuilder(this),this.shaderBuilder=null)}setUniqueName(t){this.m_uniqueName=t}setFragShaderCode(t){this.m_fragCode=t}getFragShaderCode(){return this.m_flag?this.m_coder.buildFragCode():this.m_fragCode}setVtxShaderCode(t){this.m_vtxCode=t}getVertShaderCode(){return this.m_flag?this.m_coder.buildVertCode():this.m_vtxCode}getUniqueShaderName(){return this.m_uniqueName}toString(){return"[RawCodeShaderBuffer()]"}}class h extends n.default{constructor(t){super(),this.m_buffer=new l,this.m_uniformData=null,this.m_shaderBuilder=null,this.vertColorEnabled=!1,this.premultiplyAlpha=!1,this.shadowReceiveEnabled=!1,this.lightEnabled=!1,this.fogEnabled=!1,this.envAmbientLightEnabled=!1,this.brightnessOverlayEnabeld=!1,this.glossinessEnabeld=!0,this.m_buffer.setUniqueName(t)}buildBuf(){let t=this.m_buffer;t.shaderBuilder=this.m_shaderBuilder,t.vertColorEnabled=this.vertColorEnabled,t.premultiplyAlpha=this.premultiplyAlpha,t.shadowReceiveEnabled=this.shadowReceiveEnabled,t.lightEnabled=this.lightEnabled,t.fogEnabled=this.fogEnabled,t.envAmbientLightEnabled=this.envAmbientLightEnabled,t.brightnessOverlayEnabeld=this.brightnessOverlayEnabeld,t.glossinessEnabeld=this.glossinessEnabeld}setShaderBuilder(t){this.m_shaderBuilder=t}setFragShaderCode(t){this.m_buffer.shaderBuilder=null,this.m_buffer.setFragShaderCode(t)}setVtxShaderCode(t){this.m_buffer.shaderBuilder=null,this.m_buffer.setVtxShaderCode(t)}addUniformDataAt(t,e){null!=e&&(null==this.m_uniformData&&(this.m_uniformData=new r.default,this.m_uniformData.uniformNameList=[],this.m_uniformData.dataList=[]),this.m_uniformData.uniformNameList.push(t),this.m_uniformData.dataList.push(e))}getCodeBuf(){return this.m_buffer}createSelfUniformData(){return this.m_uniformData}destroy(){this.m_shaderBuilder=null}}e.default=h},1440:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(t,e){this.m_rcuid=0,this.uProbe=null,this.pixelRatio=1,this.stageWidth=800,this.stageHeight=600,this.stageHalfWidth=400,this.stageHalfHeight=300,this.mouseX=0,this.mouseY=0,this.viewWidth=800,this.viewHeight=600,this.mouseViewX=0,this.mouseViewY=0,this.m_viewX=0,this.m_viewY=0,this.m_viewW=1,this.m_viewH=1,this.m_preStageWidth=0,this.m_preStageHeight=0,this.m_autoSynViewAndStageSize=!0,this.m_rcuid=t,null==s.s_document&&(s.s_document=e)}getRCUid(){return this.m_rcuid}getDevicePixelRatio(){return window.devicePixelRatio}getViewX(){return this.m_viewX}getViewY(){return this.m_viewY}getViewWidth(){return this.m_viewW}getViewHeight(){return this.m_viewH}setViewPort(t,e,i,s){this.m_autoSynViewAndStageSize=!1,this.m_viewX=t,this.m_viewY=e,i==this.m_viewW&&s==this.m_viewH||(this.m_viewW=i,this.m_viewH=s,this.updateViewUData())}updateViewUData(){this.uProbe.setVec4Data(2/this.stageWidth,2/this.stageHeight,this.stageWidth,this.stageHeight),this.uProbe.update(),this.m_preStageWidth=this.m_viewW,this.m_preStageHeight=this.m_viewH}update(){this.m_preStageWidth==this.stageWidth&&this.m_preStageHeight==this.stageHeight||(this.m_autoSynViewAndStageSize&&(this.m_viewW=this.stageWidth,this.m_viewH=this.stageHeight,this.updateViewUData()),this.stageHalfWidth=.5*this.stageWidth,this.stageHalfHeight=.5*this.stageHeight)}mouseDown(t=1){}mouseUp(t=1){}mouseClick(){}mouseDoubleClick(){}mouseRightDown(t=1){}mouseRightUp(t=1){}mouseMiddleDown(t=1){}mouseMiddleUp(t=1){}mouseBgDown(){}mouseBgUp(){}mouseBgClick(){}mouseBgRightDown(){}mouseBgRightUp(){}mouseBgMiddleDown(){}mouseBgMiddleUp(){}mouseRightClick(){}mouseMove(){}mouseWheel(t){}mouseCancel(){}mouseMultiDown(t){}mouseMultiUp(t){}mouseMultiMove(t){}mouseWindowUp(t=1){}mouseWindowRightUp(t=1){}enterFrame(){}addEventListener(t,e,i,s=!0,a=!0){}removeEventListener(t,e,i){}}s.s_document=null,e.default=s},"18c7":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s(i("6e01")),r=s(i("8e17")),n=i("cc7a"),l=s(i("abdb"));class h{constructor(t=null,e=0){this.m_uid=-1,this._mvx=new r.default,this._mvy=new r.default,this._mvz=new r.default,this.m_index=0,this.m_fs32=null,this.m_localFS32=null,this.m_index=e,null!=t?(this.m_uid=h.s_uid++,this.m_fs32=t,this.m_localFS32=this.m_fs32.subarray(e,e+16)):(this.m_uid=h.s_isolatedUid++,this.m_fs32=new Float32Array(16),this.m_fs32.set(h.s_InitData,0),this.m_localFS32=this.m_fs32)}setData(t){16==t.length&&this.m_localFS32.set(t)}getCapacity(){return 16}GetMaxUid(){return h.s_uid}getUid(){return this.m_uid}getLocalFS32(){return this.m_localFS32}getFS32(){return this.m_fs32}getFSIndex(){return this.m_index}identity(){this.m_localFS32.set(h.s_InitData,0)}determinant(){let t=this.m_localFS32;return(t[0]*t[5]-t[4]*t[1])*(t[10]*t[15]-t[14]*t[11])-(t[0]*t[9]-t[8]*t[1])*(t[6]*t[15]-t[14]*t[7])+(t[0]*t[13]-t[12]*t[1])*(t[6]*t[11]-t[10]*t[7])+(t[4]*t[9]-t[8]*t[5])*(t[2]*t[15]-t[14]*t[3])-(t[4]*t[13]-t[12]*t[5])*(t[2]*t[11]-t[10]*t[3])+(t[8]*t[13]-t[12]*t[9])*(t[2]*t[7]-t[6]*t[3])}multiplyMatrices(t,e){const i=t.getLocalFS32(),s=e.getLocalFS32(),a=this.getLocalFS32(),r=i[0],n=i[4],l=i[8],h=i[12],_=i[1],o=i[5],u=i[9],m=i[13],d=i[2],c=i[6],f=i[10],p=i[14],g=i[3],x=i[7],y=i[11],T=i[15],S=s[0],A=s[4],E=s[8],b=s[12],v=s[1],D=s[5],M=s[9],R=s[13],F=s[2],P=s[6],L=s[10],B=s[14],N=s[3],V=s[7],C=s[11],w=s[15];return a[0]=r*S+n*v+l*F+h*N,a[4]=r*A+n*D+l*P+h*V,a[8]=r*E+n*M+l*L+h*C,a[12]=r*b+n*R+l*B+h*w,a[1]=_*S+o*v+u*F+m*N,a[5]=_*A+o*D+u*P+m*V,a[9]=_*E+o*M+u*L+m*C,a[13]=_*b+o*R+u*B+m*w,a[2]=d*S+c*v+f*F+p*N,a[6]=d*A+c*D+f*P+p*V,a[10]=d*E+c*M+f*L+p*C,a[14]=d*b+c*R+f*B+p*w,a[3]=g*S+x*v+y*F+T*N,a[7]=g*A+x*D+y*P+T*V,a[11]=g*E+x*M+y*L+T*C,a[15]=g*b+x*R+y*B+T*w,this}multiply(t,e=null){return null!=t&&null!=e?this.multiplyMatrices(t,e):null!=t?this.multiplyMatrices(this,t):this}premultiply(t){return t!=this&&null!=t?this.multiplyMatrices(t,this):this}append(t){let e=t.getLocalFS32(),i=this.m_localFS32,s=i[0],a=i[4],r=i[8],n=i[12],l=i[1],h=i[5],_=i[9],o=i[13],u=i[2],m=i[6],d=i[10],c=i[14],f=i[3],p=i[7],g=i[11],x=i[15],y=e[0],T=e[4],S=e[8],A=e[12],E=e[1],b=e[5],v=e[9],D=e[13],M=e[2],R=e[6],F=e[10],P=e[14],L=e[3],B=e[7],N=e[11],V=e[15];i[0]=s*y+l*T+u*S+f*A,i[1]=s*E+l*b+u*v+f*D,i[2]=s*M+l*R+u*F+f*P,i[3]=s*L+l*B+u*N+f*V,i[4]=a*y+h*T+m*S+p*A,i[5]=a*E+h*b+m*v+p*D,i[6]=a*M+h*R+m*F+p*P,i[7]=a*L+h*B+m*N+p*V,i[8]=r*y+_*T+d*S+g*A,i[9]=r*E+_*b+d*v+g*D,i[10]=r*M+_*R+d*F+g*P,i[11]=r*L+_*B+d*N+g*V,i[12]=n*y+o*T+c*S+x*A,i[13]=n*E+o*b+c*v+x*D,i[14]=n*M+o*R+c*F+x*P,i[15]=n*L+o*B+c*N+x*V}append3x3(t){let e=t.getLocalFS32(),i=this.m_localFS32,s=i[0],a=i[4],r=i[8],n=i[1],l=i[5],h=i[9],_=i[2],o=i[6],u=i[10],m=e[0],d=e[4],c=e[8],f=e[1],p=e[5],g=e[9],x=e[2],y=e[6],T=e[10];i[0]=s*m+n*d+_*c,i[1]=s*f+n*p+_*g,i[2]=s*x+n*y+_*T,i[4]=a*m+l*d+o*c,i[5]=a*f+l*p+o*g,i[6]=a*x+l*y+o*T,i[8]=r*m+h*d+u*c,i[9]=r*f+h*p+u*g,i[10]=r*x+h*y+u*T}appendRotationPivot(t,e,i=null){null==i&&(i=r.default.Z_AXIS),h.s_tMat4.identity(),h.s_tMat4.getAxisRotation(e.x,e.y,e.z,t),h.s_tMat4.appendTranslationXYZ(i.x,i.y,i.z),this.append(h.s_tMat4)}appendRotation(t,e){h.s_tMat4.identity(),h.s_tMat4.getAxisRotation(e.x,e.y,e.z,t),this.append(h.s_tMat4)}appendRotationX(t){h.s_tMat4.rotationX(t),this.append3x3(h.s_tMat4)}appendRotationY(t){h.s_tMat4.rotationY(t),this.append3x3(h.s_tMat4)}appendRotationZ(t){h.s_tMat4.rotationZ(t),this.append3x3(h.s_tMat4)}appendRotationEulerAngle(t,e,i){h.s_tMat4.rotationY(e),this.append3x3(h.s_tMat4),h.s_tMat4.rotationX(t),this.append3x3(h.s_tMat4),h.s_tMat4.rotationZ(i),this.append3x3(h.s_tMat4)}setScale(t){let e=this.m_localFS32;return e[0]=t.x,e[5]=t.y,e[10]=t.z,this}setScaleXYZ(t,e,i){let s=this.m_localFS32;s[0]=t,s[5]=e,s[10]=i}getScale(t){let e=this.m_localFS32;t.x=e[0],t.y=e[5],t.z=e[10]}setRotationEulerAngle(t,e,i){let s=this.m_localFS32,a=Math.cos(t),r=Math.sin(t),n=Math.cos(e),l=Math.sin(e),h=Math.cos(i),_=Math.sin(i),o=h*l,u=_*l,m=n*s[0],d=r*s[5],c=a*s[5],f=a*s[10],p=r*s[10];s[1]=_*m,s[2]=-l*s[0],s[0]=h*m,s[4]=o*d-_*c,s[8]=o*f+_*p,s[5]=u*d+h*c,s[9]=u*f-h*p,s[6]=n*d,s[10]=n*f}setRotationEulerAngle2(t,e,i,s,a,r){let n=this.m_localFS32,l=a*s,h=r*s,_=i*n[0],o=e*n[5],u=t*n[5],m=t*n[10],d=e*n[10];n[1]=r*_,n[2]=-s*n[0],n[0]=a*_,n[4]=l*o-r*u,n[8]=l*m+r*d,n[5]=h*o+a*u,n[9]=h*m-a*d,n[6]=i*o,n[10]=i*m}compose(t,e,i){const s=this.m_localFS32,a=e.x,r=e.y,n=e.z,l=e.w,h=a+a,_=r+r,o=n+n,u=a*h,m=a*_,d=a*o,c=r*_,f=r*o,p=n*o,g=l*h,x=l*_,y=l*o,T=i.x,S=i.y,A=i.z;return s[0]=(1-(c+p))*T,s[1]=(m+y)*T,s[2]=(d-x)*T,s[3]=0,s[4]=(m-y)*S,s[5]=(1-(u+p))*S,s[6]=(f+g)*S,s[7]=0,s[8]=(d+x)*A,s[9]=(f-g)*A,s[10]=(1-(u+c))*A,s[11]=0,s[12]=t.x,s[13]=t.y,s[14]=t.z,s[15]=1,this}makeRotationFromQuaternion(t){return this.compose(r.default.ZERO,t,r.default.ONE)}makeRotationFromEuler(t){const e=this.m_localFS32,i=t.x,s=t.y,a=t.z,r=Math.cos(i),l=Math.sin(i),h=Math.cos(s),_=Math.sin(s),o=Math.cos(a),u=Math.sin(a);if(t.order===n.EulerOrder.XYZ){const t=r*o,i=r*u,s=l*o,a=l*u;e[0]=h*o,e[4]=-h*u,e[8]=_,e[1]=i+s*_,e[5]=t-a*_,e[9]=-l*h,e[2]=a-t*_,e[6]=s+i*_,e[10]=r*h}else if(t.order===n.EulerOrder.YXZ){const t=h*o,i=h*u,s=_*o,a=_*u;e[0]=t+a*l,e[4]=s*l-i,e[8]=r*_,e[1]=r*u,e[5]=r*o,e[9]=-l,e[2]=i*l-s,e[6]=a+t*l,e[10]=r*h}else if(t.order===n.EulerOrder.ZXY){const t=h*o,i=h*u,s=_*o,a=_*u;e[0]=t-a*l,e[4]=-r*u,e[8]=s+i*l,e[1]=i+s*l,e[5]=r*o,e[9]=a-t*l,e[2]=-r*_,e[6]=l,e[10]=r*h}else if(t.order===n.EulerOrder.ZYX){const t=r*o,i=r*u,s=l*o,a=l*u;e[0]=h*o,e[4]=s*_-i,e[8]=t*_+a,e[1]=h*u,e[5]=a*_+t,e[9]=i*_-s,e[2]=-_,e[6]=l*h,e[10]=r*h}else if(t.order===n.EulerOrder.YZX){const t=r*h,i=r*_,s=l*h,a=l*_;e[0]=h*o,e[4]=a-t*u,e[8]=s*u+i,e[1]=u,e[5]=r*o,e[9]=-l*o,e[2]=-_*o,e[6]=i*u+s,e[10]=t-a*u}else if(t.order===n.EulerOrder.XZY){const t=r*h,i=r*_,s=l*h,a=l*_;e[0]=h*o,e[4]=-u,e[8]=_*o,e[1]=t*u+a,e[5]=r*o,e[9]=i*u-s,e[2]=s*u-i,e[6]=l*o,e[10]=a*u+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}extractRotation(t){const e=this.m_localFS32,i=t.getLocalFS32(),s=h.m_v3;t.copyColumnTo(0,s);const a=1/s.getLength();t.copyColumnTo(1,s);const r=1/s.getLength();t.copyColumnTo(2,s);const n=1/s.getLength();return e[0]=i[0]*a,e[1]=i[1]*a,e[2]=i[2]*a,e[3]=0,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=0,e[8]=i[8]*n,e[9]=i[9]*n,e[10]=i[10]*n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}copyTranslation(t){const e=this.m_localFS32,i=t.getLocalFS32();return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setTranslationXYZ(t,e,i){this.m_localFS32[12]=t,this.m_localFS32[13]=e,this.m_localFS32[14]=i}setTranslation(t){this.m_localFS32[12]=t.x,this.m_localFS32[13]=t.y,this.m_localFS32[14]=t.z}appendScaleXYZ(t,e,i){const s=this.m_localFS32;s[0]*=t,s[1]*=t,s[2]*=t,s[3]*=t,s[4]*=e,s[5]*=e,s[6]*=e,s[7]*=e,s[8]*=i,s[9]*=i,s[10]*=i,s[11]*=i}appendScaleXY(t,e){const i=this.m_localFS32;i[0]*=t,i[1]*=t,i[2]*=t,i[3]*=t,i[4]*=e,i[5]*=e,i[6]*=e,i[7]*=e}appendTranslationXYZ(t,e,i){this.m_localFS32[12]+=t,this.m_localFS32[13]+=e,this.m_localFS32[14]+=i}appendTranslation(t){this.m_localFS32[12]+=t.x,this.m_localFS32[13]+=t.y,this.m_localFS32[14]+=t.z}copyColumnFrom(t,e){const i=this.m_localFS32;switch(t){case 0:i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w;break;case 1:i[4]=e.x,i[5]=e.y,i[6]=e.z,i[7]=e.w;break;case 2:i[8]=e.x,i[9]=e.y,i[10]=e.z,i[11]=e.w;break;case 3:i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=e.w;break;default:break}}copyColumnTo(t,e){const i=this.m_localFS32;t<<=2,e.x=i[t],e.y=i[1+t],e.z=i[2+t],e.w=i[3+t]}setF32ArrAndIndex(t,e=0){null!=t&&e>=0&&(this.m_fs32=t,this.m_index=e,this.m_localFS32=this.m_fs32.subarray(e,e+16))}setF32ArrIndex(t=0){t>=0&&(this.m_index=t,this.m_localFS32=this.m_fs32.subarray(t,t+16))}setF32Arr(t){null!=t&&(this.m_fs32=t)}copyFromF32Arr(t,e=0){let i=0;for(let s=e+16;e<s;e++)this.m_localFS32[i]=t[e],++i}copyToF32Arr(t,e=0){t.set(this.m_localFS32,e)}copy(t){return this.m_localFS32.set(t.getLocalFS32(),0),this}copyFrom(t){this.m_localFS32.set(t.getLocalFS32(),0)}copyTo(t){t.getLocalFS32().set(this.getLocalFS32(),0)}copyRawDataFrom(t,e=16,i=0,s=!1){s&&this.transpose(),e-=i;let a=0;while(a<e)this.m_fs32[this.m_index+a]=t[a+i],++a;s&&this.transpose()}copyRawDataTo(t,e=16,i=0,s=!1){s&&this.transpose();let a=0;while(a<e)t[a+i]=this.m_fs32[this.m_index+a],++a;s&&this.transpose()}copyRowFrom(t,e){const i=this.m_localFS32;switch(t){case 0:i[0]=e.x,i[4]=e.y,i[8]=e.z,i[12]=e.w;break;case 1:i[1]=e.x,i[5]=e.y,i[9]=e.z,i[13]=e.w;break;case 2:i[2]=e.x,i[6]=e.y,i[10]=e.z,i[14]=e.w;break;case 3:i[3]=e.x,i[7]=e.y,i[11]=e.z,i[15]=e.w;break;default:break}}copyRowTo(t,e){const i=this.m_localFS32;e.x=i[t],e.y=i[4+t],e.z=i[8+t],e.w=i[12+t]}decompose(t){let e=[],i=h.s_tMat4,s=i.getLocalFS32();i.copyFrom(this);let n=new r.default(s[12],s[13],s[14]),_=new r.default;_.x=Math.sqrt(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]),_.y=Math.sqrt(s[4]*s[4]+s[5]*s[5]+s[6]*s[6]),_.z=Math.sqrt(s[8]*s[8]+s[9]*s[9]+s[10]*s[10]),s[0]*(s[5]*s[10]-s[6]*s[9])-s[1]*(s[4]*s[10]-s[6]*s[8])+s[2]*(s[4]*s[9]-s[5]*s[8])<0&&(_.z=-_.z),s[0]/=_.x,s[1]/=_.x,s[2]/=_.x,s[4]/=_.y,s[5]/=_.y,s[6]/=_.y,s[8]/=_.z,s[9]/=_.z,s[10]/=_.z;let o=new r.default;switch(t){case l.default.AXIS_ANGLE:{o.w=a.default.SafeACos((s[0]+s[5]+s[10]-1)/2);let t=Math.sqrt((s[6]-s[9])*(s[6]-s[9])+(s[8]-s[2])*(s[8]-s[2])+(s[1]-s[4])*(s[1]-s[4]));t>a.default.MATH_MIN_POSITIVE?(o.x=(s[6]-s[9])/t,o.y=(s[8]-s[2])/t,o.z=(s[1]-s[4])/t):o.x=o.y=o.z=0}break;case l.default.QUATERNION:{let t=s[0]+s[5]+s[10];t>0?(o.w=Math.sqrt(1+t)/2,o.x=(s[6]-s[9])/(4*o.w),o.y=(s[8]-s[2])/(4*o.w),o.z=(s[1]-s[4])/(4*o.w)):s[0]>s[5]&&s[0]>s[10]?(o.x=Math.sqrt(1+s[0]-s[5]-s[10])/2,o.w=(s[6]-s[9])/(4*o.x),o.y=(s[1]+s[4])/(4*o.x),o.z=(s[8]+s[2])/(4*o.x)):s[5]>s[10]?(o.y=Math.sqrt(1+s[5]-s[0]-s[10])/2,o.x=(s[1]+s[4])/(4*o.y),o.w=(s[8]-s[2])/(4*o.y),o.z=(s[6]+s[9])/(4*o.y)):(o.z=Math.sqrt(1+s[10]-s[0]-s[5])/2,o.x=(s[8]+s[2])/(4*o.z),o.y=(s[6]+s[9])/(4*o.z),o.w=(s[1]-s[4])/(4*o.z))}break;case l.default.EULER_ANGLES:o.y=Math.asin(-s[2]),1!=s[2]&&-1!=s[2]?(o.x=Math.atan2(s[6],s[10]),o.z=Math.atan2(s[1],s[0])):(o.z=0,o.x=Math.atan2(s[4],s[5]));break;default:break}return e.push(n),e.push(o),e.push(_),i=null,e}invert(){let t=this.determinant(),e=Math.abs(t)>a.default.MATH_MIN_POSITIVE;if(e){let e=this.m_localFS32;t=1/t;let i=e[0],s=e[4],a=e[8],r=e[12],n=e[1],l=e[5],h=e[9],_=e[13],o=e[2],u=e[6],m=e[10],d=e[14],c=e[3],f=e[7],p=e[11],g=e[15];e[0]=t*(l*(m*g-d*p)-h*(u*g-d*f)+_*(u*p-m*f)),e[1]=-t*(n*(m*g-d*p)-h*(o*g-d*c)+_*(o*p-m*c)),e[2]=t*(n*(u*g-d*f)-l*(o*g-d*c)+_*(o*f-u*c)),e[3]=-t*(n*(u*p-m*f)-l*(o*p-m*c)+h*(o*f-u*c)),e[4]=-t*(s*(m*g-d*p)-a*(u*g-d*f)+r*(u*p-m*f)),e[5]=t*(i*(m*g-d*p)-a*(o*g-d*c)+r*(o*p-m*c)),e[6]=-t*(i*(u*g-d*f)-s*(o*g-d*c)+r*(o*f-u*c)),e[7]=t*(i*(u*p-m*f)-s*(o*p-m*c)+a*(o*f-u*c)),e[8]=t*(s*(h*g-_*p)-a*(l*g-_*f)+r*(l*p-h*f)),e[9]=-t*(i*(h*g-_*p)-a*(n*g-_*c)+r*(n*p-h*c)),e[10]=t*(i*(l*g-_*f)-s*(n*g-_*c)+r*(n*f-l*c)),e[11]=-t*(i*(l*p-h*f)-s*(n*p-h*c)+a*(n*f-l*c)),e[12]=-t*(s*(h*d-_*m)-a*(l*d-_*u)+r*(l*m-h*u)),e[13]=t*(i*(h*d-_*m)-a*(n*d-_*o)+r*(n*m-h*o)),e[14]=-t*(i*(l*d-_*u)-s*(n*d-_*o)+r*(n*u-l*o)),e[15]=t*(i*(l*m-h*u)-s*(n*m-h*o)+a*(n*u-l*o))}return e}invertThis(){return this.invert(),this}pointAt(t,e,i){null==e&&(e=new r.default(0,0,-1)),null==i&&(i=new r.default(0,-1,0));let s=e.subtract(t),n=i.clone();s.normalize(),n.normalize();let l=s.clone().scaleBy(n.dot(s));n.subtractBy(l),n.getLength()>a.default.MATH_MIN_POSITIVE?n.normalize():0!=s.x?n.setTo(-s.y,s.x,0):n.setTo(1,0,0);let h=n.crossProduct(s);h.normalize();let _=this.m_localFS32;_[0]=h.x,_[4]=h.y,_[8]=h.z,_[12]=0,_[1]=n.x,_[5]=n.y,_[9]=n.z,_[13]=0,_[2]=s.x,_[6]=s.y,_[10]=s.z,_[14]=0,_[3]=t.x,_[7]=t.y,_[11]=t.z,_[15]=1}prepend(t){let e=t.getLocalFS32(),i=this.m_localFS32,s=e[0],a=e[4],r=e[8],n=e[12],l=e[1],h=e[5],_=e[9],o=e[13],u=e[2],m=e[6],d=e[10],c=e[14],f=e[3],p=e[7],g=e[11],x=e[15],y=i[0],T=i[4],S=i[8],A=i[12],E=i[1],b=i[5],v=i[9],D=i[13],M=i[2],R=i[6],F=i[10],P=i[14],L=i[3],B=i[7],N=i[11],V=i[15];i[0]=s*y+l*T+u*S+f*A,i[1]=s*E+l*b+u*v+f*D,i[2]=s*M+l*R+u*F+f*P,i[3]=s*L+l*B+u*N+f*V,i[4]=a*y+h*T+m*S+p*A,i[5]=a*E+h*b+m*v+p*D,i[6]=a*M+h*R+m*F+p*P,i[7]=a*L+h*B+m*N+p*V,i[8]=r*y+_*T+d*S+g*A,i[9]=r*E+_*b+d*v+g*D,i[10]=r*M+_*R+d*F+g*P,i[11]=r*L+_*B+d*N+g*V,i[12]=n*y+o*T+c*S+x*A,i[13]=n*E+o*b+c*v+x*D,i[14]=n*M+o*R+c*F+x*P,i[15]=n*L+o*B+c*N+x*V}prepend3x3(t){let e=t.getLocalFS32(),i=this.m_localFS32,s=e[0],a=e[4],r=e[8],n=e[1],l=e[5],h=e[9],_=e[2],o=e[6],u=e[10],m=i[0],d=i[4],c=i[8],f=i[1],p=i[5],g=i[9],x=i[2],y=i[6],T=i[10];i[0]=s*m+n*d+_*c,i[1]=s*f+n*p+_*g,i[2]=s*x+n*y+_*T,i[4]=a*m+l*d+o*c,i[5]=a*f+l*p+o*g,i[6]=a*x+l*y+o*T,i[8]=r*m+h*d+u*c,i[9]=r*f+h*p+u*g,i[10]=r*x+h*y+u*T}prependRotationPivot(t,e,i){h.s_tMat4.identity(),h.s_tMat4.getAxisRotation(e.x,e.y,e.z,t),h.s_tMat4.appendTranslationXYZ(i.x,i.y,i.z),this.prepend(h.s_tMat4)}prependRotation(t,e){h.s_tMat4.identity(),h.s_tMat4.getAxisRotation(e.x,e.y,e.z,t),this.prepend(h.s_tMat4)}prependRotationX(t){h.s_tMat4.rotationX(t),this.prepend3x3(h.s_tMat4)}prependRotationY(t){h.s_tMat4.rotationY(t),this.prepend3x3(h.s_tMat4)}prependRotationZ(t){h.s_tMat4.rotationZ(t),this.prepend3x3(h.s_tMat4)}prependRotationEulerAngle(t,e,i){h.s_tMat4.rotationY(e),this.prepend3x3(h.s_tMat4),h.s_tMat4.rotationX(t),this.prepend3x3(h.s_tMat4),h.s_tMat4.rotationZ(i),this.prepend3x3(h.s_tMat4)}prependScale(t,e,i){const s=this.m_localFS32;s[0]*=t,s[1]*=e,s[2]*=i,s[4]*=t,s[5]*=e,s[6]*=i,s[8]*=t,s[9]*=e,s[10]*=i,s[12]*=t,s[13]*=e,s[14]*=i}prependScaleXY(t,e){const i=this.m_localFS32;i[0]*=t,i[1]*=e,i[4]*=t,i[5]*=e,i[8]*=t,i[9]*=e,i[12]*=t,i[13]*=e}prependTranslationXYZ(t,e,i){h.s_tMat4.identity(),this.prepend(h.s_tMat4)}prependTranslation(t){h.s_tMat4.identity(),this.prepend(h.s_tMat4)}recompose(t,e){if(t.length<3||0==t[2].x||0==t[2].y||0==t[2].z)return!1;this.identity();let i=h.s_tMat4.getFS32();i[0]=i[1]=i[2]=t[2].x,i[4]=i[5]=i[6]=t[2].y,i[8]=i[9]=i[10]=t[2].z;let s=this.m_localFS32;switch(e){case l.default.EULER_ANGLES:{let e=Math.cos(t[1].x),a=Math.cos(t[1].y),r=Math.cos(t[1].z),n=Math.sin(t[1].x),l=Math.sin(t[1].y),h=Math.sin(t[1].z);s[0]=a*r*i[0],s[1]=a*h*i[1],s[2]=-l*i[2],s[3]=0,s[4]=(n*l*r-e*h)*i[4],s[5]=(n*l*h+e*r)*i[5],s[6]=n*a*i[6],s[7]=0,s[8]=(e*l*r+n*h)*i[8],s[9]=(e*l*h-n*r)*i[9],s[10]=e*a*i[10],s[11]=0,s[12]=t[0].x,s[13]=t[0].y,s[14]=t[0].z,s[15]=1}break;default:{let a=t[1].x,r=t[1].y,n=t[1].z,h=t[1].w;if(e==l.default.AXIS_ANGLE){let t=.5*h;a*=Math.sin(t),r*=Math.sin(t),n*=Math.sin(t),h=Math.cos(t)}s[0]=(1-2*r*r-2*n*n)*i[0],s[1]=(2*a*r+2*h*n)*i[1],s[2]=(2*a*n-2*h*r)*i[2],s[3]=0,s[4]=(2*a*r-2*h*n)*i[4],s[5]=(1-2*a*a-2*n*n)*i[5],s[6]=(2*r*n+2*h*a)*i[6],s[7]=0,s[8]=(2*a*n+2*h*r)*i[8],s[9]=(2*r*n-2*h*a)*i[9],s[10]=(1-2*a*a-2*r*r)*i[10],s[11]=0,s[12]=t[0].x,s[13]=t[0].y,s[14]=t[0].z,s[15]=1}break}return 0==t[2].x&&(this.m_localFS32[0]=0),0==t[2].y&&(this.m_localFS32[5]=0),0==t[2].z&&(this.m_localFS32[10]=0),i=null,!0}setThreeAxes(t,e,i){let s=this.m_localFS32;s[0]=t.x,s[1]=t.y,s[2]=t.z,s[4]=e.x,s[5]=e.y,s[6]=e.z,s[8]=i.x,s[9]=i.y,s[10]=i.z}deltaTransformVector(t){let e=t.x,i=t.y,s=t.z;return new r.default(e*this.m_localFS32[0]+i*this.m_localFS32[4]+s*this.m_localFS32[8],e*this.m_localFS32[1]+i*this.m_localFS32[5]+s*this.m_localFS32[9],e*this.m_localFS32[2]+i*this.m_localFS32[6]+s*this.m_localFS32[10],0)}deltaTransformVectorSelf(t){let e=this.m_localFS32,i=t.x,s=t.y,a=t.z;t.x=i*e[0]+s*e[4]+a*e[8],t.y=i*e[1]+s*e[5]+a*e[9],t.z=i*e[2]+s*e[6]+a*e[10]}deltaTransformOutVector(t,e){let i=this.m_localFS32;e.x=t.x*i[0]+t.y*i[4]+t.z*i[8],e.y=t.x*i[1]+t.y*i[5]+t.z*i[9],e.z=t.x*i[2]+t.y*i[6]+t.z*i[10]}transformVector(t){let e=this.m_localFS32,i=t.x,s=t.y,a=t.z;return new r.default(i*e[0]+s*e[4]+a*e[8]+e[12],i*e[1]+s*e[5]+a*e[9]+e[13],i*e[2]+s*e[6]+a*e[10]+e[14],i*e[3]+s*e[7]+a*e[11]+e[15])}transformOutVector(t,e){let i=t.x,s=t.y,a=t.z,r=this.m_localFS32;e.setTo(i*r[0]+s*r[4]+a*r[8]+r[12],i*r[1]+s*r[5]+a*r[9]+r[13],i*r[2]+s*r[6]+a*r[10]+r[14],i*r[3]+s*r[7]+a*r[11]+r[15])}transformOutVector3(t,e){let i=this.m_localFS32;e.x=t.x*i[0]+t.y*i[4]+t.z*i[8]+i[12],e.y=t.x*i[1]+t.y*i[5]+t.z*i[9]+i[13],e.z=t.x*i[2]+t.y*i[6]+t.z*i[10]+i[14]}transformVector3Self(t){let e=t.x,i=t.y,s=t.z,a=this.m_localFS32;t.x=e*a[0]+i*a[4]+s*a[8]+a[12],t.y=e*a[1]+i*a[5]+s*a[9]+a[13],t.z=e*a[2]+i*a[6]+s*a[10]+a[14]}transformVectorSelf(t){let e=t.x,i=t.y,s=t.z,a=this.m_localFS32;t.setTo(e*a[0]+i*a[4]+s*a[8]+a[12],e*a[1]+i*a[5]+s*a[9]+a[13],e*a[2]+i*a[6]+s*a[10]+a[14],e*a[3]+i*a[7]+s*a[11]+a[15])}transformVectors(t,e,i){let s,a,r,n=0,l=this.m_localFS32;e-=3;while(n<=e)s=t[n],a=t[n+1],r=t[n+2],i[n]=s*l[0]+a*l[4]+r*l[8]+l[12],i[n+1]=s*l[1]+a*l[5]+r*l[9]+l[13],i[n+2]=s*l[2]+a*l[6]+r*l[10]+l[14],n+=3}transformVectorsSelf(t,e){let i,s,a,r=0,n=this.m_localFS32;e-=3;while(r<=e)i=t[r],s=t[r+1],a=t[r+2],t[r]=i*n[0]+s*n[4]+a*n[8]+n[12],t[r+1]=i*n[1]+s*n[5]+a*n[9]+n[13],t[r+2]=i*n[2]+s*n[6]+a*n[10]+n[14],r+=3}transformVectorsRangeSelf(t,e,i){let s,a,r,n=e,l=this.m_localFS32;i-=3;while(n<=i)s=t[n],a=t[n+1],r=t[n+2],t[n]=s*l[0]+a*l[4]+r*l[8]+l[12],t[n+1]=s*l[1]+a*l[5]+r*l[9]+l[13],t[n+2]=s*l[2]+a*l[6]+r*l[10]+l[14],n+=3}transpose(){h.s_tMat4.copyFrom(this);let t=h.s_tMat4.getFS32(),e=this.m_localFS32;e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11]}interpolateTo(t,e){let i=t.getFS32(),s=t.getFSIndex(),a=0,r=this.m_index;while(a<16)this.m_fs32[r]+=(i[s+a]-this.m_fs32[r])*e,++r,++a}getAxisRotation(t,e,i,s){s=-s;let a=this.m_localFS32,r=Math.sin(s),n=Math.cos(s),l=1-n;a[0]=n+t*t*l,a[5]=n+e*e*l,a[10]=n+i*i*l;let h=t*e*l,_=i*r;a[4]=h+_,a[1]=h-_,h=t*i*l,_=e*r,a[8]=h-_,a[2]=h+_,h=e*i*l,_=t*r,a[9]=h+_,a[6]=h-_}rotationX(t){let e=Math.sin(t),i=Math.cos(t);this.m_localFS32[0]=1,this.m_localFS32[1]=0,this.m_localFS32[2]=0,this.m_localFS32[4]=0,this.m_localFS32[5]=i,this.m_localFS32[6]=e,this.m_localFS32[8]=0,this.m_localFS32[9]=-e,this.m_localFS32[10]=i}rotationY(t){let e=Math.sin(t),i=Math.cos(t);this.m_localFS32[0]=i,this.m_localFS32[1]=0,this.m_localFS32[2]=-e,this.m_localFS32[4]=0,this.m_localFS32[5]=1,this.m_localFS32[6]=0,this.m_localFS32[8]=e,this.m_localFS32[9]=0,this.m_localFS32[10]=i}rotationZ(t){let e=Math.sin(t),i=Math.cos(t);this.m_localFS32[0]=i,this.m_localFS32[1]=e,this.m_localFS32[2]=0,this.m_localFS32[4]=-e,this.m_localFS32[5]=i,this.m_localFS32[6]=0,this.m_localFS32[8]=0,this.m_localFS32[9]=0,this.m_localFS32[10]=1}toString(){let t="\n"+this.m_localFS32[0]+","+this.m_localFS32[1]+","+this.m_localFS32[2]+","+this.m_localFS32[3]+"\n";return t+=this.m_localFS32[4]+","+this.m_localFS32[5]+","+this.m_localFS32[6]+","+this.m_localFS32[7]+"\n",t+=this.m_localFS32[8]+","+this.m_localFS32[9]+","+this.m_localFS32[10]+","+this.m_localFS32[11]+"\n",t+=this.m_localFS32[12]+","+this.m_localFS32[13]+","+this.m_localFS32[14]+","+this.m_localFS32[15]+"\n",t}transformPerspV4Self(t){const e=this.m_localFS32;t.w=t.z,t.x*=e[0],t.y*=e[5],t.z*=e[10],t.z+=e[14],t.w*=e[11],t.w+=e[15]}clone(){let t=new h;return t.copyFrom(this),t}perspectiveRH(t,e,i,s){const a=this.m_localFS32;let r=Math.tan(.5*t);this.identity(),a[0]=1/(e*r),a[5]=1/r,a[10]=-(s+i)/(s-i),a[11]=-1,a[14]=-2*s*i/(s-i)}perspectiveRH2(t,e,i,s,a){let r=e/Math.tan(.5*t),n=r/e,l=r/i,h=-a/(a-s),_=-s*h;this.identity();const o=this.m_localFS32;o[0]=n,o[5]=l,o[10]=h,o[11]=-1,o[14]=_}orthoRH(t,e,i,s,a,r){this.identity();const n=this.m_localFS32;n[0]=2/(s-i),n[5]=2/(e-t),n[10]=-2/(r-a),n[12]=-(s+i)/(s-i),n[13]=-(e+t)/(e-t),n[14]=-(r+a)/(r-a),n[15]=1}perspectiveLH(t,e,i,s){let a=Math.tan(.5*t);this.identity();const r=this.m_localFS32;r[0]=1/(e*a),r[5]=1/a,r[10]=(s+i)/(s-i),r[11]=1,r[14]=2*s*i/(s-i)}orthoLH(t,e,i,s,a,r){this.identity();const n=this.m_localFS32;n[0]=2/(s-i),n[5]=2/(e-t),n[10]=2/(r-a),n[12]=-(s+i)/(s-i),n[13]=-(e+t)/(e-t),n[14]=-(r+a)/(r-a),n[15]=1}lookAtRH(t,e,i){this.identity();let s=e.subtract(t);s.normalize();let a=s.crossProduct(i);a.normalize();let r=a.crossProduct(s);a.w=-a.dot(t),r.w=-r.dot(t),s.w=s.dot(t),s.negate(),this.copyRowFrom(0,a),this.copyRowFrom(1,r),this.copyRowFrom(2,s)}lookAtLH(t,e,i){this.identity();let s=e.subtract(t);s.normalize();let a=s.crossProduct(i);a.normalize();let r=a.crossProduct(s);a.w=-a.dot(t),r.w=-r.dot(t),s.w=-s.dot(t),this.copyRowFrom(0,a),this.copyRowFrom(1,r),this.copyRowFrom(2,s)}destroy(){this.m_localFS32=null,this.m_fs32=null,this.m_index=-1}}h.s_InitData=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),h.m_v3=new r.default,h.s_uid=0,h.s_isolatedUid=327679,h.s_tMat4=new h,e.default=h},"1b95":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("0714"),a=i("ee6e"),r=i("6c6b");class n{constructor(){this.m_initFlag=!0}initialize(){this.m_initFlag&&(this.m_initFlag=!1)}createMaterial(t){let e=new r.Material;return e.setDecorator(t),e}createSimpleMaterial(t){let e=new a.SimpleMaterial;return e.setDecorator(t),e}createMaterialPipeline(t){return new s.MaterialPipeline(t)}}e.RenderableMaterialBlock=n},"1d40":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s(i("e7d2")),r=s(i("8a0a")),n=s(i("cb29")),l=s(i("fecb"));class h extends n.default{constructor(t=r.default.VTX_STATIC_DRAW){super(t),this.m_dataList=[],this.m_rayTester=null,this.autoBuilding=!0,this.ivsEnabled=!0,this.aabbEnabled=!0}setRayTester(t){this.m_rayTester=t}reset(){this.m_dataList=[],a.default.Reset()}addFloat32Data(t,e,i=r.default.VTX_STATIC_DRAW){this.m_dataList.push(t),a.default.AddFloat32Data(t,e,i)}setIVS(t){this.m_ivs=t}getVS(){return this.m_dataList[0]}getUVS(){return this.m_dataList.length>1?this.m_dataList[1]:null}getNVS(){return this.m_dataList.length>2?this.m_dataList[2]:null}initialize(){this.getBufSortFormat();const t=this.m_dataList[0];this.m_ivs=this.m_ivs;let e=a.default;if(e.vbWholeDataEnabled=this.vbWholeDataEnabled,this.aabbEnabled&&this.autoBuilding&&this.m_dataList.length>0&&(null==this.bounds&&(this.bounds=new l.default),null!=this.m_transMatrix&&this.m_transMatrix.transformVectorsSelf(t,t.length),this.bounds.addFloat32Arr(t),this.bounds.updateFast()),this.ivsEnabled?(this.vtCount=this.m_ivs.length,this.autoBuilding&&(this.updateWireframeIvs(),this.vtCount=this.m_ivs.length)):this.vtCount=0,a.default.vbWholeDataEnabled=this.vbWholeDataEnabled,null!=this.m_vbuf)e.UpdateBufData(this.m_vbuf);else{let t=this.getBufDataUsage(),i=this.getBufSortFormat();this.vbWholeDataEnabled?this.m_vbuf=e.CreateBySaveData(t,i):this.m_vbuf=e.CreateBySaveDataSeparate(t)}this.ivsEnabled&&this.m_vbuf.setUintIVSData(this.m_ivs),this.buildEnd()}setBufData4fAt(t,e,i,s,a,r){null!=this.m_vbuf&&this.m_vbuf.setData4fAt(t,e,i,s,a,r)}setBufData3fAt(t,e,i,s,a){null!=this.m_vbuf&&this.m_vbuf.setData3fAt(t,e,i,s,a)}setBufData2fAt(t,e,i,s){null!=this.m_vbuf&&this.m_vbuf.setData2fAt(t,e,i,s)}testRay(t,e,i,s){return null!=this.m_rayTester?this.m_rayTester.testRay(t,e,i,s):-1}__$destroy(){null!=this.m_dataList&&(this.m_dataList=[]),null!=this.m_rayTester&&(this.m_rayTester.destroy(),this.m_rayTester=null),super.__$destroy()}}e.default=h},"1eb2":function(t,e,i){"use strict";if("undefined"!==typeof window){var s=window.document.currentScript,a=i("8875");s=a(),"currentScript"in document||Object.defineProperty(document,"currentScript",{get:a});var r=s&&s.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);r&&(i.p=r[1])}},"1f61":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s(i("030e"));class r{static ToGL(t,e){switch(e){case r.UNSIGNED_BYTE:return t.UNSIGNED_BYTE;case r.BYTE:return t.BYTE;case r.FLOAT:return t.FLOAT;case r.HALF_FLOAT:return t.HALF_FLOAT;case r.HALF_FLOAT_OES:return null!=a.default.OES_texture_half_float?a.default.OES_texture_half_float.HALF_FLOAT_OES:t.FLOAT;case r.UNSIGNED_SHORT:return t.UNSIGNED_SHORT;case r.UNSIGNED_INT:return t.UNSIGNED_INT;case r.UNSIGNED_SHORT_5_6_5:return t.UNSIGNED_SHORT_5_6_5;case r.UNSIGNED_SHORT_4_4_4_4:return t.UNSIGNED_SHORT_4_4_4_4;case r.UNSIGNED_SHORT_5_5_5_1:return t.UNSIGNED_SHORT_5_5_5_1;case r.UNSIGNED_INT_24_8_WEBGL:return a.default.WEBGL_depth_texture.UNSIGNED_INT_24_8_WEBGL;default:break}return t.UNSIGNED_BYTE}}r.UNSIGNED_BYTE=1108,r.UNSIGNED_SHORT=1109,r.UNSIGNED_INT=1110,r.BYTE=1111,r.FLOAT=1211,r.HALF_FLOAT=1212,r.HALF_FLOAT_OES=1213,r.UNSIGNED_SHORT_5_6_5=1214,r.UNSIGNED_SHORT_4_4_4_4=1215,r.UNSIGNED_SHORT_5_5_5_1=1216,r.UNSIGNED_INT_24_8_WEBGL=1217,e.default=r},"20ef":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s(i("3b73")),r=s(i("8a0a"));class n{constructor(t){this.m_shdData=null,this.m_uid=-1,this.m_program=null,this.m_rcuid=-1,this.m_gl=null,this.m_shdUniqueName="",this.m_texTotal=0,this.m_aLocations=null,this.m_aLocationIVS=new Array(12),this.m_aLocationTypes=null,this.m_aLocationSizes=null,this.m_uLocations=null,this.m_texLocations=null,this.m_attribLIndexList=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],this.m_attribTypeSizeList=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],this.m_attriSizeList=null,this.m_uniformDict=new Map,this.m_uLocationDict=new Map,this.m_vertShader=null,this.m_fragShader=null,this.dataUniformEnabled=!1,this.m_attrid=0,this.m_attridIndex=0,this.m_uLc=null,this.m_uIndex=0,this.m_uid=t,this.m_aLocationIVS.fill(0)}setShdData(t){this.m_shdData=t,this.m_shdUniqueName=t.getUniqueShaderName()}getUid(){return this.m_uid}getTexTotal(){return this.m_shdData.getTexTotal()}useTexLocation(){for(let t=0;t<this.m_texTotal;t++)this.m_gl.uniform1i(this.m_texLocations[t],t)}haveTexture(){return this.m_shdData.haveTexture()}createLocations(){let t=0,e=0,i=this.m_shdData.getAttriNSList();if(null!=i&&i.length>0&&null==this.m_aLocations){this.dataUniformEnabled=!1;let s=this.m_shdData.getAttriSizeList();this.m_aLocations=[],this.m_aLocationTypes=[],this.m_aLocationSizes=[];const n=this.m_aLocationTypes;e=i.length;let l=0,h=0;while(t<e)h=this.m_gl.getAttribLocation(this.m_program,i[t]),this.m_aLocations.push(h),l=r.default.GetVBufAttributeTypeByNS(i[t]),n.push(l),this.m_aLocationSizes.push(s[t]),this.m_attribLIndexList[l]=h,this.m_attribTypeSizeList[l]=s[t],this.dataUniformEnabled=!0,++t;for(t=0;t<n.length;++t)this.m_aLocationIVS[n[t]]=t;for(this.m_attriSizeList=[],t=0;t<this.m_attribTypeSizeList.length;++t)this.m_attribTypeSizeList[t]>0&&this.m_attriSizeList.push(this.m_attribTypeSizeList[t]);a.default.SHADERCODE_TRACE_ENABLED}if(this.m_shdData.haveCommonUniform()&&null==this.m_uLocations){let i=this.m_shdData.getUniforms();this.m_uLocations=[],e=i.length,t=0;let s=null,r="";while(t<e)i[t].isTex||(r=i[t].name,s=this.m_gl.getUniformLocation(this.m_program,r),a.default.SHADERCODE_TRACE_ENABLED,null!=s?(s.uniformName=r,s.uniqueName=this.m_shdUniqueName,i[t].location=s,this.m_uniformDict.set(r,i[t]),this.m_uLocationDict.set(r,s),this.m_uLocations.push(s),this.dataUniformEnabled=!0):a.default.SHADERCODE_TRACE_ENABLED),++t}if(this.m_texTotal=this.m_shdData.getTexTotal(),this.m_texTotal>0){this.m_texLocations=new Array(this.m_texTotal);let e=this.m_shdData.getTexUniformNames();for(t=0;t<this.m_texTotal;++t)e[t]="u_sampler"+t,this.m_texLocations[t]=this.m_gl.getUniformLocation(this.m_program,e[t])}}getLayoutBit(){return this.m_shdData.getLayoutBit()}getMid(){return this.m_shdData.getMid()}getFragOutputTotal(){return this.m_shdData.getFragOutputTotal()}getLocationsTotal(){return this.m_aLocationTypes.length}getLocationTypeByIndex(t){return this.m_aLocationTypes[t]}getLocationSizeByIndex(t){return this.m_aLocationSizes[t]}getLocationTypes(){return this.m_aLocationTypes}getLocationIVS(){return this.m_aLocationIVS}testVertexAttribPointerOffset(t){let e=!1;if(null!=t&&null!=this.m_attriSizeList&&t.length>=this.m_attriSizeList.length){let i=0,s=0;for(;s<this.m_attriSizeList.length;++s){if(i!=t[s])break;i+=4*this.m_attriSizeList[s]}e=s>=this.m_attriSizeList.length}if(!e)throw Error("Shader program vertx attributes layout can not match float attribute vertex data !!!");return e}vertexAttribPointerType(t,e,i,s,a,r){this.m_attrid=this.m_attribLIndexList[t],this.m_attrid>-1&&(this.m_gl.enableVertexAttribArray(this.m_attrid),this.m_gl.vertexAttribPointer(this.m_attrid,this.m_attribTypeSizeList[t],i,s,a,r))}vertexAttribPointerTypeFloat(t,e,i){this.m_attrid=this.m_attribLIndexList[t],this.m_attrid>-1&&(this.m_gl.enableVertexAttribArray(this.m_attrid),this.m_gl.vertexAttribPointer(this.m_attrid,this.m_attribTypeSizeList[t],this.m_gl.FLOAT,!1,e,i))}testVertexAttribPointerType(t){return this.m_attribLIndexList[t]>-1}getVertexAttribByTpye(t){return this.m_attribLIndexList[t]}vertexAttribPointerAt(t,e,i,s,a,r){this.m_attridIndex=t,this.m_attrid=this.m_aLocations[t],this.m_attrid>-1&&(this.m_gl.enableVertexAttribArray(this.m_attrid),this.m_gl.vertexAttribPointer(this.m_attrid,e,i,s,a,r))}vertexAttribPointerNext(t,e,i,s,a){this.m_attrid=this.m_aLocations[this.m_attridIndex],this.m_attrid>-1&&(this.m_gl.enableVertexAttribArray(this.m_attrid),this.m_gl.vertexAttribPointer(this.m_attrid,t,e,i,s,a)),this.m_attridIndex++}vertexAttribPointerFirst(t,e,i,s,a){this.m_attridIndex=1,this.m_attrid=this.m_aLocations[0],this.m_attrid>-1&&(this.m_gl.enableVertexAttribArray(this.m_attrid),this.m_gl.vertexAttribPointer(this.m_attrid,t,e,i,s,a))}getUniformLocationAt(t){return this.m_uIndex=t+1,this.m_uLocations[t]}getUniformLocationNext(){return this.m_uLc=this.m_uLocations[this.m_uIndex++],this.m_uLc}getUniformLocationFirst(){return this.m_uIndex=1,this.m_uLocations[0]}getUniformLocationByNS(t){return this.m_uLocationDict.get(t)}getUniformTypeNameByNS(t){return this.m_uniformDict.has(t)?this.m_uniformDict.get(t).typeName:""}getUniformTypeByNS(t){return this.m_uniformDict.has(t)?this.m_uniformDict.get(t).type:0}hasUniformByName(t){return this.m_uniformDict.has(t)}getUniformLengthByNS(t){return this.m_uniformDict.has(t)?this.m_uniformDict.get(t).arrLength:0}initShdProgram(){let t,e=this.m_gl,i=this.m_shdData.getVSCodeStr(),s=this.m_shdData.getFSCodeStr();null==this.m_shdData.preCompileInfo&&a.default.VERT_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED&&(i.indexOf(" mediump ")>=0&&(t=new RegExp(" mediump ","g"),i=i.replace(t," highp ")),i.indexOf(" lowp ")>=0&&(t=new RegExp(" lowp ","g"),i=i.replace(t," highp "))),a.default.SHADERCODE_TRACE_ENABLED;let r=this.loadShader(e.VERTEX_SHADER,i);null==this.m_shdData.preCompileInfo&&a.default.FRAG_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED&&(s.indexOf(" mediump ")>=0&&(t=new RegExp(" mediump ","g"),s=s.replace(t," highp ")),s.indexOf(" lowp ")>=0&&(t=new RegExp(" lowp ","g"),s=s.replace(t," highp "))),a.default.SHADERCODE_TRACE_ENABLED;let n=this.loadShader(e.FRAGMENT_SHADER,s),l=e.createProgram();return e.attachShader(l,n),e.attachShader(l,r),e.linkProgram(l),e.getProgramParameter(l,e.LINK_STATUS)?(this.m_vertShader=r,this.m_fragShader=n,e.detachShader(l,r),e.detachShader(l,n),e.deleteShader(r),e.deleteShader(n),l):(a.default.SHADERCODE_TRACE_ENABLED,null)}loadShader(t,e){let i=this.m_gl.createShader(t);return this.m_gl.shaderSource(i,e),this.m_gl.compileShader(i),this.m_gl.getShaderParameter(i,this.m_gl.COMPILE_STATUS)?i:(a.default.SHADERCODE_TRACE_ENABLED,this.m_gl.deleteShader(i),null)}getUniqueShaderName(){return this.m_shdUniqueName}enabled(){return null!=this.m_program}upload(t,e){null==this.m_program&&(this.m_rcuid=e,this.m_gl=t,this.m_program=this.initShdProgram(),this.m_program.uniqueName=this.m_shdUniqueName,null!=this.m_program&&this.createLocations())}getRCUid(){return this.m_rcuid}uniformBlockBinding(t,e){this.m_gl.uniformBlockBinding(this.m_program,this.m_gl.getUniformBlockIndex(this.m_program,t),e)}toString(){return"[ShdProgram(uniqueName = "+this.m_shdUniqueName+")]"}getGPUProgram(){return this.m_program}destroy(){this.m_aLocations=null,this.m_attriSizeList=null,this.m_texTotal>0&&(this.m_texLocations.fill(null),this.m_texTotal=0),null!=this.m_program&&(this.m_gl.deleteShader(this.m_vertShader),this.m_gl.deleteShader(this.m_fragShader),this.m_vertShader=null,this.m_fragShader=null,this.m_gl.deleteProgram(this.m_program),this.m_program=null),this.m_gl=null,this.m_shdData=null}}e.default=n},2139:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s(i("18c7"));class r{static GetMatTotal(){return r.s_mtotal}static GetFS32Arr(){return r.s_mfs32Arr}static SetFS32Arr(t){r.s_mfs32Arr=t;let e=r.s_mtotal,i=r.s_matList;for(let s=0;s<e;++s)i[s].setF32Arr(t)}static GetFreeId(){return r.m_freeIdList.length>0?r.m_freeIdList.pop():-1}static Allocate(t){if(t<1024&&(t=1024),r.s_mtotal<1){r.s_mtotal=t,r.s_mfs32Arr=new Float32Array(16*t);let e=0,i=new a.default(r.s_mfs32Arr,16*e),s=i.getUid();for(r.s_baseUid=s,r.s_maxUid=s+t;e<s;++e)r.s_matList.push(null),r.s_matFlagList.push(r.s_FLAG_FREE);for(r.s_matList.push(i),r.s_matFlagList.push(r.s_FLAG_FREE),r.m_freeIdList.push(i.getUid()),e=1;e<t;++e)i=new a.default(r.s_mfs32Arr,16*e),r.s_matList.push(i),r.s_matFlagList.push(r.s_FLAG_FREE),r.m_freeIdList.push(i.getUid())}}static GetMatrix(){let t=null,e=r.GetFreeId()-r.s_baseUid;return e>=0?(t=r.s_matList[e],t.identity(),r.s_matFlagList[e]=r.s_FLAG_BUSY):t=new a.default,t}static RetrieveMatrix(t){if(null!=t){let e=t.getUid();e>=r.s_baseUid&&e<r.s_maxUid&&r.s_matFlagList[e-r.s_baseUid]==r.s_FLAG_BUSY&&(r.m_freeIdList.push(e),r.s_matFlagList[e-r.s_baseUid]=r.s_FLAG_FREE)}}}r.s_FLAG_BUSY=1,r.s_FLAG_FREE=0,r.s_matList=[],r.s_matFlagList=[],r.m_freeIdList=[],r.s_mfs32Arr=null,r.s_baseUid=0,r.s_maxUid=0,r.s_mtotal=0,e.default=r},"251a":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s(i("402a")),r=i("d08b"),n=s(i("519e")),l=s(i("fecb")),h=s(i("8e17")),_=s(i("18c7"));class o{constructor(){this.m_initFlag=!0,this.screenPlane=new a.default,this.unitXOYPlane=new a.default,this.unitXOZPlane=new a.default,this.unitYOZPlane=new a.default,this.unitBox=new a.default,this.unitOXOYPlane=new a.default,this.unitOXOZPlane=new a.default,this.unitOYOZPlane=new a.default,this.unitOBox=new a.default}initialize(){if(this.m_initFlag){this.m_initFlag=!1;let t=new r.VtxBufRenderData,e=new Float32Array([1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1]);for(let r=0;r<e.length;++r)e[r]*=.5;let i=new Float32Array([0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1]),s=new Float32Array([0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,0,1,0,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,0,1,0,0,1,0,0,1,0,0,1]),a=new Uint16Array([3,2,1,3,1,0,6,7,4,6,4,5,11,10,9,11,9,8,15,14,13,15,13,12,18,19,16,18,16,17,22,23,20,22,20,21]),l=new n.default;l.setVS(e).setUVS(i).setNVS(s).setIVS(a).setVtxBufRenderData(t),l.vbWholeDataEnabled=!0,l.initialize(),this.unitBox.setMesh(l),e=new Float32Array(e);for(let r=0;r<e.length;++r)e[r]+=.5;l=new n.default,l.setVS(e).setUVS(i).setNVS(s).setIVS(a).setVtxBufRenderData(t),l.vbWholeDataEnabled=!0,l.initialize(),this.unitOBox.setMesh(l),e=new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,1,0]),i=new Float32Array([0,0,1,0,1,1,0,1]),s=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1]),a=new Uint16Array([0,1,2,0,2,3]),l=new n.default,l.setVS(e).setUVS(i).setNVS(s).setIVS(a).setVtxBufRenderData(t),l.vbWholeDataEnabled=!0,l.initialize(),this.screenPlane.setMesh(l);for(let r=0;r<e.length;++r)e[r]*=.5;l=new n.default,l.setVS(e).setUVS(i).setNVS(s).setIVS(a).setVtxBufRenderData(t),l.vbWholeDataEnabled=!0,l.initialize(),this.unitXOYPlane.setMesh(l),e=new Float32Array(e);for(let r=0;r<e.length;)e[r++]+=.5,e[r++]+=.5,r++;l=new n.default,l.setVS(e).setUVS(i).setNVS(s).setIVS(a).setVtxBufRenderData(t),l.vbWholeDataEnabled=!0,l.initialize(),this.unitOXOYPlane.setMesh(l),e=new Float32Array([.5,0,-.5,-.5,0,-.5,-.5,0,.5,.5,0,.5]),s=new Float32Array([0,1,0,0,1,0,0,1,0,0,1,0]),l=new n.default,l.setVS(e).setUVS(i).setNVS(s).setIVS(a).setVtxBufRenderData(t),l.vbWholeDataEnabled=!0,l.initialize(),this.unitXOZPlane.setMesh(l),e=new Float32Array(e);for(let r=0;r<e.length;)e[r++]+=.5,r++,e[r++]+=.5;l=new n.default,l.setVS(e).setUVS(i).setNVS(s).setIVS(a).setVtxBufRenderData(t),l.vbWholeDataEnabled=!0,l.initialize(),this.unitOXOZPlane.setMesh(l),e=new Float32Array([0,-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5]),s=new Float32Array([1,0,0,1,0,0,1,0,0,1,0,0]),l=new n.default,l.setVS(e).setUVS(i).setNVS(s).setIVS(a).setVtxBufRenderData(t),l.vbWholeDataEnabled=!0,l.initialize(),this.unitYOZPlane.setMesh(l);for(let r=0;r<e.length;)r++,e[r++]+=.5,e[r++]+=.5;l=new n.default,l.setVS(e).setUVS(i).setNVS(s).setIVS(a).setVtxBufRenderData(t),l.vbWholeDataEnabled=!0,l.initialize(),this.unitOYOZPlane.setMesh(l)}}createVector3(t=0,e=0,i=0,s=1){return new h.default(t,e,i,s)}createMatrix4(){return new _.default}createAABB(){return new l.default}createEntity(){return new a.default}createMesh(){return new n.default}}e.RenderableEntityBlock=o},"28a9":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("f3a2"),a=i("69ed");class r{constructor(){this.types=[a.ShaderCodeType.VertHead,a.ShaderCodeType.VertBody,a.ShaderCodeType.FragHead,a.ShaderCodeType.FragBody],this.urls=null,this.uuid=s.ShaderCodeUUID.Default,this.binary=!1,this.buildBinaryFile=!1}}e.ShaderCodeConfigure=r},"29ef":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{static CreateBlendMode(t,e,i,a=0){return s.rstb.createBlendMode(t,e,i,a)}static CreateBlendModeSeparate(t,e,i,a=0,r=0,n=0){return s.rstb.createBlendModeSeparate(t,e,i,a,r,n)}static CreateRenderState(t,e,i,a){return s.rstb.createRenderState(t,e,i,a)}static CreateRenderColorMask(t,e,i,a,r){return s.rstb.createRenderColorMask(t,e,i,a,r)}static GetRenderStateByName(t){return s.rstb.getRenderStateByName(t)}static GetRenderColorMaskByName(t){return s.rstb.getRenderColorMaskByName(t)}static UnlockBlendMode(){s.rstb.unlockBlendMode()}static LockBlendMode(t){s.rstb.lockBlendMode(t)}static UnlockDepthTestMode(){s.rstb.unlockDepthTestMode()}static LockDepthTestMode(t){s.rstb.lockDepthTestMode(t)}static ResetState(){s.rstb.resetState()}static Reset(t){s.rstb.reset(t)}static ResetInfo(){}static SetDepthTestEnable(t){s.rstb.setDepthTestEnable(t)}static SetBlendEnable(t){s.rstb.setBlendEnable(t)}}e.default=s},"2e8a":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s(i("8a0a")),r=s(i("644c"));class n{constructor(){this.type=-1,this.attriType=-1,this.typeSize=3,this.typeName="",this.name="",this.layoutEnabled=!0}parseCode(t){const e=";",i=" ";t=t.replace(/^\s*|\s*$/g,"");let s=t.indexOf(e);s>0&&(t=t.slice(0,s));let n=t.split(i);this.typeName=n[n.length-2],this.name=n[n.length-1],this.type=r.default.GetTypeByTypeNS(this.typeName),this.typeSize=parseInt(this.typeName.slice(this.typeName.length-1)),this.attriType=a.default.GetVBufAttributeTypeByNS(this.name)}}e.default=n},3113:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i("839a"),r=i("a9f4"),n=s(i("ab73"));class l{constructor(){this.m_codeBuilder=null,this.m_uniqueNSKeyString="",this.m_uniqueNSKeys=new Uint16Array(128),this.m_uniqueNSKeysTotal=16,this.m_uniqueNSKeyFlag=!1}__$setCodeBuilder(t){this.m_codeBuilder=t}getUniqueNSKeyID(){if(this.m_uniqueNSKeyFlag){let t=31;for(let e=0;e<this.m_uniqueNSKeysTotal;++e)t=131*t+this.m_uniqueNSKeys[e];return t}return 0}getUniqueNSKeyString(){if(this.m_uniqueNSKeyFlag){this.m_uniqueNSKeyString="["+this.m_uniqueNSKeys[0];for(let t=1;t<this.m_uniqueNSKeysTotal;++t)this.m_uniqueNSKeyString+=""+this.m_uniqueNSKeys[t];return this.m_uniqueNSKeyString+="]",this.m_uniqueNSKeyString}return""}reset(){if(this.m_uniqueNSKeyFlag){for(let t=0;t<this.m_uniqueNSKeysTotal;++t)this.m_uniqueNSKeys[t]=0;this.m_uniqueNSKeyFlag=!1}}useCameraPosition(t=!1,e=!0){t&&this.m_codeBuilder.addVertUniformParam(n.default.CameraPosParam),e&&this.m_codeBuilder.addFragUniformParam(n.default.CameraPosParam)}useViewPort(t=!1,e=!0){t&&this.m_codeBuilder.addVertUniformParam(n.default.ViewportParam),e&&this.m_codeBuilder.addFragUniformParam(n.default.ViewportParam)}useFrustum(t=!1,e=!0){t&&this.m_codeBuilder.addVertUniformParam(n.default.FrustumParam),e&&this.m_codeBuilder.addFragUniformParam(n.default.FrustumParam)}useStage(t,e){t&&this.m_codeBuilder.addVertUniformParam(n.default.StageParam),e&&this.m_codeBuilder.addFragUniformParam(n.default.StageParam)}addDiffuseMap(){this.m_codeBuilder.addTextureSample2D("VOX_DIFFUSE_MAP",!0,!0,!1),this.m_uniqueNSKeys[0]=1,this.m_uniqueNSKeyFlag=!0}addNormalMap(){this.m_codeBuilder.addTextureSample2D("VOX_NORMAL_MAP",!0,!0,!1),this.m_codeBuilder.normalMapEnabled=!0,this.m_uniqueNSKeys[1]=1,this.m_uniqueNSKeyFlag=!0}addParallaxMap(t){this.m_codeBuilder.addTextureSample2D("VOX_PARALLAX_MAP",!0,!0,!1),t>=0?(this.m_codeBuilder.addDefine("VOX_PARALLAX_PARAMS_INDEX",""+t),this.m_uniqueNSKeys[2]=1+(t<<1)):this.m_uniqueNSKeys[2]=1,this.m_uniqueNSKeyFlag=!0}addDisplacementMap(t){this.m_codeBuilder.addTextureSample2D("VOX_DISPLACEMENT_MAP",!0,!1,!0),t>=0?(this.m_codeBuilder.addDefine("VOX_DISPLACEMENT_PARAMS_INDEX",""+t),this.m_uniqueNSKeys[3]=1+(t<<1)):this.m_uniqueNSKeys[3]=1,this.m_uniqueNSKeyFlag=!0}addSpecularMap(t=a.SpecularMode.Default){this.m_codeBuilder.addTextureSample2D("VOX_SPECULAR_MAP",!0,!0,!1),this.m_codeBuilder.addDefine("VOX_SPECULAR_MODE",""+t),this.m_uniqueNSKeys[5]=1+(t<<1),this.m_uniqueNSKeyFlag=!0}addShadowMap(t=r.ShadowMode.VSM){this.m_codeBuilder.addTextureSample2D("VOX_VSM_SHADOW_MAP",!1,!0,!1),this.m_uniqueNSKeys[6]=1+(t<<1),this.m_uniqueNSKeyFlag=!0}addFogColorMap(){this.m_codeBuilder.addTextureSample2D("VOX_FOG_COLOR_MAP",!0,!0,!1),this.m_uniqueNSKeys[7]=1,this.m_uniqueNSKeyFlag=!0}addSpecularEnvMap(t=!0){t?this.m_codeBuilder.addTextureSampleCube("VOX_ENV_MAP",!0,!1):this.m_codeBuilder.addTextureSample2D("VOX_ENV_MAP",!0,!0,!1),this.m_uniqueNSKeys[8]=1,this.m_uniqueNSKeyFlag=!0}addAOMap(){this.m_codeBuilder.addTextureSample2D("VOX_AO_MAP",!0,!0,!1),this.m_uniqueNSKeys[4]=1,this.m_uniqueNSKeyFlag=!0}addRoughnessMap(){this.m_codeBuilder.addTextureSample2D("VOX_ROUGHNESS_MAP",!0,!0,!1),this.m_uniqueNSKeys[9]=1,this.m_uniqueNSKeyFlag=!0}addMetalnessMap(){this.m_codeBuilder.addTextureSample2D("VOX_METALNESS_MAP",!0,!0,!1),this.m_uniqueNSKeys[10]=1,this.m_uniqueNSKeyFlag=!0}addARMMap(){this.m_codeBuilder.addTextureSample2D("VOX_ARM_MAP",!0,!0,!1),this.m_uniqueNSKeys[11]=1,this.m_uniqueNSKeyFlag=!0}add2DMap(t="",e=!0,i=!0,s=!1){this.m_codeBuilder.addTextureSample2D(t,e,i,s)}addCubeMap(t="",e=!0,i=!1){this.m_codeBuilder.addTextureSampleCube(t,e,i)}add3DMap(t="",e=!0,i=!1){this.m_codeBuilder.addTextureSample3D(t,e,i)}}e.ShaderCodeUniform=l},"32cc":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s(i("b3bd")),r=s(i("faa5")),n=s(i("0fc4"));class l extends r.default{constructor(){super(),this.m_uniqueName="",this.dynColorEnabled=!1}initialize(t){super.initialize(t),this.m_uniqueName="Line3DShd",this.dynColorEnabled&&(this.m_uniqueName+="_dynColor")}buildShader(){this.m_coder.addVertLayout("vec3","a_vs"),this.m_coder.addFragUniform("vec4","u_color"),this.dynColorEnabled?this.m_coder.addDefine("DYNAMIC_COLOR"):(this.m_coder.addVertLayout("vec3","a_cvs"),this.m_coder.addVarying("vec3","v_color")),this.m_coder.addFragOutputHighp("vec4","FragColor0"),this.m_coder.addFragMainCode("\n    #ifndef DYNAMIC_COLOR\n        FragColor0 = vec4(v_color, 1.0) * u_color;\n    #else\n        FragColor0 = u_color;\n    #endif\n"),this.m_coder.addVertMainCode("\n    viewPosition = u_viewMat * u_objMat * vec4(a_vs,1.0);\n    vec4 pv = u_projMat * viewPosition;\n    #ifndef DYNAMIC_COLOR\n        v_color = a_cvs;\n    #endif\n    gl_Position = pv;\n            ")}getUniqueShaderName(){return this.m_uniqueName}static GetInstance(){let t=l;return null!=t.s_instance||(t.s_instance=new l),t.s_instance}}l.s_instance=null;class h extends n.default{constructor(t=!1){super(),this.m_dynColorEnabled=!1,this.m_data=null,this.premultiplyAlpha=!1,this.normalEnabled=!1,this.shadowReceiveEnabled=!1,this.m_dynColorEnabled=t,this.m_data=new Float32Array([1,1,1,1]);let e=new a.default;e.uniformNameList=["u_color"],e.dataList=[this.m_data],this.m_shaderUniformData=e}buildBuf(){l.GetInstance().dynColorEnabled=this.m_dynColorEnabled}getCodeBuf(){return l.GetInstance()}setRGB3f(t,e,i){this.m_data[0]=t,this.m_data[1]=e,this.m_data[2]=i}getRGB3f(t){let e=this.m_data;t.setRGB3f(e[0],e[1],e[2])}setRGBA4f(t,e,i,s){this.m_data[0]=t,this.m_data[1]=e,this.m_data[2]=i,this.m_data[3]=s}getRGBA4f(t){t.fromArray4(this.m_data)}setAlpha(t){this.m_data[3]=t}getAlpha(){return this.m_data[3]}setColor(t){t.toArray4(this.m_data)}getColor(t){t.fromArray4(this.m_data)}}e.default=h},"35fa":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s(i("8e17"));class r{static ClacTriNormal(t,e,i,s){let n=r;a.default.Subtract(e,t,n.s_temp_vb),a.default.Subtract(i,e,n.s_temp_vc),a.default.Cross(n.s_temp_vb,n.s_temp_vc,s),s.normalize()}static ClacTriNormalByVS(t,e,i){let s=r,a=9*e;s.s_temp_va.setTo(t[a],t[a+1],t[a+2]),i.setTo(t[a+3],t[a+4],t[a+5]),s.s_temp_vc.setTo(t[a+6],t[a+7],t[a+8]),i.subtractBy(s.s_temp_va),s.s_temp_vc.subtractBy(s.s_temp_va),i.crossBy(s.s_temp_vc),i.normalize()}static ClacTriNormalByIVS(t,e,i,s){let a=r,n=3*e,l=3*i[n];a.s_temp_va.setTo(t[l],t[l+1],t[l+2]),l=3*i[n+1],s.setTo(t[l],t[l+1],t[l+2]),l=3*i[n+2],a.s_temp_vc.setTo(t[l],t[l+1],t[l+2]),s.subtractBy(a.s_temp_va),a.s_temp_vc.subtractBy(a.s_temp_va),s.crossBy(a.s_temp_vc),s.normalize()}static ClacTrisNormal(t,e,i,s,n){let l=r,h=new a.default,_=0,o=0,u=0;for(u=0;u<e;++u)n[u]=0;for(u=0;u<i;++u)l.ClacTriNormalByIVS(t,u,s,h),_=3*u,o=3*s[_],n[o]+=h.x,n[o+1]+=h.y,n[o+2]+=h.z,o=3*s[_+1],n[o]+=h.x,n[o+1]+=h.y,n[o+2]+=h.z,o=3*s[_+2],n[o]+=h.x,n[o+1]+=h.y,n[o+2]+=h.z;for(u=0;u<e;u+=3)l.s_temp_va.setTo(n[u],n[u+1],n[u+2]),l.s_temp_va.normalize(),n[u]=l.s_temp_va.x,n[u+1]=l.s_temp_va.y,n[u+2]=l.s_temp_va.z}static ClacTriTangent(t,e,i,s,a,n,l){let h=r,_=3*s,o=3*a[_];h.s_temp_va.setTo(i[o],i[o+1],i[o+2]),h.s_temp_va.setTo(t[o],t[o+1],t[o+2]),o=3*a[_+1],h.s_temp_vb.setTo(t[o],t[o+1],t[o+2]),o=3*a[_+2],h.s_temp_vc.setTo(t[o],t[o+1],t[o+2]),o=2*a[_],h.s_temp_vd.setTo(e[o],e[o+1],0),o=2*a[_+1],h.s_temp_ve.setTo(e[o],e[o+1],0),o=2*a[_+2],h.s_temp_vf.setTo(e[o],e[o+1],0),h.s_temp_vb.subtractBy(h.s_temp_va),h.s_temp_vc.subtractBy(h.s_temp_va),h.s_temp_ve.subtractBy(h.s_temp_vd),h.s_temp_vf.subtractBy(h.s_temp_vd);let u=1/(h.s_temp_ve.x*h.s_temp_vf.y-h.s_temp_ve.y*h.s_temp_vf.x);n.copyFrom(h.s_temp_vb),n.scaleBy(h.s_temp_vf.y),h.s_temp_va.copyFrom(h.s_temp_vc),h.s_temp_va.scaleBy(h.s_temp_ve.y),n.subtractBy(h.s_temp_va),n.scaleBy(u),n.normalize(),l.copyFrom(h.s_temp_vc),l.scaleBy(h.s_temp_ve.x),h.s_temp_va.copyFrom(h.s_temp_vb),h.s_temp_va.scaleBy(h.s_temp_vf.x),l.subtractBy(h.s_temp_va),l.scaleBy(u),l.normalize()}static ClacTrisTangent(t,e,i,s,n,l,h,_){let o=r,u=new a.default,m=new a.default,d=0,c=0,f=0;for(f=0;f<e;++f)h[f]=0,_[f]=0;for(f=0;f<n;++f)o.ClacTriTangent(t,i,s,f,l,u,m),d=3*f,c=3*l[d],h[c]=u.x,h[c+1]=u.y,h[c+2]=u.z,_[c]=m.x,_[c+1]=m.y,_[c+2]=m.z,c=3*l[d+1],h[c]=u.x,h[c+1]=u.y,h[c+2]=u.z,_[c]=m.x,_[c+1]=m.y,_[c+2]=m.z,c=3*l[d+2],h[c]=u.x,h[c+1]=u.y,h[c+2]=u.z,_[c]=m.x,_[c+1]=m.y,_[c+2]=m.z;for(f=0;f<e;f+=3)o.s_temp_vd.setTo(h[f],h[f+1],h[f+2]),o.s_temp_vd.normalize(),o.s_temp_vb.setTo(_[f],_[f+1],_[f+2]),o.s_temp_vb.normalize(),o.s_temp_vc.setTo(s[f],s[f+1],s[f+2]),o.s_temp_va.copyFrom(o.s_temp_vc),o.s_temp_vc.scaleBy(o.s_temp_vc.dot(o.s_temp_vd)),o.s_temp_vd.subtractBy(o.s_temp_vc),o.s_temp_vd.normalize(),o.s_temp_vc.setTo(s[f],s[f+1],s[f+2]),o.s_temp_vc.scaleBy(o.s_temp_vb.dot(o.s_temp_vc)),o.s_temp_vb.subtractBy(o.s_temp_vc),o.s_temp_vb.normalize(),o.s_temp_va.crossBy(o.s_temp_vd),o.s_temp_va.dot(o.s_temp_vb)<0&&o.s_temp_vd.scaleBy(-1),h[f]=o.s_temp_vd.x,h[f+1]=o.s_temp_vd.y,h[f+2]=o.s_temp_vd.z,o.s_temp_vb.setTo(s[f],s[f+1],s[f+2]),o.s_temp_vb.crossBy(o.s_temp_vd),o.s_temp_vb.normalize(),_[f]=o.s_temp_vb.x,_[f+1]=o.s_temp_vb.y,_[f+2]=o.s_temp_vb.z}}r.s_temp_va=new a.default,r.s_temp_vb=new a.default,r.s_temp_vc=new a.default,r.s_temp_vd=new a.default,r.s_temp_ve=new a.default,r.s_temp_vf=new a.default,r.s_temp_vg=new a.default,e.default=r},3930:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=1e-5;class a{constructor(t=1,e=1,i=1,s=1){this.r=t,this.g=e,this.b=i,this.a=s}clone(){return new a(this.r,this.g,this.b,this.a)}fromArray4(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this.a=t[e+3],this}toArray4(t,e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t[e+3]=this.a,this}fromArray3(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray3(t,e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,this}fromBytesArray3(t,e=0){return this.setRGB3Bytes(t[e],t[e+1],t[e+2]),this}toBytesArray3(t,e=0){return t[e]=Math.round(255*this.r),t[e+1]=Math.round(255*this.g),t[e+2]=Math.round(255*this.b),this}setRGB3f(t,e,i){return this.r=t,this.g=e,this.b=i,this}setRGB3Bytes(t,e,i){const s=1/255;return this.r=t*s,this.g=e*s,this.b=i*s,this}setRGBUint24(t){return this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this}getRGBUint24(){return(Math.round(255*this.r)<<16)+(Math.round(255*this.g)<<8)+Math.round(255*this.b)}setRGBA4f(t,e,i,s){return this.r=t,this.g=e,this.b=i,this.a=s,this}copyFrom(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this}copyFromRGB(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}scaleBy(t){return this.r*=t,this.g*=t,this.b*=t,this}inverseRGB(){return this.r=1-this.r,this.g=1-this.g,this.b=1-this.b,this}randomRGB(t=1,e=0){return this.r=Math.random()*t,this.g=Math.random()*t,this.b=Math.random()*t,this.r+=e,this.g+=e,this.b+=e,this}normalizeRandom(t=1,e=0){this.r=Math.random(),this.g=Math.random(),this.b=Math.random();let i=Math.sqrt(this.r*this.r+this.g*this.g+this.b*this.b);return i>s&&(this.r=t*this.r/i,this.g=t*this.g/i,this.b=t*this.b/i),this.r+=e,this.g+=e,this.b+=e,this}normalize(t){void 0==t&&(t=1);let e=Math.sqrt(this.r*this.r+this.g*this.g+this.b*this.b);return e>s&&(this.r=t*this.r/e,this.g=t*this.g/e,this.b=t*this.b/e),this}getCSSDecRGBAColor(){let t=Math.floor(255*this.r),e=Math.floor(255*this.g),i=Math.floor(255*this.b),s=this.a;return"rgba("+t+","+e+","+i+","+s+")"}getCSSHeXRGBColor(){let t="#",e=Math.floor(255*this.r);return t+=e<15?"0"+e.toString(16):""+e.toString(16),e=Math.floor(255*this.g),t+=e<15?"0"+e.toString(16):""+e.toString(16),e=Math.floor(255*this.b),t+=e<15?"0"+e.toString(16):""+e.toString(16),t}toString(){return"[Color4(r="+this.r+", g="+this.g+",b="+this.b+",a="+this.a+")]"}}e.default=a},"3b73":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{static SetWebBodyColor(t="white"){const e=document.body;e.style.background=t}static SetLanguage(t){s.s_language=t}static GetLanguage(){return""!=s.s_language||(s.s_language=navigator.language),s.s_language}static SetThreadEnabled(t){s.s_threadEnabled=t}static GetThreadEnabled(){return s.s_threadEnabled}static GetDebugEnabled(){return s.s_debugEnabled}static SetDebugEnabled(t){s.s_debugEnabled=t}static SetDevicePixelRatio(t){s.s_devicePixelRatio=t}static GetDevicePixelRatio(){return s.s_devicePixelRatio}static Initialize(t){s.s_inited&&(s.s_inited=!1,s.s_WEBGL_VER=t[0],s.TestMobileWeb(),s.s_language=navigator.language+"")}static IsWindowsPCOS(){return!(s.IsSafariWeb()||s.IsMobileWeb())}static IsWinExternalVideoCard(){if(s.s_winExternalVideoCardFlag>0)return 2==s.s_winExternalVideoCardFlag;let t=s.IsSafariWeb()||s.IsMobileWeb();return t||(t=s.GPU_RENDERER.indexOf("Intel(R)")<0),s.s_winExternalVideoCardFlag=t?2:1,2==s.s_winExternalVideoCardFlag}static TestSafariWeb(){return/Safari/.test(navigator.userAgent)&&/Mac OS/.test(navigator.userAgent)}static IsWebGL1(){return 1==s.s_WEBGL_VER}static IsWebGL2(){return 2==s.s_WEBGL_VER}static IsMobileWeb(){return s.s_mobileFlag>0?2==s.s_mobileFlag:s.TestMobileWeb()}static IsSafariWeb(){return s.s_safariFlag>0||(s.s_safariFlag=s.TestSafariWeb()?2:1),2==s.s_safariFlag}static IsIOS(){if(s.s_IOS_Flag>0)return 2==s.s_IOS_Flag;let t=!1;return t=!!/iPad|iPhone|iPod/.test(navigator.platform)||void 0!=navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform),s.s_IOS_Flag=t?2:1,t}static IsIpadOS(){if(s.s_IPad_Flag>0)return 2==s.s_IPad_Flag;let t=navigator.maxTouchPoints>0&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform);return!t&&/iPod|iPad|iPadPro|iPodPro/i.test(navigator.userAgent)&&(t=!0),s.s_IPad_Flag=t?2:1,t}static IsAndroidOS(){if(s.s_Android_Flag>0)return 2==s.s_Android_Flag;let t=s.TestMobileWeb();return t=!(!t||!/Android|Linux/i.test(navigator.userAgent)),s.s_Android_Flag=t?2:1,t}static TestMobileWeb(){return s.s_mobileFlag>0?2==s.s_mobileFlag:/mobile/.test(location.href)?(s.s_mobileFlag=2,2==s.s_mobileFlag):/Android/i.test(navigator.userAgent)?/Mobile/i.test(navigator.userAgent)?(s.s_mobileFlag=2,2==s.s_mobileFlag):(s.s_mobileFlag=1,2==s.s_mobileFlag):/webOS|iPhone|iPod|iPad|iPodPro|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?(s.s_mobileFlag=2,2==s.s_mobileFlag):(s.s_mobileFlag=1,2==s.s_mobileFlag)}}s.s_inited=!0,s.s_WEBGL_VER=2,s.s_devicePixelRatio=1,s.s_mobileFlag=0,s.s_safariFlag=0,s.s_Android_Flag=0,s.s_IOS_Flag=0,s.s_IPad_Flag=0,s.s_winExternalVideoCardFlag=0,s.s_language="",s.s_debugEnabled=!0,s.GPU_VENDOR="unknown",s.GPU_RENDERER="unknown",s.MAX_TEXTURE_SIZE=4096,s.MAX_RENDERBUFFER_SIZE=4096,s.MAX_VIEWPORT_WIDTH=4096,s.MAX_VIEWPORT_HEIGHT=4096,s.SHOWLOG_ENABLED=!1,s.SHADERCODE_TRACE_ENABLED=!1,s.VERT_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED=!0,s.FRAG_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED=!0,s.s_threadEnabled=!0,e.default=s},"3efb":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s(i("8e17")),r=s(i("18c7")),n=s(i("2139")),l=s(i("29ef")),h=s(i("1440")),_=s(i("c51d")),o=s(i("c497")),u=s(i("af68")),m=s(i("a80a")),d=s(i("9c4d")),c=i("5d04"),f=s(i("af29")),p=s(i("d7e2")),g=i("a156");class x{constructor(){this.m_uid=-1,this.m_adapter=null,this.m_renderProxy=null,this.m_shader=null,this.m_rcontext=null,this.m_renderer=null,this.m_processids=new Uint8Array(128),this.m_processidsLen=0,this.m_accessor=null,this.m_viewX=0,this.m_viewY=0,this.m_viewW=800,this.m_viewH=800,this.m_nodeWaitLinker=null,this.m_nodeWaitQueue=null,this.m_camDisSorter=null,this.m_subscListLen=0,this.m_runFlag=-1,this.m_autoRunning=!0,this.m_processUpdate=!1,this.m_tickId=-1,this.m_rparam=null,this.m_enabled=!0,this.runnableQueue=new d.default,this.textureBlock=new c.TextureBlock,this.stage3D=null,this.materialBlock=null,this.entityBlock=null,this.m_containers=[],this.m_containersTotal=0,this.m_currCamera=null,this.m_prependNodes=null,this.m_appendNodes=null,this.m_uid=x.s_uid++}tickUpdate(){this.m_tickId>-1&&clearTimeout(this.m_tickId),this.m_tickId=setTimeout(this.tickUpdate.bind(this),this.m_rparam.getTickUpdateTime()),this.textureBlock.run()}enable(){this.m_enabled=!0}disable(){this.m_enabled=!1}isEnabled(){return this.m_enabled}getUid(){return this.m_uid}getDiv(){return this.m_renderProxy.getDiv()}getCanvas(){return this.m_renderProxy.getCanvas()}getRPONodeBuilder(){return null}getRenderProxy(){return this.m_renderProxy}setViewPort(t,e,i,s){null!=this.m_renderProxy&&(this.m_viewX=t,this.m_viewY=e,this.m_viewW=i,this.m_viewH=s,this.m_renderProxy.setViewPort(t,e,i,s))}setViewPortFromCamera(t){null!=this.m_renderProxy&&null!=t&&(this.m_viewX=t.getViewX(),this.m_viewY=t.getViewY(),this.m_viewW=t.getViewWidth(),this.m_viewH=t.getViewHeight(),this.m_renderProxy.setViewPort(this.m_viewX,this.m_viewY,this.m_viewW,this.m_viewH))}reseizeViewPort(){this.m_renderProxy.reseizeRCViewPort()}lockViewport(){this.m_adapter.lockViewport()}unlockViewport(){this.m_adapter.unlockViewport()}getRendererAdapter(){return this.m_adapter}getRenderer(){return this.m_renderer}getRendererContext(){return this.m_rcontext}getStage3D(){return this.m_renderProxy.getStage3D()}getRendererStatus(){return this.m_renderer.getRendererStatus()}getViewWidth(){return this.m_renderProxy.getStage3D().viewWidth}getViewHeight(){return this.m_renderProxy.getStage3D().viewHeight}getCamera(){return this.m_renderProxy.getCamera()}asynFBOSizeWithViewport(){this.m_rcontext.asynFBOSizeWithViewport()}synFBOSizeWithViewport(){this.m_rcontext.synFBOSizeWithViewport()}cameraLock(){this.m_renderProxy.cameraLock()}cameraUnlock(){this.m_renderProxy.cameraUnlock()}getMouseXYWorldRay(t,e){this.m_renderProxy.getMouseXYWorldRay(t,e)}createCamera(){return new _.default}createFBOInstance(){return new f.default(this,this.textureBlock.getRTTStrore())}createMatrix4(){return new r.default}createVector3(t=0,e=0,i=0,s=1){return new a.default(t,e,i,s)}setClearUint24Color(t,e=1){this.m_renderProxy.setClearUint24Color(t,e)}setClearRGBColor3f(t,e,i){this.m_renderProxy.setClearRGBColor3f(t,e,i)}setClearRGBAColor4f(t,e,i,s){this.m_renderProxy.setClearRGBAColor4f(t,e,i,s)}setClearColor(t){this.m_renderProxy.setClearRGBAColor4f(t.r,t.g,t.b,t.a)}setRenderToBackBuffer(){this.m_rcontext.setRenderToBackBuffer()}drawBackBufferToCanvas(t){let e=this.getCanvas();var i=t.getContext("2d");i.drawImage(e,0,0,t.width,t.height)}updateRenderBufferSize(){this.m_adapter.updateRenderBufferSize()}setEvt3DController(t){throw Error("iellegal operations !!!")}isRayPickSelected(){return!1}enableMouseEvent(t=!0){}disableMouseEvent(){}getEvt3DController(){return null}getSpace(){return null}getDevicePixelRatio(){return this.m_adapter.getDevicePixelRatio()}createSubScene(t=null,e=3,i=!0){throw Error("illegal operations !!!")}addEventListener(t,e,i,s=!0,a=!1){}removeEventListener(t,e,i){}setAccessor(t){this.m_accessor=t}initialize(t=null,e=3){if(null==this.m_renderer){null==t&&(t=new o.default),this.m_rparam=t;let i=this;i.stage3D=new h.default(this.getUid(),document),e<1&&(e=1),e>8&&(e=8),this.m_renderer=CoRenderer.createRendererInstance(),this.m_renderer.__$setStage3D(this.stage3D),n.default.Allocate(t.getMatrix4AllocateSize());let s=new _.default;this.m_renderer.initialize(t,s,new g.ShaderProgramBuilder(this.m_renderer.getRCUid()));let a=CoRenderer.RendererState;a.rstb.buildToRST(l.default),this.m_processids[0]=0,this.m_processidsLen++;let r=null;for(;e>=0;)r=this.m_renderer.appendProcess(t.batchEnabled,t.processFixedState),this.m_processids[this.m_processidsLen]=r.getRPIndex(),this.m_processidsLen++,--e;this.m_rcontext=this.m_renderer.getRendererContext(),this.m_renderProxy=this.m_rcontext.getRenderProxy(),this.m_adapter=this.m_renderProxy.getRenderAdapter();let u=this.m_renderProxy.getStage3D();this.m_viewW=u.stageWidth,this.m_viewH=u.stageHeight,this.m_shader=this.m_renderer.getDataBuilder().getRenderShader(),this.textureBlock.setRenderer(this.m_renderProxy),this.m_camDisSorter=new p.default(this.m_renderProxy),this.tickUpdate()}}setRendererProcessParam(t,e,i){this.m_renderer.setRendererProcessParam(this.m_processids[t],e,i)}appendARendererProcess(t=!0,e=!1){let i=this.m_renderer.appendProcess(t,e);this.m_processids[this.m_processidsLen]=i.getRPIndex(),this.m_processidsLen++}getRenderProcessAt(t){return this.m_renderer.getProcessAt(this.m_processids[t])}addContainer(t,e=0){if(e<0&&(e=0),null!=t&&t.__$wuid<0&&t.__$contId<1){let i=0;for(;i<this.m_containersTotal;++i)if(this.m_containers[i]==t)return;i>=this.m_containersTotal&&(t.__$wuid=this.m_uid,t.wprocuid=e,t.__$setRenderer(this),this.m_containers.push(t),this.m_containersTotal++)}}removeContainer(t){if(null!=t&&t.__$wuid==this.m_uid&&t.getRenderer()==this.m_renderer){let e=0;for(;e<this.m_containersTotal;++e)if(this.m_containers[e]==t){t.__$wuid=-1,t.wprocuid=-1,t.__$setRenderer(null),this.m_containers.splice(e,1),--this.m_containersTotal;break}}}setAutoRunningEnabled(t){this.m_autoRunning=t}setAutoRenderingSort(t){this.m_processUpdate=t}setProcessSortEnabledAt(t,e,i=null){if(this.m_renderer.setProcessSortEnabledAt(t,e),e){let e=this.m_renderer.getProcessAt(t);i=null!=i?i:this.m_camDisSorter,null!=e&&e.setSorter(i)}}setProcessSortEnabled(t,e,i=null){this.m_renderer.setProcessSortEnabled(t,e),e&&null!=t&&!t.hasSorter()&&(i=null!=i?i:this.m_camDisSorter,t.setSorter(i))}moveEntityTo(t,e){this.m_renderer.moveEntityToProcessAt(t,this.m_processids[e])}drawEntity(t,e=!1,i=!0){this.m_renderer.drawEntity(t,e,i)}addEntity(t,e=0,i=!0){if(null!=t&&t.__$testSpaceEnabled())if(t.isPolyhedral())if(t.hasMesh())this.m_renderer.addEntity(t,this.m_processids[e],i);else{null==this.m_nodeWaitLinker&&(this.m_nodeWaitLinker=new m.default,this.m_nodeWaitQueue=new u.default);let i=this.m_nodeWaitQueue.addEntity(t);i.rstatus=e,this.m_nodeWaitLinker.addNode(i)}else this.m_renderer.addEntity(t,this.m_processids[e],i)}removeEntity(t){if(null!=t){let e=null;if(null!=this.m_nodeWaitLinker){let e=this.m_nodeWaitQueue.getNodeByEntity(t);null!=e&&(this.m_nodeWaitLinker.removeNode(e),this.m_nodeWaitQueue.removeEntity(t))}null==e&&this.m_renderer.removeEntity(t)}}updateMaterialUniformToCurrentShd(t){this.m_renderer.updateMaterialUniformToCurrentShd(t)}showInfoAt(t){this.m_renderer.showInfoAt(t)}getRenderUnitsTotal(){return this.m_renderer.getRenderUnitsTotal()}useCamera(t,e=!1){this.m_currCamera=t,e&&(this.m_renderProxy.setRCViewPort(t.getViewX(),t.getViewY(),t.getViewWidth(),t.getViewHeight(),!0),this.m_renderProxy.reseizeRCViewPort()),t.update(),this.m_rcontext.resetUniform(),this.m_renderProxy.updateCameraDataFromCamera(t)}useMainCamera(){this.m_currCamera=null;let t=this.m_renderProxy.getCamera();this.m_renderProxy.setRCViewPort(t.getViewX(),t.getViewY(),t.getViewWidth(),t.getViewHeight(),!0),this.m_renderProxy.reseizeRCViewPort(),this.m_renderProxy.updateCamera(),this.m_rcontext.resetUniform(),this.m_renderProxy.updateCameraDataFromCamera(this.m_renderProxy.getCamera())}updateCameraDataFromCamera(t){this.m_renderProxy.updateCameraDataFromCamera(t)}resetState(){this.m_rcontext.resetState()}resetUniform(){this.m_rcontext.resetUniform()}enableSynViewAndStage(){this.m_renderProxy.enableSynViewAndStage()}renderBegin(t=!0){if(null==this.m_currCamera){if(this.m_adapter.unlockViewport(),this.m_renderProxy.isAutoSynViewAndStage()){let t=this.m_renderProxy.testViewPortChanged(this.m_viewX,this.m_viewY,this.m_viewW,this.m_viewH);this.m_viewX=this.m_renderProxy.getViewX(),this.m_viewY=this.m_renderProxy.getViewY(),this.m_viewW=this.m_renderProxy.getViewWidth(),this.m_viewH=this.m_renderProxy.getViewHeight(),t&&(this.m_renderProxy.setRCViewPort(this.m_viewX,this.m_viewY,this.m_viewW,this.m_viewH,!0),this.m_renderProxy.reseizeRCViewPort())}else this.m_renderProxy.setViewPort(this.m_viewX,this.m_viewY,this.m_viewW,this.m_viewH);this.m_renderProxy.updateCamera(),this.m_renderProxy.updateCameraDataFromCamera(this.m_renderProxy.getCamera())}this.m_shader.renderBegin(),t&&this.m_rcontext.renderBegin(null==this.m_currCamera),this.m_currCamera=null,null!=this.m_accessor&&this.m_accessor.renderBegin(this)}runBegin(t=!0,e=!0){t&&this.m_autoRunning&&(this.m_runFlag>=0&&this.runEnd(),this.m_runFlag=0),this.renderBegin(e)}renderContextBegin(){this.m_rcontext.renderBegin()}setRayTestEnabled(t){}runMouseTest(t,e){return-1}update(t=!0,e=!0){if(this.stage3D.enterFrame(),t&&this.m_autoRunning&&(0!=this.m_runFlag&&this.runBegin(),this.m_runFlag=1),null!=this.m_nodeWaitLinker){let t=this.m_nodeWaitLinker.getBegin();if(null!=t){let e,i,s;while(null!=t)t.entity.hasMesh()?(e=t,t=t.next,i=e.entity,s=e.rstatus,this.m_nodeWaitLinker.removeNode(e),this.m_nodeWaitQueue.removeEntity(e.entity),this.addEntity(i,s)):t=t.next}}let i=0;for(;i<this.m_containersTotal;++i)this.m_containers[i].update();this.m_renderer.update(),this.m_processUpdate&&this.m_renderer.updateAllProcess()}cullingTest(){}mouseRayTest(){}runRenderNodes(t){if(null!=t)for(let e=0;e<t.length;++e)t[e].render()}addRenderNodes(t,e){for(let i=0;i<e.length;++i)if(t==e[i])return;e.push(t)}prependRenderNode(t){null!=t&&t!=this&&(null==this.m_prependNodes&&(this.m_prependNodes=[]),this.addRenderNodes(t,this.m_prependNodes))}appendRenderNode(t){if(null!=t&&t!=this){null==this.m_appendNodes&&(this.m_appendNodes=[]);let e=this.m_appendNodes;for(let i=0;i<e.length;++i)if(t==e[i])return;e.push(t)}}removeRenderNode(t){if(null!=t){let e=this.m_prependNodes;if(null!=e)for(let i=0;i<e.length;++i)if(t==e[i]){e.splice(i,1);break}}}run(t=!0){if(this.m_enabled){if(t&&this.m_autoRunning&&(1!=this.m_runFlag&&this.update(),this.m_runFlag=2),this.runnableQueue.run(),this.runRenderNodes(this.m_prependNodes),this.m_subscListLen>0)for(let t=0;t<this.m_processidsLen;++t)this.m_renderer.runAt(this.m_processids[t]);else this.m_renderer.run();this.runRenderNodes(this.m_appendNodes),t&&this.runEnd()}}runAt(t){this.m_enabled&&this.m_renderer.runAt(this.m_processids[t])}runEnd(){this.m_rcontext.runEnd(),this.m_autoRunning&&(this.m_runFlag=-1),null!=this.m_accessor&&this.m_accessor.renderEnd(this)}render(){}renderFlush(){null!=this.m_renderProxy&&this.m_renderProxy.flush()}updateCamera(){null!=this.m_renderProxy&&this.m_renderProxy.updateCamera()}destroy(){}}x.s_uid=0,e.default=x},"402a":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s(i("11e6")),r=s(i("8e17")),n=s(i("fecb")),l=s(i("29ef")),h=s(i("0929")),_=i("cc48"),o=s(i("dc2b"));class u{constructor(t=null,e=!1){this.m_uid=0,this.m_transfrom=null,this.m_eventDispatcher=null,this.m_visible=!0,this.m_drawEnabled=!0,this.m_rcolorMask=0,this.m_renderState=0,this.m_display=null,this.m_mesh=null,this.m_localBounds=null,this.m_globalBounds=null,this.m_localBuondsVer=-1,this.m_parent=null,this.m_renderProxy=null,this.m_pipeLine=null,this.__$rseFlag=a.default.DEFAULT,this.name="DisplayEntity",this.spaceCullMask=_.SpaceCullingMask.CAMERA,this.drawEnabled=!1,this.mouseEnabled=!1,this.vbWholeDataEnabled=!0,this.pipeTypes=null,this.m_texChanged=!1,this.m_meshChanged=!1,this.m_lBoundsVS=null,this.m_transStatus=h.default.UPDATE_TRANSFORM,this.m_uid=u.s_uid++,this.m_transfrom=null==t?h.default.Create():e?h.default.Create(null,t.getFS32Data()):t,this.createBounds()}createBounds(){this.m_globalBounds=new n.default}__$setRenderProxy(t){this.m_renderProxy=t}__$setParent(t){this.m_parent,this.m_parent=t}__$getParent(){return this.m_parent}__$testSpaceEnabled(){return a.default.TestSpaceEnabled2(this.__$rseFlag)}__$testContainerEnabled(){return a.default.TestContainerEnabled(this.__$rseFlag)}__$testRendererEnabled(){return a.default.TestRendererEnabled(this.__$rseFlag)}getRendererUid(){return a.default.GetRendererUid(this.__$rseFlag)}setMaterialPipeline(t){this.m_pipeLine=t}getMaterialPipeline(){return this.m_pipeLine}isFree(){return this.__$rseFlag==a.default.DEFAULT}dispatchEvt(t){return null!=this.m_eventDispatcher?this.m_eventDispatcher.dispatchEvt(t):0}getEvtDispatcher(t){return this.m_eventDispatcher}setEvtDispatcher(t){this.m_eventDispatcher=t}getGlobalBounds(){return this.m_globalBounds}getLocalBounds(){return this.m_mesh.bounds}getGlobalBoundsVer(){return null!=this.m_globalBounds?this.m_globalBounds.version:-1}__$setDrawEnabled(t){if(this.m_drawEnabled!=t){this.m_drawEnabled=t;const e=this.m_display;null!=e&&(e.visible=this.m_visible&&t,null!=e.__$$runit&&e.__$$runit.setVisible(e.visible))}}isDrawEnabled(){return this.m_drawEnabled}updateMeshToGpu(t=null,e=!0){null!=t&&(this.m_renderProxy=t),null!=this.m_renderProxy&&null!=this.m_display&&this.m_display.__$ruid>-1&&(this.m_meshChanged?(this.m_meshChanged=!1,this.m_renderProxy.VtxBufUpdater.updateDispVbuf(this.m_display,e)):this.m_renderProxy.VtxBufUpdater.updateVtxDataToGpuByUid(this.m_display.getVtxResUid(),e))}updateMaterialToGpu(t=null,e=!0){null!=t&&(this.m_renderProxy=t),null!=this.m_renderProxy&&null!=this.m_display&&this.m_display.__$ruid>-1&&this.m_texChanged&&(this.m_texChanged=!1,this.m_renderProxy.MaterialUpdater.updateDispTRO(this.m_display,e))}setTextureList(t){if(null!=this.m_display&&this.m_display.__$ruid>-1){let e=this.m_display.getMaterial();null!=e&&(e.setTextureList(t),this.m_texChanged=!0)}}setTextureAt(t,e){if(null!=this.m_display&&this.m_display.__$ruid>-1){let i=this.m_display.getMaterial();null!=i&&(i.setTextureAt(t,e),this.m_texChanged=!0)}}setSortValue(t){null!=this.m_display&&null!=this.m_display.__$$runit&&(this.m_display.__$$runit.value=t)}setVisible(t){this.m_visible!=t&&(this.m_visible=t,null!=this.m_display&&(this.m_display.visible=t&&this.m_drawEnabled,null!=this.m_display.__$$runit&&this.m_display.__$$runit.setVisible(this.m_display.visible)))}getVisible(){return this.m_visible}getTransform(){return this.m_transfrom}copyPositionFrom(t){null!=t&&this.m_transfrom.copyPositionFrom(t.getTransform())}copyMeshFrom(t){null!=t&&this.setMesh(t.getMesh())}copyMaterialFrom(t){null!=t&&this.setMaterial(t.getMaterial())}copyTransformFrom(t){let e=t;null!=e&&this.m_transfrom.copyFrom(e.m_transfrom)}initDisplay(t){let e=t.__$attachVBuf();e.setBufSortFormat(t.getBufSortFormat());const i=this.m_display;i.vbuf=e,i.ivbuf=t.__$attachIVBuf(),i.ivsIndex=0,i.ivsCount=t.vtCount,i.drawMode=t.drawMode,i.trisNumber=t.trisNumber,i.visible=this.m_visible&&this.m_drawEnabled}setMesh(t){null==this.m_mesh?null!=t&&(t.isEnabled()||t.rebuild(),t.isEnabled()&&(this.m_mesh=t,t.__$attachThis(),null==this.m_display&&this.createDisplay(),null!=this.m_display&&(this.m_display.setTransform(this.m_transfrom.getMatrix()),this.initDisplay(t)),null==this.m_localBounds?this.m_localBounds=t.bounds:this.m_localBounds.copyFrom(t.bounds),this.updateMesh())):null!=this.m_display&&this.m_display.__$ruid>-1&&this.m_mesh!=t&&null!=t&&(this.m_transfrom.updatedStatus|=2,this.m_mesh.__$detachVBuf(this.m_display.vbuf),this.m_mesh.__$detachIVBuf(this.m_display.ivbuf),this.m_mesh.__$detachThis(),t.__$attachThis(),this.m_mesh=t,this.initDisplay(t),this.updateMesh(),this.m_meshChanged=!0)}updateMesh(){}getIvsIndex(){return this.m_display.ivsIndex}getIvsCount(){return this.m_display.ivsCount}setIvsParam(t,e,i=!1){if(null!=this.m_display&&(this.m_display.ivsIndex=t,this.m_display.ivsCount=e,this.m_display.__$ruid>-1)){let s=this.m_display.__$$runit;if(s.trisNumber=Math.floor((e-t)/3),s.setIvsParam(t,e),s.drawMode=this.m_mesh.drawMode,i&&this.isPolyhedral()){this.m_localBounds==this.m_mesh.bounds&&(this.m_localBounds=new n.default,this.m_localBounds.copyFrom(this.m_mesh.bounds)),this.m_transStatus=h.default.UPDATE_TRANSFORM,this.m_localBounds.reset();let i=this.m_mesh.getIVS();this.m_localBounds.addFloat32AndIndicesArr(this.m_mesh.getVS(),i.subarray(t,t+e)),this.m_localBounds.update()}}}getMesh(){return this.m_mesh}hasMesh(){return null!=this.m_mesh}isPolyhedral(){return null===this.m_mesh||this.m_mesh.isPolyhedral()}testRay(t,e,i,s){return this.m_mesh.testRay(t,e,i,s)}setMaterial(t){if(null!=t){null==this.m_display&&(this.m_display=o.default.Create(),this.m_display.setTransform(this.m_transfrom.getMatrix()),this.m_display.visible=this.m_visible&&this.m_drawEnabled);const e=a.default.RENDERER_UID_FLAG,i=this.m_display;i.getMaterial()!=t&&(e&this.__$rseFlag)==e&&i.__$ruid<0&&(i.renderState=this.m_renderState,i.rcolorMask=this.m_rcolorMask,i.setMaterial(t))}}getMaterial(){return null!=this.m_display?this.m_display.getMaterial():null}getDisplay(){return this.m_display}getInvMatrix(){return this.m_transfrom.getInvMatrix()}getMatrix(t=!0){return this.m_transfrom.getMatrix(t)}getToParentMatrix(){return this.m_transfrom.getToParentMatrix()}setRenderColorMask(t){this.m_rcolorMask=t,null!=this.m_display&&(this.m_display.rcolorMask=this.m_rcolorMask,null!=this.m_display.__$$runit&&this.m_display.__$$runit.setDrawFlag(this.m_renderState,this.m_rcolorMask))}setRenderColorMaskByName(t){this.m_rcolorMask=l.default.GetRenderColorMaskByName(t),null!=this.m_display&&(this.m_display.rcolorMask=this.m_rcolorMask,null!=this.m_display.__$$runit&&this.m_display.__$$runit.setDrawFlag(this.m_renderState,this.m_rcolorMask))}setRenderState(t){this.m_renderState=t,null!=this.m_display&&(this.m_display.renderState=this.m_renderState,null!=this.m_display.__$$runit&&this.m_display.__$$runit.setDrawFlag(this.m_renderState,this.m_rcolorMask))}getRenderState(){return this.m_renderState}setRenderStateByName(t){this.m_renderState=l.default.GetRenderStateByName(t),null!=this.m_display&&(this.m_display.renderState=this.m_renderState,null!=this.m_display.__$$runit&&this.m_display.__$$runit.setDrawFlag(this.m_renderState,this.m_rcolorMask))}createDisplay(){this.m_display=o.default.Create()}activeDisplay(){if(null!=this.m_display){let t=this.m_display.getMaterial();if(null!=t){if(null==t.getShaderData()&&null!=t.getCodeBuf()&&null==t.getShaderData()){let e=t.getTextureList(),i=null!=e&&e.length>0;null==t.getMaterialPipeline()&&null!=this.getMaterialPipeline()&&t.setMaterialPipeline(this.getMaterialPipeline()),null==t.pipeTypes&&(t.pipeTypes=this.pipeTypes),t.initializeByCodeBuf(i)}null==this.getMesh()&&(this.__activeMesh(t),this.m_display.name=this.name)}}}__activeMesh(t){}getUid(){return this.m_uid}setXYZ(t,e,i){this.m_transfrom.setXYZ(t,e,i)}offsetPosition(t){this.m_transfrom.offsetPosition(t)}setPosition(t){this.m_transfrom.setPosition(t)}getPosition(t){return this.m_transfrom.getPosition(t),t}setRotation3(t){this.m_transfrom.setRotationXYZ(t.x,t.y,t.z)}setRotationXYZ(t,e,i){this.m_transfrom.setRotationXYZ(t,e,i)}setScale3(t){this.m_transfrom.setScaleXYZ(t.x,t.y,t.z)}setScaleXYZ(t,e,i){this.m_transfrom.setScaleXYZ(t,e,i)}getRotationXYZ(t){this.m_transfrom.getRotationXYZ(t)}getScaleXYZ(t){this.m_transfrom.getScaleXYZ(t)}localToGlobal(t){null!=this.m_transfrom&&this.m_transfrom.localToGlobal(t)}globalToLocal(t){null!=this.m_transfrom&&this.m_transfrom.globalToLocal(t)}isRFree(){return this.__$rseFlag==a.default.DEFAULT}isInRenderer(){return(this.__$rseFlag&a.default.RENDERER_UID_FLAG)!=a.default.RENDERER_UID_FLAG}isInRendererProcess(){return null!=this.m_display&&this.m_display.__$ruid>-1}isRenderEnabled(){return this.drawEnabled&&this.m_visible&&null!=this.m_display&&this.m_display.__$ruid>-1}updateBounds(){if(null!=this.m_transfrom){if(this.m_transStatus=h.default.UPDATE_TRANSFORM,null!=this.m_mesh&&this.m_localBounds!=this.m_mesh.bounds){this.m_localBounds.reset();let t=this.m_mesh.getIVS();this.m_localBounds.addFloat32AndIndicesArr(this.m_mesh.getVS(),t.subarray(this.m_display.ivsIndex,this.m_display.ivsIndex+this.m_display.ivsCount)),this.m_localBounds.update()}this.update()}}updateLocalBoundsVS(t){let e=t.min,i=t.max;null==this.m_lBoundsVS&&(this.m_lBoundsVS=new Float32Array(24));let s=this.m_lBoundsVS;s[0]=e.x,s[1]=e.y,s[2]=e.z,s[3]=i.x,s[4]=e.y,s[5]=e.z,s[6]=e.x,s[7]=e.y,s[8]=i.z,s[9]=i.x,s[10]=e.y,s[11]=i.z,s[12]=e.x,s[13]=i.y,s[14]=e.z,s[15]=i.x,s[16]=i.y,s[17]=e.z,s[18]=e.x,s[19]=i.y,s[20]=i.z,s[21]=i.x,s[22]=i.y,s[23]=i.z}updateGlobalBounds(){let t=u,e=this.m_localBounds;if(this.m_transStatus>h.default.UPDATE_POSITION||this.m_localBuondsVer!=e.version){let i=this.m_transfrom.updateStatus;if(this.m_transfrom.update(),this.m_localBuondsVer!=e.version||i!=this.m_transfrom.updateStatus){this.m_localBuondsVer=e.version,this.updateLocalBoundsVS(e);let i=this.m_lBoundsVS,s=t.s_boundsOutVS;this.m_transfrom.getMatrix().transformVectors(i,24,s),this.m_globalBounds.reset(),this.m_globalBounds.addFloat32Arr(s),this.m_globalBounds.update()}}else{t.s_prePos.setXYZ(0,0,0),t.s_pos.setXYZ(0,0,0);let e=this.m_transfrom.getMatrix(!1);e.transformVector3Self(t.s_prePos),this.m_transfrom.update(),e=this.m_transfrom.getMatrix(!1),e.transformVector3Self(t.s_pos),t.s_pos.subtractBy(t.s_prePos);let i=this.m_globalBounds;i.min.addBy(t.s_pos),i.max.addBy(t.s_pos),i.center.addBy(t.s_pos),++this.m_globalBounds.version}}update(){this.m_transfrom.updatedStatus>this.m_transStatus&&(this.m_transStatus=this.m_transfrom.updatedStatus),this.m_transStatus!=h.default.UPDATE_NONE&&(null!=this.m_mesh&&null!=this.m_globalBounds?this.updateGlobalBounds():this.m_transfrom.update(),this.m_transStatus=h.default.UPDATE_NONE,this.m_transfrom.updatedStatus=this.m_transStatus)}destroy(){null!=this.m_eventDispatcher&&(this.m_eventDispatcher.destroy(),this.m_eventDispatcher=null),null!=this.m_transfrom&&this.isFree()&&(null!=this.m_display&&(this.m_mesh.__$detachVBuf(this.m_display.vbuf),o.default.Restore(this.m_display),this.m_display=null),h.default.Restore(this.m_transfrom),this.m_transfrom=null,null!=this.m_mesh&&(this.m_mesh.__$detachThis(),this.m_mesh=null),this.__$setParent(null),this.m_visible=!0,this.m_drawEnabled=!0,this.m_renderProxy=null,this.__$rseFlag=a.default.DEFAULT),this.m_globalBounds=null,this.m_localBounds=null,this.m_pipeLine=null}toString(){return"DisplayEntity(name="+this.name+",uid = "+this.m_uid+", rseFlag = "+this.__$rseFlag+")"}}u.s_uid=0,u.s_boundsOutVS=new Float32Array(24),u.s_pos=new r.default,u.s_prePos=new r.default,e.default=u},4301:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.pointLightsTotal=1,this.directionLightsTotal=1,this.spotLightsTotal=0,this.vsmFboIndex=0,this.vsmEnabled=!0,this.loadAllShaderCode=!1,this.shaderCodeBinary=!1,this.shaderLibVersion="",this.shaderFileNickname=!1,this.lambertMaterialEnabled=!0,this.pbrMaterialEnabled=!0,this.buildBinaryFile=!1}}e.MaterialContextParam=s},"4a54":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s(i("3b73")),r=s(i("81ce")),n=s(i("f208")),l=i("c164");class h{constructor(t){this.m_versionDeclare="#version 300 es\n",this.m_preciousCode="precision mediump float;\n",this.m_fragExt=[],this.m_vertExt=[],this.m_defineNames=[],this.m_defineValues=[],this.m_vertLayoutNames=[],this.m_vertLayoutTypes=[],this.m_fragOutputPrecises=[],this.m_fragOutputNames=[],this.m_fragOutputTypes=[],this.m_vertUniformNames=[],this.m_vertUniformTypes=[],this.m_fragUniformNames=[],this.m_fragUniformTypes=[],this.m_varyingNames=[],this.m_varyingTypes=[],this.m_fragFunctionBlocks=[],this.m_vertFunctionBlocks=[],this.m_textureSampleTypes=[],this.m_texturePrecises=[],this.m_textureMacroNames=[],this.m_texturePrecise="",this.m_textureFlags=[],this.m_vertObjMat=!1,this.m_vertViewMat=!1,this.m_vertProjMat=!1,this.m_fragObjMat=!1,this.m_fragViewMat=!1,this.m_fragProjMat=!1,this.m_vertHeadCode="",this.m_vertMainCode="",this.m_fragHeadCode="",this.m_fragMainCode="",this.m_uniqueNSKeyString="",this.m_uniqueNSKeysTotal=10,this.m_use2DMap=!1,this.m_preCompileInfo=null,this.fragHeadCodeUnlock=!0,this.fragMainCodeUnlock=!0,this.vertHeadCodeUnlock=!0,this.vertMainCodeUnlock=!0,this.gamma=!0,this.autoBuildHeadCodeEnabled=!0,this.mathDefineEanbled=!0,this.normalEnabled=!1,this.normalMapEnabled=!1,this.mapLodEnabled=!1,this.derivatives=!1,this.vertMatrixInverseEnabled=!1,this.vtxUVTransfromEnabled=!1,this.fragMatrixInverseEnabled=!1;let e=this;e.uniform=t}getUniqueNSKeyID(){throw Error("can not use this function !!!")}getUniqueNSKeyString(){let t=this.m_uniqueNSKeyString;return this.vtxUVTransfromEnabled&&(t+="VtxUVT"),this.normalEnabled&&(t+="Nor"),this.uniform.getUniqueNSKeyString()+t}reset(){this.m_vertObjMat=!0,this.m_vertViewMat=!0,this.m_vertProjMat=!0,this.m_fragObjMat=!1,this.m_fragViewMat=!1,this.m_fragProjMat=!1,this.fragHeadCodeUnlock=!0,this.fragMainCodeUnlock=!0,this.vertHeadCodeUnlock=!0,this.vertMainCodeUnlock=!0,this.gamma=!0,this.autoBuildHeadCodeEnabled=!0,this.m_use2DMap=!1,this.m_vertHeadCode="",this.m_vertMainCode="",this.m_fragHeadCode="",this.m_fragMainCode="",this.m_uniqueNSKeyString="",this.m_vertExt=[],this.m_fragExt=[],this.m_vertLayoutNames=[],this.m_vertLayoutTypes=[],this.m_fragOutputPrecises=[],this.m_fragOutputNames=[],this.m_fragOutputTypes=[],this.m_varyingNames=[],this.m_varyingTypes=[],this.m_vertUniformNames=[],this.m_vertUniformTypes=[],this.m_fragUniformNames=[],this.m_fragUniformTypes=[],this.m_fragFunctionBlocks=[],this.m_vertFunctionBlocks=[],this.m_defineNames=[],this.m_defineValues=[],this.m_textureSampleTypes=[],this.m_texturePrecises=[],this.m_textureMacroNames=[],this.m_textureFlags=[],this.m_texturePrecise="",this.mathDefineEanbled=!0,this.normalEnabled=!1,this.normalMapEnabled=!1,this.mapLodEnabled=!1,this.vertMatrixInverseEnabled=!1,this.fragMatrixInverseEnabled=!1,this.vtxUVTransfromEnabled=!1,this.m_preCompileInfo=null,this.uniform.reset()}addUniqueNSKeyString(t){this.m_uniqueNSKeyString+=t}getPreCompileInfo(){let t=this.m_preCompileInfo;return this.m_preCompileInfo=null,t}useHighPrecious(){this.m_preciousCode="precision highp float;"}useMediumPrecious(){this.m_preciousCode="precision mediump float;"}useLowPrecious(){this.m_preciousCode="precision lowp float;"}addDefine(t,e="1"){return!this.m_defineNames.includes(t)&&(this.m_defineNames.push(t),this.m_defineValues.push(e),!0)}addVertLayout(t,e){this.m_vertLayoutNames.includes(e)||(this.m_vertLayoutNames.push(e),this.m_vertLayoutTypes.push(t))}addFragOutputHighp(t,e){this.m_fragOutputNames.includes(e)||(this.m_fragOutputPrecises.push("highp"),this.m_fragOutputNames.push(e),this.m_fragOutputTypes.push(t))}addFragOutput(t,e){this.m_fragOutputNames.includes(e)||(this.m_fragOutputPrecises.push(""),this.m_fragOutputNames.push(e),this.m_fragOutputTypes.push(t))}addVarying(t,e){this.m_varyingNames.includes(e)||(this.m_varyingNames.push(e),this.m_varyingTypes.push(t))}addVertUniform(t,e,i=0){this.m_vertUniformNames.includes(e)||(i>0?this.m_vertUniformNames.push(e+"["+i+"]"):this.m_vertUniformNames.push(e),this.m_vertUniformTypes.push(t))}addVertUniformParam(t){this.addVertUniform(t.type,t.name,t.arrayLength)}addFragUniform(t,e,i=0){this.m_fragUniformNames.includes(e)||(i>0?this.m_fragUniformNames.push(e+"["+i+"]"):this.m_fragUniformNames.push(e),this.m_fragUniformTypes.push(t))}addFragUniformParam(t){this.addFragUniform(t.type,t.name,t.arrayLength)}addVertAndFragUniform(t,e,i=0){this.addVertUniform(t,e,i),this.addFragUniform(t,e,i)}addFragFunction(t){this.m_fragFunctionBlocks.push(t)}addVertFunction(t){this.m_vertFunctionBlocks.push(t)}useTexturePreciseHighp(){this.m_texturePrecise="highp"}addTextureSample2D(t="",e=!0,i=!0,s=!1){if(""==t||!this.m_textureMacroNames.includes(t)){this.m_textureSampleTypes.push("sampler2D"),this.m_textureMacroNames.push(t),this.m_texturePrecises.push(this.m_texturePrecise);let a=0;i&&(a|=2),s&&(a|=4),this.m_textureFlags.push(a),this.m_texturePrecise="",e&&(this.m_use2DMap=!0)}}addTextureSampleCube(t="",e=!0,i=!1){if(""==t||!this.m_textureMacroNames.includes(t)){this.m_textureSampleTypes.push("samplerCube"),this.m_textureMacroNames.push(t),this.m_texturePrecises.push(this.m_texturePrecise);let s=0;e&&(s|=2),i&&(s|=4),this.m_textureFlags.push(s),this.m_texturePrecise=""}}addTextureSample3D(t="",e=!0,i=!1){if(""==t||!this.m_textureMacroNames.includes(t)){this.m_textureSampleTypes.push("sampler3D"),this.m_textureMacroNames.push(t),this.m_texturePrecises.push(this.m_texturePrecise);let s=0;e&&(s|=2),i&&(s|=4),this.m_textureFlags.push(s),this.m_texturePrecise=""}}isHaveTexture(){return this.m_textureSampleTypes.length>0}isHaveTexture2D(){return this.m_use2DMap}useVertSpaceMats(t=!0,e=!0,i=!0){this.m_vertObjMat=t,this.m_vertViewMat=e,this.m_vertProjMat=i}useFragSpaceMats(t=!0,e=!0,i=!0){this.m_fragObjMat=t,this.m_fragViewMat=e,this.m_fragProjMat=i}addVertExtend(t){this.m_vertExt.push(t)}addFragExtend(t){this.m_fragExt.push(t)}addVertHeadCode(t){""!=t&&(this.m_vertHeadCode+="\n"+t)}addVertMainCode(t){""!=t&&(this.m_vertMainCode+="\n"+t)}addFragHeadCode(t){""!=t&&(this.m_fragHeadCode+="\n"+t)}addFragMainCode(t){""!=t&&(this.m_fragMainCode+="\n"+t)}addShaderObject(t){this.fragHeadCodeUnlock&&this.addFragHeadCode(t.frag_head),this.fragMainCodeUnlock&&this.addFragMainCode(t.frag_body),this.vertHeadCodeUnlock&&this.addVertHeadCode(t.vert_head),this.vertMainCodeUnlock&&this.addVertMainCode(t.vert_body)}addShaderObjectHead(t){this.fragHeadCodeUnlock&&this.addFragHeadCode(t.frag_head),this.vertHeadCodeUnlock&&this.addVertMainCode(t.vert_head)}autoBuildHeadCode(){this.addVertLayout("vec3","a_vs"),(this.m_use2DMap||this.m_vertLayoutNames.includes("a_uvs"))&&(this.addVertLayout("vec2","a_uvs"),this.addVarying("vec2","v_uv")),(this.normalEnabled||this.normalMapEnabled||this.m_vertLayoutNames.includes("a_nvs"))&&(this.addVertLayout("vec3","a_nvs"),this.addVarying("vec3","v_worldNormal"),this.addVarying("vec3","v_worldPosition"),this.addDefine("VOX_USE_NORMAL"),this.vertMatrixInverseEnabled=!0);let t=["a_vs","a_uvs","a_nvs"],e=[],i=[];for(;t.length>0;){let s=this.m_vertLayoutNames.indexOf(t[0]);s>=0&&(e.push(this.m_vertLayoutNames[s]),i.push(this.m_vertLayoutTypes[s]),this.m_vertLayoutNames.splice(s,1),this.m_vertLayoutTypes.splice(s,1)),t.shift()}this.m_vertLayoutNames=e.concat(this.m_vertLayoutNames),this.m_vertLayoutTypes=i.concat(this.m_vertLayoutTypes),this.vtxUVTransfromEnabled&&this.addDefine("VOX_VTX_TRANSFORM_PARAM_INDEX","0")}buildFragCode(){this.autoBuildHeadCodeEnabled&&this.autoBuildHeadCode(),this.m_fragOutputNames.length<1&&this.addFragOutput("vec4","FragColor0");let t=0,e=0,i="";for((a.default.FRAG_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED||a.default.IsMobileWeb())&&this.useHighPrecious(),a.default.IsWebGL2()&&(i+=this.m_versionDeclare),this.m_preCompileInfo=new n.default,this.m_preCompileInfo.info="\n//##COMPILE_INFO_BEGIN",this.m_preCompileInfo.info+="\n//##COMPILE_INFO_END",t=0,e=this.m_fragExt.length;t<e;t++)i+="\n"+this.m_fragExt[t];for(a.default.IsWebGL1()&&(this.m_fragOutputNames.length>1&&(i+="\n#extension GL_EXT_draw_buffers: require"),(this.normalMapEnabled||this.derivatives)&&(i+="\n#extension GL_OES_standard_derivatives : enable"),this.mapLodEnabled&&(i+="\n#extension GL_EXT_shader_texture_lod : enable")),a.default.IsMobileWeb()?i+="\nprecision highp float;":i+="\n"+this.m_preciousCode,a.default.IsWebGL2()?(i+="\n#define VOX_GLSL_ES3 1",i+="\n#define VOX_IN in",this.mapLodEnabled&&(i+="\n#define VOX_TextureCubeLod textureLod",i+="\n#define VOX_Texture2DLod textureLod"),i+="\n#define VOX_Texture2D texture",i+="\n#define VOX_TextureCube texture"):(i+="\n#define VOX_GLSL_ES2 1",i+="\n#define VOX_IN varying",this.mapLodEnabled&&(i+="\n#define VOX_TextureCubeLod textureCubeLodEXT",i+="\n#define VOX_Texture2DLod texture2DLodEXT"),i+="\n#define VOX_TextureCube textureCube",i+="\n#define VOX_Texture2D texture2D"),this.mathDefineEanbled&&(i+=l.MathShaderCode.BasePredefined),e=this.m_defineNames.length,t=0;t<e;t++)""!=this.m_defineValues[t]?i+="\n#define "+this.m_defineNames[t]+" "+this.m_defineValues[t]:i+="\n#define "+this.m_defineNames[t]+" 1";for(t=0,e=this.m_textureMacroNames.length;t<e;t++)""!=this.m_textureMacroNames[t]&&0!=(2&this.m_textureFlags[t])&&(i+="\n#define "+this.m_textureMacroNames[t]+" u_sampler"+t);for(this.m_use2DMap&&(i+="\n#define VOX_USE_2D_MAP 1"),t=0,e=this.m_textureSampleTypes.length;t<e;t++)0!=(2&this.m_textureFlags[t])&&(""==this.m_texturePrecises[t]?i+="\nuniform "+this.m_textureSampleTypes[t]+" u_sampler"+t+";":i+="\nuniform "+this.m_texturePrecises[t]+" "+this.m_textureSampleTypes[t]+" u_sampler"+t+";");for(t=0,e=this.m_fragUniformTypes.length;t<e;t++)i+="\nuniform "+this.m_fragUniformTypes[t]+" "+this.m_fragUniformNames[t]+";";if(this.m_fragObjMat&&(i+="\nuniform mat4 u_objMat;"),this.m_fragViewMat&&(i+="\nuniform mat4 u_viewMat;"),this.m_fragProjMat&&(i+="\nuniform mat4 u_projMat;"),e=this.m_varyingNames.length,a.default.IsWebGL2())for(t=0;t<e;t++)i+="\nin "+this.m_varyingTypes[t]+" "+this.m_varyingNames[t]+";";else for(t=0;t<e;t++)i+="\nvarying "+this.m_varyingTypes[t]+" "+this.m_varyingNames[t]+";";for(i+=l.ShaderCode.BasePredefined,this.fragMatrixInverseEnabled&&a.default.IsWebGL1()&&(this.addVertFunction(r.default.__glslInverseMat3),this.addVertFunction(r.default.__glslInverseMat4)),i+=this.m_fragHeadCode,t=0,e=this.m_fragFunctionBlocks.length;t<e;t++)i+="\n"+this.m_fragFunctionBlocks[t];if(t=0,e=this.m_fragOutputNames.length,a.default.IsWebGL2())for(;t<e;t++)""!=this.m_fragOutputPrecises[t]?i+="\nlayout(location = "+t+") out "+this.m_fragOutputPrecises[t]+" "+this.m_fragOutputTypes[t]+" "+this.m_fragOutputNames[t]+";":i+="\nlayout(location = "+t+") out "+this.m_fragOutputTypes[t]+" "+this.m_fragOutputNames[t]+";";else 1==e&&(i+="\n#define "+this.m_fragOutputNames[t]+" gl_FragColor");let s=!1,h=this.m_fragMainCode.indexOf("{");if(h>0){let t=this.m_fragMainCode.slice(0,h);s=t.indexOf(" main")>0,s||(s=this.m_fragMainCode.indexOf(" main")>0)}if(s?i+=this.m_fragMainCode:(i+="\nvoid main() {\n",i+=this.m_fragMainCode,i+="\n}\n"),e=this.m_fragOutputNames.length,a.default.IsWebGL1()&&e>1)for(t=0;t<e;t++){let e=new RegExp(this.m_fragOutputNames[t],"g");i=i.replace(e,"gl_FragData["+t+"]")}return i}buildVertCode(){let t=0,e=0,i="";for(a.default.VERT_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED&&this.useHighPrecious(),a.default.IsWebGL2()&&(i+=this.m_versionDeclare),t=0,e=this.m_vertExt.length;t<e;t++)i+="\n"+this.m_vertExt[t];for(a.default.IsMobileWeb()?i+="\nprecision highp float;":i+="\n"+this.m_preciousCode,a.default.IsWebGL2()?(i+="\n#define VOX_GLSL_ES3 1",i+="\n#define VOX_IN in",this.mapLodEnabled&&(i+="\n#define VOX_TextureCubeLod textureLod",i+="\n#define VOX_Texture2DLod textureLod"),i+="\n#define VOX_Texture2D texture",i+="\n#define VOX_TextureCube texture"):(i+="\n#define VOX_GLSL_ES2 1",i+="\n#define VOX_IN varying",this.mapLodEnabled&&(i+="\n#define VOX_TextureCubeLod textureCubeLodEXT",i+="\n#define VOX_Texture2DLod texture2DLodEXT"),i+="\n#define VOX_TextureCube textureCube",i+="\n#define VOX_Texture2D texture2D"),a.default.IsWebGL2()?i+="\n#define VOX_OUT out":i+="\n#define VOX_OUT varying",this.mathDefineEanbled&&(i+=l.MathShaderCode.BasePredefined),e=this.m_defineNames.length,t=0;t<e;t++)""!=this.m_defineValues[t]?i+="\n#define "+this.m_defineNames[t]+" "+this.m_defineValues[t]:i+="\n#define "+this.m_defineNames[t];for(t=0,e=this.m_textureMacroNames.length;t<e;t++)""!=this.m_textureMacroNames[t]&&0!=(4&this.m_textureFlags[t])&&(i+="\n#define "+this.m_textureMacroNames[t]+" u_sampler"+t);for(this.m_use2DMap&&(i+="\n#define VOX_USE_2D_MAP 1"),t=0,e=this.m_textureSampleTypes.length;t<e;t++)0!=(4&this.m_textureFlags[t])&&(""==this.m_texturePrecises[t]?i+="\nuniform "+this.m_textureSampleTypes[t]+" u_sampler"+t+";":i+="\nuniform "+this.m_texturePrecises[t]+" "+this.m_textureSampleTypes[t]+" u_sampler"+t+";");if(e=this.m_vertLayoutNames.length,a.default.IsWebGL2())for(t=0;t<e;t++)i+="\nlayout(location = "+t+") in "+this.m_vertLayoutTypes[t]+" "+this.m_vertLayoutNames[t]+";";else for(t=0;t<e;t++)i+="\nattribute "+this.m_vertLayoutTypes[t]+" "+this.m_vertLayoutNames[t]+";";for(e=this.m_vertUniformTypes.length,t=0;t<e;t++)i+="\nuniform "+this.m_vertUniformTypes[t]+" "+this.m_vertUniformNames[t]+";";if(this.m_vertObjMat&&(i+="\nuniform mat4 u_objMat;"),this.m_vertViewMat&&(i+="\nuniform mat4 u_viewMat;"),this.m_vertProjMat&&(i+="\nuniform mat4 u_projMat;"),e=this.m_varyingNames.length,a.default.IsWebGL2())for(t=0;t<e;t++)i+="\nout "+this.m_varyingTypes[t]+" "+this.m_varyingNames[t]+";";else for(t=0;t<e;t++)i+="\nvarying "+this.m_varyingTypes[t]+" "+this.m_varyingNames[t]+";";for(i+=l.ShaderCode.BasePredefined,i+=l.ShaderCode.VertPredefined,this.vertMatrixInverseEnabled&&a.default.IsWebGL1()&&(this.addVertFunction(r.default.__glslInverseMat3),this.addVertFunction(r.default.__glslInverseMat4)),i+=this.m_vertHeadCode,t=0,e=this.m_vertFunctionBlocks.length;t<e;t++)i+="\n"+this.m_vertFunctionBlocks[t];let s=!1,n=this.m_vertMainCode.indexOf("{");if(n>0){let t=this.m_vertMainCode.slice(0,n);s=t.indexOf(" main")>0,s||(s=this.m_vertMainCode.indexOf(" main")>0)}return s?i+=this.m_vertMainCode:(i+="\nvoid main() {\n",i+=this.m_vertMainCode,i+="\n}\n"),i}}e.default=h},"4cf7":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("7918");class a{constructor(){this.m_imgTexList=[],this.m_bytesTexList=[],this.m_floatTexList=[],this.m_wrapperTexList=[]}addTexture(t){switch(t.getType()){case s.TextureProxyType.Image:this.m_imgTexList.push(t);break;case s.TextureProxyType.Bytes:this.m_bytesTexList.push(t);break;case s.TextureProxyType.Float:this.m_floatTexList.push(t);break;case s.TextureProxyType.Wrapper:this.m_wrapperTexList.push(t);break;default:break}}getTexture(t){switch(t){case s.TextureProxyType.Image:if(this.m_imgTexList.length>0)return this.m_imgTexList.pop();break;case s.TextureProxyType.Bytes:if(this.m_bytesTexList.length>0)return this.m_bytesTexList.pop();break;case s.TextureProxyType.Float:if(this.m_floatTexList.length>0)return this.m_floatTexList.pop();break;case s.TextureProxyType.Wrapper:if(this.m_wrapperTexList.length>0)return this.m_wrapperTexList.pop();break;default:break}return null}}e.TexturePool=a,e.default=a},"4efa":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("839a"),a=i("a9f4");class r{constructor(t){this.m_coderBuilder=null,this.m_uniform=null,this.m_texList=[],this.m_coderBuilder=t,this.m_uniform=t.uniform}getCodeBuilder(){return this.m_coderBuilder}reset(){this.m_texList=[]}getTextures(){return this.m_texList}getTexturesTotal(){return this.m_texList.length}addDiffuseMap(t){null!=t&&(this.m_uniform.addDiffuseMap(),this.m_texList.push(t))}addNormalMap(t){null!=t&&(this.m_uniform.addNormalMap(),this.m_texList.push(t))}addParallaxMap(t,e){null!=t&&(this.m_uniform.addParallaxMap(e),this.m_texList.push(t))}addDisplacementMap(t,e){null!=t&&(this.m_uniform.addDisplacementMap(e),this.m_texList.push(t))}addSpecularMap(t,e=s.SpecularMode.Default){null!=t&&(this.m_uniform.addSpecularMap(e),this.m_texList.push(t))}addShadowMap(t,e=a.ShadowMode.VSM){null!=t&&(this.m_uniform.addShadowMap(e),this.m_texList.push(t))}addSpecularEnvMap(t,e=!0){null!=t&&(this.m_uniform.addSpecularEnvMap(e),this.m_texList.push(t))}addAOMap(t){null!=t&&(this.m_uniform.addAOMap(),this.m_texList.push(t))}addRoughnessMap(t){null!=t&&(this.m_uniform.addRoughnessMap(),this.m_texList.push(t))}addMetalnessMap(t){null!=t&&(this.m_uniform.addMetalnessMap(),this.m_texList.push(t))}addARMMap(t){null!=t&&(this.m_uniform.addARMMap(),this.m_texList.push(t))}add2DMap(t,e="",i=!0,s=!0,a=!1){null!=t&&(this.m_uniform.add2DMap(e,i,s,a),this.m_texList.push(t))}addCubeMap(t,e="",i=!0,s=!1){null!=t&&(this.m_uniform.addCubeMap(e,i,s),this.m_texList.push(t))}add3DMap(t,e="",i=!0,s=!1){null!=t&&(this.m_uniform.add3DMap(e,i,s),this.m_texList.push(t))}}e.ShaderTextureBuilder=r},"519e":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s(i("8a0a")),r=s(i("cb29")),n=s(i("e7d2")),l=s(i("fecb")),h=s(i("35fa"));class _ extends r.default{constructor(t=a.default.VTX_STATIC_DRAW){super(t),this.m_initIVS=null,this.m_boundsChanged=!0,this.m_vs=null,this.m_uvs=null,this.m_nvs=null,this.m_cvs=null,this.m_tvs=null,this.m_btvs=null,this.m_rayTester=null,this.m_boundsVersion=-2,this.autoBuilding=!0,this.vsStride=3,this.uvsStride=2,this.nvsStride=3,this.cvsStride=3}setRayTester(t){this.m_rayTester=t}setVS(t){return this.m_vs=t,this.m_boundsChanged=!0,this}getVS(){return this.m_vs}setUVS(t){return this.m_uvs=t,this}getUVS(){return this.m_uvs}setNVS(t){return this.m_nvs=t,this}getNVS(){return this.m_nvs}setTVS(t){return this.m_tvs=t,this}getTVS(){return this.m_tvs}setBTVS(t){return this.m_btvs=t,this}setCVS(t){return this.m_cvs=t,this}getBTVS(){return this.m_btvs}setIVS(t){return this.m_initIVS=t,this.m_ivs=t,this.m_boundsChanged=!0,this}initializeFromGeometry(t){this.m_vs=t.getVS(),this.m_uvs=t.getUVS(),this.m_nvs=t.getNVS(),this.m_tvs=t.getTVS(),this.m_btvs=t.getBTVS(),this.m_cvs=t.getCVS(),this.m_ivs=t.getIVS(),this.m_initIVS=this.m_ivs,this.m_boundsChanged=!0,this.initialize()}initialize(){if(null!=this.m_vs){if(this.autoBuilding&&(null==this.bounds?(this.bounds=new l.default,this.bounds.addFloat32Arr(this.m_vs),this.bounds.update()):(this.m_boundsChanged||this.m_boundsVersion==this.bounds.version)&&(this.bounds.reset(),this.bounds.addFloat32Arr(this.m_vs),this.bounds.update())),this.m_boundsVersion=this.bounds.version,this.m_boundsChanged=!1,this.m_ivs=this.m_initIVS,n.default.Reset(),n.default.AddFloat32Data(this.m_vs,this.vsStride),this.isVBufEnabledAt(a.default.VBUF_UVS_INDEX)&&n.default.AddFloat32Data(this.m_uvs,this.uvsStride),this.isVBufEnabledAt(a.default.VBUF_NVS_INDEX)){if(null==this.m_nvs){let t=this.m_ivs.length/3;this.m_nvs=new Float32Array(this.m_vs.length),h.default.ClacTrisNormal(this.m_vs,this.m_vs.length,t,this.m_ivs,this.m_nvs)}n.default.AddFloat32Data(this.m_nvs,this.nvsStride)}if(this.isVBufEnabledAt(a.default.VBUF_CVS_INDEX)&&n.default.AddFloat32Data(this.m_cvs,this.cvsStride),this.isVBufEnabledAt(a.default.VBUF_TVS_INDEX)&&(n.default.AddFloat32Data(this.m_tvs,3),n.default.AddFloat32Data(this.m_btvs,3)),n.default.vbWholeDataEnabled=this.vbWholeDataEnabled,this.vtCount=this.m_ivs.length,this.autoBuilding&&(this.vtxTotal=this.m_vs.length/this.vsStride,this.updateWireframeIvs(),this.vtCount=this.m_ivs.length,this.trisNumber=this.vtCount/3),null!=this.m_vbuf)n.default.UpdateBufData(this.m_vbuf);else{let t=this.getBufDataUsage(),e=this.getBufSortFormat();this.m_vbuf=n.default.CreateBySaveData(t,e),this.vbWholeDataEnabled?this.m_vbuf=n.default.CreateBySaveData(t,e):this.m_vbuf=n.default.CreateBySaveDataSeparate(t)}this.m_vbuf.setUintIVSData(this.m_ivs),this.buildEnd()}}testRay(t,e,i,s){return null!=this.m_rayTester?this.m_rayTester.testRay(t,e,i,s):-1}__$destroy(){this.isResFree()&&(this.bounds=null,null!=this.m_rayTester&&(this.m_rayTester.destroy(),this.m_rayTester=null),this.m_vs=null,this.m_uvs=null,this.m_nvs=null,this.m_cvs=null,this.m_tvs=null,this.m_btvs=null,this.m_initIVS=null,super.__$destroy())}}e.default=_},5216:function(t,e,i){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t["ENV_LIGHT_PARAM"]=0]="ENV_LIGHT_PARAM",t[t["ENV_AMBIENT_LIGHT"]=1]="ENV_AMBIENT_LIGHT",t[t["FOG"]=2]="FOG",t[t["FOG_EXP2"]=3]="FOG_EXP2",t[t["VSM_SHADOW"]=4]="VSM_SHADOW",t[t["GLOBAL_LIGHT"]=5]="GLOBAL_LIGHT"}(s||(s={})),e.MaterialPipeType=s},"52e0":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i("7918"),r=s(i("ffc0")),n=s(i("1f61")),l=s(i("5deb")),h=s(i("0851"));class _ extends h.default{constructor(t,e){super(t,e,!1),this.m_imgDataList=null,this.m_texTarget=l.default.TEXTURE_CUBE,this.mipmapEnabled=!0,this.m_type=a.TextureProxyType.BytesCube}toAlphaFormat(){this.srcFormat=r.default.ALPHA,this.internalFormat=r.default.ALPHA,this.unpackAlignment=1}toRedFormat(){this.srcFormat=r.default.RED,this.internalFormat=r.default.RED,this.unpackAlignment=1}toRGBFormat(){this.srcFormat=r.default.RGB,this.internalFormat=r.default.RGB,this.unpackAlignment=1}toRGBAFormat(){this.srcFormat=r.default.RGBA,this.internalFormat=r.default.RGBA,this.unpackAlignment=4}setDataFromBytesToFaceAt(t,e,i,s,a=0){if(null==this.m_imgDataList&&(this.m_imgDataList=[null,null,null,null,null,null]),i>0&&s>0){0==t&&a<1&&(this.m_texWidth=i,this.m_texHeight=s,this.m_miplevel=a),null==this.m_imgDataList[t]&&(this.m_imgDataList[t]=new Array(16));let r=this.m_imgDataList[t];r[a]={width:i,height:s,imgData:e,miplevel:a},this.m_haveRData=null!=r[a].imgData}}uploadData(t){let e,i,s=t.getRC(),a=null,l=this.getWidth(),h=this.getHeight();for(let _=0;_<6;++_){let t=this.m_imgDataList[_];if(this.mipmapEnabled&&this.m_generateMipmap)a=t[0],s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+_,0,r.default.ToGL(s,this.internalFormat),l,h,0,r.default.ToGL(s,this.srcFormat),n.default.ToGL(s,this.dataType),a.imgData);else{e=l,i=h;let o=0;for(;e>0||i>0;)null!=t[o]&&(a=t[o],s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+_,o,r.default.ToGL(s,this.internalFormat),e,i,0,r.default.ToGL(s,this.srcFormat),n.default.ToGL(s,this.dataType),a.imgData)),e>0&&(e>>=1),i>0&&(i>>=1),++o}}this.version=0}toString(){return"[BytesCubeTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}__$destroy(){if(this.getAttachCount()<1){if(this.version=0,null!=this.m_imgDataList)for(let t=0;t<6;++t)null!=this.m_imgDataList[t]&&(this.m_imgDataList[t].imgData=null);super.__$destroy()}}}e.default=_},"557f":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i("7918"),r=s(i("ffc0")),n=s(i("5deb")),l=s(i("0851"));class h extends l.default{constructor(t,e,i=1,s=!1){super(t,e,s),this.m_bytes=null,this.m_tex3DDepth=1,this.internalFormat=r.default.R8,this.srcFormat=r.default.RED,this.m_tex3DDepth=i,this.m_texTarget=n.default.TEXTURE_3D,this.m_type=a.TextureProxyType.Texture3D,this.unpackAlignment=1}getDepth(){return this.m_tex3DDepth}uploadFromTypedArray(t,e=0){this.isGpuEnabled()||(this.m_bytes=t,this.m_miplevel=e,this.m_haveRData=!0)}uploadData(t){if(null!=this.m_bytes){let e=t.getRC();e.pixelStorei(e.UNPACK_ALIGNMENT,1),e.texImage3D(e.TEXTURE_3D,0,r.default.ToGL(e,this.internalFormat),this.m_texWidth,this.m_texHeight,this.m_tex3DDepth,0,r.default.ToGL(e,this.srcFormat),e.UNSIGNED_BYTE,this.m_bytes),e.pixelStorei(e.UNPACK_ALIGNMENT,4)}}__$destroy(){this.getAttachCount()<1&&(this.m_bytes=null,super.__$destroy())}toString(){return"[Texture3DProxy(width="+this.getWidth()+",height="+this.getHeight()+",depth="+this.getDepth()+")]"}}e.default=h},"5d04":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i("7918"),r=s(i("8d98")),n=s(i("ffc0")),l=s(i("1f61")),h=s(i("4cf7")),_=s(i("5e78")),o=s(i("fe7f")),u=s(i("9f3e")),m=s(i("f928")),d=s(i("eaee")),c=s(i("52e0")),f=s(i("d314")),p=s(i("557f")),g=s(i("da6a")),x=i("ccdf");class y{constructor(){this.m_texPool=new h.default,this.m_rttStore=null,this.m_renderProxy=null,this.m_texLoaders=[],this.m_clearDelay=128}addTexLoader(t){if(null!=t){let e=0,i=this.m_texLoaders.length;for(;e<i;++e)if(t==this.m_texLoaders[e])break;e>=i&&this.m_texLoaders.push(t)}}removeTexLoader(t){if(null!=t){let e=0,i=this.m_texLoaders.length;for(;e<i;++e)if(t==this.m_texLoaders[e]){this.m_texLoaders.slice(e,1);break}}}setRenderer(t){this.m_renderProxy=t,g.default.GetInstance().setRenderProxy(t),null==this.m_rttStore&&null!=t&&(this.m_rttStore=new x.RTTTextureStore(t))}getRTTStrore(){return this.m_rttStore}createWrapperTex(t,e,i=!1){return this.m_rttStore.createWrapperTex(t,e,i)}createRTTTex2D(t,e,i=!1){let s=this.m_rttStore.createRTTTex2D(t,e,i);return s.__$setRenderProxy(this.m_renderProxy),s}createImageTex2D(t,e,i=!1){let s=this.m_texPool.getTexture(a.TextureProxyType.Image);return null==s&&(s=new _.default(t,e,i)),s.__$setRenderProxy(this.m_renderProxy),s.mipmapEnabled=!0,s.setWrap(r.default.WRAP_REPEAT),s}createHalfFloatTex2D(t,e,i=!1){let s=this.m_texPool.getTexture(a.TextureProxyType.Float);return null==s&&(s=new m.default(t,e,i)),s.__$setRenderProxy(this.m_renderProxy),s.srcFormat=n.default.RGBA,s.dataType=l.default.HALF_FLOAT_OES,s}createFloatTex2D(t,e,i=!1){let s=this.m_texPool.getTexture(a.TextureProxyType.Float);return null==s&&(s=new m.default(t,e,i)),s.__$setRenderProxy(this.m_renderProxy),s}createUint16Tex2D(t,e,i=!1){return new u.default(t,e,i)}createFloatCubeTex(t,e,i=!1){return new d.default(t,e)}createBytesTex(t,e){let i=this.m_texPool.getTexture(a.TextureProxyType.Bytes);return null==i&&(i=new o.default(t,e)),i.__$setRenderProxy(this.m_renderProxy),i}createBytesCubeTex(t,e){let i=new c.default(t,e);return i.__$setRenderProxy(this.m_renderProxy),i}createImageCubeTex(t,e){let i=new f.default(t,e);return i.__$setRenderProxy(this.m_renderProxy),i}createTex3D(t,e,i=1){i<1&&(i=1);let s=new p.default(t,e,i);return s.__$setRenderProxy(this.m_renderProxy),s}createRGBATex2D(t,e,i){t=t>1?t:1,e=e>1?e:1;let s=t*e,a=this.createBytesTex(t,e),r=new Uint8Array(4*s),n=Math.round(255*i.r),l=Math.round(255*i.g),h=Math.round(255*i.b),_=Math.round(255*i.a),o=0,u=[n,l,h,_];for(let m=0;m<s;++m)r.set(u,o),o+=4;return a.setDataFromBytes(r,0,t,e,0,0,!1),a.__$setRenderProxy(this.m_renderProxy),a}createAlphaTex2D(t,e,i){t=t>1?t:1,e=e>1?e:1;let s=t*e,a=this.createBytesTex(t,e);a.toAlphaFormat();let r=new Uint8Array(s),n=Math.round(255*i);return r.fill(n,0,s),a.setDataFromBytes(r,0,t,e,0,0,!1),a.__$setRenderProxy(this.m_renderProxy),a}createAlphaTexBytes2D(t,e,i){let s=this.createBytesTex(t,e);return s.setDataFromBytes(i,0,t,e,0,0,!1),s.toAlphaFormat(),s.__$setRenderProxy(this.m_renderProxy),s}getCubeRTTTextureAt(t){return this.m_rttStore.getCubeRTTTextureAt(t)}createCubeRTTTextureAt(t,e,i){return this.m_rttStore.createCubeRTTTextureAt(t,e,i)}getRTTTextureAt(t){return this.m_rttStore.getRTTTextureAt(t)}createRTTTextureAt(t,e,i){return this.m_rttStore.createRTTTextureAt(t,e,i)}getDepthTextureAt(t){return this.m_rttStore.getDepthTextureAt(t)}createDepthTextureAt(t,e,i){return this.m_rttStore.createDepthTextureAt(t,e,i)}getRTTFloatTextureAt(t){return this.m_rttStore.getRTTFloatTextureAt(t)}createRTTFloatTextureAt(t,e,i){return this.m_rttStore.createRTTFloatTextureAt(t,e,i)}run(){let t=0,e=this.m_texLoaders.length;for(;t<e;++t)this.m_texLoaders[t].run();if(this.m_clearDelay<1){let t;this.m_clearDelay=128;let e=g.default.GetInstance().getFreeResUidMap(),i=32;for(const[s,a]of e){if(i<1)break;i--,a>2?(e.delete(s),t=g.default.GetInstance().removeTextureByUid(s),null!=t&&this.m_texPool.addTexture(t)):e.set(s,a+1)}}this.m_clearDelay--}}e.TextureBlock=y},"5deb":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{static GetValue(t,e){switch(e){case s.TEXTURE_2D:return t.TEXTURE_2D;case s.TEXTURE_2D_ARRAY:return t.TEXTURE_2D_ARRAY;case s.TEXTURE_CUBE:return t.TEXTURE_CUBE_MAP;case s.TEXTURE_3D:return t.TEXTURE_3D;default:break}return t.TEXTURE_2D}}s.TEXTURE_2D=20,s.TEXTURE_2D_ARRAY=22,s.TEXTURE_SHADOW_2D=23,s.TEXTURE_CUBE=25,s.TEXTURE_3D=30,e.default=s},"5e78":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i("7918"),r=s(i("8d98")),n=s(i("7181")),l=s(i("0851"));class h extends l.default{constructor(t,e,i=!1){super(t,e,i),this.m_texData=null,this.m_texDatas=null,this.m_texDatasLen=0,this.mipmapEnabled=!0,this.minFilter=r.default.LINEAR_MIPMAP_LINEAR,this.m_type=a.TextureProxyType.Image}getTexData(){return this.m_texData}setDataFromImage(t,e=0,i=0,s=0,a=!1){if(null!=t&&t.width>0&&t.height>0){this.m_haveRData=!0,e<0&&(e=0),e>15&&(e=15),e>=this.m_texDatasLen&&(this.m_texDatasLen=e+1);let r=this.m_texData;null!=r?this.m_texData.miplevel!=e?(null==this.m_texDatas&&(this.m_texDatas=[this.m_texData,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]),r=this.m_texDatas[e],null==r&&(r=n.default.Create(),r.miplevel=e,a=!0,this.m_texDatas[e]=r)):this.isGpuEnabled()&&(r.status=0):(r=this.m_texData=n.default.Create(),r.miplevel=e,a=!0,this.m_texWidth=t.width,this.m_texHeight=t.height),r.data==t&&r.offsetx==i&&r.offsety==s||(0==e&&(this.m_texWidth=t.width,this.m_texHeight=t.height),r.data=t,r.status=0,(r.width<t.width||r.height<t.height||a)&&(r.width=t.width,r.height=t.height,r.status=1),r.offsetx=i,r.offsety=s),this.version++}}uploadData(t){null!=this.m_texData&&this.dataUploadToGpu(t.getRC(),this.m_texData,this.m_texDatas,!0),this.version=0}__$updateToGpu(t){if(this.version>0&&t.hasResUid(this.getResUid())&&null!=this.m_texData){let e=t.getRC();this.__$updateToGpuBegin(t),this.dataUploadToGpu(e,this.m_texData,this.m_texDatas),this.__$buildParam(e),this.m_generateMipmap=!0}}__$destroy(){if(this.getAttachCount()<1){if(this.version=0,null!=this.m_texDatas){for(let t=0;t<this.m_texDatasLen;++t)n.default.Restore(this.m_texDatas[t]);this.m_texDatasLen=0,this.m_texDatas=null,this.m_texData=null}null!=this.m_texData&&(n.default.Restore(this.m_texData),this.m_texData=null),super.__$destroy()}}toString(){return"[ImageTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=h},"644c":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{static GetTypeByTypeNS(t){const e=s;switch(t){case"mat4":return e.SHADER_MAT4;case"mat3":return e.SHADER_MAT3;case"mat2":return e.SHADER_MAT2;case"float":return e.SHADER_FLOAT;case"int":return e.SHADER_INT;case"vec4":return e.SHADER_VEC4;case"vec3":return e.SHADER_VEC3;case"vec2":return e.SHADER_VEC2;case"vec4[]":return e.SHADER_VEC4FV;case"vec3[]":return e.SHADER_VEC3FV;case"vec2[]":return e.SHADER_VEC2FV;case"sampler2D":return e.SHADER_SAMPLER2D;case"sampler3D":return e.SHADER_SAMPLER3D;case"samplerCube":return e.SHADER_SAMPLERCUBE;default:break}return s.SHADER_UNDEFINED}static GetTypeNSByType(t){const e=s;switch(t){case e.SHADER_MAT4:return"mat4";case e.SHADER_MAT3:return"mat3";case e.SHADER_MAT2:return"mat2";case e.SHADER_FLOAT:return"float";case e.SHADER_VEC4:return"vec4";case e.SHADER_VEC3:return"vec3";case e.SHADER_VEC2:return"vec2";case e.SHADER_SAMPLER2D:return"sampler2D";case e.SHADER_SAMPLER3D:return"sampler3D";case e.SHADER_SAMPLERCUBE:return"samplerCube";case e.SHADER_UNDEFINED:return"undefined";default:break}return""}}s.ATTRINS_VTX_VS="a_vs",s.ATTRINS_VTX_UVS="a_uvs",s.ATTRINS_VTX_NVS="a_nvs",s.ATTRINS_VTX_CVS="a_cvs",s.UNIFORMNS_OBJ_MAT_NS="u_objMat",s.UNIFORMNS_VIEW_MAT_NS="u_viewMat",s.UNIFORMNS_PROJ_MAT_NS="u_projMat",s.SHADER_UNDEFINED=3010,s.SHADER_VEC2=3011,s.SHADER_VEC3=3012,s.SHADER_VEC4=3013,s.SHADER_VEC2FV=3014,s.SHADER_VEC3FV=3015,s.SHADER_VEC4FV=3016,s.SHADER_MAT2=3017,s.SHADER_MAT3=3018,s.SHADER_MAT4=3019,s.SHADER_FLOAT=3020,s.SHADER_INT=3021,s.SHADER_MAT2FV=3022,s.SHADER_MAT3FV=3023,s.SHADER_MAT4FV=3024,s.SHADER_SAMPLER2D=3031,s.SHADER_SAMPLERCUBE=3032,s.SHADER_SAMPLER3D=3033,s.SHADER_PRECISION_LOWP=3101,s.SHADER_PRECISION_MEDIUMP=3111,s.SHADER_PRECISION_HIGHP=3121,s.UNIFORM_TEX_SAMPLER2D="sampler2D",s.UNIFORM_TEX_SAMPLERCUBE="samplerCube",s.UNIFORM_TEX_SAMPLER3D="sampler3D",s.UNIFORMNS_TEX_SAMPLER_0="u_sampler0",s.UNIFORMNS_TEX_SAMPLER_1="u_sampler1",s.UNIFORMNS_TEX_SAMPLER_2="u_sampler2",s.UNIFORMNS_TEX_SAMPLER_3="u_sampler3",s.UNIFORMNS_TEX_SAMPLER_4="u_sampler4",s.UNIFORMNS_TEX_SAMPLER_5="u_sampler5",s.UNIFORMNS_TEX_SAMPLER_6="u_sampler6",s.UNIFORMNS_TEX_SAMPLER_7="u_sampler7",s.UNIFORMNS_TEX_SAMPLER_LIST=[s.UNIFORMNS_TEX_SAMPLER_0,s.UNIFORMNS_TEX_SAMPLER_1,s.UNIFORMNS_TEX_SAMPLER_2,s.UNIFORMNS_TEX_SAMPLER_3,s.UNIFORMNS_TEX_SAMPLER_4,s.UNIFORMNS_TEX_SAMPLER_5,s.UNIFORMNS_TEX_SAMPLER_6,s.UNIFORMNS_TEX_SAMPLER_7],e.default=s},"68aa":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.width=0,this.height=0,this.data=null,this.miplevel=0,this.status=1,this.offsetx=0,this.offsety=0}updateToGpu(t,e,i,s,a,r){1==this.status||r?t.texImage2D(e,this.miplevel,i,this.width,this.height,0,s,a,this.data):0==this.status&&t.texSubImage2D(e,this.miplevel,this.offsetx,this.offsety,this.width,this.height,s,a,this.data),this.status=-1}static Create(){return s.s_list.length>0?s.s_list.pop():new s}static Restore(t){null!=t&&(t.data=null,s.s_list.push(t))}}s.s_list=[],e.default=s},"69ed":function(t,e,i){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t["VertHead"]="vertHead",t["VertBody"]="vertBody",t["FragHead"]="fragHead",t["FragBody"]="fragBody"}(s||(s={})),e.ShaderCodeType=s},"6c6b":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s(i("0fc4")),r=s(i("faa5"));class n extends r.default{constructor(){super(),this.m_uniqueName="",this.decorator=null}initialize(t){super.initialize(t),this.m_uniqueName="MS_",t&&(this.m_uniqueName+="Tex")}createTextureList(){return this.m_texBuilder.reset(),this.decorator.buildTextureList(this.m_texBuilder),this.m_texBuilder.getTextures()}buildShader(){null!=this.decorator.vertUniform&&this.decorator.vertUniform.use(this.m_coder),this.decorator.buildShader(this.m_coder)}getShaderCodeObjectUUID(){return this.decorator.getShaderCodeObjectUUID()}getShaderCodeObject(){return this.decorator.getShaderCodeObject()}getUniqueShaderName(){let t=this.m_uniqueName+this.decorator.getUniqueName();return null!=this.decorator.vertUniform&&(t+=this.decorator.vertUniform.getUniqueNSKeyString()),t}}class l extends a.default{constructor(){super(),this.m_decorator=null,null==l.s_shdBufins&&(l.s_shdBufins=new n)}buildBuf(){let t=l.s_shdBufins,e=this.m_decorator;t.decorator=e,e.buildBufParams(),t.vertColorEnabled=e.vertColorEnabled,t.premultiplyAlpha=e.premultiplyAlpha,t.shadowReceiveEnabled=e.shadowReceiveEnabled,t.lightEnabled=e.lightEnabled,t.fogEnabled=e.fogEnabled,t.envAmbientLightEnabled=e.envAmbientLightEnabled,t.brightnessOverlayEnabeld=e.brightnessOverlayEnabeld,t.glossinessEnabeld=e.glossinessEnabeld,t.buildPipelineParams();let i=t.createTextureList(),s=e.vertUniform;null!=s&&s.getTextures(t.getShaderCodeBuilder(),i),t.getTexturesFromPipeline(i),super.setTextureList(i)}getCodeBuf(){return l.s_shdBufins}setTextureList(t){}setDecorator(t){this.m_decorator=t}getDecorator(){return this.m_decorator}createSelfUniformData(){let t=this.m_decorator.createUniformData();return t}destroy(){super.destroy(),this.m_decorator=null}}l.s_shdBufins=null,e.Material=l},"6e01":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{static Clamp(t,e,i){return Math.max(Math.min(t,i),e)}static IsPowerOf2(t){return 0==(t&t-1)}static CalcCeilPowerOfTwo(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}static CalcNearestCeilPow2(t){return Math.pow(2,Math.round(Math.log(t)/Math.LN2))}static CalcFloorCeilPow2(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}static DegreeToRadian(t){return s.MATH_PI_OVER_180*t}static Log2(t){return Math.log(t)/Math.LN2}static GetMaxMipMapLevel(t,e){return Math.round(s.Log2(Math.max(t,e))+1)}static SafeACos(t){return t<=-1?s.MATH_PI:t>=1?0:Math.acos(t)}static GetNearestCeilPow2(t){let e=1;while(e<t)e<<=1;return e}static GetMinRadian(t,e){return e%=s.MATH_2PI,t%=s.MATH_2PI,e<t?(e=s.MATH_2PI-t+e,e>s.MATH_PI?e-s.MATH_2PI:e):e>t?(t=s.MATH_2PI-e+t,t>s.MATH_PI?s.MATH_2PI-t:-t):0}static GetMinDegree(t,e){let i=0;return e>=270&&t<90?i=(e-(t+360))%180:e<=90&&t>=270?i=(e+360-t)%180:(i=e-t,i>180?(i-=360,i%=360):i<-180&&(i+=360,i%=360)),i}static GetDegreeByXY(t,e){if(Math.abs(t)<1e-5)return e>=0?270:90;let i=180*Math.atan(e/t)/Math.PI;return t>=0?i:180+i}static GetRadianByXY(t,e){if(Math.abs(t)<s.MATH_MIN_POSITIVE)return e>=0?s.MATH_1PER2PI:s.MATH_3PER2PI;let i=Math.atan(e/t);return t>=0?i:s.MATH_PI+i}static GetRadianByCos(t,e,i){var a=Math.acos(t);return e>=0?a:s.MATH_PI+a}}s.MATH_MIN_POSITIVE=1e-5,s.MATH_MAX_NEGATIVE=-1e-5,s.MATH_MAX_POSITIVE=268435454,s.MATH_MIN_NEGATIVE=-268435454,s.MATH_1_OVER_255=1/255,s.MATH_PI=Math.PI,s.MATH_2PI=2*s.MATH_PI,s.MATH_3PER2PI=1.5*s.MATH_PI,s.MATH_1PER2PI=.5*s.MATH_PI,s.MATH_1_OVER_PI=1/s.MATH_PI,s.MATH_1_OVER_360=1/360,s.MATH_1_OVER_180=1/180,s.MATH_180_OVER_PI=180/s.MATH_PI,s.MATH_PI_OVER_180=s.MATH_PI/180,s.MATH_LN2=.6931471805599453,e.default=s},"710f":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){if(this.m_useidList=[],this.m_removeidList=[],null!=s.s_ins)throw Error("ROVtxBufUidStore is a singleton class!!");s.s_ins=this}static GetInstance(){return s.s_ins}__$getRemovedListLen(){return this.m_removeidList.length}__$getRemovedList(){return this.m_removeidList}__$attachAt(t){if(t<this.m_useidList.length)++this.m_useidList[t];else{let e=this.m_useidList.length;for(;e<=t;++e)this.m_useidList.push(0);++this.m_useidList[t]}}__$detachAt(t){--this.m_useidList[t],this.m_useidList[t]<1&&(this.m_useidList[t]=0,this.m_removeidList.push(t))}getAttachCountAt(t){return t<this.m_useidList.length?this.m_useidList[t]:0}getAttachAllCount(){let t=0,e=0,i=this.m_useidList.length;for(;e<i;++e)this.m_useidList[e]>0&&(t+=this.m_useidList[e]);return t}}s.s_ins=null,e.default=s},7181:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.width=0,this.height=0,this.data=null,this.miplevel=0,this.status=1,this.offsetx=0,this.offsety=0}updateToGpu(t,e,i,s,a,r){1==this.status||r?t.texImage2D(e,this.miplevel,i,s,a,this.data):0==this.status&&t.texSubImage2D(e,this.miplevel,this.offsetx,this.offsety,s,a,this.data),this.status=-1}static Create(){return s.s_list.length>0?s.s_list.pop():new s}static Restore(t){null!=t&&(t.data=null,s.s_list.push(t))}}s.s_list=[],e.default=s},"722e":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{}s.NEAREST=4001,s.LINEAR=4002,s.LINEAR_MIPMAP_LINEAR=4003,s.NEAREST_MIPMAP_NEAREST=4004,s.LINEAR_MIPMAP_NEAREST=4005,s.NEAREST_MIPMAP_LINEAR=4006,e.default=s},"78e9":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s(i("644c"));class r{constructor(){this.type=-1,this.typeName="",this.name="",this.isArray=!1,this.arrLength=0,this.isTex=!1,this.location=null}parseCode(t){const e=";";let i=t.indexOf(e);if(i<0)return!1;const s=" ";t=t.replace(/^\s*|\s*$/g,""),i>0&&(t=t.slice(0,i));let r=t.split(s);return this.typeName=r[r.length-2],this.name=r[r.length-1],i=this.name.indexOf("["),this.isArray=i>0,this.arrLength=0,this.isArray&&(this.arrLength=parseInt(this.name.slice(i+1,this.name.indexOf("]",i+1))),this.name=this.name.slice(0,i),this.typeName+="[]"),this.type=a.default.GetTypeByTypeNS(this.typeName),!(this.type<0)&&(this.isTex=this.type==a.default.SHADER_SAMPLER2D||this.type==a.default.SHADER_SAMPLERCUBE||this.type==a.default.SHADER_SAMPLER3D,!0)}}e.default=r},7918:function(t,e,i){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t["Default"]=0]="Default",t[t["Depth"]=1]="Depth",t[t["Wrapper"]=2]="Wrapper",t[t["RTT"]=3]="RTT",t[t["Image"]=4]="Image",t[t["Float"]=5]="Float",t[t["Uint16"]=6]="Uint16",t[t["FloatCube"]=7]="FloatCube",t[t["Bytes"]=8]="Bytes",t[t["BytesCube"]=9]="BytesCube",t[t["ImageCube"]=10]="ImageCube",t[t["Texture3D"]=11]="Texture3D"}(s||(s={})),e.TextureProxyType=s},"7a04":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s(i("f044"));class r{constructor(){this.m_uid=-1,this.m_total=0,this.layoutBit=0,this.m_fOffsetList=null,this.m_f32List=null,this.m_f32SizeList=null,this.m_f32ChangedList=null,this.m_f32Bufs=null,this.m_bufersTotal=0,this.m_uid=a.default.CreateNewID()}getUid(){return this.m_uid}getType(){return 1}getBuffersTotal(){return this.m_bufersTotal}getAttribsTotal(){return this.m_bufersTotal}getF32DataAt(t){return this.m_f32List[t]}setF32DataAt(t,e,i,s){this.m_bufersTotal=t<1?1:t+1,null==this.m_f32List&&(this.m_f32List=[null,null,null,null,null,null,null,null],this.m_f32ChangedList=[!1,!1,!1,!1,!1,!1,!1,!1],this.m_f32SizeList=[0,0,0,0,0,0,0,0]),this.m_f32List[t]=e,null!=this.m_f32Bufs&&null!=e&&(this.m_f32ChangedList[t]=!0),null!=s&&(this.m_fOffsetList=s),null!=e&&(this.m_f32SizeList[t]=e.length)}setData4fAt(t,e,i,s,a,r){t*=this.m_fOffsetList[e],this.m_f32List[e][t++]=i,this.m_f32List[e][t++]=s,this.m_f32List[e][t++]=a,this.m_f32List[e][t++]=r}setData3fAt(t,e,i,s,a){t*=this.m_fOffsetList[e],this.m_f32List[e][t++]=i,this.m_f32List[e][t++]=s,this.m_f32List[e][t++]=a}setData2fAt(t,e,i,s){t*=this.m_fOffsetList[e],this.m_f32List[e][t++]=i,this.m_f32List[e][t++]=s}destroy(){this.m_f32List=null,this.m_f32ChangedList=null,this.m_f32SizeList=null,this.m_f32List=null}toString(){return"VtxSeparatedBuf(uid = "+this.m_uid+")"}}e.default=r},"7b0e":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s(i("bbf4"));class r{constructor(){this.uid=-1,this.rstatus=0,this.pcoEnabled=!1,this.drawEnabled=!0,this.prev=null,this.next=null,this.entity=null,this.bounds=null,this.rayTestState=0,this.rpoNode=null,this.spaceId=-1,this.camVisiSt=0,this.camVisi=a.default.CAMERA_VISIBLE_ENABLE}reset(){this.rayTestState=0,this.uid=-1,this.rstatus=0,this.pcoEnabled=!1,this.drawEnabled=!0,this.prev=null,this.next=null,this.entity=null,this.bounds=null,this.rpoNode=null,this.spaceId=-1,this.camVisi=0}static GetFreeId(){return r.m_freeIds.length>0?r.m_freeIds.pop():-1}static GetByUid(t){return t>-1&&t<r.m_nodesLen?r.m_nodes[t]:null}static SetCamVisiByUid(t,e){r.m_nodes[t].camVisi=e}static GetCamVisiByUid(t){return r.m_nodes[t].camVisi}static Create(){let t=null,e=r.GetFreeId();return e>=0?(t=r.m_nodes[e],t.uid=e,r.m_flags[e]=r.s_b):(t=new r,r.m_nodes.push(t),r.m_flags.push(r.s_b),t.uid=r.m_nodesLen,r.m_nodesLen++),t}static Restore(t){null!=t&&t.uid>=0&&r.m_flags[t.uid]==r.s_b&&(r.m_freeIds.push(t.uid),r.m_flags[t.uid]=r.s_f,t.reset())}}r.s_b=1,r.s_f=0,r.m_nodesLen=0,r.m_nodes=[],r.m_flags=[],r.m_freeIds=[],e.default=r},"81ce":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{static Es2VtxShderToES3(t){let e=t;const i="attribute",s="varying ";let a=e.indexOf(i),r=0;while(a>=0)e=e.slice(0,a)+"layout(location="+r+") in"+e.slice(a+9),a=e.indexOf(i),r++;let n=new RegExp(s,"g");return e=e.replace(n,"out "),"#version 300 es\n"+e}static Es2FragShderToES3(t){let e=t;const i="gl_FragColor",s="varying ";let a=e.indexOf(i),r=0,n="FragColorOut_"+r;a>=0&&(e=e.slice(0,a)+n+e.slice(a+12)),a=e.indexOf("void "),e=e.slice(0,a)+"out vec4 "+n+";\n"+e.slice(a);let l=new RegExp(s,"g");return e=e.replace(l,"in "),l=new RegExp(" texture2D","g"),e=e.replace(l," texture"),l=new RegExp(" textureCube","g"),e=e.replace(l," texture"),"#version 300 es\n"+e}static Es3VtxShaderToES2(t){const e=/^#.+(\bes|core\b)/;t=t.replace(e,"");const i=/\blayout\b.+\bin\b/g;t=t.replace(i,"attribute");const a=/\bout\b/g;t=t.replace(a,"varying");const r=/\btexture\b/g;t=t.replace(r,"texture2D"),t.indexOf("#version")>=0&&(t=t.replace("#version","//#version"));let n=0,l=0,h=t.indexOf("inverse(");h<0&&(h=t.indexOf("inverse ("));let _="",o=!1,u=!1;while(h>3){if(n=t.indexOf(")",h+2),_=t.slice(h+2,n),_.indexOf("mat3")>0)o=!0;else if(_=_.replace(/\s+/g,""),n=_.indexOf("("),_=_.slice(n+1),n=t.indexOf(_,1),l=t.lastIndexOf("mat",n),l>0)switch(_=t.slice(l,n),_=_.replace(/\s+/g,""),_){case"mat3":o=!0;break;case"mat4":u=!0;break}if(h=t.indexOf("inverse(",h+5),h<0&&(h=t.indexOf("inverse (",h+5)),o&&u)break}n=0,h=t.indexOf("transpose("),h<0&&(h=t.indexOf("transpose (")),_="";let m=!1,d=!1;while(h>3){if(n=t.indexOf(")",h+2),_=t.slice(h+2,n+1),_.indexOf("mat3")>0)m=!0;else if(_=_.replace(/\s+/g,""),n=_.indexOf("("),_=_.slice(n+1),n=t.indexOf(_,1),l=t.lastIndexOf("mat",n),l>0)switch(_=t.slice(l,n),_=_.replace(/\s+/g,""),_){case"mat3":m=!0;break;case"mat4":d=!0;break}if(h=t.indexOf("transpose(",h+5),h<0&&(h=t.indexOf("transpose (",h+5)),m&&d)break}return(o||u)&&(h=t.indexOf("void "),h>10&&(o&&u?t=t.slice(0,h)+s.__glslInverseMat3+s.__glslInverseMat4+t.slice(h):o?t=t.slice(0,h)+s.__glslInverseMat3+t.slice(h):u&&(t=t.slice(0,h)+s.__glslInverseMat4+t.slice(h)))),(m||d)&&(h=t.indexOf("void "),h>10&&(m&&d?t=t.slice(0,h)+s.__glslTransposeMat3+s.__glslTransposeMat4+t.slice(h):m?t=t.slice(0,h)+s.__glslTransposeMat3+t.slice(h):d&&(t=t.slice(0,h)+s.__glslTransposeMat4+t.slice(h)))),t}static Es3FragShaderToES2(t){const e=/^#.+(\bes|core\b)/;t=t.replace(e,"");const i=new RegExp(" in ","g");t=t.replace(i,"_fref_");const s=/\bin\b/g;t=t.replace(s,"varying");const a=new RegExp("_fref_","g");t=t.replace(a," in ");const r=/\btexture\b/g;t=t.replace(r,"texture2D");const n=/" "/g;let l=t;const h=";",_="layout";let o=l.indexOf(_),u=0,m=0,d="",c="",f=0,p=null,g=[],x=[];while(o>=0)u=l.indexOf(h,o+1),d=l.slice(o+1,u),c=d.slice(d.lastIndexOf(" ")+1),f=d.indexOf(")"),o=d.lastIndexOf("=",f)+1,d=d.slice(o+1,f),f=parseInt(d.replace(n,"")),g.push(c),x.push(f),o=l.indexOf(_,u);let y=g.length;if(y>0)if(p=/layout/g,t=t.replace(p,"//layout"),y>1){o=0;while(o<y)p=new RegExp(g[o],"g"),t=t.replace(p,"gl_FragData["+x[o]+"]"),++o}else p=new RegExp(c,"g"),t=t.replace(p,"gl_FragColor");else o=l.indexOf("out "),o>0&&(u=l.indexOf(h,o+1),d=l.slice(o+1,u),c=d.slice(d.lastIndexOf(" ")+1),p=new RegExp(c,"g"),t=t.replace(p,"gl_FragColor"),p=/\bout\b/g,t=t.replace(p,"//out"));y>1&&(t="#extension GL_EXT_draw_buffers: require\n"+t),t.indexOf("#version")>=0&&(t=t.replace("#version","//#version")),o=0;for(let T=0;T<16;++T){if(o=t.indexOf("samplerCube ",o),!(o>0))break;{u=t.indexOf(";",o),d=l.slice(o+12,u),c="";let e=d.split(" ");for(let t=0;t<16;++t)if(""!=e[t]){c=e[t];break}for(y=0;y<16;++y){if(u=t.indexOf(c,u+1),!(u>0))break;if(m=t.lastIndexOf("texture2D",u-1),m<0)break;d=t.slice(m,u),t=t.slice(0,m)+"textureCube("+t.slice(u),u+=2}}o+=4}return t}}s.__glslTransposeMat3="\n    mat3 transpose(mat3 m) {\n        return mat3(m[0][0],m[1][0],m[2][0],\n            m[0][1],m[1][1],m[2][1],\n            m[0][2],m[1][2],m[2][2]);\n    }\n    ",s.__glslTransposeMat4="\n    mat4 transpose(mat4 m) {\n        return mat4(m[0][0],m[1][0],m[2][0],m[3][0],\n            m[0][1],m[1][1],m[2][1],m[3][1],\n            m[0][2],m[1][2],m[2][2],m[3][2],\n            m[0][3],m[1][3],m[2][3],m[3][3]);\n    }\n    ",s.__glslInverseMat3="\n    mat3 inverse(mat3 m) {\n        float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n        float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n        float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];  \n        float b01 = a22 * a11 - a12 * a21;\n        float b11 = -a22 * a10 + a12 * a20;\n        float b21 = a21 * a10 - a11 * a20;  \n        float det = a00 * b01 + a01 * b11 + a02 * b21;  \n        return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n                    b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n                    b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n    }\n    ",s.__glslInverseMat4="\n    mat4 inverse(mat4 m) {\n        float\n            a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n            a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n            a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n            a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n            b00 = a00 * a11 - a01 * a10,\n            b01 = a00 * a12 - a02 * a10,\n            b02 = a00 * a13 - a03 * a10,\n            b03 = a01 * a12 - a02 * a11,\n            b04 = a01 * a13 - a03 * a11,\n            b05 = a02 * a13 - a03 * a12,\n            b06 = a20 * a31 - a21 * a30,\n            b07 = a20 * a32 - a22 * a30,\n            b08 = a20 * a33 - a23 * a30,\n            b09 = a21 * a32 - a22 * a31,\n            b10 = a21 * a33 - a23 * a31,\n            b11 = a22 * a33 - a23 * a32,\n            det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n        return mat4(\n            a11 * b11 - a12 * b10 + a13 * b09,\n            a02 * b10 - a01 * b11 - a03 * b09,\n            a31 * b05 - a32 * b04 + a33 * b03,\n            a22 * b04 - a21 * b05 - a23 * b03,\n            a12 * b08 - a10 * b11 - a13 * b07,\n            a00 * b11 - a02 * b08 + a03 * b07,\n            a32 * b02 - a30 * b05 - a33 * b01,\n            a20 * b05 - a22 * b02 + a23 * b01,\n            a10 * b10 - a11 * b08 + a13 * b06,\n            a01 * b08 - a00 * b10 - a03 * b06,\n            a30 * b04 - a31 * b02 + a33 * b00,\n            a21 * b02 - a20 * b04 - a23 * b00,\n            a11 * b07 - a10 * b09 - a12 * b06,\n            a00 * b09 - a01 * b07 + a02 * b06,\n            a31 * b01 - a30 * b03 - a32 * b00,\n            a20 * b03 - a21 * b01 + a22 * b00) / det;\n        }\n    ",e.default=s},8333:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{}s.COLOR_BUFFER_BIT=131,s.DEPTH_BUFFER_BIT=132,s.STENCIL_BUFFER_BIT=133,e.default=s},"839a":function(t,e,i){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t["Default"]=1]="Default",t[t["FragColor"]=2]="FragColor",t[t["SpecularMapColor"]=3]="SpecularMapColor"}(s||(s={})),e.SpecularMode=s},"85b6":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i("7918"),r=s(i("0851"));class n extends r.default{constructor(t,e,i=!1){super(t,e,i),this.m_tex=null,this.m_type=a.TextureProxyType.Wrapper}getResUid(){return this.m_tex.getResUid()}getBufWidth(){return this.m_tex.getBufWidth()}getBufHeight(){return this.m_tex.getBufHeight()}getWidth(){return this.m_tex.getWidth()}getHeight(){return this.m_tex.getHeight()}isDirect(){return!1}getAttachTex(){return this.m_tex}attachTex(t){this.m_tex!=t&&(null!=this.m_tex&&this.m_tex.__$detachThis(),null!=t&&t.__$attachThis(),this.m_tex=t)}detachTex(){null!=this.m_tex&&this.m_tex.__$detachThis(),this.m_tex=null}__$attachThis(){super.__$attachThis(),null!=this.m_tex&&this.m_tex.__$attachThis()}__$detachThis(){super.__$detachThis(),null!=this.m_tex&&this.m_tex.__$detachThis()}__$$use(t){this.m_tex.__$$use(t)}isGpuEnabled(){return this.m_tex.isGpuEnabled()}getSampler(){return this.m_tex.getSampler()}__$updateToGpu(t){this.m_tex.__$updateToGpu(t)}__$$upload(t){this.m_tex.__$$upload(t)}__$destroy(){this.getAttachCount()<1&&(null!=this.m_tex&&this.m_tex.__$detachThis(),this.m_tex=null,super.__$destroy())}isDataEnough(){return this.m_tex.isDataEnough()}getTargetType(){return this.m_tex.getTargetType()}}e.default=n},8875:function(t,e,i){var s,a,r;(function(i,n){a=[],s=n,r="function"===typeof s?s.apply(e,a):s,void 0===r||(t.exports=r)})("undefined"!==typeof self&&self,(function(){function t(){var e=Object.getOwnPropertyDescriptor(document,"currentScript");if(!e&&"currentScript"in document&&document.currentScript)return document.currentScript;if(e&&e.get!==t&&document.currentScript)return document.currentScript;try{throw new Error}catch(d){var i,s,a,r=/.*at [^(]*\((.*):(.+):(.+)\)$/gi,n=/@([^@]*):(\d+):(\d+)\s*$/gi,l=r.exec(d.stack)||n.exec(d.stack),h=l&&l[1]||!1,_=l&&l[2]||!1,o=document.location.href.replace(document.location.hash,""),u=document.getElementsByTagName("script");h===o&&(i=document.documentElement.outerHTML,s=new RegExp("(?:[^\\n]+?\\n){0,"+(_-2)+"}[^<]*<script>([\\d\\D]*?)<\\/script>[\\d\\D]*","i"),a=i.replace(s,"$1").trim());for(var m=0;m<u.length;m++){if("interactive"===u[m].readyState)return u[m];if(u[m].src===h)return u[m];if(h===o&&u[m].innerHTML&&u[m].innerHTML.trim()===a)return u[m]}return null}}return t}))},"8a0a":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s(i("ca6c"));class r{static ToGL(t,e){const i=r;switch(e){case i.VTX_STATIC_DRAW:return t.STATIC_DRAW;case i.VTX_DYNAMIC_DRAW:return t.DYNAMIC_DRAW;case i.VTX_STREAM_DRAW:return t.STREAM_DRAW;case i.VTX_STATIC_READ:return t.STATIC_READ;case i.VTX_DYNAMIC_READ:return t.DYNAMIC_READ;case i.VTX_STREAM_READ:return t.STREAM_READ;case i.VTX_STATIC_COPY:return t.STATIC_COPY;case i.VTX_DYNAMIC_COPY:return t.DYNAMIC_COPY;case i.VTX_STREAM_COPY:return t.STREAM_COPY;default:break}return t.STATIC_DRAW}static GetVBufTypeByNS(t){const e=r;switch(t){case e.VBUF_VS_NS:return e.VBUF_VS;case e.VBUF_UVS_NS:return e.VBUF_UVS;case e.VBUF_NVS_NS:return e.VBUF_NVS;case e.VBUF_CVS_NS:return e.VBUF_CVS;case e.VBUF_VS2_NS:return e.VBUF_VS2;case e.VBUF_UVS2_NS:return e.VBUF_UVS2;case r.VBUF_NVS2_NS:return r.VBUF_NVS2;case e.VBUF_CVS2_NS:return e.VBUF_CVS2;case e.VBUF_TVS_NS:return e.VBUF_TVS;case e.VBUF_TVS2_NS:return e.VBUF_TVS2;default:}return-1}static GetVBufNSByType(t){const e=r;switch(t){case e.VBUF_VS:return e.VBUF_VS_NS;case e.VBUF_UVS:return e.VBUF_UVS_NS;case e.VBUF_NVS:return e.VBUF_NVS_NS;case e.VBUF_CVS:return e.VBUF_CVS_NS;case e.VBUF_VS2:return e.VBUF_VS2_NS;case e.VBUF_UVS2:return e.VBUF_UVS2_NS;case e.VBUF_NVS2:return e.VBUF_NVS2_NS;case e.VBUF_CVS2:return e.VBUF_CVS2_NS;case e.VBUF_TVS:return e.VBUF_TVS_NS;case e.VBUF_TVS2:return e.VBUF_TVS2_NS;default:}return""}static GetVBufAttributeTypeByNS(t){return r.GetVBufTypeByNS(t)-3e3}static GetVBufAttributeTypeByVBufType(t){return t-3e3}}r.VTXTYPE_GL_POINTS=101,r.VTXTYPE_GL_LINES=102,r.VTXTYPE_GL_LINE_STRIP=103,r.VTXTYPE_GL_TRIANGLES=111,r.VTX_STATIC_DRAW=0,r.VTX_DYNAMIC_DRAW=1,r.VTX_STREAM_DRAW=2,r.VTX_STATIC_READ=3,r.VTX_DYNAMIC_READ=4,r.VTX_STREAM_READ=5,r.VTX_STATIC_COPY=6,r.VTX_DYNAMIC_COPY=7,r.VTX_STREAM_COPY=8,r.VBUF_VS=3001,r.VBUF_UVS=3002,r.VBUF_NVS=3003,r.VBUF_CVS=3004,r.VBUF_TVS=3005,r.VBUF_VS2=3006,r.VBUF_UVS2=3007,r.VBUF_NVS2=3008,r.VBUF_CVS2=3009,r.VBUF_TVS2=3010,r.VBUF_VS_INDEX=a.default.BIT_ONE_0,r.VBUF_UVS_INDEX=a.default.BIT_ONE_1,r.VBUF_NVS_INDEX=a.default.BIT_ONE_2,r.VBUF_CVS_INDEX=a.default.BIT_ONE_3,r.VBUF_TVS_INDEX=a.default.BIT_ONE_4,r.VBUF_VS2_INDEX=a.default.BIT_ONE_5,r.VBUF_UVS2_INDEX=a.default.BIT_ONE_6,r.VBUF_NVS2_INDEX=a.default.BIT_ONE_7,r.VBUF_CVS2_INDEX=a.default.BIT_ONE_8,r.VBUF_TVS2_INDEX=a.default.BIT_ONE_9,r.VBUF_VS_NS="a_vs",r.VBUF_VS2_NS="a_vs2",r.VBUF_UVS_NS="a_uvs",r.VBUF_UVS2_NS="a_uvs2",r.VBUF_NVS_NS="a_nvs",r.VBUF_NVS2_NS="a_nvs2",r.VBUF_CVS_NS="a_cvs",r.VBUF_CVS2_NS="a_cvs2",r.VBUF_TVS_NS="a_tvs",r.VBUF_TVS2_NS="a_tvs2";class n{}n.FLAT=210,n.GOURAND=310,e.VtxNormalType=n,e.default=r},"8d98":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{static GetConst(t,e){switch(e){case s.NEAREST:return t.NEAREST;case s.LINEAR:return t.LINEAR;case s.LINEAR_MIPMAP_LINEAR:return t.LINEAR_MIPMAP_LINEAR;case s.NEAREST_MIPMAP_NEAREST:return t.NEAREST_MIPMAP_NEAREST;case s.LINEAR_MIPMAP_NEAREST:return t.LINEAR_MIPMAP_NEAREST;case s.NEAREST_MIPMAP_LINEAR:return t.NEAREST_MIPMAP_LINEAR;case s.WRAP_REPEAT:return t.REPEAT;case s.WRAP_CLAMP_TO_EDGE:return t.CLAMP_TO_EDGE;case s.WRAP_MIRRORED_REPEAT:return t.MIRRORED_REPEAT;default:break}return-1}}s.WRAP_REPEAT=3001,s.WRAP_CLAMP_TO_EDGE=3002,s.WRAP_MIRRORED_REPEAT=3003,s.NEAREST=4001,s.LINEAR=4002,s.LINEAR_MIPMAP_LINEAR=4003,s.NEAREST_MIPMAP_NEAREST=4004,s.LINEAR_MIPMAP_NEAREST=4005,s.NEAREST_MIPMAP_LINEAR=4006,e.default=s},"8e17":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=180/Math.PI,a=1e-7;class r{constructor(t=0,e=0,i=0,s=1){this.x=0,this.y=0,this.z=0,this.w=0,this.x=t,this.y=e,this.z=i,this.w=s}clone(){return new r(this.x,this.y,this.z,this.w)}setTo(t,e,i,s=1){return this.x=t,this.y=e,this.z=i,this.w=s,this}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t,e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,this}fromArray4(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray4(t,e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,this}setXYZ(t,e,i){return this.x=t,this.y=e,this.z=i,this}copyFrom(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}multBy(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}normalize(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return t>a&&(this.x/=t,this.y/=t,this.z/=t),this}normalizeTo(t){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);e>a?(t.x=this.x/e,t.y=this.y/e,t.z=this.z/e):(t.x=this.x,t.y=this.y,t.z=this.z)}scaleVector(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}scaleBy(t){return this.x*=t,this.y*=t,this.z*=t,this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}equalsXYZ(t){return Math.abs(this.x-t.x)<a&&Math.abs(this.y-t.y)<a&&Math.abs(this.z-t.z)<a}equalsAll(t){return Math.abs(this.x-t.x)<a&&Math.abs(this.y-t.y)<a&&Math.abs(this.z-t.z)<a&&Math.abs(this.w-t.w)<a}project(){let t=1/this.w;this.x*=t,this.y*=t,this.z*=t}getLength(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}getLengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z}addBy(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}subtractBy(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subtract(t){return new r(this.x-t.x,this.y-t.y,this.z-t.z)}add(t){return new r(this.x+t.x,this.y+t.y,this.z+t.z)}crossProduct(t){return new r(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}crossBy(t){let e=this.y*t.z-this.z*t.y,i=this.z*t.x-this.x*t.z,s=this.x*t.y-this.y*t.x;return this.x=e,this.y=i,this.z=s,this}reflectBy(t){let e=2*(this.x*t.x+this.y*t.y+this.z*t.z);return this.x=this.x-e*t.x,this.y=this.y-e*t.y,this.z=this.z-e*t.z,this}scaleVecTo(t,e){return this.x=t.x*e,this.y=t.y*e,this.z=t.z*e,this}subVecsTo(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}addVecsTo(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}crossVecsTo(t,e){return this.x=t.y*e.z-t.z*e.y,this.y=t.z*e.x-t.x*e.z,this.z=t.x*e.y-t.y*e.x,this}toString(){return"Vector3D("+this.x+this.y+this.z+")"}static Cross(t,e,i){i.x=t.y*e.z-t.z*e.y,i.y=t.z*e.x-t.x*e.z,i.z=t.x*e.y-t.y*e.x}static CrossSubtract(t,e,i,s,a){n.x=e.x-t.x,n.y=e.y-t.y,n.z=e.z-t.z,l.x=s.x-i.x,l.y=s.y-i.y,l.z=s.z-i.z,t=n,i=l,a.x=t.y*i.z-t.z*i.y,a.y=t.z*i.x-t.x*i.z,a.z=t.x*i.y-t.y*i.x}static Subtract(t,e,i){i.x=t.x-e.x,i.y=t.y-e.y,i.z=t.z-e.z}static DistanceSquared(t,e){return n.x=t.x-e.x,n.y=t.y-e.y,n.z=t.z-e.z,n.getLengthSquared()}static DistanceXYZ(t,e,i,s,a,r){return n.x=t-s,n.y=e-a,n.z=i-r,n.getLength()}static Distance(t,e){return n.x=t.x-e.x,n.y=t.y-e.y,n.z=t.z-e.z,n.getLength()}static AngleBetween(t,e){return t.normalizeTo(n),e.normalizeTo(l),Math.acos(n.dot(l))*s}static RadianBetween(t,e){return t.normalizeTo(n),e.normalizeTo(l),Math.acos(n.dot(l))}static RadianBetween2(t,e){let i=t.getLengthSquared(),s=e.getLengthSquared();return n.x=t.x-e.x,n.y=t.y-e.y,n.z=t.z-e.z,Math.acos((i+s-n.getLengthSquared())/(2*Math.sqrt(i)*Math.sqrt(s)))}static Reflect(t,e,i){let s=2*(t.x*e.x+t.y*e.y+t.z*e.z);i.x=t.x-s*e.x,i.y=t.y-s*e.y,i.z=t.z-s*e.z}static VerticalCCWOnXOY(t){const e=t.x;t.x=-t.y,t.y=e}static VerticalCWOnXOY(t){const e=t.y;t.y=-t.x,t.x=e}}r.X_AXIS=new r(1,0,0),r.Y_AXIS=new r(0,1,0),r.Z_AXIS=new r(0,0,1),r.ZERO=new r(0,0,0),r.ONE=new r(1,1,1),e.default=r;const n=new r,l=new r},9666:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s(i("3b73")),r=s(i("acfe"));class n{static CreateShdData(t,e,i,s,l){if(n.s_shdDataDict.has(t))return n.s_shdDataDict.get(t);let h=new r.default;return h.adaptationShaderVersion=s,h.preCompileInfo=l,h.initialize(t,e,i),n.s_shdDataList[h.getUid()]=h,++n.s_shdDataListLen,n.s_shdDataDict.set(t,h),a.default.SHADERCODE_TRACE_ENABLED,h}static FindData(t){return n.s_shdDataDict.has(t)?n.s_shdDataDict.get(t):null}}n.s_shdDataDict=new Map,n.s_shdDataList=[],n.s_shdDataListLen=0,e.default=n},"9c4d":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.prev=null,this.next=null,this.flag=0,this.target=null}reset(){this.flag=0,this.target=null}}class a{constructor(){this.m_begin=null,this.m_end=null}destroy(){this.clear()}clear(){this.m_begin=this.m_end=null}getBegin(){return this.m_begin}isEmpty(){return this.m_begin==this.m_end&&null==this.m_end}addNode(t){null==this.m_begin?this.m_end=this.m_begin=t:null!=this.m_end.prev?(this.m_end.next=t,t.prev=this.m_end,this.m_end=t):(this.m_begin.next=t,t.prev=this.m_end,this.m_end=t),this.m_end.next=null}removeNode(t){t==this.m_begin?t==this.m_end?this.m_begin=this.m_end=null:(this.m_begin=t.next,this.m_begin.prev=null):t==this.m_end?(this.m_end=t.prev,this.m_end.next=null):(t.next.prev=t.prev,t.prev.next=t.next),t.prev=null,t.next=null}}class r{constructor(){this.m_linker=new a,this.m_freeIds=[],this.m_runners=[new s]}getFreeId(){if(this.m_freeIds.length>0)return this.m_freeIds.pop();let t=new s;return t.flag=this.m_runners.length,this.m_runners.push(t),t.flag}addRunner(t){if(null!=t&&t.getRunFlag()<1){let e=this.getFreeId(),i=this.m_runners[e];i.flag=e,i.target=t,t.setRunFlag(e),this.m_linker.addNode(i)}}removeRunner(t){if(null!=t&&t.getRunFlag()>0){let e=t.getRunFlag();this.m_freeIds.push(e);let i=this.m_runners[e];i.flag=e,i.target=null,t.setRunFlag(0),this.m_linker.removeNode(i)}}run(){let t=this.m_linker.getBegin(),e=t;while(null!=e)t=e,e=t.next,t.target.isRunning()&&t.target.run()}destroy(){let t=this.m_linker.getBegin(),e=t;while(null!=e)t=e,e=t.next,t.target=null;this.m_linker.clear()}}e.default=r},"9f3e":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i("7918"),r=s(i("8d98")),n=s(i("ffc0")),l=s(i("1f61")),h=s(i("df25"));class _ extends h.default{constructor(t,e,i=!1){super(t,e,i),this.m_type=a.TextureProxyType.Uint16,this.minFilter=r.default.LINEAR,this.dataType=l.default.UNSIGNED_SHORT}toHalfFloatOes(){this.srcFormat=n.default.RGBA,this.internalFormat=n.default.RGBA,this.unpackAlignment=4,this.dataType=l.default.HALF_FLOAT_OES}toUShort565(){this.srcFormat=n.default.RGB,this.internalFormat=n.default.RGB,this.unpackAlignment=3,this.dataType=l.default.UNSIGNED_SHORT_5_6_5}toUShort4444(){this.srcFormat=n.default.RGBA,this.internalFormat=n.default.RGBA,this.unpackAlignment=4,this.dataType=l.default.UNSIGNED_SHORT_4_4_4_4}toUShort5551(){this.unpackAlignment=4,this.dataType=l.default.UNSIGNED_SHORT_5_5_5_1}toUShort(){this.srcFormat=n.default.RGBA,this.internalFormat=n.default.RGBA,this.dataType=l.default.UNSIGNED_SHORT}toAlphaFormat(){this.dataType==l.default.UNSIGNED_SHORT&&(this.srcFormat=n.default.ALPHA,this.internalFormat=n.default.ALPHA,this.unpackAlignment=1)}toRedFormat(){this.dataType==l.default.UNSIGNED_SHORT&&(this.srcFormat=n.default.RED,this.internalFormat=n.default.RED,this.unpackAlignment=1)}toRGBFormat(){this.dataType==l.default.UNSIGNED_SHORT&&(this.srcFormat=n.default.RGB,this.internalFormat=n.default.RGB,this.unpackAlignment=3)}toRGBAFormat(){this.dataType==l.default.UNSIGNED_SHORT&&(this.srcFormat=n.default.RGBA,this.internalFormat=n.default.RGBA,this.unpackAlignment=4)}uploadFromBytes(t,e=0,i=-1,s=-1,a=0,r=0,n=!1){super.setDataFromBytes(t,e,i,s,a,r,n)}setPartDataFromeBytes(t,e,i,s,a,r=0){super.setPartDataFromeBytes(t,e,i,s,a,r)}getPixels(t,e,i,s,a){super.getPixels(t,e,i,s,a)}toString(){return"[Uint16TextureProxy(width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=_},a156:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s(i("3b73")),r=s(i("20ef"));class n{constructor(t){this.m_shdDict=new Map,this.m_shdList=[],this.m_shdListLen=0,this.m_sharedUniformList=[],this.m_rcuid=-1,this.m_rcuid=t}getRCUid(){return this.m_rcuid}create(t){let e=t.getUniqueShaderName();if(this.m_shdDict.has(e))return this.m_shdDict.get(e);let i=new r.default(this.m_shdListLen);return i.setShdData(t),this.m_shdList[i.getUid()]=i,this.m_sharedUniformList[i.getUid()]=null,++this.m_shdListLen,this.m_shdDict.set(e,i),a.default.SHADERCODE_TRACE_ENABLED,i}findShdProgramByUid(t){return this.m_shdList[t]}findShdProgram(t){return this.m_shdDict.has(t)?this.m_shdDict.get(t):null}findShdProgramByShdData(t){return null!=t&&this.m_shdDict.has(t.getUniqueShaderName())?this.m_shdDict.get(t.getUniqueShaderName()):null}hasUid(t){return null!=this.m_shdList[t]}getTotal(){return this.m_shdListLen}containsUid(t){return t>-1&&t<this.m_shdListLen}}e.ShaderProgramBuilder=n},a221:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},a80a:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.m_begin=null,this.m_end=null}destroy(){this.clear()}clear(){this.m_begin=this.m_end=null}getBegin(){return this.m_begin}isEmpty(){return this.m_begin==this.m_end&&null==this.m_end}addNode(t){null==this.m_begin?this.m_end=this.m_begin=t:null!=this.m_end.prev?(this.m_end.next=t,t.prev=this.m_end,this.m_end=t):(this.m_begin.next=t,t.prev=this.m_end,this.m_end=t),this.m_end.next=null}removeNode(t){t==this.m_begin?t==this.m_end?this.m_begin=this.m_end=null:(this.m_begin=t.next,this.m_begin.prev=null):t==this.m_end?(this.m_end=t.prev,this.m_end.next=null):(t.next.prev=t.prev,t.prev.next=t.next),t.prev=null,t.next=null}}e.default=s},a9f4:function(t,e,i){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t["Default"]=1]="Default",t[t["VSM"]=1]="VSM"}(s||(s={})),e.ShadowMode=s},ab73:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.type="vec4",this.data=null,this.name="u_vsmParams",this.arrayLength=3}}class a{constructor(){this.type="vec4",this.data=new Float32Array([.1,.1,.1,1,1,.1,600,3500,.3,0,.9,5e-4,0,0,800,800,-500,-500,1e3,1e3]),this.name="u_envLightParams",this.arrayLength=5}}class r{constructor(){this.type="mat4",this.data=null,this.name="u_shadowMat",this.arrayLength=0}}class n{constructor(){this.type="vec4",this.data=null,this.name="u_stageParam",this.arrayLength=0}}class l{constructor(){this.type="vec4",this.data=null,this.name="u_viewParam",this.arrayLength=0}}class h{constructor(){this.type="vec4",this.data=null,this.name="u_frustumParam",this.arrayLength=0}}class _{constructor(){this.type="vec4",this.data=null,this.name="u_cameraPosition",this.arrayLength=0}}class o{constructor(){this.type="vec4",this.positionName="u_lightPositions",this.colorName="u_lightColors"}}class u{}u.LocalTransformMatUNS="u_objMat",u.CameraViewMatUNS="u_viewMat",u.CameraProjectiveMatUNS="u_projMat",u.FrustumParam=new h,u.CameraPosParam=new _,u.StageParam=new n,u.ViewportParam=new l,u.ShadowMatrix=new r,u.ShadowVSMParams=new s,u.GlobalLight=new o,u.EnvLightParams=new a,e.default=u},abdb:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{}s.AXIS_ANGLE=0,s.QUATERNION=1,s.EULER_ANGLES=2,e.default=s},acaa:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i("7918"),r=s(i("8d98")),n=s(i("ffc0")),l=s(i("1f61")),h=s(i("cfaf"));class _ extends h.default{constructor(t,e,i=!1){super(t,e,i),this.minFilter=r.default.NEAREST,this.magFilter=r.default.NEAREST,this.srcFormat=n.default.DEPTH_COMPONENT,this.internalFormat=n.default.DEPTH_COMPONENT,this.dataType=l.default.UNSIGNED_SHORT,this.m_generateMipmap=!1,this.m_haveRData=!0,this.mipmapEnabled=!1,this.m_type=a.TextureProxyType.Depth}toDepthUnsignedInt(){this.minFilter=r.default.NEAREST,this.magFilter=r.default.NEAREST,this.srcFormat=n.default.DEPTH_COMPONENT,this.internalFormat=n.default.DEPTH_COMPONENT,this.dataType=l.default.UNSIGNED_INT,this.m_generateMipmap=!1,this.m_haveRData=!0,this.mipmapEnabled=!1}toDepthUnsignedShort(){this.minFilter=r.default.NEAREST,this.magFilter=r.default.NEAREST,this.srcFormat=n.default.DEPTH_COMPONENT,this.internalFormat=n.default.DEPTH_COMPONENT,this.dataType=l.default.UNSIGNED_SHORT,this.m_generateMipmap=!1,this.m_haveRData=!0,this.mipmapEnabled=!1}toDepthAndStencil(){this.minFilter=r.default.NEAREST,this.magFilter=r.default.NEAREST,this.srcFormat=n.default.DEPTH_STENCIL,this.internalFormat=n.default.DEPTH_STENCIL,this.dataType=l.default.UNSIGNED_INT_24_8_WEBGL,this.m_generateMipmap=!1,this.mipmapEnabled=!1,this.m_haveRData=!0}uploadData(t){let e=t.getRC();e.texImage2D(this.m_sampler,0,n.default.ToGL(e,this.internalFormat),this.m_texWidth,this.m_texHeight,0,n.default.ToGL(e,this.srcFormat),l.default.ToGL(e,this.dataType),null)}toString(){return"[DepthTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=_},acfe:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s(i("8a0a")),r=s(i("3b73")),n=s(i("81ce")),l=s(i("fc07"));class h{constructor(){this.m_uid=-1,this.adaptationShaderVersion=!0,this.preCompileInfo=null,this.m_vshdCode="",this.m_fshdCode="",this.m_shdUniqueName="",this.m_texTotal=0,this.m_uniforms=null,this.m_useTex=!1,this.m_attriNSList=null,this.m_attriSizeList=null,this.m_aLocationTypes=null,this.m_uniformDict=new Map,this.m_layoutTypes=null,this.m_haveCommonUniform=!1,this.m_layoutBit=0,this.m_mid=0,this.m_fragOutputTotal=1,this.m_texUniformNames=null,this.dataUniformEnabled=!1,this.m_uid=h.s_uid++}getVSCodeStr(){return this.m_vshdCode}getFSCodeStr(){return this.m_fshdCode}getLocationTypes(){return this.m_layoutTypes}getLayoutBit(){return this.m_layoutBit}getMid(){return this.m_mid}getFragOutputTotal(){return this.m_fragOutputTotal}parseCode(t,e){h.s_codeParser.reset(),h.s_codeParser.parseVShaderCode(t),h.s_codeParser.parseFShaderCode(e),this.m_fragOutputTotal=h.s_codeParser.fragOutputTotal,this.m_uniforms=h.s_codeParser.uniforms}initialize(t,e,i){this.m_shdUniqueName=t,this.adaptationShaderVersion&&null==this.preCompileInfo&&r.default.IsWebGL1()&&(e=n.default.Es3VtxShaderToES2(e),i=n.default.Es3FragShaderToES2(i)),this.preCompileInfo,this.parseCode(e,i);let s=h.s_codeParser.attributes,l=0,_=s.length,o=null;this.m_attriNSList=[],this.m_attriSizeList=[],this.m_layoutBit=0;let u=0,m=this.m_layoutTypes=[];while(l<_){if(o=s[l],null!=o){this.m_attriNSList.push(o.name),this.m_attriSizeList.push(o.typeSize),u+=1;let t=a.default.GetVBufTypeByNS(o.name);t>=3001&&t<=3010?this.m_layoutBit|=1<<t-3001:(u-=1,t=0),t>0&&m.push(a.default.GetVBufAttributeTypeByVBufType(t))}++l}let d=(u<<11)+this.m_layoutBit;h.s_midMap.has(d)||(h.s_midMap.set(d,h.s_mid),h.s_mid++),this.m_mid=h.s_midMap.get(d),this.m_texTotal=h.s_codeParser.texTotal,this.m_useTex=this.m_texTotal>0,this.m_useTex&&(this.m_texUniformNames=h.s_codeParser.texUniformNameListStr.split(",")),this.m_haveCommonUniform=this.m_texTotal<this.m_uniforms.length,this.m_vshdCode=e,this.m_fshdCode=i,this.m_shdUniqueName=t}getAttriSizeList(){return this.m_attriSizeList}getTexUniformNames(){return this.m_texUniformNames}getUniforms(){return this.m_uniforms}haveCommonUniform(){return this.m_haveCommonUniform}getAttriNSList(){return this.m_attriNSList}getUid(){return this.m_uid}getTexTotal(){return this.m_texTotal}haveTexture(){return this.m_useTex}getLocationsTotal(){return this.m_aLocationTypes.length}getUniformTypeNameByNS(t){let e=this.m_uniformDict.get(t);return null!=e?e.typeName:""}getUniformTypeByNS(t){let e=this.m_uniformDict.get(t);return null!=e?e.type:0}hasUniformByName(t){return this.m_uniformDict.has(t)}getUniformLengthByNS(t){return this.m_uniformDict.has(t)&&this.m_uniformDict.get(t).arrLength,0}getUniqueShaderName(){return this.m_shdUniqueName}destroy(){this.m_texTotal=0}}h.s_uid=0,h.s_codeParser=new l.default,h.s_midMap=new Map,h.s_mid=1,e.default=h},af29:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s(i("722e")),r=s(i("8333")),n=s(i("8d98")),l=s(i("1f61")),h=s(i("ffc0")),_=s(i("3930")),o=s(i("baae")),u=s(i("29ef"));class m{constructor(t,e){this.m_backBufferColor=new _.default,this.m_adapter=null,this.m_rproxy=null,this.m_rcontext=null,this.m_bgColor=new _.default,this.m_renderer=null,this.m_runFlag=!0,this.m_fboIndex=-1,this.m_fboType=-1,this.m_initW=128,this.m_initH=128,this.m_enableDepth=!0,this.m_enableStencil=!1,this.m_multisampleLevel=0,this.m_gMateiral=null,this.m_gRState=-1,this.m_gRColorMask=-1,this.m_rindexs=[],this.m_texs=[null,null,null,null,null,null,null,null],this.m_texStore=null,this.m_texsTot=0,this.m_synFBOSizeWithViewport=!0,this.m_fboSizeFactor=1,this.m_clearDepth=256,this.m_clearColorBoo=!0,this.m_clearDepthBoo=!0,this.m_clearStencilBoo=!1,this.m_viewportLock=!1,this.m_texUnlock=!1,this.m_tmaterialUniformUpdate=!1,this.uns="FBOInstance",this.m_renderer=t,this.m_texStore=e,this.m_rproxy=t.getRenderProxy(),this.m_adapter=this.m_rproxy.getRenderAdapter(),this.m_rcontext=t.getRendererContext()}getFBOUid(){return this.m_fboIndex}setRProcessIDList(t){if(null!=t){if(t.length<1)throw Error("processIDlist.length < 1, but it must: processIDlist.length >= 1");this.m_rindexs=t.slice(0)}}setRProcessList(t){if(t.length<1)throw Error("list.length < 1, but must: list.length >= 1");this.m_rindexs=new Array(t.length);for(let e=0;e<t.length;++e)this.m_rindexs[e]=t[e].getRPIndex()}getRProcessIDAt(t){return this.m_rindexs[t]}getStage3D(){return this.m_rproxy.getStage3D()}getCamera(){return null!=this.m_rproxy?this.m_rproxy.getCamera():null}lockViewport(){this.m_viewportLock=!0}unlockViewport(){this.m_viewportLock=!1}updateCamera(){null!=this.m_rproxy&&this.m_rproxy.updateCamera()}updateCameraDataFromCamera(t){null!=this.m_rproxy&&this.m_rproxy.updateCameraDataFromCamera(t)}useGlobalRenderState(t){this.m_rcontext.useGlobalRenderState(t)}useGlobalRenderStateByName(t){this.m_rcontext.useGlobalRenderStateByName(t)}setGlobalRenderState(t){this.m_gRState=t}setGlobalRenderStateByName(t){this.m_gRState=this.m_rcontext.getRenderStateByName(t)}lockRenderState(t=-1){this.m_gRState>=0||t>=0?this.m_rcontext.useGlobalRenderState(t<0?this.m_gRState:t):this.m_rproxy.lockRenderState()}unlockRenderState(){this.m_rproxy.unlockRenderState()}useGlobalRenderColorMask(t){this.m_rcontext.useGlobalRenderColorMask(t)}useGlobalRenderColorMaskByName(t){this.m_rcontext.useGlobalRenderColorMaskByName(t)}setGlobalRenderColorMask(t){this.m_gRColorMask=t}setGlobalRenderColorMaskByName(t){this.m_gRColorMask=this.m_rcontext.getRenderColorMaskByName(t)}lockColorMask(t=-1){this.m_gRColorMask>=0||t>=0?this.m_rcontext.useGlobalRenderColorMask(t<0?this.m_gRColorMask:t):this.m_rproxy.lockRenderColorMask()}unlockRenderColorMask(){this.m_rcontext.useGlobalRenderColorMask(u.default.COLOR_MASK_ALL_TRUE),this.m_rproxy.unlockRenderColorMask()}useGlobalMaterial(t,e=!1,i=!1){this.m_texUnlock=e,this.m_tmaterialUniformUpdate=i,this.m_rcontext.useGlobalMaterial(t,this.m_texUnlock,i)}setGlobalMaterial(t,e=!1,i=!1){this.m_texUnlock=e,this.m_tmaterialUniformUpdate=i,this.m_gMateiral!=t&&(null!=this.m_gMateiral&&this.m_gMateiral.__$detachThis(),null!=t&&t.__$attachThis(),this.m_gMateiral=t)}lockMaterial(){null!=this.m_gMateiral?this.m_rcontext.useGlobalMaterial(this.m_gMateiral,this.m_texUnlock,this.m_tmaterialUniformUpdate):this.m_rcontext.lockMaterial()}unlockMaterial(){this.m_rcontext.unlockMaterial()}updateGlobalMaterialUniform(){this.m_rcontext.updateMaterialUniform(this.m_gMateiral)}clearDepth(t=1){this.m_adapter.clearFBODepthAt(this.m_fboIndex,t)}synFBOSizeWithViewport(){this.m_synFBOSizeWithViewport=!0}asynFBOSizeWithViewport(){this.m_synFBOSizeWithViewport=!1}setFBOSizeFactorWithViewPort(t){this.m_fboSizeFactor=t}createViewportSizeFBOAt(t,e=!1,i=!1,s=0){this.m_fboIndex<0&&(this.m_fboIndex=t,this.m_fboType=o.default.FRAMEBUFFER,this.m_initW=this.m_adapter.getViewportWidth(),this.m_initH=this.m_adapter.getViewportHeight(),this.m_enableDepth=e,this.m_enableStencil=i,this.m_multisampleLevel=s,this.m_adapter.createFBOAt(t,this.m_fboType,this.m_initW,this.m_initH,e,i,s))}createFBO(t,e,i=0){this.m_enableDepth=t,this.m_enableStencil=e,this.m_multisampleLevel=i,this.m_adapter.createFBOAt(this.m_fboIndex,this.m_fboType,this.m_initW,this.m_initH,t,e,i)}createAutoSizeFBOAt(t,e=!1,i=!1,s=0){t>=0&&this.m_fboIndex<0&&(this.m_fboType=o.default.FRAMEBUFFER,this.m_initW=512,this.m_initH=512,this.m_fboIndex=t,this.createFBO(e,i,s))}createFBOAt(t,e,i,s=!1,a=!1,r=0){t>=0&&this.m_fboIndex<0&&(this.m_fboType=o.default.FRAMEBUFFER,this.m_initW=e,this.m_initH=i,this.m_fboIndex=t,this.m_initW<1&&(this.m_initW=this.m_adapter.getRCanvasWidth()),this.m_initH<1&&(this.m_initH=this.m_adapter.getRCanvasHeight()),this.createFBO(s,a,r))}createReadFBOAt(t,e,i,s=!1,a=!1,r=0){t>=0&&this.m_fboIndex<0&&(this.m_fboType=o.default.READ_FRAMEBUFFER,this.m_initW=e,this.m_initH=i,this.m_fboIndex=t,this.m_initW<1&&(this.m_initW=this.m_adapter.getRCanvasWidth()),this.m_initH<1&&(this.m_initH=this.m_adapter.getRCanvasHeight()),this.createFBO(s,a,r))}createDrawFBOAt(t,e,i,s=!1,a=!1,r=0){t>=0&&this.m_fboIndex<0&&(this.m_fboType=o.default.DRAW_FRAMEBUFFER,this.m_initW=e,this.m_initH=i,this.m_fboIndex=t,this.m_initW<1&&(this.m_initW=this.m_adapter.getRCanvasWidth()),this.m_initH<1&&(this.m_initH=this.m_adapter.getRCanvasHeight()),this.createFBO(s,a,r))}resizeFBO(t,e){this.m_initW==t&&this.m_initH==e||(this.m_initW=t,this.m_initH=e,this.m_adapter.resizeFBOAt(this.m_fboIndex,t,e))}getRTTAt(t){return this.m_texs[t]}enableMipmapRTTAt(t){this.m_texs[t].enableMipmap()}generateMipmapTextureAt(t){this.m_texs[t].generateMipmap(this.m_rproxy.Texture)}setRenderToTexture(t,e=0){return 0==e?this.m_texsTot=1:this.m_texsTot<e+1&&(this.m_texsTot=e+1),this.m_texs[e]=t,t}setRenderToRTTTextureAt(t,e=0){this.setRenderToTexture(this.m_texStore.getRTTTextureAt(t),e)}setRenderToFloatTextureAt(t,e=0){this.setRenderToTexture(this.m_texStore.getRTTFloatTextureAt(t),e)}setRenderToHalfFloatTexture(t,e=0){return null==t&&(t=this.m_texStore.createRTTTex2D(128,128,!1),t.__$setRenderProxy(this.m_rproxy),t.internalFormat=h.default.RGBA16F,t.srcFormat=h.default.RGBA,t.dataType=l.default.FLOAT,t.minFilter=n.default.LINEAR,t.magFilter=n.default.LINEAR,t.__$setRenderProxy(this.m_rproxy)),this.setRenderToTexture(t,e)}setRenderToRGBATexture(t,e=0){return null==t&&(t=this.createRGBATexture()),this.setRenderToTexture(t,e)}setRenderToDepthTextureAt(t,e=0){return this.setRenderToTexture(this.m_texStore.getDepthTextureAt(t),e)}createRGBATexture(){let t=this.m_texStore.createRTTTex2D(32,32,!1);return t.internalFormat=h.default.RGBA,t.srcFormat=h.default.RGBA,t.dataType=l.default.UNSIGNED_BYTE,t.minFilter=n.default.LINEAR,t.magFilter=n.default.LINEAR,t.__$setRenderProxy(this.m_rproxy),t}setClearState(t=!0,e=!0,i=!1){this.m_clearColorBoo=t,this.m_clearDepthBoo=e,this.m_clearStencilBoo=i}setRenderToBackBuffer(){this.m_rproxy.setClearColor(this.m_backBufferColor),this.m_rcontext.setRenderToBackBuffer()}setClearDepth(t){this.m_clearDepth=t}getClearDepth(){return this.m_adapter.getClearDepth()}getViewportX(){return this.m_adapter.getViewportX()}getViewportY(){return this.m_adapter.getViewportY()}getViewportWidth(){return this.m_adapter.getViewportWidth()}getViewportHeight(){return this.m_adapter.getViewportHeight()}getFBOWidth(){return this.m_adapter.getFBOWidthAt(this.m_fboIndex)}getFBOHeight(){return this.m_adapter.getFBOHeightAt(this.m_fboIndex)}resetAttachmentMask(t){this.m_adapter.resetFBOAttachmentMask(t)}setAttachmentMaskAt(t,e){this.m_adapter.setFBOAttachmentMaskAt(t,e)}setClearRGBColor3f(t,e,i){this.m_bgColor.setRGB3f(t,e,i)}setClearColorEnabled(t){this.m_clearColorBoo=t}setClearDepthEnabled(t){this.m_clearDepthBoo=t}setClearStencilEnabled(t){this.m_clearStencilBoo=t}setClearUint24Color(t,e=1){this.m_bgColor.setRGBUint24(t),this.m_bgColor.a=e}setClearRGBAColor4f(t,e,i,s){this.m_bgColor.setRGBA4f(t,i,e,s)}blitFrom(t,e=r.default.COLOR_BUFFER_BIT,i=a.default.NEAREST,s=-1,n=0,l=null){this.m_fboIndex>=0&&(this.m_adapter.setBlitFboSrcRect(0,0,t.getFBOWidth(),t.getFBOHeight()),this.m_adapter.setBlitFboSrcRect(0,0,this.getFBOWidth(),this.getFBOHeight()),this.m_adapter.blitFBO(t.getFBOUid(),this.m_fboIndex,e,i,s,n,l))}blitColorFrom(t,e=a.default.NEAREST,i=-1,s=0,n=null){this.m_fboIndex>=0&&(this.m_adapter.setBlitFboSrcRect(0,0,t.getFBOWidth(),t.getFBOHeight()),this.m_adapter.setBlitFboSrcRect(0,0,this.getFBOWidth(),this.getFBOHeight()),this.m_adapter.blitFBO(t.getFBOUid(),this.m_fboIndex,r.default.COLOR_BUFFER_BIT,e,i,s,n))}blitDepthFrom(t,e=a.default.NEAREST,i=-1,s=0,n=null){this.m_fboIndex>=0&&(this.m_adapter.setBlitFboSrcRect(0,0,t.getFBOWidth(),t.getFBOHeight()),this.m_adapter.setBlitFboSrcRect(0,0,this.getFBOWidth(),this.getFBOHeight()),this.m_adapter.blitFBO(t.getFBOUid(),this.m_fboIndex,r.default.COLOR_BUFFER_BIT|r.default.DEPTH_BUFFER_BIT,e,i,s,n))}blitColorAndDepthFrom(t,e=a.default.NEAREST,i=-1,s=0,n=null){this.m_fboIndex>=0&&(this.m_adapter.setBlitFboSrcRect(0,0,t.getFBOWidth(),t.getFBOHeight()),this.m_adapter.setBlitFboSrcRect(0,0,this.getFBOWidth(),this.getFBOHeight()),this.m_adapter.blitFBO(t.getFBOUid(),this.m_fboIndex,r.default.COLOR_BUFFER_BIT|r.default.DEPTH_BUFFER_BIT,e,i,s,n))}blitStencilFrom(t,e=a.default.NEAREST,i=-1,s=0,n=null){this.m_fboIndex>=0&&(this.m_adapter.setBlitFboSrcRect(0,0,t.getFBOWidth(),t.getFBOHeight()),this.m_adapter.setBlitFboSrcRect(0,0,this.getFBOWidth(),this.getFBOHeight()),this.m_adapter.blitFBO(t.getFBOUid(),this.m_fboIndex,r.default.STENCIL_BUFFER_BIT,e,i,s,n))}renderToTextureAt(t,e=0){this.m_adapter.setRenderToTexture(this.m_texs[t],this.m_enableDepth,this.m_enableStencil,e),this.m_adapter.useFBO(this.m_clearColorBoo,this.m_clearDepthBoo,this.m_clearStencilBoo)}runBeginDo(){if(this.m_runFlag){this.m_runFlag=!1,this.m_rproxy.rshader.resetRenderState(),this.m_rproxy.getClearRGBAColor4f(this.m_backBufferColor),this.m_viewportLock?this.m_adapter.lockViewport():this.m_adapter.unlockViewport(),this.m_adapter.bindFBOAt(this.m_fboIndex,this.m_fboType),this.m_synFBOSizeWithViewport?(this.m_adapter.synFBOSizeWithViewport(),this.m_adapter.setFBOSizeFactorWithViewPort(this.m_fboSizeFactor)):this.m_adapter.asynFBOSizeWithViewport(),this.m_clearDepth<128&&this.m_adapter.setClearDepth(this.m_clearDepth),this.m_rproxy.setClearColor(this.m_bgColor);let t=0;for(;t<this.m_texsTot;++t)this.m_adapter.setRenderToTexture(this.m_texs[t],this.m_enableDepth,this.m_enableStencil,t);this.m_adapter.useFBO(this.m_clearColorBoo,this.m_clearDepthBoo,this.m_clearStencilBoo),null!=this.m_gMateiral?this.m_rcontext.useGlobalMaterial(this.m_gMateiral,this.m_texUnlock,this.m_tmaterialUniformUpdate):this.m_rcontext.unlockMaterial()}}run(t=!1,e=!1,i=!0,s=!0){if(t&&this.lockRenderState(),e&&!s&&this.lockMaterial(),this.m_fboIndex>=0&&(s&&this.runBeginDo(),null!=this.m_rindexs))for(let a=0,r=this.m_rindexs.length;a<r;++a)this.m_renderer.runAt(this.m_rindexs[a]);t&&this.unlockRenderState(),e&&this.unlockMaterial(),i&&this.runEnd()}runAt(t,e=!0){this.m_fboIndex>=0&&null!=this.m_rindexs&&(0==t&&e?this.runBeginDo():this.m_runFlag=!0,this.m_renderer.runAt(this.m_rindexs[t]))}drawEntity(t,e=!1,i=!0){this.m_runFlag||this.m_renderer.drawEntity(t,e,i)}runBegin(){this.m_fboIndex>=0&&null!=this.m_rindexs&&(this.m_runFlag=!0,this.runBeginDo())}runEnd(){this.m_rproxy.setClearColor(this.m_backBufferColor),this.m_runFlag=!0,this.m_viewportLock&&this.m_adapter.unlockViewport()}useCamera(t,e=!1){this.m_renderer.useCamera(t,e)}useMainCamera(){this.m_renderer.useMainCamera()}reset(){this.setGlobalMaterial(null);let t=0;for(;t<this.m_texsTot;++t)this.m_texs[t]=null;this.m_runFlag=!1,this.m_fboIndex=-1,this.m_texsTot=0,this.m_rindexs=[]}clone(){let t=new m(this.m_renderer,this.m_texStore);t.m_fboSizeFactor=this.m_fboSizeFactor,t.m_bgColor.copyFrom(this.m_bgColor),t.m_fboIndex=this.m_fboIndex,t.m_fboType=this.m_fboType,t.m_clearDepth=this.m_clearDepth,t.m_texsTot=this.m_texsTot,t.m_enableDepth=this.m_enableDepth,t.m_enableStencil=this.m_enableStencil,t.m_synFBOSizeWithViewport=this.m_synFBOSizeWithViewport,t.m_initW=this.m_initW,t.m_initH=this.m_initH,t.m_multisampleLevel=this.m_multisampleLevel;let e=0;for(;e<this.m_texsTot;++e)t.m_texs[e]=t.m_texs[e];if(null!=this.m_rindexs){let i=this.m_rindexs.length,s=new Array(i);for(e=0;e<i;++e)s[e]=this.m_rindexs[e];t.setRProcessIDList(s)}return t}}e.default=m},af68:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s(i("11e6")),r=s(i("7b0e"));class n{constructor(){this.m_listLen=0,this.m_ids=[],this.m_list=[],this.m_entieies=[],this.m_fs=[],this.m_fids=[]}getFreeId(){return this.m_fids.length>0?this.m_fids.pop():-1}createNode(){let t,e=this.getFreeId();return e>=0?(this.m_fs[e]=1,t=this.m_list[e],t.spaceId=e,t):(e=this.m_listLen,t=r.default.Create(),this.m_list.push(t),this.m_entieies.push(null),t.spaceId=e,this.m_fs.push(1),this.m_ids.push(e),this.m_fs.push(1),this.m_listLen++,t)}restoreId(t){t>0&&1==this.m_fs[t]&&(this.m_fids.push(t),this.m_fs[t]=0,this.m_entieies[t]=null)}addEntity(t){let e=this.createNode();return this.m_entieies[e.spaceId]=t,e.entity=t,t.__$rseFlag=a.default.AddSpaceUid(t.__$rseFlag,e.spaceId),e}initialize(t){if(t>0)for(let e=0;e<t;e++){let t=this.createNode();this.m_entieies[t.spaceId]=null}}getNodeByEntity(t){if(a.default.TestSpaceContains(t.__$rseFlag)){let e=a.default.GetSpaceUid(t.__$rseFlag);if(this.m_entieies[e]==t)return this.m_list[e]}return null}removeEntity(t){if(a.default.TestSpaceContains(t.__$rseFlag)){let e=a.default.GetSpaceUid(t.__$rseFlag);this.m_entieies[e]==t&&(this.m_list[e].reset(),this.restoreId(e),t.__$rseFlag=a.default.RemoveSpaceUid(t.__$rseFlag))}}}e.default=n},b3bd:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.uns="",this.types=null,this.uniformSize=0,this.uniformNameList=null,this.locations=null,this.dataList=null,this.calcModels=null,this.always=!0,this.next=null}getDataRefFromUniformName(t){if(null!=this.uniformNameList){let e=this.uniformNameList,i=e.length;for(let s=0;s<i;++s)if(t==e[s])return this.dataList[s]}return null}setDataRefFromUniformName(t,e){if(null!=this.uniformNameList){let i=this.uniformNameList,s=i.length;for(let a=0;a<s;++a)if(t==i[a]){this.dataList[a]=e;break}}}copyDataFromProbe(t){this.types=[];for(let e=0;e<t.uniformsTotal;++e)this.types.push(t.uniformTypes[e]);this.uniformSize=t.uniformsTotal}destroy(){let t=0,e=this.dataList.length;for(;t<e;++t)this.dataList[t]=null;if(null!=this.calcModels)for(e=this.calcModels.length,t=0;t<e;++t)this.calcModels[t].destroy(),this.calcModels[t]=null;this.dataList=null,this.types=null,this.locations=null,this.calcModels=null}}e.default=s},b4ea:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s(i("f63b")),r=s(i("8d98")),n=i("f3a2");e.ShaderCodeUUID=n.ShaderCodeUUID;const l=i("c052");e.ShaderCodeConfigure=l.ShaderCodeConfigure,e.ShaderCodeType=l.ShaderCodeType,e.IShaderLibConfigure=l.IShaderLibConfigure,e.IShaderLibListener=l.IShaderLibListener;const h=i("4301");e.MaterialContextParam=h.MaterialContextParam;class _{constructor(){this.m_initFlag=!0,this.m_texLoader=null,this.m_rscene=null,this.lightModule=null,this.envLightModule=null,this.vsmModule=null,this.pipeline=null}addShaderLibListener(t){null!=_.ShaderLib&&_.ShaderLib.setListener(t)}getTextureLoader(){return this.m_texLoader}isTextureLoadedAll(){return this.m_texLoader.isLoadedAll()}getTextureByUrl(t,e=!0,i=!0){let s=null,a=t.slice(t.lastIndexOf(".")+1);switch(a=a.toLocaleLowerCase(),a){case"jpeg":case"jpg":case"png":case"gif":s=this.m_texLoader.getImageTexByUrl(t),s.mipmapEnabled=i,e&&s.setWrap(r.default.WRAP_REPEAT);break;default:break}return s}createShaderLibConfig(){return{shaderCodeConfigures:[],version:""}}buildConfigure(t,e){if(null==e){let i=this.createShaderLibConfig();if(null==t&&(t=new h.MaterialContextParam),t.loadAllShaderCode){let e=_.ShaderLib.createShaderCodeConfigure(t);null!=e&&i.shaderCodeConfigures.push(e)}e=i}return e}initialize(t,e=null,i=null){if(this.m_initFlag){i=this.buildConfigure(e,i),this.m_initFlag=!1,this.m_rscene=t,this.m_texLoader=new a.default(this.m_rscene.textureBlock);let s=this;if(null==e&&(e=new h.MaterialContextParam),this.m_param=e,""!=e.shaderLibVersion&&(i.version=e.shaderLibVersion),_.ShaderLib.initialize(i,e.shaderCodeBinary),e.loadAllShaderCode&&_.ShaderLib.addAllShaderCodeObject(),this.initPipes(this.m_param),s.pipeline=this.createPipeline(),this.initEnd(e),!e.loadAllShaderCode){let t=_.ShaderLib.getListener();null!=t&&t.shaderLibLoadComplete(0,0)}}}initPipes(t){}initEnd(t){}hasShaderCodeObjectWithUUID(t){return _.ShaderLib.hasShaderCodeObjectWithUUID(t)}addShaderCodeObject(t,e){_.ShaderLib.addShaderCodeObject(t,e)}addPipeline(t){null!=t&&t!=this.pipeline&&(null!=this.lightModule&&t.addPipe(this.lightModule),null!=this.envLightModule&&t.addPipe(this.envLightModule),null!=this.vsmModule&&t.addPipe(this.vsmModule))}createPipeline(){let t=this.m_rscene.materialBlock.createMaterialPipeline(_.ShaderLib);return null!=this.lightModule&&t.addPipe(this.lightModule),null!=this.envLightModule&&t.addPipe(this.envLightModule),null!=this.vsmModule&&t.addPipe(this.vsmModule),t}run(){null!=this.vsmModule&&this.m_param.vsmEnabled&&this.vsmModule.run()}destroy(){this.m_rscene=null}}_.ShaderLib=new l.ShaderLib,e.MaterialContext=_},baae:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{}s.FRAMEBUFFER=71,s.DRAW_FRAMEBUFFER=72,s.READ_FRAMEBUFFER=73,e.default=s},bbf4:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{}s.CAMERA_VISIBLE_ENABLE=0,s.CAMERA_VISIBLE_DISABLE=1,e.default=s},c052:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("f3a2"),a=i("cc55"),r=i("69ed");e.ShaderCodeType=r.ShaderCodeType;const n=i("28a9");e.ShaderCodeConfigure=n.ShaderCodeConfigure;const l=i("a221");e.IShaderLibConfigure=l.IShaderLibConfigure;const h=i("ca2f"),_=i("12e2");e.IShaderLibListener=_.IShaderLibListener;class o{constructor(){this.m_map=new Map,this.m_uuidList=[]}addConfigureWithUUID(t,e){""==t||this.m_map.has(t)||(this.m_map.set(t,e),this.m_uuidList.push(t))}getConfigureWithUUID(t){return this.m_map.get(t)}getUUIDList(){return this.m_uuidList}getUUIDListLength(){return this.m_uuidList.length}}class u{constructor(t){this.m_loadingTotal=0,this.m_shaderCodeObject=new a.ShaderCodeObject,this.m_configure=null,this.version="",this.m_configure=t}decodeUint8Arr(t){return new TextDecoder("utf-8").decode(t)}encodeUint8Arr(t){return(new TextEncoder).encode(t)}loadedShdCode(t,e,i){if(this.m_loadingTotal++,this.m_configure.buildBinaryFile&&!this.m_configure.binary){let i=this.encodeUint8Arr(t);for(let t=0;t<i.length;++t)i[t]=222-i[t];u.s_fileIO.downloadBinFile(i,e+"","bin")}switch(e){case r.ShaderCodeType.VertHead:this.m_shaderCodeObject.vert_head=t;break;case r.ShaderCodeType.VertBody:this.m_shaderCodeObject.vert_body=t;break;case r.ShaderCodeType.FragHead:this.m_shaderCodeObject.frag_head=t;break;case r.ShaderCodeType.FragBody:this.m_shaderCodeObject.frag_body=t;break;default:break}this.m_loadingTotal==this.m_configure.types.length&&(i(this.m_configure.uuid,this.m_shaderCodeObject),this.m_shaderCodeObject=null,this.m_configure=null)}async loadBinCode(t,e,i){const s=new FileReader;s.onload=t=>{let a=new Uint8Array(s.result);for(let e=0;e<a.length;++e)a[e]=222-a[e];this.loadedShdCode(this.decodeUint8Arr(a),e,i)};const a=new XMLHttpRequest;a.open("GET",t,!0),a.responseType="blob",a.onload=t=>{a.status<=206&&s.readAsArrayBuffer(a.response)},a.onerror=t=>{},a.send()}loadTextCode(t,e,i){let s=new XMLHttpRequest;s.open("GET",t,!0),s.onload=()=>{s.status<=206&&this.loadedShdCode(s.responseText,e,i)},s.onerror=t=>{},s.send()}loadCode(t,e,i){this.m_configure.binary?this.loadBinCode(t,e,i):this.loadTextCode(t,e,i)}load(t){if(this.m_loadingTotal=0,null==this.m_configure.urls){let e=""!=this.version?this.version+"/":"",i=this.m_configure.binary?".bin":".glsl";for(let s=0;s<this.m_configure.types.length;++s){let a="static/shader/"+e+"glsl/"+this.m_configure.uuid+"/"+this.m_configure.types[s]+i;this.loadCode(a,this.m_configure.types[s],t)}}else for(let e=0;e<this.m_configure.urls.length;++e){let i=this.m_configure.urls[e];this.loadCode(i,this.m_configure.types[e],t)}}}u.s_fileIO=new h.FileIO;class m{constructor(){this.m_loadingTotal=0,this.m_loadedTotal=0,this.m_loadStatusMap=new Map,this.m_shaderCodeMap=new Map,this.m_configLib=null,this.m_listener=null,this.m_version=""}setListener(t){this.m_listener=t}getListener(){return this.m_listener}initialize(t=null,e=!1){if(null==this.m_configLib){let i;this.m_configLib=new o;let a=null;if(null!=t&&(a=t.shaderCodeConfigures,this.m_version=t.version),null!=a)for(let t=0;t<a.length;++t)i=a[t],null!=i&&this.m_configLib.addConfigureWithUUID(i.uuid,i);else i=new n.ShaderCodeConfigure,i.uuid=s.ShaderCodeUUID.PBR,i.types=[r.ShaderCodeType.VertHead,r.ShaderCodeType.VertBody,r.ShaderCodeType.FragHead,r.ShaderCodeType.FragBody],i.binary=e,this.m_configLib.addConfigureWithUUID(i.uuid,i)}}addAllShaderCodeObject(){if(this.m_configLib.getUUIDListLength()>0){let t=this.m_configLib.getUUIDList();for(let e=0;e<t.length;++e)this.addShaderCodeObjectWithUUID(t[e])}else null!=this.m_listener&&this.m_listener.shaderLibLoadComplete(0,0)}hasShaderCodeObjectWithUUID(t){return this.m_shaderCodeMap.has(t)}addShaderCodeObjectWithUUID(t){if(!this.m_shaderCodeMap.has(t)&&!this.m_loadStatusMap.has(t)){this.m_loadingTotal++;let e=new u(this.m_configLib.getConfigureWithUUID(t));e.version=this.m_version,e.load((t,e)=>{this.m_shaderCodeMap.set(t,e),this.m_loadedTotal++,null!=this.m_listener&&this.m_listener.shaderLibLoadComplete(this.m_loadingTotal,this.m_loadedTotal)})}}addShaderCodeObject(t,e){null==e||e.uuid!=""+t||this.m_shaderCodeMap.has(t)||this.m_shaderCodeMap.set(t,e)}getShaderCodeObjectWithUUID(t){let e=null;return this.m_shaderCodeMap.has(t)&&(e=this.m_shaderCodeMap.get(t)),e}createShaderCodeConfigure(t){let e,i="static/shader/"+(""!=t.shaderLibVersion?t.shaderLibVersion+"/":"");i+="glsl/";let a=s.ShaderCodeUUID.None;return t.lambertMaterialEnabled?a=s.ShaderCodeUUID.Lambert:t.pbrMaterialEnabled&&(a=s.ShaderCodeUUID.PBR),a!=s.ShaderCodeUUID.None&&(e=new n.ShaderCodeConfigure,e.uuid=a,e.buildBinaryFile=t.buildBinaryFile,i+=e.uuid+"/",t.shaderCodeBinary&&t.shaderFileNickname&&(e.urls=[i+"glsl01.bin",i+"glsl02.bin",i+"glsl03.bin",i+"glsl04.bin"]),e.binary=t.shaderCodeBinary),e}}e.ShaderLib=m},c164:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){}}s.BasePredefined="\n#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n",e.MathShaderCode=s;class a{constructor(){}}a.BasePredefined="\nvec4 localPosition = vec4(0.0,0.0,0.0,1.0);\nvec4 worldPosition = vec4(0.0,0.0,0.0,1.0);\n// view space position\nvec4 viewPosition = vec4(0.0,0.0,0.0,1.0);\nvec3 worldNormal = vec3(0.0, 0.0, 1.0);\n",a.FragPredefined="\n",a.FragDefined="\n",a.VertPredefined="\n// origin world position\nvec4 oWorldPosition = vec4(0.0,0.0,0.0,1.0);\n",a.VertDefined="\n",e.ShaderCode=a},c497:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s(i("8e17"));class r{constructor(t=null){this.m_matrix4AllocateSize=8192,this.m_mainDiv=null,this.m_renderContextAttri={depth:!0,premultipliedAlpha:!1,alpha:!0,antialias:!1,stencil:!1,preserveDrawingBuffer:!0,powerPreference:"high-performance"},this.m_tickUpdateTime=20,this.m_polygonOffsetEnabled=!1,this.m_ditherEnabled=!1,this.autoSyncRenderBufferAndWindowSize=!0,this.maxWebGLVersion=2,this.cameraPerspectiveEnabled=!0,this.evtFlowEnabled=!1,this.camProjParam=new a.default(45,10,5e3),this.camPosition=new a.default(2e3,2e3,2e3),this.camLookAtPos=new a.default(0,0,0),this.camUpDirect=new a.default(0,1,0),this.batchEnabled=!0,this.processFixedState=!1,this.m_mainDiv=t,this.autoSyncRenderBufferAndWindowSize=null==t}setTickUpdateTime(t){t=Math.round(t),this.m_tickUpdateTime=t>5?t:5}getTickUpdateTime(){return this.m_tickUpdateTime}setPolygonOffsetEanbled(t){this.m_polygonOffsetEnabled=t}getPolygonOffsetEanbled(){return this.m_polygonOffsetEnabled}setDitherEanbled(t){this.m_ditherEnabled=t}getDitherEanbled(){return this.m_ditherEnabled}getDiv(){return this.m_mainDiv}getRenderContextAttri(){return this.m_renderContextAttri}setAttriDepth(t){this.m_renderContextAttri.depth=t}setAttriStencil(t){this.m_renderContextAttri.stencil=t}setAttriAlpha(t){this.m_renderContextAttri.alpha=t}setAttriPremultipliedAlpha(t){this.m_renderContextAttri.premultipliedAlpha=t}setAttriAntialias(t){this.m_renderContextAttri.antialias=t}setAttripreserveDrawingBuffer(t){this.m_renderContextAttri.preserveDrawingBuffer=t}setAttriHightPowerPreference(t){this.m_renderContextAttri.powerPreference=t?"high-performance":"default"}setMatrix4AllocateSize(t){t<1024&&(t=1024),this.m_matrix4AllocateSize=t}getMatrix4AllocateSize(){return this.m_matrix4AllocateSize}setCamProject(t,e,i){if(e>=i)throw Error("Error Camera cear > far !!!");this.camProjParam.setTo(t,e,i)}setCamPosition(t,e,i){this.camPosition.setTo(t,e,i)}setCamLookAtPos(t,e,i){this.camLookAtPos.setTo(t,e,i)}setCamUpDirect(t,e,i){this.camUpDirect.setTo(t,e,i)}}e.default=r},c51d:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s(i("6e01")),r=s(i("8e17")),n=s(i("18c7")),l=s(i("e214")),h=s(i("fecb"));class _{constructor(){this.version=0,this.matUProbe=null,this.ufrustumProbe=null,this.uniformEnabled=!1,this.name="Camera",this.m_tempV=new r.default,this.m_tempV1=new r.default,this.m_initRV=new r.default,this.m_initUP=new r.default,this.m_lookRHEnabled=!0,this.m_matrix=new n.default,this.m_viewMat=new n.default,this.m_viewInvertMat=new n.default,this.m_vpMat=new n.default,this.m_tempMat=new n.default,this.m_projMat=new n.default,this.m_camPos=new r.default,this.m_lookAtPos=new r.default,this.m_up=new r.default,this.m_lookDirectNV=new r.default,this.m_lookAtDirec=new r.default,this.m_nearPlaneWidth=1,this.m_nearPlaneHeight=1,this.m_viewX=0,this.m_viewY=0,this.m_viewW=800,this.m_viewH=600,this.m_viewHalfW=400,this.m_viewHalfH=300,this.m_fovRadian=0,this.m_aspect=1,this.m_zNear=.1,this.m_zFar=1e3,this.m_b=0,this.m_t=0,this.m_l=0,this.m_r=0,this.m_perspectiveEnabled=!1,this.m_project2Enabled=!1,this.m_rightHandEnabled=!0,this.m_rotV=new r.default(0,0,0),this.m_viewFieldZoom=1,this.m_changed=!0,this.m_unlock=!0,this.m_tempNV=new r.default,this.m_tempUPV=new r.default,this.m_tempRV=new r.default,this.m_tempCamPos=new r.default,this.m_tempLookAtPos=new r.default,this.m_rotDegree=0,this.m_rotAxis=new r.default,this.m_rotPivotPoint=null,this.m_axisRotEnabled=!1,this.m_frustumWAABB=new h.default,this.m_invViewMat=null,this.m_nearPlaneHalfW=.5,this.m_nearPlaneHalfH=.5,this.m_nearWCV=new r.default,this.m_farWCV=new r.default,this.m_wNV=new r.default,this.m_wFrustumVtxArr=[new r.default,new r.default,new r.default,new r.default,new r.default,new r.default,new r.default,new r.default,null,null,null],this.m_wFruPlaneList=[new l.default,new l.default,new l.default,new l.default,new l.default,new l.default],this.m_fpNVArr=[new r.default,new r.default,new r.default,new r.default,new r.default,new r.default],this.m_fpDisArr=[0,0,0,0,0,0],this.m_viewMatrix=null}lock(){this.m_unlock=!1}unlock(){this.m_unlock=!0}lookAtLH(t,e,i){this.m_unlock&&(this.m_camPos.copyFrom(t),this.m_lookAtPos.copyFrom(e),this.m_up.copyFrom(i),this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookRHEnabled=!1,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),this.m_initUP.copyFrom(i),this.m_initUP.normalize(),r.default.Cross(this.m_lookAtDirec,this.m_up,this.m_initRV),this.m_initRV.normalize(),this.m_changed=!0)}lookAtRH(t,e,i){this.m_unlock&&(this.m_camPos.copyFrom(t),this.m_lookAtPos.copyFrom(e),this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookRHEnabled=!0,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),r.default.Cross(this.m_lookAtDirec,i,this.m_initRV),r.default.Cross(this.m_initRV,this.m_lookAtDirec,this.m_initUP),this.m_initUP.normalize(),this.m_initRV.normalize(),this.m_up.copyFrom(this.m_initUP),this.m_changed=!0)}getLookAtLHToCamera(t){t.lookAtLH(this.m_camPos,this.m_lookAtPos,this.m_up)}getLookAtRHToCamera(t){t.lookAtRH(this.m_camPos,this.m_lookAtPos,this.m_up)}perspectiveLH(t,e,i,s){this.m_unlock&&(this.m_project2Enabled=!1,this.m_aspect=e,this.m_fovRadian=t,this.m_zNear=i,this.m_zFar=s,this.m_projMat.perspectiveLH(t,e,i,s),this.m_viewFieldZoom=Math.tan(.5*t),this.m_perspectiveEnabled=!0,this.m_rightHandEnabled=!1,this.m_changed=!0)}perspectiveRH(t,e,i,s){this.m_unlock&&(this.m_aspect=e,this.m_fovRadian=t,this.m_zNear=i,this.m_zFar=s,this.m_projMat.perspectiveRH(t,e,i,s),this.m_viewFieldZoom=Math.tan(.5*t),this.m_project2Enabled=!1,this.m_perspectiveEnabled=!0,this.m_rightHandEnabled=!0,this.m_changed=!0)}perspectiveRH2(t,e,i,s,a){this.m_unlock&&(this.m_aspect=e/i,this.m_fovRadian=t,this.m_zNear=s,this.m_zFar=a,this.m_projMat.perspectiveRH2(t,e,i,s,a),this.m_viewFieldZoom=Math.tan(.5*t),this.m_perspectiveEnabled=!0,this.m_project2Enabled=!0,this.m_rightHandEnabled=!0,this.m_changed=!0)}getAspect(){return this.m_aspect}getViewFieldZoom(){return this.m_viewFieldZoom}orthoRH(t,e,i,s,a,r){this.m_unlock&&(this.m_zNear=t,this.m_zFar=e,this.m_b=i,this.m_t=s,this.m_l=a,this.m_r=r,this.m_projMat.orthoRH(i,s,a,r,t,e),this.m_perspectiveEnabled=!1,this.m_rightHandEnabled=!0,this.m_changed=!0)}orthoLH(t,e,i,s,a,r){this.m_unlock&&(this.m_zNear=t,this.m_zFar=e,this.m_b=i,this.m_t=s,this.m_l=a,this.m_r=r,this.m_projMat.orthoLH(i,s,a,r,t,e),this.m_perspectiveEnabled=!1,this.m_rightHandEnabled=!1,this.m_changed=!0)}isPerspectiveEnabled(){return this.m_perspectiveEnabled}isRightHandEnabled(){return this.m_rightHandEnabled}setViewXY(t,e){this.m_unlock&&(this.m_viewX=t,this.m_viewY=e)}setViewSize(t,e){this.m_unlock&&(t==this.m_viewW&&e==this.m_viewH||(this.m_viewW=t,this.m_viewH=e,this.m_viewHalfW=.5*t,this.m_viewHalfH=.5*e,this.m_perspectiveEnabled?this.m_project2Enabled?this.m_rightHandEnabled&&this.perspectiveRH2(this.m_fovRadian,t,e,this.m_zNear,this.m_zFar):this.m_rightHandEnabled?this.perspectiveRH(this.m_fovRadian,t/e,this.m_zNear,this.m_zFar):this.perspectiveLH(this.m_fovRadian,t/e,this.m_zNear,this.m_zFar):this.orthoRH(this.m_zNear,this.m_zFar,-.5*e,.5*e,-.5*t,.5*t)))}getViewX(){return this.m_viewX}getViewY(){return this.m_viewY}getViewWidth(){return this.m_viewW}getViewHeight(){return this.m_viewH}translation(t){this.m_unlock&&(this.m_camPos.copyFrom(t),this.m_lookAtPos.x=t.x+this.m_lookAtDirec.x,this.m_lookAtPos.y=t.y+this.m_lookAtDirec.y,this.m_lookAtPos.z=t.z+this.m_lookAtDirec.z,this.m_changed=!0)}translationXYZ(t,e,i){this.m_tempV.setXYZ(t,e,i),this.m_unlock&&r.default.DistanceSquared(this.m_camPos,this.m_tempV)>1e-5&&(this.m_camPos.setTo(t,e,i),this.m_lookAtPos.x=t+this.m_lookAtDirec.x,this.m_lookAtPos.y=e+this.m_lookAtDirec.y,this.m_lookAtPos.z=i+this.m_lookAtDirec.z,this.m_changed=!0)}forward(t){this.m_unlock&&(this.m_camPos.x+=this.m_lookDirectNV.x*t,this.m_camPos.y+=this.m_lookDirectNV.y*t,this.m_camPos.z+=this.m_lookDirectNV.z*t,this.m_lookAtPos.x=this.m_camPos.x+this.m_lookAtDirec.x,this.m_lookAtPos.y=this.m_camPos.y+this.m_lookAtDirec.y,this.m_lookAtPos.z=this.m_camPos.z+this.m_lookAtDirec.z,this.m_changed=!0)}slideViewOffsetXY(t,e){if(this.m_unlock){this.m_tempV.setXYZ(t,e,0),this.m_invViewMat.transformVectorSelf(this.m_tempV),t=this.m_tempV.x-this.m_camPos.x,e=this.m_tempV.y-this.m_camPos.y;let i=this.m_tempV.z-this.m_camPos.z;this.m_camPos.x+=t,this.m_camPos.y+=e,this.m_camPos.z+=i,this.m_lookAtPos.x+=t,this.m_lookAtPos.y+=e,this.m_lookAtPos.z+=i,this.m_changed=!0}}forwardFixPos(t,e){this.m_unlock&&(this.m_camPos.x=e.x+this.m_lookDirectNV.x*t,this.m_camPos.y=e.y+this.m_lookDirectNV.y*t,this.m_camPos.z=e.z+this.m_lookDirectNV.z*t,this.m_lookAtPos.x=this.m_camPos.x+this.m_lookAtDirec.x,this.m_lookAtPos.y=this.m_camPos.y+this.m_lookAtDirec.y,this.m_lookAtPos.z=this.m_camPos.z+this.m_lookAtDirec.z,this.m_changed=!0)}swingHorizontalWithAxis(t,e){this.m_unlock&&(this.m_tempMat.identity(),null!=e?this.m_tempMat.appendRotation(t*a.default.MATH_PI_OVER_180,e):this.m_tempMat.appendRotation(t*a.default.MATH_PI_OVER_180,r.default.Y_AXIS),this.m_lookAtDirec.x=this.m_camPos.x-this.m_lookAtPos.x,this.m_lookAtDirec.y=this.m_camPos.y-this.m_lookAtPos.y,this.m_lookAtDirec.z=this.m_camPos.z-this.m_lookAtPos.z,this.m_tempMat.transformVectorSelf(this.m_lookAtDirec),this.m_camPos.x=this.m_lookAtDirec.x+this.m_lookAtPos.x,this.m_camPos.y=this.m_lookAtDirec.y+this.m_lookAtPos.y,this.m_camPos.z=this.m_lookAtDirec.z+this.m_lookAtPos.z,this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookRHEnabled=!0,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),this.m_tempMat.transformVectorSelf(this.m_initRV),this.m_initRV.normalize(),r.default.Cross(this.m_initRV,this.m_lookAtDirec,this.m_up),this.m_up.normalize(),this.m_changed=!0)}swingHorizontal(t){this.m_unlock&&(this.m_tempMat.identity(),this.m_tempMat.appendRotation(t*a.default.MATH_PI_OVER_180,this.m_up),this.m_lookAtDirec.x=this.m_camPos.x-this.m_lookAtPos.x,this.m_lookAtDirec.y=this.m_camPos.y-this.m_lookAtPos.y,this.m_lookAtDirec.z=this.m_camPos.z-this.m_lookAtPos.z,this.m_tempMat.transformVectorSelf(this.m_lookAtDirec),this.m_camPos.x=this.m_lookAtDirec.x+this.m_lookAtPos.x,this.m_camPos.y=this.m_lookAtDirec.y+this.m_lookAtPos.y,this.m_camPos.z=this.m_lookAtDirec.z+this.m_lookAtPos.z,this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookRHEnabled=!0,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),r.default.Cross(this.m_lookAtDirec,this.m_up,this.m_initRV),this.m_initRV.normalize(),this.m_changed=!0)}swingVertical(t){this.m_unlock&&(this.m_tempMat.identity(),this.m_tempMat.appendRotation(t*a.default.MATH_PI_OVER_180,this.m_initRV),this.m_lookAtDirec.x=this.m_camPos.x-this.m_lookAtPos.x,this.m_lookAtDirec.y=this.m_camPos.y-this.m_lookAtPos.y,this.m_lookAtDirec.z=this.m_camPos.z-this.m_lookAtPos.z,this.m_tempMat.transformVectorSelf(this.m_lookAtDirec),this.m_camPos.x=this.m_lookAtDirec.x+this.m_lookAtPos.x,this.m_camPos.y=this.m_lookAtDirec.y+this.m_lookAtPos.y,this.m_camPos.z=this.m_lookAtDirec.z+this.m_lookAtPos.z,this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookRHEnabled=!0,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),r.default.Cross(this.m_initRV,this.m_lookAtDirec,this.m_up),this.m_up.normalize(),this.m_initUP.copyFrom(this.m_up),this.m_changed=!0)}setPosition(t){if(this.m_unlock){r.default.Cross(this.m_lookAtDirec,this.m_up,this.m_tempV);let e=this.m_tempV.dot(this.m_initUP);this.m_tempV1.copyFrom(this.m_initUP),this.m_tempV1.scaleBy(e),this.m_tempV.subtractBy(this.m_tempV1),this.m_camPos.copyFrom(t),this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),r.default.Cross(this.m_tempV,this.m_lookAtDirec,this.m_up),this.m_up.normalize(),this.m_changed=!0}}setPositionXYZ(t,e,i){if(this.m_unlock){r.default.Cross(this.m_lookAtDirec,this.m_up,this.m_tempV);var s=this.m_tempV.dot(this.m_initUP);this.m_tempV1.copyFrom(this.m_initUP),this.m_tempV1.scaleBy(s),this.m_tempV.subtractBy(this.m_tempV1),this.m_camPos.setTo(t,e,i),this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),r.default.Cross(this.m_tempV,this.m_lookAtDirec,this.m_up),this.m_up.normalize(),this.m_changed=!0}}setLookPosXYZFixUp(t,e,i){this.m_unlock&&(this.m_lookAtPos.setTo(t,e,i),this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookRHEnabled=!0,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),r.default.Cross(this.m_lookAtDirec,this.m_up,this.m_initRV),this.m_initRV.normalize(),this.m_changed=!0)}setPositionXYZFixUp(t,e,i){this.m_unlock&&(this.m_camPos.setTo(t,e,i),this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookRHEnabled=!0,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),r.default.Cross(this.m_lookAtDirec,this.m_up,this.m_initRV),this.m_initRV.normalize(),this.m_changed=!0)}setPositionFixUp(t){this.m_unlock&&(this.m_camPos.copyFrom(t),this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookRHEnabled=!0,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),r.default.Cross(this.m_lookAtDirec,this.m_up,this.m_initRV),this.m_initRV.normalize(),this.m_changed=!0)}copyFrom(t){let e=t.getPosition();this.m_camPos.copyFrom(e),e=t.getLookAtPosition(),this.m_lookAtPos.copyFrom(e),this.setZNear(t.getZNear()),this.setZFar(t.getZFar()),this.setNearPlaneWidth(t.getNearPlaneWidth()),this.setNearPlaneHeight(t.getNearPlaneHeight()),this.setPerspectiveEnabled(t.getPerspectiveEnabled()),this.m_viewInvertMat.copyFrom(t.getViewInvMatrix())}getNV(){return this.m_tempNV.copyFrom(this.m_lookDirectNV),this.m_tempNV}getUV(){return this.m_tempUPV.copyFrom(this.m_up),this.m_tempUPV}getRV(){return this.m_tempRV.copyFrom(this.m_initRV),this.m_tempRV}getPosition(){return this.m_tempCamPos.copyFrom(this.m_camPos),this.m_tempCamPos}getLookAtPosition(){return this.m_tempLookAtPos.copyFrom(this.m_lookAtPos),this.m_tempLookAtPos}setLookAtPosition(t){this.m_unlock&&(this.m_lookAtPos.copyFrom(t),this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),this.m_changed=!0)}setLookAtXYZ(t,e,i){this.m_unlock&&(this.m_lookAtPos.setTo(t,e,i),this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),this.m_changed=!0)}getPerspectiveEnabled(){return this.m_perspectiveEnabled}setPerspectiveEnabled(t){this.m_perspectiveEnabled=t}appendRotationByAxis(t,e,i=null){this.m_unlock&&(this.m_rotDegree=t,this.m_changed=!0,this.m_rotAxis.copyFrom(e),this.m_rotPivotPoint=i,this.m_axisRotEnabled=!0)}setRotationX(t){this.m_rotV.x=t,this.m_changed=!0,this.m_axisRotEnabled=!1}getRotationX(){return this.m_rotV.x}setRotationY(t){this.m_rotV.y=t,this.m_changed=!0,this.m_axisRotEnabled=!1}getRotationY(){return this.m_rotV.y}setRotationZ(t){this.m_rotV.z=t,this.m_changed=!0,this.m_axisRotEnabled=!1}getRotationZ(){return this.m_rotV.z}setRotationXYZ(t,e,i){this.m_unlock&&(this.m_rotV.setXYZ(t,e,i),this.m_changed=!0,this.m_axisRotEnabled=!1)}screenXYToViewXYZ(t,e,i){t-=this.m_viewX,e-=this.m_viewY,this.m_perspectiveEnabled&&(t=this.m_nearPlaneWidth*(t-this.m_viewHalfW)/this.m_viewHalfW,e=this.m_nearPlaneHeight*(this.m_viewHalfH-e)/this.m_viewHalfH),i.setTo(t,e,-this.m_zNear)}screenXYToWorldXYZ(t,e,i){t-=this.m_viewX,e-=this.m_viewY,this.m_perspectiveEnabled&&(t=.5*this.m_nearPlaneWidth*(t-this.m_viewHalfW)/this.m_viewHalfW,e=.5*this.m_nearPlaneHeight*(this.m_viewHalfH-e)/this.m_viewHalfH),i.setTo(t,e,-this.m_zNear),i.w=1,this.m_viewInvertMat.transformVectorSelf(i)}getWorldPickingRayByScreenXY(t,e,i,s){t-=this.m_viewX,e-=this.m_viewY,this.m_perspectiveEnabled?(t=.5*this.m_nearPlaneWidth*(t-this.m_viewHalfW)/this.m_viewHalfW,e=.5*this.m_nearPlaneHeight*(e-this.m_viewHalfH)/this.m_viewHalfH,i.setTo(t,e,-this.m_zNear),i.w=1,this.m_viewInvertMat.transformVectorSelf(i),s.copyFrom(i),s.subtractBy(this.m_camPos),s.normalize()):(t-=this.m_viewHalfW,e-=this.m_viewHalfH,i.setTo(t,e,-this.m_zNear),i.w=1,this.m_viewInvertMat.transformVectorSelf(i),s.copyFrom(this.m_lookDirectNV))}calcScreenNormalizeXYByWorldPos(t,e){e.copyFrom(t),this.m_vpMat.transformVectorSelf(e),e.x/=e.w,e.y/=e.w}worldPosToScreen(t){this.m_viewMat.transformVector3Self(t),this.m_projMat.transformVectorSelf(t),t.x/=t.w,t.y/=t.w,t.x*=this.m_viewHalfW,t.y*=this.m_viewHalfH,t.x+=this.m_viewX,t.y+=this.m_viewY}calcViewRectByWorldSphere(t,e,i){this.m_viewMat.transformVector3Self(t),e*=1.15,i.x=t.x-e,i.y=t.y-e,i.z=t.z,t.x+=e,t.y+=e,this.m_projMat.transformPerspV4Self(i),this.m_projMat.transformPerspV4Self(t),t.z=1/t.w,i.z=t.x*t.z,i.w=t.y*t.z,i.z*=this.m_viewHalfW,i.w*=this.m_viewHalfH,i.x*=t.z,i.y*=t.z,i.x*=this.m_viewHalfW,i.y*=this.m_viewHalfH,i.z=i.z-i.x,i.w=i.w-i.y,i.x+=this.m_viewX,i.y+=this.m_viewY}calcScreenRectByWorldSphere(t,e,i){this.m_viewMat.transformVector3Self(t),e*=1.15,i.x=t.x-e,i.y=t.y-e,t.x+=e,t.y+=e,this.m_projMat.transformPerspV4Self(i),this.m_projMat.transformPerspV4Self(t),t.z=1/t.w,i.z=t.x*t.z,i.w=t.y*t.z,i.x*=t.z,i.y*=t.z,i.z=i.z-i.x,i.w=i.w-i.y}getInvertViewMatrix(){return this.m_invViewMat}getZNear(){return this.m_zNear}setZNear(t){this.m_zNear=t}getZFar(){return this.m_zFar}setZFar(t){this.m_zFar=t}getNearPlaneWidth(){return this.m_nearPlaneWidth}setNearPlaneWidth(t){this.m_nearPlaneWidth=t}getNearPlaneHeight(){return this.m_nearPlaneHeight}setNearPlaneHeight(t){this.m_nearPlaneHeight=t}getFov(){return this.m_fovRadian}__calcTestParam(){null==this.m_invViewMat&&(this.m_invViewMat=new n.default),this.m_invViewMat.copyFrom(this.m_viewMat),this.m_invViewMat.invert();let t=null,e=this.m_viewHalfH,i=this.m_viewHalfW,s=this.m_viewHalfH,a=this.m_viewHalfW;if(this.m_perspectiveEnabled){let t=Math.tan(.5*this.m_fovRadian);e=this.m_zNear*t,i=e*this.m_aspect,s=this.m_zFar*t,a=s*this.m_aspect}this.m_nearPlaneHalfW=i,this.m_nearPlaneHalfH=e,this.m_nearWCV.setTo(0,0,-this.m_zNear),this.m_farWCV.setTo(0,0,-this.m_zFar),this.m_invViewMat.transformVectorSelf(this.m_nearWCV),this.m_invViewMat.transformVectorSelf(this.m_farWCV),this.m_wNV.x=this.m_farWCV.x-this.m_nearWCV.x,this.m_wNV.y=this.m_farWCV.y-this.m_nearWCV.y,this.m_wNV.z=this.m_farWCV.z-this.m_nearWCV.z,this.m_wNV.normalize(),t=this.m_wFruPlaneList[0],t.nv.copyFrom(this.m_wNV),t.distance=t.nv.dot(this.m_farWCV),t.position.copyFrom(this.m_farWCV),t=this.m_wFruPlaneList[1],t.nv.copyFrom(this.m_wFruPlaneList[0].nv),t.distance=t.nv.dot(this.m_nearWCV),t.position.copyFrom(this.m_nearWCV),this.m_wFrustumVtxArr[8]=this.m_nearWCV,this.m_wFrustumVtxArr[9]=this.m_farWCV,this.m_wFrustumVtxArr[11]=this.m_wNV,this.m_wFrustumVtxArr[0].setTo(-a,-s,-this.m_zFar),this.m_wFrustumVtxArr[1].setTo(a,-s,-this.m_zFar),this.m_wFrustumVtxArr[2].setTo(a,s,-this.m_zFar),this.m_wFrustumVtxArr[3].setTo(-a,s,-this.m_zFar),this.m_wFrustumVtxArr[4].setTo(-i,-e,-this.m_zNear),this.m_wFrustumVtxArr[5].setTo(i,-e,-this.m_zNear),this.m_wFrustumVtxArr[6].setTo(i,e,-this.m_zNear),this.m_wFrustumVtxArr[7].setTo(-i,e,-this.m_zNear),this.m_invViewMat.transformVectorSelf(this.m_wFrustumVtxArr[0]),this.m_invViewMat.transformVectorSelf(this.m_wFrustumVtxArr[1]),this.m_invViewMat.transformVectorSelf(this.m_wFrustumVtxArr[2]),this.m_invViewMat.transformVectorSelf(this.m_wFrustumVtxArr[3]),this.m_invViewMat.transformVectorSelf(this.m_wFrustumVtxArr[4]),this.m_invViewMat.transformVectorSelf(this.m_wFrustumVtxArr[5]),this.m_invViewMat.transformVectorSelf(this.m_wFrustumVtxArr[6]),this.m_invViewMat.transformVectorSelf(this.m_wFrustumVtxArr[7]),this.m_frustumWAABB.max.setTo(-9999999,-9999999,-9999999),this.m_frustumWAABB.min.setTo(9999999,9999999,9999999);for(let r=0;r<8;++r)this.m_frustumWAABB.addPosition(this.m_wFrustumVtxArr[r]);this.m_frustumWAABB.updateFast();let l=this.m_wFrustumVtxArr[0],h=this.m_wFrustumVtxArr[4];this.m_tempV.x=l.x-h.x,this.m_tempV.y=l.y-h.y,this.m_tempV.z=l.z-h.z,l=this.m_wFrustumVtxArr[1],h=this.m_wFrustumVtxArr[5],this.m_tempV1.x=l.x-h.x,this.m_tempV1.y=l.y-h.y,this.m_tempV1.z=l.z-h.z,t=this.m_wFruPlaneList[3],r.default.Cross(this.m_tempV1,this.m_tempV,t.nv),t.nv.normalize(),t.distance=t.nv.dot(l),t.position.copyFrom(l),l=this.m_wFrustumVtxArr[3],h=this.m_wFrustumVtxArr[7],this.m_tempV.x=l.x-h.x,this.m_tempV.y=l.y-h.y,this.m_tempV.z=l.z-h.z,l=this.m_wFrustumVtxArr[2],h=this.m_wFrustumVtxArr[6],this.m_tempV1.x=l.x-h.x,this.m_tempV1.y=l.y-h.y,this.m_tempV1.z=l.z-h.z,t=this.m_wFruPlaneList[2],r.default.Cross(this.m_tempV1,this.m_tempV,t.nv),t.nv.normalize(),t.distance=t.nv.dot(l),t.position.copyFrom(l),l=this.m_wFrustumVtxArr[0],h=this.m_wFrustumVtxArr[4],this.m_tempV.x=l.x-h.x,this.m_tempV.y=l.y-h.y,this.m_tempV.z=l.z-h.z,l=this.m_wFrustumVtxArr[3],h=this.m_wFrustumVtxArr[7],this.m_tempV1.x=l.x-h.x,this.m_tempV1.y=l.y-h.y,this.m_tempV1.z=l.z-h.z,t=this.m_wFruPlaneList[4],r.default.Cross(this.m_tempV,this.m_tempV1,t.nv),t.nv.normalize(),t.distance=t.nv.dot(l),t.position.copyFrom(l),l=this.m_wFrustumVtxArr[1],h=this.m_wFrustumVtxArr[5],this.m_tempV.x=l.x-h.x,this.m_tempV.y=l.y-h.y,this.m_tempV.z=l.z-h.z,l=this.m_wFrustumVtxArr[2],h=this.m_wFrustumVtxArr[6],this.m_tempV1.x=l.x-h.x,this.m_tempV1.y=l.y-h.y,this.m_tempV1.z=l.z-h.z,t=this.m_wFruPlaneList[5],r.default.Cross(this.m_tempV,this.m_tempV1,t.nv),t.nv.normalize(),t.distance=t.nv.dot(l),t.position.copyFrom(l),this.m_fpNVArr[0].copyFrom(this.m_wFruPlaneList[0].nv),this.m_fpNVArr[1].copyFrom(this.m_wFruPlaneList[1].nv),this.m_fpNVArr[1].scaleBy(-1),this.m_fpNVArr[2].copyFrom(this.m_wFruPlaneList[2].nv),this.m_fpNVArr[3].copyFrom(this.m_wFruPlaneList[3].nv),this.m_fpNVArr[3].scaleBy(-1),this.m_fpNVArr[4].copyFrom(this.m_wFruPlaneList[4].nv),this.m_fpNVArr[4].scaleBy(-1),this.m_fpNVArr[5].copyFrom(this.m_wFruPlaneList[5].nv),this.m_fpDisArr[0]=this.m_wFruPlaneList[0].distance,this.m_fpDisArr[1]=-this.m_wFruPlaneList[1].distance,this.m_fpDisArr[2]=this.m_wFruPlaneList[2].distance,this.m_fpDisArr[3]=-this.m_wFruPlaneList[3].distance,this.m_fpDisArr[4]=-this.m_wFruPlaneList[4].distance,this.m_fpDisArr[5]=this.m_wFruPlaneList[5].distance}getWordFrustumWAABB(){return this.m_frustumWAABB}getWordFrustumWAABBCenter(){return this.m_frustumWAABB.center}getWordFrustumVtxArr(){return this.m_wFrustumVtxArr}getWordFrustumPlaneArr(){return this.m_wFruPlaneList}visiTestSphere2(t,e){let i=this.m_fpNVArr[0].dot(t)-this.m_fpDisArr[0]-e>a.default.MATH_MIN_POSITIVE;return!i&&(i=this.m_fpNVArr[1].dot(t)-this.m_fpDisArr[1]-e>a.default.MATH_MIN_POSITIVE,!i&&(i=this.m_fpNVArr[2].dot(t)-this.m_fpDisArr[2]-e>a.default.MATH_MIN_POSITIVE,!i&&(i=this.m_fpNVArr[3].dot(t)-this.m_fpDisArr[3]-e>a.default.MATH_MIN_POSITIVE,!i&&(i=this.m_fpNVArr[4].dot(t)-this.m_fpDisArr[4]-e>a.default.MATH_MIN_POSITIVE,!i&&(i=this.m_fpNVArr[5].dot(t)-this.m_fpDisArr[5]-e>a.default.MATH_MIN_POSITIVE,!i)))))}visiTestSphere3(t,e,i){let s=this.m_fpNVArr[0].dot(t)-this.m_fpDisArr[0]+i-e>a.default.MATH_MIN_POSITIVE;return!s&&(s=this.m_fpNVArr[1].dot(t)-this.m_fpDisArr[1]-e>a.default.MATH_MIN_POSITIVE,!s&&(s=this.m_fpNVArr[2].dot(t)-this.m_fpDisArr[2]-e>a.default.MATH_MIN_POSITIVE,!s&&(s=this.m_fpNVArr[3].dot(t)-this.m_fpDisArr[3]-e>a.default.MATH_MIN_POSITIVE,!s&&(s=this.m_fpNVArr[4].dot(t)-this.m_fpDisArr[4]-e>a.default.MATH_MIN_POSITIVE,!s&&(s=this.m_fpNVArr[5].dot(t)-this.m_fpDisArr[5]-e>a.default.MATH_MIN_POSITIVE,!s)))))}visiTestPosition(t){let e=this.m_fpNVArr[0].dot(t)-this.m_fpDisArr[0]>a.default.MATH_MIN_POSITIVE;return!e&&(e=this.m_fpNVArr[1].dot(t)-this.m_fpDisArr[1]>a.default.MATH_MIN_POSITIVE,!e&&(e=this.m_fpNVArr[2].dot(t)-this.m_fpDisArr[2]>a.default.MATH_MIN_POSITIVE,!e&&(e=this.m_fpNVArr[3].dot(t)-this.m_fpDisArr[3]>a.default.MATH_MIN_POSITIVE,!e&&(e=this.m_fpNVArr[4].dot(t)-this.m_fpDisArr[4]>a.default.MATH_MIN_POSITIVE,!e&&(e=this.m_fpNVArr[5].dot(t)-this.m_fpDisArr[5]>a.default.MATH_MIN_POSITIVE,!e)))))}visiTestPlane(t,e){let i=t.dot(this.m_wFruPlaneList[0].position)-e,s=i*(t.dot(this.m_wFruPlaneList[1].position)-e);return s<a.default.MATH_MIN_POSITIVE||(s=i*(t.dot(this.m_wFruPlaneList[2].position)-e),s<a.default.MATH_MIN_POSITIVE||(s=i*(t.dot(this.m_wFruPlaneList[3].position)-e),s<a.default.MATH_MIN_POSITIVE||(s=i*(t.dot(this.m_wFruPlaneList[4].position)-e),s<a.default.MATH_MIN_POSITIVE||(s=i*(t.dot(this.m_wFruPlaneList[5].position)-e),s<a.default.MATH_MIN_POSITIVE))))}visiTestSphere(t,e){let i=this.m_frustumWAABB.sphereIntersect(t,e);if(i){let i=this.m_wFruPlaneList[0].intersectSphere(t,e),s=this.m_wFruPlaneList[1].intersectSphere(t,e);return!(i*s>=0&&!this.m_wFruPlaneList[0].intersectBoo&&!this.m_wFruPlaneList[1].intersectBoo)&&(i=this.m_wFruPlaneList[2].intersectSphere(t,e),s=this.m_wFruPlaneList[3].intersectSphere(t,e),!(i*s>=0&&!this.m_wFruPlaneList[2].intersectBoo&&!this.m_wFruPlaneList[3].intersectBoo)&&(i=this.m_wFruPlaneList[4].intersectSphere(t,e),s=this.m_wFruPlaneList[5].intersectSphere(t,e),!(i*s>=0&&!this.m_wFruPlaneList[4].intersectBoo&&!this.m_wFruPlaneList[5].intersectBoo)))}return!1}visiTestAABB(t){let e=t.center,i=t.radius,s=this.m_frustumWAABB.sphereIntersect(e,i);if(s){let t=this.m_wFruPlaneList[0].intersectSphere(e,i),s=this.m_wFruPlaneList[1].intersectSphere(e,i);return!(t*s>=0&&!this.m_wFruPlaneList[0].intersectBoo&&!this.m_wFruPlaneList[1].intersectBoo)&&(t=this.m_wFruPlaneList[2].intersectSphere(e,i),s=this.m_wFruPlaneList[3].intersectSphere(e,i),!(t*s>=0&&!this.m_wFruPlaneList[2].intersectBoo&&!this.m_wFruPlaneList[3].intersectBoo)&&(t=this.m_wFruPlaneList[4].intersectSphere(e,i),s=this.m_wFruPlaneList[5].intersectSphere(e,i),!(t*s>=0&&!this.m_wFruPlaneList[4].intersectBoo&&!this.m_wFruPlaneList[5].intersectBoo)))}return!1}setViewMatrix(t){this.m_viewMatrix=t,this.m_changed=!0}update(){this.m_changed&&(this.version++,this.m_changed=!1,null==this.m_viewMatrix?(this.m_axisRotEnabled?this.m_matrix.appendRotationPivot(this.m_rotDegree*a.default.MATH_PI_OVER_180,this.m_rotAxis,this.m_rotPivotPoint):(this.m_matrix.identity(),this.m_matrix.appendRotationEulerAngle(this.m_rotV.x*a.default.MATH_PI_OVER_180,this.m_rotV.y*a.default.MATH_PI_OVER_180,this.m_rotV.z*a.default.MATH_PI_OVER_180)),this.m_lookRHEnabled?this.m_viewMat.lookAtRH(this.m_camPos,this.m_lookAtPos,this.m_up):this.m_viewMat.lookAtLH(this.m_camPos,this.m_lookAtPos,this.m_up),this.m_viewMat.append(this.m_matrix)):this.m_viewMat.copyFrom(this.m_viewMatrix),this.m_project2Enabled?(this.m_nearPlaneWidth=this.m_zNear*Math.tan(.5*this.m_fovRadian)*2,this.m_nearPlaneHeight=this.m_nearPlaneWidth/this.m_aspect):(this.m_nearPlaneHeight=this.m_zNear*Math.tan(.5*this.m_fovRadian)*2,this.m_nearPlaneWidth=this.m_aspect*this.m_nearPlaneHeight),this.m_viewInvertMat.copyFrom(this.m_viewMat),this.m_viewInvertMat.invert(),this.m_vpMat.identity(),this.m_vpMat.copyFrom(this.m_viewMat),this.m_vpMat.append(this.m_projMat),this.__calcTestParam(),this.updateUniformData())}updateCamMatToUProbe(t){t.isEnabled()&&(t.update(),t.getFS32At(0).set(this.m_viewMat.getLocalFS32(),0),t.getFS32At(1).set(this.m_projMat.getLocalFS32(),0))}updateUniformData(){this.uniformEnabled&&(this.updateCamMatToUProbe(this.matUProbe),this.ufrustumProbe.setVec4DataAt(0,this.m_zNear,this.m_zFar,this.m_nearPlaneHalfW,this.m_nearPlaneHalfH),this.ufrustumProbe.update(),this.ucameraPosProbe.setVec4DataAt(0,this.m_camPos.x,this.m_camPos.y,this.m_camPos.z,1),this.ucameraPosProbe.update())}destroy(){}lookRHEnabled(){return this.m_lookRHEnabled}lookLHEnabled(){return!this.m_lookRHEnabled}getVPMatrix(){return this.m_vpMat}getViewMatrix(){return this.m_viewMat}getViewInvMatrix(){return this.m_viewInvertMat}getProjectMatrix(){return this.m_projMat}}e.default=_},c807:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s(i("8e17"));e.Vector3D=a.default;const r=s(i("18c7"));e.Matrix4=r.default;const n=s(i("3930"));e.Color4=n.default;const l=s(i("3b73"));e.RendererDevice=l.default;const h=s(i("29ef"));e.RendererState=h.default;const _=s(i("c497"));e.RendererParam=_.default;const o=s(i("3efb"));e.CoSimpleRendererScene=o.default;const u=s(i("1d40")),m=s(i("402a")),d=s(i("f63e")),c=s(i("131b")),f=i("1b95"),p=i("251a"),g=i("4301");e.MaterialContextParam=g.MaterialContextParam;const x=i("b4ea"),y=i("f3a2");e.ShaderCodeUUID=y.ShaderCodeUUID;const T=i("5216");e.MaterialPipeType=T.MaterialPipeType;const S=s(i("32cc"));function A(t=0,e=0,i=0,s=1){return new a.default(t,e,i,s)}function E(t=null,e=0){return new r.default(t,e)}function b(t=1,e=1,i=1,s=1){return new n.default(t,e,i,s)}function v(t){let e=t;if(null==e.materialBlock){let t=new f.RenderableMaterialBlock;t.initialize(),e.materialBlock=t}if(null==e.entityBlock){let t=new p.RenderableEntityBlock;t.initialize(),e.entityBlock=t}}function D(t=null){return new _.default(t)}e.createVec3=A,e.createMat4=E,e.createColor4=b,e.applySceneBlock=v,e.createRendererSceneParam=D;let M=null;function R(t=null,e=3,i=!0){let s=new o.default;return null!=t&&(s.initialize(t,3),i&&v(s)),M=s,s}function F(t){M=t}function P(){return M}function L(){return new u.default}function B(t=!1){let e=new d.default;return e.normalEnabled=t,e}function N(t){return new c.default(t)}function V(){return new m.default}function C(t,e,i=null){let s=new S.default(!1);s.initializeByCodeBuf(!1);let a=new Float32Array([t.x,0,0,e.x,0,0,0,t.y,0,0,e.y,0,0,0,t.z,0,0,e.z]),r=new Float32Array([1,0,0,1,0,0,0,1,0,0,1,0,0,0,1,0,0,1]),n=new u.default;n.ivsEnabled=!1,n.aabbEnabled=!0,n.reset(),n.setBufSortFormat(s.getBufSortFormat()),n.addFloat32Data(a,3),n.addFloat32Data(r,3),n.initialize(),n.toArraysLines(),n.vtCount=Math.floor(a.length/3);let l=new m.default(i);return l.setMaterial(s),l.setMesh(n),l}function w(t=100,e=null){return t<1e-4&&(t=1e-4),C(new a.default,new a.default(t,t,t),e)}function I(t=100,e=null){return t<1e-4&&(t=1e-4),t*=.5,C(new a.default(-t,-t,-t),new a.default(t,t,t),e)}function O(){return new x.MaterialContext}function U(){return new g.MaterialContextParam}e.createRendererScene=R,e.setRendererScene=F,e.getRendererScene=P,e.createRawMesh=L,e.createDefaultMaterial=B,e.createShaderMaterial=N,e.createDisplayEntity=V,e.createFreeAxis3DEntity=C,e.createAxis3DEntity=w,e.createCrossAxis3DEntity=I,e.createMaterialContext=O,e.creatMaterialContextParam=U},ca2f:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){}downloadBinFile(t,e,i="vrd"){var s,a;s=function(t,e,i){var s,r;s=new Blob([t],{type:i}),r=window.URL.createObjectURL(s),a(r,e),setTimeout((function(){return window.URL.revokeObjectURL(r)}),1e3)},a=function(t,e){var i;i=document.createElement("a"),i.href=t,i.download=e,document.body.appendChild(i),i.style="display: none",i.click(),i.remove()},s(t,e+"."+i,"application/octet-stream")}}e.FileIO=s},ca6c:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{static PushThreeBitValueToInt(t,e){return(t<<3)+e}static PopThreeBitValueFromInt(t){return s.value=7&t,t>>3}static ContainsBit(t,e){return(e&t)>0}static RemoveBit(t,e){return~e&t}static AddBit(t,e){return e|t}static AssembleFromIntArray(t){let e=0,i=t.length;for(let s=0;s<i;++s)t[s]>0&&(e|=1<<s);return e}}s.BIT_ZERO=0,s.BIT_ONE_0=1,s.BIT_ONE_1=2,s.BIT_ONE_2=4,s.BIT_ONE_3=8,s.BIT_ONE_4=16,s.BIT_ONE_5=32,s.BIT_ONE_6=64,s.BIT_ONE_7=128,s.BIT_ONE_8=256,s.BIT_ONE_9=512,s.BIT_ONE_10=1024,s.BIT_ONE_11=2048,s.value=0,e.default=s},cb29:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s(i("8a0a")),r=i("8a0a"),n=s(i("e7d2")),l=i("e08e");class h{constructor(t=a.default.VTX_STATIC_DRAW){this.m_bufDataUsage=0,this.m_bufDataList=null,this.m_bufDataStepList=null,this.m_bufStatusList=null,this.m_bufTypeList=null,this.m_bufSizeList=null,this.m_polyhedral=!0,this.m_layoutBit=0,this.m_transMatrix=null,this.m_vbuf=null,this.m_ivbuf=null,this.m_ivs=null,this.forceUpdateIVS=!1,this.wireframe=!1,this.bounds=null,this.normalType=r.VtxNormalType.GOURAND,this.normalScale=1,this.vtxTotal=0,this.trisNumber=0,this.drawMode=l.RenderDrawMode.ELEMENTS_TRIANGLES,this.vtCount=0,this.vbWholeDataEnabled=!0,this.drawInsBeginIndex=0,this.drawInsStride=0,this.drawInsTotal=0,this.m_attachCount=0,this.m_bufDataUsage=t}isUVSEnabled(){return this.isVBufEnabledAt(a.default.VBUF_UVS_INDEX)}isNVSEnabled(){return this.isVBufEnabledAt(a.default.VBUF_NVS_INDEX)}isCVSEnabled(){return this.isVBufEnabledAt(a.default.VBUF_CVS_INDEX)}toElementsTriangles(){this.drawMode=l.RenderDrawMode.ELEMENTS_TRIANGLES}toElementsTriangleStrip(){this.drawMode=l.RenderDrawMode.ELEMENTS_TRIANGLE_STRIP}toElementsTriangleFan(){this.drawMode=l.RenderDrawMode.ELEMENTS_TRIANGLE_FAN}toElementsInstancedTriangles(){this.drawMode=l.RenderDrawMode.ELEMENTS_INSTANCED_TRIANGLES}toArraysLines(){this.drawMode=l.RenderDrawMode.ARRAYS_LINES,this.setPolyhedral(!1)}toArraysLineStrip(){this.drawMode=l.RenderDrawMode.ARRAYS_LINE_STRIP,this.setPolyhedral(!1)}toArraysPoints(){this.drawMode=l.RenderDrawMode.ARRAYS_POINTS,this.setPolyhedral(!1)}toElementsLines(){this.drawMode=l.RenderDrawMode.ELEMENTS_LINES,this.setPolyhedral(!1)}toDisable(){this.drawMode=l.RenderDrawMode.DISABLE,this.setPolyhedral(!1)}createIVSBYSize(t){return t>65535?new Uint32Array(t):new Uint16Array(t)}createIVSByArray(t){return t.length>65535?new Uint32Array(t):new Uint16Array(t)}createWireframeIvs(t=null){if(null==t&&(t=this.m_ivs),null!==t){let e,i,s,a=2*t.length,r=a<=65536?new Uint16Array(a):new Uint32Array(a),n=0;for(let l=0,h=t.length;l<h;l+=3)e=t[l+0],i=t[l+1],s=t[l+2],r[n]=e,r[n+1]=i,r[n+2]=i,r[n+3]=s,r[n+4]=s,r[n+5]=e,n+=6;return r}return null}updateWireframeIvs(){if(this.toElementsTriangles(),this.wireframe){let t=this.createWireframeIvs();null!=t&&(this.m_ivs=this.createWireframeIvs()),this.toElementsLines()}}buildEnd(){this.m_vbuf.setBufTypeList(this.m_bufTypeList),this.m_vbuf.setBufSizeList(this.m_bufSizeList),this.m_bufDataList=n.default.BufDataList,this.m_bufDataStepList=n.default.BufDataStepList,this.m_bufStatusList=n.default.BufStatusList}setTransformMatrix(t){this.m_transMatrix=t}getTransformMatrix(){return this.m_transMatrix}isPolyhedral(){return this.m_polyhedral}setPolyhedral(t){this.m_polyhedral=t}testRay(t,e,i,s){return-1}rebuild(){if(null==this.m_vbuf&&null!=this.m_bufDataList){n.default.Reset();let t=0,e=this.m_bufDataList.length;for(;t<e;++t)n.default.AddFloat32Data(this.m_bufDataList[t],this.m_bufDataStepList[t],this.m_bufStatusList[t]);this.m_vbuf=n.default.CreateBySaveData(this.getBufDataUsage()),null!=this.m_ivs&&(this.m_vbuf.setUintIVSData(this.m_ivs),this.vtCount=this.m_ivs.length)}}__$attachIVBuf(){return this.m_ivbuf}__$detachIVBuf(t){if(this.m_vbuf!=t)throw Error("Fatal Error!")}__$attachVBuf(){return null==this.m_vbuf&&this.rebuild(),n.default.__$$AttachAt(this.m_vbuf.getUid()),this.m_vbuf}__$detachVBuf(t){if(this.m_vbuf!=t)throw Error("Fatal Error!");n.default.__$$DetachAt(this.m_vbuf.getUid())}isGeomDynamic(){return!0}getBufDataUsage(){return this.m_bufDataUsage}getVS(){return null}getUVS(){return null}getNVS(){return null}getCVS(){return null}getIVS(){return this.m_ivs}setVtxBufRenderData(t){null!=t&&(this.m_bufTypeList=t.getBufTypeList(),this.m_bufSizeList=t.getBufSizeList(),this.setBufSortFormat(t.getBufSortFormat()))}setBufSortFormat(t){this.m_layoutBit=t}getBufSortFormat(){return this.m_layoutBit}setBufTypeList(t){this.m_bufTypeList=t}setBufSizeList(t){this.m_bufSizeList=t}getBufTypeList(){return this.m_bufTypeList}getBufSizeList(){return this.m_bufSizeList}isVBufEnabledAt(t){return(t&this.m_layoutBit)>0}__$attachThis(){++this.m_attachCount}__$detachThis(){1==this.m_attachCount?(--this.m_attachCount,this.__$dispose()):--this.m_attachCount,this.m_attachCount<1&&(this.m_attachCount=0)}getAttachCount(){return this.m_attachCount}__$dispose(){this.getAttachCount()<1&&null!=this.m_vbuf&&(n.default.__$$DetachAt(this.m_vbuf.getUid()),this.m_vbuf=null)}isEnabled(){return null!=this.m_vbuf}isResFree(){return this.getAttachCount()<1&&null==this.m_vbuf}__$destroy(){this.isResFree()&&(this.m_ivs=null,this.m_bufDataList=null,this.m_bufDataStepList=null,this.m_bufStatusList=null,this.trisNumber=0,this.m_transMatrix=null,this.m_bufTypeList=null,this.m_bufSizeList=null)}toString(){return"[MeshBase()]"}}e.default=h},cc48:function(t,e,i){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t["NONE"]=0]="NONE",t[t["CAMERA"]=1]="CAMERA",t[t["POV"]=2]="POV",t[t["INNER_POV_PASS"]=3]="INNER_POV_PASS",t[t["CAMERA_AND_POV"]=4]="CAMERA_AND_POV"}(s||(s={})),e.SpaceCullingMask=s},cc55:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.vert="",this.vert_head="",this.vert_body="",this.frag="",this.frag_head="",this.frag_body="",this.uuid=""}}e.ShaderCodeObject=s},cc7a:function(t,e,i){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t["XYZ"]=0]="XYZ",t[t["YZX"]=1]="YZX",t[t["ZXY"]=2]="ZXY",t[t["XZY"]=3]="XZY",t[t["YXZ"]=4]="YXZ",t[t["ZYX"]=5]="ZYX"}(s||(s={})),e.EulerOrder=s},ccdf:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s(i("8d98")),r=s(i("ffc0")),n=s(i("1f61")),l=s(i("cfaf")),h=s(i("acaa")),_=s(i("85b6")),o=s(i("3b73"));class u{constructor(t){this.m_renderProxy=null,this.m_rttTexs=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.m_rttCubeTexs=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.m_rttFloatTexs=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.m_rttDepthTexs=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.m_renderProxy=t}getRenderProxy(){return this.m_renderProxy}createWrapperTex(t,e,i=!1){let s=new _.default(t,e,i);return s}createRTTTex2D(t,e,i=!1){let s=new l.default(t,e,i);return s}createDepthTex2D(t,e,i=!1){let s=new h.default(t,e,i);return s}getCubeRTTTextureAt(t){return null!=this.m_rttCubeTexs[t]?(this.m_rttCubeTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttCubeTexs[t]):(this.m_rttCubeTexs[t]=this.createRTTTex2D(32,32),this.m_rttCubeTexs[t].toCubeTexture(),this.m_rttCubeTexs[t].name="sys_cube_rttTex_"+t,this.m_rttCubeTexs[t].minFilter=a.default.LINEAR,this.m_rttCubeTexs[t].magFilter=a.default.LINEAR,this.m_rttCubeTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttCubeTexs[t])}createCubeRTTTextureAt(t,e,i){return e=e>1?e:1,i=i>1?i:1,null!=this.m_rttCubeTexs[t]?(this.m_rttCubeTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttCubeTexs[t]):(this.m_rttCubeTexs[t]=this.createRTTTex2D(e,i),this.m_rttCubeTexs[t].toCubeTexture(),this.m_rttCubeTexs[t].name="sys_cube_rttTex_"+t,this.m_rttCubeTexs[t].minFilter=a.default.LINEAR,this.m_rttCubeTexs[t].magFilter=a.default.LINEAR,this.m_rttCubeTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttCubeTexs[t])}getRTTTextureAt(t){return null!=this.m_rttTexs[t]?(this.m_rttTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttTexs[t]):(this.m_rttTexs[t]=this.createRTTTex2D(32,32),this.m_rttTexs[t].to2DTexture(),this.m_rttTexs[t].name="sys_rttTex_"+t,this.m_rttTexs[t].minFilter=a.default.LINEAR,this.m_rttTexs[t].magFilter=a.default.LINEAR,this.m_rttTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttTexs[t])}createRTTTextureAt(t,e,i){return e=e>1?e:1,i=i>1?i:1,null!=this.m_rttTexs[t]?(this.m_rttTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttTexs[t]):(this.m_rttTexs[t]=this.createRTTTex2D(e,i),this.m_rttTexs[t].to2DTexture(),this.m_rttTexs[t].name="sys_rttTex_"+t,this.m_rttTexs[t].minFilter=a.default.LINEAR,this.m_rttTexs[t].magFilter=a.default.LINEAR,this.m_rttTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttTexs[t])}getDepthTextureAt(t){return null!=this.m_rttDepthTexs[t]?(this.m_rttDepthTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttDepthTexs[t]):(this.m_rttDepthTexs[t]=this.createDepthTex2D(64,64),this.m_rttDepthTexs[t].to2DTexture(),this.m_rttDepthTexs[t].name="sys_depthTex_"+t,this.m_rttDepthTexs[t].minFilter=a.default.NEAREST,this.m_rttDepthTexs[t].magFilter=a.default.NEAREST,this.m_rttDepthTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttDepthTexs[t])}createDepthTextureAt(t,e,i){return e=e>1?e:1,i=i>1?i:1,null!=this.m_rttDepthTexs[t]?(this.m_rttDepthTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttDepthTexs[t]):(this.m_rttDepthTexs[t]=this.createDepthTex2D(e,i),this.m_rttDepthTexs[t].to2DTexture(),this.m_rttDepthTexs[t].name="sys_depthTex_"+t,this.m_rttDepthTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttDepthTexs[t])}getRTTFloatTextureAt(t){if(null!=this.m_rttFloatTexs[t])return this.m_rttFloatTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttFloatTexs[t];let e=this.createRTTTex2D(64,64);return e.to2DTexture(),this.m_rttFloatTexs[t]=e,this.m_rttFloatTexs[t].name="sys_rttFloatTex_"+t,e.internalFormat=r.default.RGBA16F,e.srcFormat=r.default.RGBA,e.dataType=n.default.FLOAT,e.minFilter=a.default.NEAREST,e.magFilter=a.default.NEAREST,o.default.IsWebGL1()&&(e.dataType=n.default.HALF_FLOAT_OES),this.m_rttFloatTexs[t].__$setRenderProxy(this.m_renderProxy),e}createRTTFloatTextureAt(t,e,i){if(e=e>1?e:1,i=i>1?i:1,null!=this.m_rttFloatTexs[t])return this.m_rttFloatTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttFloatTexs[t];let s=this.createRTTTex2D(e,i);return s.to2DTexture(),this.m_rttFloatTexs[t]=s,this.m_rttFloatTexs[t].name="sys_rttFloatTex_"+t,s.internalFormat=r.default.RGBA16F,s.srcFormat=r.default.RGBA,s.dataType=n.default.FLOAT,s.minFilter=a.default.NEAREST,s.magFilter=a.default.NEAREST,o.default.IsWebGL1()&&(s.dataType=n.default.HALF_FLOAT_OES),this.m_rttFloatTexs[t].__$setRenderProxy(this.m_renderProxy),s}}e.RTTTextureStore=u},cfaf:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i("7918"),r=s(i("8d98")),n=s(i("ffc0")),l=s(i("5deb")),h=s(i("1f61")),_=s(i("0851"));class o extends _.default{constructor(t,e,i=!1){super(t,e,i),this.m_type=a.TextureProxyType.RTT,this.minFilter=r.default.NEAREST,this.magFilter=r.default.NEAREST}to2DTexture(){this.m_texTarget=l.default.TEXTURE_2D}toCubeTexture(){this.m_texTarget=l.default.TEXTURE_CUBE}setSize(t,e){this.m_texWidth=t,this.m_texHeight=e}enableMipmap(){this.minFilter=r.default.LINEAR_MIPMAP_LINEAR,this.magFilter=r.default.LINEAR,this.mipmapEnabled=!0}disableMipmap(){this.minFilter=r.default.NEAREST,this.magFilter=r.default.NEAREST,this.mipmapEnabled=!1}uploadFromFbo(t,e,i){let s=t.getRC(),a=this.mipmapEnabled;this.mipmapEnabled=!1,t.hasResUid(this.getResUid())?this.getBufWidth()==e&&this.getBufHeight()==i||(t.bindToGpu(this.getResUid()),this.bindTexture(s,e,i),this.m_texWidth=e,this.m_texHeight=i,this.__$buildParam(s)):(this.m_sampler=l.default.GetValue(s,this.m_texTarget),this.createTexBuf(t),t.bindToGpu(this.getResUid()),this.bindTexture(s,e,i),this.m_haveRData=!0,this.m_texWidth=e,this.m_texHeight=i,this.__$buildParam(s)),this.mipmapEnabled=a}bindTexture(t,e,i){let s=n.default.ToGL(t,this.internalFormat),a=n.default.ToGL(t,this.srcFormat),r=h.default.ToGL(t,this.dataType);switch(this.m_texTarget){case l.default.TEXTURE_2D:t.texImage2D(t.TEXTURE_2D,0,s,e,i,0,a,r,null);break;case l.default.TEXTURE_CUBE:for(let n=0;n<6;++n)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,s,e,i,0,a,r,null);break;case l.default.TEXTURE_SHADOW_2D:t.texImage2D(t.TEXTURE_2D,0,t.DEPTH_COMPONENT16,e,i,0,t.DEPTH_COMPONENT,t.FLOAT,null);break;default:break}}toString(){return"[RTTTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=o},d08b:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){}getBufSortFormat(){return 7}getBufTypeList(){return[1,2,3]}getBufSizeList(){return[3,2,3]}}e.VtxBufRenderData=s},d314:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i("7918"),r=s(i("5deb")),n=s(i("ffc0")),l=s(i("1f61")),h=s(i("0851"));class _ extends h.default{constructor(t,e){super(t,e,!1),this.m_imgDataList=null,this.m_texTarget=r.default.TEXTURE_CUBE,this.m_type=a.TextureProxyType.ImageCube,this.internalFormat=n.default.RGBA,this.srcFormat=n.default.RGBA,this.dataType=l.default.UNSIGNED_BYTE,this.mipmapEnabled=!0}setDataFromImageToFaceAt(t,e,i=0){null!=e&&(null==this.m_imgDataList&&(this.m_imgDataList=[null,null,null,null,null,null]),e.width>0&&e.height>0&&(0==t&&(this.m_texWidth=e.width,this.m_texHeight=e.height,this.m_miplevel=i),this.m_imgDataList[t]={imgData:e,miplevel:i},this.m_haveRData=null!=this.m_imgDataList[t]))}uploadData(t){let e=t.getRC(),i=null;for(let s=0;s<6;++s)i=this.m_imgDataList[s],e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+s,this.m_miplevel,n.default.ToGL(e,this.internalFormat),n.default.ToGL(e,this.srcFormat),l.default.ToGL(e,this.dataType),i.imgData)}toString(){return"[ImageCubeTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}__$destroy(){if(this.getAttachCount()<1){if(null!=this.m_imgDataList)for(let t=0;t<6;++t)null!=this.m_imgDataList[t]&&(this.m_imgDataList[t].imgData=null);super.__$destroy()}}}e.default=_},d7e2:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s(i("8e17"));class r{constructor(t){this.m_rc=null,this.m_rc=t}sortRODisplay(t,e){let i=this.m_rc.getCamera().getPosition();for(let s=0;s<e;++s)t[s].value=-a.default.DistanceSquared(t[s].bounds.center,i);return 0}}e.default=r},da6a:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){if(this.m_texResource=null,this.m_bufferUpdater=null,this.m_textureTotal=0,this.m_textureMap=new Map,this.m_freeMap=new Map,this.m_texUid=0,this.m_freeUids=[],null!=s.s_ins)throw Error("This Class is a singleton class!!!");s.s_ins=null}static GetInstance(){return null!=s.s_ins||(s.s_ins=new s),s.s_ins}getFreeUid(){if(this.m_freeUids.length>0)return this.m_freeUids.pop();let t=this.m_texUid++;return t}__$$addTexture(t){null==t||this.m_textureMap.has(t.getUid())||(this.m_textureMap.set(t.getUid(),t),this.m_textureTotal++)}getTextureByUid(t){return this.m_textureMap.get(t)}hasTextureByUid(t){return this.m_textureMap.has(t)}removeTextureByUid(t){if(this.m_textureMap.has(t)){let e=this.m_textureMap.get(t);if(e.getAttachCount()<1)return this.m_freeMap.has(t)&&this.m_freeMap.delete(t),e.__$destroy(),e.__$$removeFromSlot(),this.m_textureMap.delete(t),this.m_freeUids.push(t),this.m_textureTotal--,e}return null}getTextureTotal(){return this.m_textureTotal}setRenderProxy(t){this.m_texResource=t.Texture}setBufferUpdater(t){this.m_bufferUpdater=t}getFreeResUidMap(){return this.m_freeMap}isGpuEnabledByResUid(t){return this.m_texResource.hasResUid(t)}addRenderBuffer(t,e){null!=this.m_bufferUpdater&&this.m_bufferUpdater.__$addBuf(t,e)}addFreeUid(t){this.m_freeMap.set(t,0)}removeFreeUid(t){this.m_freeMap.has(t)&&this.m_freeMap.delete(t)}}s.s_ins=null,e.default=s},dc2b:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i("e08e"),r=s(i("29ef"));class n{constructor(){this.m_uid=0,this.m_partGroup=null,this.m_trans=null,this.m_material=null,this.m_matFS32=null,this.name="RODisplay",this.visible=!0,this.ivsIndex=0,this.ivsCount=0,this.trisNumber=0,this.insCount=0,this.drawMode=a.RenderDrawMode.ELEMENTS_TRIANGLES,this.vbuf=null,this.ivbuf=null,this.renderState=r.default.NORMAL_STATE,this.rcolorMask=r.default.COLOR_MASK_ALL_TRUE,this.mouseEnabled=!1,this.__$ruid=-1,this.__$rpuid=-1,this.__$$rsign=a.DisplayRenderSign.NOT_IN_RENDERER,this.__$$runit=null,this.m_uid=n.s_uid++}getVtxResUid(){let t=131+this.vbuf.getUid();return null==this.ivbuf?t:131*t+this.ivbuf.getUid()}getVtxResVer(){let t=131+this.vbuf.version;return null==this.ivbuf?t:131*t+this.ivbuf.version}getPartGroup(){return this.m_partGroup}createPartGroup(t){t<1&&(t=1),this.m_partGroup=new Uint16Array(2*t)}setDrawPartAt(t,e,i){t*=2,this.m_partGroup[t]=i,this.m_partGroup[++t]=e}getUid(){return this.m_uid}setTransform(t){this.m_trans=t,this.m_matFS32=t.getLocalFS32()}getTransform(){return this.m_trans}getMatrixFS32(){return this.m_matFS32}enableDrawInstanced(t,e){this.drawMode=a.RenderDrawMode.ELEMENTS_INSTANCED_TRIANGLES,this.ivsIndex=t,this.insCount=e}disableDrawInstanced(){this.drawMode=a.RenderDrawMode.ELEMENTS_TRIANGLES}getMaterial(){return this.m_material}setMaterial(t){null!=this.m_material&&this.m_material!=t&&(this.m_material.__$detachThis(),null!=t&&t.__$attachThis()),this.m_material=t}copyFrom(t){this.vbuf=t.vbuf,this.ivsIndex=t.ivsIndex,this.ivsCount=t.ivsCount,this.setMaterial(t.getMaterial())}toString(){return"RODisplay(name="+this.name+",uid="+this.getUid()+", __$ruid="+this.__$ruid+")"}destroy(){null!=this.m_material&&(this.m_material.__$detachThis(),this.m_material.destroy(),this.m_material=null),this.m_matFS32=null,this.vbuf=null,this.__$ruid=-1,this.__$rpuid=-1,this.__$$rsign=a.DisplayRenderSign.NOT_IN_RENDERER,this.ivsIndex=0,this.ivsCount=0,this.m_partGroup=null,this.__$$runit=null}static GetFreeId(){return n.m_freeIdList.length>0?n.m_freeIdList.pop():-1}static GetByUid(t){return n.m_unitList[t]}static IsEnabledByUid(t){return n.m_unitFlagList[t]==n.s_FLAG_BUSY}static Create(){let t=null,e=n.GetFreeId();return e>=0?(t=n.m_unitList[e],n.m_unitFlagList[e]=n.s_FLAG_BUSY):(t=new n,n.m_unitList.push(t),n.m_unitFlagList.push(n.s_FLAG_BUSY),n.m_unitListLen++),t}static Restore(t){if(null!=t&&n.m_unitFlagList[t.getUid()]==n.s_FLAG_BUSY){let e=t.getUid();n.m_freeIdList.push(e),n.m_unitFlagList[e]=n.s_FLAG_FREE,t.destroy()}}}n.s_uid=0,n.s_FLAG_BUSY=1,n.s_FLAG_FREE=0,n.m_unitFlagList=[],n.m_unitListLen=0,n.m_unitList=[],n.m_freeIdList=[],e.default=n},df25:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s(i("8d98")),r=s(i("ffc0")),n=s(i("1f61")),l=s(i("68aa")),h=s(i("0851"));class _ extends h.default{constructor(t,e,i=!1){super(t,e,i),this.m_bytes=null,this.m_subDataList=null,this.m_texDatasLen=0,this.m_texData=null,this.m_texDatas=null,this.minFilter=a.default.LINEAR}setDataFromBytes(t,e=0,i=-1,s=-1,a=0,r=0,n=!1){if(null!=t&&i>0&&s>0){e<0&&(e=0),e>15&&(e=15),e>=this.m_texDatasLen&&(this.m_texDatasLen=e+1),this.m_haveRData=!0;let h=this.m_texData;null!=h?this.m_texData.miplevel!=e&&(null==this.m_texDatas&&(this.m_texDatas=[this.m_texData,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]),h=this.m_texDatas[e],null==h&&(h=l.default.Create(),h.miplevel=e,n=!0,this.m_texDatas[e]=h)):(this.m_texData=h=l.default.Create(),h.miplevel=e,n=!0),h.data==t&&h.offsetx==a&&h.offsety==r||(0==e&&(this.m_texWidth=i,this.m_texHeight=s,this.m_bytes=t),h.data=t,h.status=0,(h.width<i||h.height<s||n)&&(h.width=i,h.height=s,h.status=1),h.offsetx=a,h.offsety=r),this.version++}}uploadData(t){null!=this.m_texData&&this.dataUploadToGpu(t.getRC(),this.m_texData,this.m_texDatas,!0)}__$updateToGpu(t){if(this.version>0&&t.hasResUid(this.getResUid())){let e=t.getRC(),i=null!=this.m_subDataList?this.m_subDataList.length:0;if(this.__$updateToGpuBegin(t),i>0){let t=0,s=null,a=r.default.ToGL(e,this.internalFormat),h=r.default.ToGL(e,this.srcFormat),_=n.default.ToGL(e,this.dataType);for(;t<i;++t)s=this.m_subDataList.pop(),s.updateToGpu(e,this.m_sampler,a,h,_,!1),l.default.Restore(s)}null!=this.m_texData&&(this.dataUploadToGpu(e,this.m_texData,this.m_texDatas),this.__$buildParam(e),this.m_generateMipmap=!0),this.__$updateToGpuEnd(e)}}setPartDataFromeBytes(t,e,i,s,a,r=0){null==this.m_subDataList&&(this.m_subDataList=[]);let n=l.default.Create();n.data=t,n.status=0,n.miplevel=r,n.offsetx=e,n.offsety=i,n.width=s,n.height=a,this.m_subDataList.push(n),this.version++}getPixels(t,e,i,s,a){if(null!=this.m_bytes&&null!=a){let n=this.unpackAlignment,l=i*s*n;if(a.length==l){let h=e,_=t,o=h+s,u=_+i,m=0;switch(this.srcFormat){case r.default.ALPHA:for(;h<o;++h)for(_=t;_<u;++_)l=h*this.m_texWidth+_,a[m]=this.m_bytes[l],m++;break;case r.default.RGBA:for(;h<o;++h)for(_=t;_<u;++_)l=(h*this.m_texWidth+_)*n,a[m]=this.m_bytes[l],a[m+1]=this.m_bytes[l+1],a[m+2]=this.m_bytes[l+2],a[m+3]=this.m_bytes[l+3],m++;break;case r.default.RGB:for(;h<o;++h)for(_=t;_<u;++_)l=(h*this.m_texWidth+_)*n,a[m]=this.m_bytes[l],a[m+1]=this.m_bytes[l+1],a[m+2]=this.m_bytes[l+2],m++;break;default:break}}}}__$destroy(){if(this.getAttachCount()<1){if(this.version=0,null!=this.m_texDatas){for(let t=0;t<this.m_texDatasLen;++t)l.default.Restore(this.m_texDatas[t]);this.m_texDatasLen=0,this.m_texDatas=null,this.m_texData=null}null!=this.m_texData&&(l.default.Restore(this.m_texData),this.m_texData=null),this.m_bytes=null,super.__$destroy()}}toString(){return"[RawDataTextureProxy(width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=_},e08e:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{}s.ELEMENTS_TRIANGLES=1,s.ELEMENTS_TRIANGLE_STRIP=2,s.ELEMENTS_TRIANGLE_FAN=3,s.ELEMENTS_INSTANCED_TRIANGLES=4,s.ARRAYS_LINES=5,s.ARRAYS_LINE_STRIP=6,s.ARRAYS_POINTS=7,s.ELEMENTS_LINES=8,s.DISABLE=0,e.RenderDrawMode=s;class a{}a.NORMAL=1,a.OPAQUE=1,a.TRANSPARENT=2,a.ALPHA_ADD=3,a.ADD=4,a.ADD_LINEAR=5,a.INVERSE_ALPHA=6,a.BLAZE=7,a.OVERLAY=8,a.OVERLAY2=8,a.DISABLE=0,e.RenderBlendMode=a;class r{}r.NEVER=1,r.LESS=1,r.EQUAL=1,r.GREATER=1,r.NOTEQUAL=1,r.GEQUAL=1,r.ALWAYS=1,e.GLStencilFunc=r;class n{}n.KEEP=1,n.ZERO=1,n.REPLACE=1,n.INCR=1,n.INCR_WRAP=1,n.DECR=1,n.DECR_WRAP=1,n.INVERT=1,e.GLStencilOp=n;class l{}l.ZERO=1,l.ONE=1,l.SRC_COLOR=1,l.DST_COLOR=1,l.SRC_ALPHA=1,l.DST_ALPHA=1,l.ONE_MINUS_SRC_ALPHA=1,e.GLBlendMode=l;class h{}h.FUNC_ADD=1,h.FUNC_SUBTRACT=1,h.FUNC_REVERSE_SUBTRACT=1,h.MIN_EXT=1,h.MAX_EXT=1,h.MIN=1,h.MAX=1,e.GLBlendEquation=h;class _{}_.BACK=1,_.FRONT=2,_.FRONT_AND_BACK=3,_.NONE=0,_.DISABLE=0,e.CullFaceMode=_;class o{}o.NEVER=1,o.ALWAYS=2,o.SKY=3,o.TRUE_LESS_EQUAL=3,o.OPAQUE=4,o.TRUE_LESS=4,o.OPAQUE_OVERHEAD=5,o.FALSE_EQUAL=5,o.FALSE_LESS=6,o.BLEND=6,o.BLEND_SORT=6,o.TRANSPARENT_SORT=6,o.TRUE_LEQUAL=7,o.WIRE_FRAME=7,o.FALSE_LEQUAL=8,o.DECALS=8,o.NEXT_LAYER=11,o.WIRE_FRAME_NEXT=12,o.TRUE_EQUAL=13,o.TRUE_GREATER=14,o.TRUE_GEQUAL=15,o.DISABLE=0,e.DepthTestMode=o,function(t){t[t["NOT_IN_RENDERER"]=-1]="NOT_IN_RENDERER",t[t["GO_TO_RENDERER"]=1]="GO_TO_RENDERER",t[t["LIVE_IN_RENDERER"]=2]="LIVE_IN_RENDERER"}(e.DisplayRenderSign||(e.DisplayRenderSign={}))},e214:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s(i("6e01")),r=s(i("8e17")),n=s(i("f48d"));class l extends n.default{constructor(){super(...arguments),this.nv=new r.default(0,1,0),this.distance=0,this.intersectBoo=!1}intersectStraightLinePos(t,e){let i=this.nv.dot(t.tv);if(i>a.default.MATH_MIN_POSITIVE||i<a.default.MATH_MAX_NEGATIVE){let s=this.nv.dot(t.position)-this.distance;return e.x=1e5*t.tv.x+t.position.x,e.y=1e5*t.tv.y+t.position.y,e.z=1e5*t.tv.z+t.position.z,i=this.nv.dot(e)-this.distance,i=s/(s-i),e.subtractBy(t.position),e.scaleBy(i),e.addBy(t.position),1}return i=this.nv.dot(t.position)-this.distance,i<=a.default.MATH_MIN_POSITIVE||i>=a.default.MATH_MAX_NEGATIVE?(e.copyFrom(t.position),2):0}intersectStraightLinePos2(t,e,i){let s=this.nv.dot(e);if(s>a.default.MATH_MIN_POSITIVE||s<a.default.MATH_MAX_NEGATIVE){let a=this.nv.dot(t)-this.distance;return i.x=1e5*e.x+t.x,i.y=1e5*e.y+t.y,i.z=1e5*e.z+t.z,s=this.nv.dot(i)-this.distance,s=a/(a-s),i.subtractBy(t),i.scaleBy(s),i.addBy(t),1}return s=this.nv.dot(t)-this.distance,s<=a.default.MATH_MIN_POSITIVE||s>=a.default.MATH_MAX_NEGATIVE?(i.copyFrom(t),2):0}intersectRadialLinePos(t,e){let i=this.nv.dot(t.position)-this.distance;if(i>a.default.MATH_MIN_POSITIVE){let i=this.nv.dot(t.tv);if(i<0)return this.intersectStraightLinePos2(t.position,t.tv,e)}else{if(!(i<a.default.MATH_MAX_NEGATIVE)){let i=this.nv.dot(t.tv);return i>a.default.MATH_MIN_POSITIVE||i<a.default.MATH_MAX_NEGATIVE?(e.copyFrom(t.position),1):(e.copyFrom(t.position),2)}{let i=this.nv.dot(t.tv);if(i>0)return this.intersectStraightLinePos2(t.position,t.tv,e)}}return-1}intersectRadialLinePos2(t,e,i){let s=this.nv.dot(t)-this.distance;if(s>a.default.MATH_MIN_POSITIVE){let s=this.nv.dot(e);if(s<0)return this.intersectStraightLinePos2(t,e,i)}else{if(!(s<a.default.MATH_MAX_NEGATIVE)){let s=this.nv.dot(e);return s>a.default.MATH_MIN_POSITIVE||s<a.default.MATH_MAX_NEGATIVE?(i.copyFrom(t),1):(i.copyFrom(t),2)}{let s=this.nv.dot(e);if(s>0)return this.intersectStraightLinePos2(t,e,i)}}return-1}containsPoint(t){let e=this.nv.dot(t)-this.distance;return e>a.default.MATH_MIN_POSITIVE?1:e<a.default.MATH_MAX_NEGATIVE?-1:0}intersectSphere(t,e){this.intersectBoo=!1;let i=this.nv.dot(t)-this.distance;return i>a.default.MATH_MIN_POSITIVE?(this.intersectBoo=i<=e,1):i<a.default.MATH_MAX_NEGATIVE?(this.intersectBoo=-i<=e,-1):0}intersectAABB(t,e){this.intersectBoo=!1;let i=n.default.__tV0;i.setXYZ(e.x,t.y,e.z);let s=this.containsPoint(i);return i.setXYZ(e.x,t.y,t.z),s+=this.containsPoint(i),i.setXYZ(t.x,t.y,t.z),s+=this.containsPoint(i),i.setXYZ(t.x,t.y,e.z),s+=this.containsPoint(i),i.setXYZ(e.x,e.y,e.z),s+=this.containsPoint(i),i.setXYZ(e.x,e.y,t.z),s+=this.containsPoint(i),i.setXYZ(t.x,e.y,t.z),s+=this.containsPoint(i),i.setXYZ(t.x,e.y,e.z),s+=this.containsPoint(i),this.intersectBoo=s<8,s<-7?-1:s>7?1:0}intersectSphNegSpace(t,e){this.intersectBoo=Math.abs(this.nv.dot(t)-this.distance)<e}update(){this.nv.normalize()}updateFast(){this.nv.normalize()}static PlaneIntersectSphere(t,e,i,s){l.IntersectBoo=!1,l.IntersectSatus=0,e=t.dot(i)-e,e>a.default.MATH_MIN_POSITIVE?(l.IntersectBoo=e<=s,l.IntersectSatus=1):e<a.default.MATH_MAX_NEGATIVE&&(l.IntersectBoo=-e<=s,l.IntersectSatus=-1)}static CalcPVCloseV(t,e,i){let s=t.distance-e.dot(t.nv);i.setTo(s*t.nv.x,s*t.nv.y,s*t.nv.z),i.addBy(e)}static CalcPVCloseV2(t,e,i,s){let a=e-i.dot(t);s.setTo(a*t.x,a*t.y,a*t.z),s.addBy(i)}static IntersectionSLV2(t,e,i,s,r){let n=t.dot(s);if(n>a.default.MATH_MIN_POSITIVE||n<a.default.MATH_MAX_NEGATIVE){let a=t.dot(i)-e;return r.x=1e5*s.x+i.x,r.y=1e5*s.y+i.y,r.z=1e5*s.z+i.z,n=t.dot(r)-e,n=a/(a-n),r.subtractBy(i),r.scaleBy(n),r.addBy(i),1}return n=t.dot(i)-e,n<=a.default.MATH_MIN_POSITIVE||n>=a.default.MATH_MAX_NEGATIVE?(r.copyFrom(i),2):0}toString(){return"Plane(position="+this.position.toString()+", nv="+this.nv.toString()+")"}}l.IntersectBoo=!1,l.IntersectSatus=0,e.default=l},e7d2:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s(i("8a0a")),r=s(i("710f")),n=s(i("f0f0")),l=s(i("7a04")),h=s(i("febe"));class _ extends h.default{constructor(t=a.default.VTX_STATIC_DRAW){super(t),this.m_vtxBuf=null,this.m_bufTypeList=null,this.m_bufSizeList=null}setVtxBuf(t){t!=this&&(this.m_vtxBuf=t,null!=t&&(t.layoutBit=this.layoutBit))}setBufDataUsage(t){this.m_bufDataUsage=t}getUid(){return this.m_uid}getType(){return this.m_vtxBuf.getType()}setBufTypeList(t){this.m_bufTypeList=t}setBufSizeList(t){this.m_bufSizeList=t}getBufTypeList(){return this.m_bufTypeList}getBufSizeList(){return this.m_bufSizeList}getIBufStep(){return this.m_ibufStep}getBufDataUsage(){return this.m_bufDataUsage}getBuffersTotal(){return this.m_vtxBuf.getBuffersTotal()}getAttribsTotal(){return this.m_vtxBuf.getAttribsTotal()}getF32DataAt(t){return this.m_vtxBuf.getF32DataAt(t)}getIvsData(){return this.m_ivs}setF32DataAt(t,e,i,s){this.m_vtxBuf.setF32DataAt(t,e,i,s),this.vertexVer++}setUintIVSData(t,e=a.default.VTX_STATIC_DRAW){if(t instanceof Uint16Array){if(this.m_ibufStep=2,t.length>65535)throw Error("its type is not Uint32Array.")}else{if(!(t instanceof Uint32Array))return;this.m_ibufStep=4}this.m_ivs=t,null!=t&&this.indicesVer++}setData4fAt(t,e,i,s,a,r){null!=this.m_vtxBuf&&(this.m_vtxBuf.setData4fAt(t,e,i,s,a,r),this.vertexVer++)}setData3fAt(t,e,i,s,a){null!=this.m_vtxBuf&&(this.m_vtxBuf.setData3fAt(t,e,i,s,a),this.vertexVer++)}setData2fAt(t,e,i,s){null!=this.m_vtxBuf&&(this.m_vtxBuf.setData2fAt(t,e,i,s),this.vertexVer++)}destroy(){super.destroy()}__$destroy(){this.m_vtxBuf.destroy(),this.m_vtxBuf.getType()<1?_.s_combinedBufs.push(this.m_vtxBuf):_.s_separatedBufs.push(this.m_vtxBuf),this.m_vtxBuf=null,this.m_ivs=null,this.bufData=null,this.m_bufTypeList=null,this.m_bufSizeList=null}static GetFreeId(){return _.s_freeIdList.length>0?_.s_freeIdList.pop():-1}static GetVtxByUid(t){return _.s_unitList[t]}static Create(t=a.default.VTX_STATIC_DRAW){let e=null,i=_.GetFreeId();return i>=0?(e=_.s_unitList[i],e.setBufDataUsage(t),_.s_unitFlagList[i]=_.s_FLAG_BUSY):(e=new _(t),_.s_unitList.push(e),_.s_unitFlagList.push(_.s_FLAG_BUSY),_.s_unitListLen++),e.vertexVer=0,e.indicesVer=0,e.version++,_.s_vtxStore.__$attachAt(e.getUid()),e}static __$Restore(t){if(null!=t&&_.s_unitFlagList[t.getUid()]==_.s_FLAG_BUSY){let e=t.getUid();_.s_freeIdList.push(e),_.s_unitFlagList[e]=_.s_FLAG_FREE,t.__$destroy()}}static __$$AttachAt(t){_.s_vtxStore.__$attachAt(t)}static __$$DetachAt(t){_.s_vtxStore.__$detachAt(t)}static Reset(){_.BufDataList=[],_.s_stride=0,_.BufStatusList=[],_.BufDataStepList=[],_.vtxFS32=null,_.vbWholeDataEnabled=!1,_.dynBufSegEnabled=!1,_.useBufByIndexEnabled=!1}static AddFloat32Data(t,e,i=a.default.VTX_STATIC_DRAW){_.BufDataList.push(t),_.BufDataStepList.push(e),_.BufStatusList.push(i),_.s_stride+=e}static CreateBySaveData(t=a.default.VTX_STATIC_DRAW,e=0){let i=0,s=0,r=0,l=_.BufDataStepList.length,h=[];for(;i<l;i++)h.push(r),r+=_.BufDataStepList[i];let o=_.BufDataList[0].length/_.BufDataStepList[0],u=new Float32Array(r*o),m=0,d=0,c=null,f=null;for(i=0;i<o;++i)for(s=i*r,m=0;m<l;++m)d=_.BufDataStepList[m],c=_.BufDataList[m],f=c.subarray(i*d,(i+1)*d),u.set(f,s),s+=d;let p=_.Create(t);if(p.layoutBit=e,_.s_combinedBufs.length>0){let t=_.s_combinedBufs.pop();p.setVtxBuf(t)}else p.setVtxBuf(new n.default(p.getBufDataUsage()));return p.setF32DataAt(0,u,r,h),p}static CreateVtxCombinedBuf(t,e,i=a.default.VTX_STATIC_DRAW,s=0){let r=0,l=0,h=e.length,o=[];for(;r<h;r++)o.push(l),l+=e[r];let u=_.Create(i);if(u.layoutBit=s,_.s_combinedBufs.length>0){let t=_.s_combinedBufs.pop();u.setVtxBuf(t)}else u.setVtxBuf(new n.default(u.getBufDataUsage()));return u.setF32DataAt(0,t,l,o),u}static UpdateCombinedBufData(t){let e=0,i=0,s=0,a=_.BufDataStepList.length,r=_.BufDataList[0].length/_.BufDataStepList[0],n=t.getF32DataAt(0),l=_.s_stride*r!=n.length,h=null;if(l)for(h=[],n=new Float32Array(_.s_stride*r);e<a;e++)h.push(s),s+=_.BufDataStepList[e];else s=_.s_stride;let o=0,u=0,m=null,d=null;for(e=0;e<r;++e)for(i=e*s,o=0;o<a;++o)u=_.BufDataStepList[o],m=_.BufDataList[o],d=m.subarray(e*u,(e+1)*u),n.set(d,i),i+=u;l?t.setF32DataAt(0,n,s,h):t.setF32DataAt(0,n,s,null)}static UpdateBufData(t){0==t.getType()?_.UpdateCombinedBufData(t):_.UpdateSeparatedBufData(t)}static CreateByBufDataSeparate(t,e=a.default.VTX_STATIC_DRAW,i=0){let s=0,r=0,n=t.getAttributesTotal(),h=new Array(n);h.fill(0);let o=_.Create(e);if(o.layoutBit=i,_.s_separatedBufs.length>0){let t=_.s_separatedBufs.pop();o.setVtxBuf(t)}else o.setVtxBuf(new l.default);for(s=0;s<n;s++)o.setF32DataAt(s,t.getAttributeDataAt(s,0),r,h);return o.setUintIVSData(t.getIndexDataAt(0)),o.bufData=t,o}static CreateBySaveDataSeparate(t=a.default.VTX_STATIC_DRAW){let e=0,i=0,s=_.BufDataStepList.length,r=new Array(s),n=_.Create(t);if(_.s_separatedBufs.length>0){let t=_.s_separatedBufs.pop();n.setVtxBuf(t)}else n.setVtxBuf(new l.default);for(e=0;e<s;e++)n.setF32DataAt(e,_.BufDataList[e],i,r);return n}static UpdateSeparatedBufData(t){let e=_.BufDataStepList.length,i=new Array(e);for(let s=0;s<e;s++)t.setF32DataAt(s,_.BufDataList[s],0,i);return t}static GetVtxAttachCountAt(t){return _.s_vtxStore.getAttachCountAt(t)}static GetVtxAttachAllCount(){return _.s_vtxStore.getAttachAllCount()}static ClearTest(){if(--_.s_timeDelay,_.s_timeDelay<1){_.s_timeDelay=128;let t=_.s_vtxStore;if(t.__$getRemovedListLen()>0){let e=t.__$getRemovedList(),i=e.length,s=0,a=0,r=null,n=32;for(i=i>n?n:i;s<i;++s)a=e.shift(),t.getAttachCountAt(a)<1&&(r=_.GetVtxByUid(a),_.__$Restore(r))}}}}_.s_combinedBufs=[],_.s_separatedBufs=[],_.s_FLAG_BUSY=1,_.s_FLAG_FREE=0,_.s_unitFlagList=[],_.s_unitListLen=0,_.s_unitList=[],_.s_freeIdList=[],_.s_vtxStore=new r.default,_.s_stride=0,_.BufDataList=null,_.BufDataStepList=null,_.BufStatusList=null,_.vtxDataFS32=null,_.vbWholeDataEnabled=!1,_.dynBufSegEnabled=!1,_.useBufByIndexEnabled=!1,_.vtxFS32=null,_.s_timeDelay=128,e.default=_},eaee:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i("7918"),r=s(i("8d98")),n=s(i("ffc0")),l=s(i("1f61")),h=s(i("5deb")),_=s(i("0851"));class o extends _.default{constructor(t,e){super(t,e,!1),this.m_imgDataList=null,this.m_texTarget=h.default.TEXTURE_CUBE,this.m_type=a.TextureProxyType.FloatCube,this.internalFormat=n.default.RGBA16F,this.dataType=l.default.FLOAT,this.mipmapEnabled=!0}toAlphaFormat(){this.srcFormat=n.default.ALPHA,this.internalFormat=n.default.ALPHA,this.unpackAlignment=1}toRedFormat(){this.srcFormat=n.default.RED,this.internalFormat=n.default.RED,this.unpackAlignment=1}toRGBFormat(){this.unpackAlignment=1,this.srcFormat=n.default.RGB,this.internalFormat=n.default.RGB16F,this.minFilter=r.default.NEAREST,this.magFilter=r.default.NEAREST,this.mipmapEnabled=!1}toRGBAFormat(){this.unpackAlignment=4,this.srcFormat=n.default.RGBA,this.internalFormat=n.default.RGBA16F}toRGBFormatFloat32F(){this.unpackAlignment=1,this.srcFormat=n.default.RGB,this.internalFormat=n.default.RGB32F,this.minFilter=r.default.NEAREST,this.magFilter=r.default.NEAREST,this.mipmapEnabled=!1}toRGBAFormatFloat32F(){this.unpackAlignment=4,this.srcFormat=n.default.RGBA,this.internalFormat=n.default.RGBA32F}toRGBAFormatHalfFloat(){this.unpackAlignment=1,this.srcFormat=n.default.RGBA,this.dataType=l.default.HALF_FLOAT,this.internalFormat=n.default.RGBA16F}setDataFromBytesToFaceAt(t,e,i,s,a=0){if(null==this.m_imgDataList&&(this.m_imgDataList=[null,null,null,null,null,null]),i>0&&s>0){0==t&&a<1&&(this.m_texWidth=i,this.m_texHeight=s,this.m_miplevel=a),null==this.m_imgDataList[t]&&(this.m_imgDataList[t]=new Array(16));let r=this.m_imgDataList[t];r[a]={width:i,height:s,imgData:e,miplevel:a},this.m_haveRData=null!=r[a].imgData}}uploadData(t){let e,i,s=t.getRC(),a=null,r=this.getWidth(),h=this.getHeight();for(let _=0;_<6;++_){let t=this.m_imgDataList[_];if(this.mipmapEnabled&&this.m_generateMipmap)a=t[0],s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+_,0,n.default.ToGL(s,this.internalFormat),r,h,0,n.default.ToGL(s,this.srcFormat),l.default.ToGL(s,this.dataType),a.imgData);else{e=r,i=h;let o=0;for(;e>0||i>0;)null!=t[o]&&(a=t[o],s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+_,o,n.default.ToGL(s,this.internalFormat),e,i,0,n.default.ToGL(s,this.srcFormat),l.default.ToGL(s,this.dataType),a.imgData)),e>0&&(e>>=1),i>0&&(i>>=1),++o}}this.version=0}toString(){return"[FloatCubeTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}__$destroy(){if(this.getAttachCount()<1){if(null!=this.m_imgDataList)for(let t=0;t<6;++t)null!=this.m_imgDataList[t]&&(this.m_imgDataList[t].imgData=null);super.__$destroy()}}}e.default=o},ee6e:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s(i("0fc4")),r=s(i("faa5"));class n extends r.default{constructor(){super(),this.m_uniqueName="",this.decorator=null,this.vertUniform=null}initialize(t){super.initialize(t),this.m_uniqueName="SMS_",t&&(this.m_uniqueName+="Tex")}createTextureList(){return this.m_texBuilder.reset(),this.decorator.buildTextureList(this.m_texBuilder),this.m_texBuilder.getTextures()}buildShader(){null!=this.vertUniform&&this.vertUniform.use(this.m_coder),this.decorator.buildShader(this.m_coder)}getUniqueShaderName(){let t=this.m_uniqueName+this.decorator.getUniqueName();return null!=this.vertUniform&&(t+=this.vertUniform.getUniqueNSKeyString()),t}}class l extends a.default{constructor(){super(),this.m_decorator=null,this.vertUniform=null,null==l.s_shdBufins&&(l.s_shdBufins=new n)}buildBuf(){let t=l.s_shdBufins,e=this.m_decorator;t.decorator=e,e.buildBufParams(),t.vertColorEnabled=e.vertColorEnabled,t.shadowReceiveEnabled=e.premultiplyAlpha,t.fogEnabled=e.fogEnabled,t.buildPipelineParams(),t.vertUniform=this.vertUniform;let i=t.createTextureList();null!=this.vertUniform&&this.vertUniform.getTextures(t.getShaderCodeBuilder(),i),t.getTexturesFromPipeline(i),super.setTextureList(i)}getCodeBuf(){return l.s_shdBufins}setTextureList(t){}setDecorator(t){this.m_decorator=t}getDecorator(){return this.m_decorator}createSelfUniformData(){let t=this.m_decorator.createUniformData();return null!=this.vertUniform&&null!=t&&this.vertUniform.buildShaderUniformData(t),t}destroy(){super.destroy(),this.m_decorator=null,this.vertUniform=null}}l.s_shdBufins=null,e.SimpleMaterial=l},f044:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{static CreateNewID(){return s.s_uid++}}s.s_uid=0,e.default=s},f0f0:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s(i("f044"));class r{constructor(t){this.m_uid=-1,this.m_total=0,this.layoutBit=0,this.m_offsetList=null,this.m_f32=null,this.m_f32Stride=0,this.m_uid=a.default.CreateNewID()}getUid(){return this.m_uid}getType(){return 0}getBuffersTotal(){return 1}getAttribsTotal(){return this.m_offsetList.length}getF32DataAt(t){return this.m_f32}setF32DataAt(t,e,i,s){null!=s&&(this.m_offsetList=s),this.m_f32Stride=i,this.m_f32=e}setData4fAt(t,e,i,s,a,r){t=this.m_f32Stride*t+this.m_offsetList[e],this.m_f32[t++]=i,this.m_f32[t++]=s,this.m_f32[t++]=a,this.m_f32[t++]=r}setData3fAt(t,e,i,s,a){t=this.m_f32Stride*t+this.m_offsetList[e],this.m_f32[t++]=i,this.m_f32[t++]=s,this.m_f32[t++]=a}setData2fAt(t,e,i,s){t=this.m_f32Stride*t+this.m_offsetList[e],this.m_f32[t++]=i,this.m_f32[t++]=s}destroy(){this.m_offsetList=null,this.m_f32=null}toString(){return"VtxCombinedBuf(uid = "+this.m_uid+")"}}e.default=r},f208:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.info=""}}e.default=s},f3a2:function(t,e,i){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t["None"]="",t["Default"]="pbr",t["Lambert"]="lambert",t["PBR"]="pbr"}(s||(s={})),e.ShaderCodeUUID=s},f48d:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s(i("8e17"));class r{constructor(){this.id=-1,this.position=new a.default}update(){}updateFast(){}}r.__tV0=new a.default,r.__tV1=new a.default,r.__tV2=new a.default,e.AbsGeomBase=r,e.default=r},f63b:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s(i("6e01")),r=s(i("8d98")),n=s(i("3b73"));function l(t,e,i){var s=document.createElement("canvas");s.width=e,s.height=i,s.style.backgroundColor="transparent",s.style.display="block",s.style.left="0px",s.style.top="0px",s.style.position="absolute";let a=s.getContext("2d");return a.drawImage(t,0,0,t.width,t.height,0,0,s.width,s.height),{canvas:s,ctx2d:a}}function h(t,e,i){var s=document.createElement("canvas");s.width=e,s.height=i,s.style.backgroundColor="transparent",s.style.display="block",s.style.left="0px",s.style.top="0px",s.style.position="absolute";let a=s.getContext("2d");return a.globalCompositeOperation="destination-atop",a.fillStyle="rgba(255, 255, 255, 1.0)",a.rect(0,0,s.width,s.height),a.fill(),a.drawImage(t,0,0,t.width,t.height,0,0,s.width,s.height),{canvas:s,ctx2d:a}}class _{constructor(t,e){this.m_url="",this.m_img=null,this.m_loaded=!1,this.m_mipLv=0,this.texture=null,this.bytesTex=null,this.powerOf2Fix=!1,this.offsetTex=null,this.premultipliedAlpha=!0,this.m_url=t,this.m_mipLv=e}startLoad(){if(null==this.m_img){this.m_img=new Image,this.m_img.onload=t=>{this.m_loaded=!0,this.buildTex()},this.m_img.addEventListener("error",t=>{this.m_url});const t=new XMLHttpRequest;t.open("GET",this.m_url,!0),t.responseType="blob",t.onload=e=>{let i=window;var s=(i.URL||i.webkitURL).createObjectURL(t.response);this.m_img.src=s},t.onerror=t=>{},t.send(null)}}buildTex(){let t=this.m_img;if(null!=t&&this.m_loaded){let e=this.texture,i=this.offsetTex,s=this.bytesTex,r=null,_=a.default.IsPowerOf2(t.width)&&a.default.IsPowerOf2(t.height),o=this.powerOf2Fix;if(n.default.IsWebGL1()&&(o=!0),!_&&o){let _=a.default.CalcCeilPowerOfTwo(t.width),o=a.default.CalcCeilPowerOfTwo(t.height);_>n.default.MAX_TEXTURE_SIZE&&(_=n.default.MAX_TEXTURE_SIZE),o>n.default.MAX_TEXTURE_SIZE&&(_=n.default.MAX_TEXTURE_SIZE);let u=l(t,_,o),m=this.m_mipLv;if(null!=e&&(e.setDataFromImage(u.canvas,m),e.name=this.m_url,null!=i&&(u=h(t,_,o),i.setDataFromImage(u.canvas,m))),null!=s)if(this.premultipliedAlpha)r=u.ctx2d.getImageData(0,0,u.canvas.width,u.canvas.height),s.setDataFromBytes(r.data,m,u.canvas.width,u.canvas.height),s.name=this.m_img.src;else{r=u.ctx2d.getImageData(0,0,u.canvas.width,u.canvas.height);let e=r.data,i=h(t,_,o);r=i.ctx2d.getImageData(0,0,i.canvas.width,i.canvas.height);let a=r.data,n=0,l=0,d=0;for(;n<o;++n)for(l=0;l<_;++l)e[d]+=255-a[d],e[d+1]+=255-a[d+1],e[d+2]+=255-a[d+2],d+=4;s.setDataFromBytes(e,m,u.canvas.width,u.canvas.height),s.name=this.m_img.src}}else if(null!=e)this.powerOf2Fix,e.setDataFromImage(t,this.m_mipLv),e.name=this.m_img.src;else if(null!=s){let e=a.default.CalcNearestCeilPow2(t.width),i=a.default.CalcNearestCeilPow2(t.height);e>2048&&(e=2048),i>2048&&(e=2048);let n=l(t,e,i),h=this.m_mipLv;r=n.ctx2d.getImageData(0,0,n.canvas.width,n.canvas.height),s.setDataFromBytes(r.data,h,n.canvas.width,n.canvas.height),s.name=this.m_img.src}this.m_loaded=!0}}getURL(){return this.m_url}getImage(){return this.m_img}isLoaded(){return this.m_loaded}destroy(){this.m_loaded=!1,this.m_url="",this.texture=null,this.m_img.src="",this.m_img=null}}class o{constructor(t){this.m_urls=null,this.m_imgs=[],this.m_loadedTotal=0,this.m_loaded=!1,this.m_texList=[],this.m_mLvList=[],this.m_urls=t;var e=this;let i=0,s=null;for(;i<6;++i)s=new Image,s.onload=function(t){if(e.m_loadedTotal++,e.m_loadedTotal>=6){let t=0;for(t=0;t<6;++t)e.m_texList[0].setDataFromImageToFaceAt(t,e.m_imgs[t],e.m_mLvList[0]);e.m_texList[0].name=e.m_imgs.src}},s.crossOrigin="",s.src=e.m_urls[i],e.m_imgs.push(s)}addTex(t,e){this.m_texList.push(t),this.m_mLvList.push(e)}getURLAt(t){return this.m_urls[0]}getTexAt(t){return this.m_texList[t]}isLoaded(){return this.m_loaded}destroy(){}}class u{constructor(t){this.m_cubeDict=new Map,this.m_resMap=new Map,this.m_loadedList=[],this.m_waitLoadList=[],this.m_loadingList=[],this.m_loadingQueueMaxLength=5,this.m_loadDelay=17,this.m_loadDelayTime=17,this.m_testDelay=512,this.m_testDelayTime=512,this.m_texBlock=null,this.m_runFlag=0,this.m_texBlock=t,null!=t&&t.addTexLoader(this)}getTexByUrl(t,e=!0,i=!0,s=!1){let a=this.getImageTexByUrl(t,0,!1,s);return a.mipmapEnabled=i,e&&a.setWrap(r.default.WRAP_REPEAT),a}getBytesNoPremultipliedAlphaTexByUrl(t,e=0){if(""==t)return null;e<0&&(e=0);let i=this.m_resMap.get(t);if(null==i){i=new _(t,e),i.premultipliedAlpha=!1,this.m_resMap.set(t,i);let s=this.m_texBlock.createBytesTex(1,1);return s.name=t,i.bytesTex=s,this.m_waitLoadList.push(i),s}return i.bytesTex.isDestroyed()&&(i.bytesTex=this.m_texBlock.createBytesTex(1,1)),i.bytesTex}getBytesTexByUrl(t,e=0){if(""==t)return null;e<0&&(e=0);let i=this.m_resMap.get(t);if(null==i){i=new _(t,e),this.m_resMap.set(t,i);let s=this.m_texBlock.createBytesTex(1,1);return s.name=t,i.bytesTex=s,this.m_waitLoadList.push(i),s}return i.bytesTex.isDestroyed()&&(i.bytesTex=this.m_texBlock.createBytesTex(1,1)),i.bytesTex}getImageOffsetTexByUrl(t,e=0){if(""==t)return null;e<0&&(e=0);let i=this.m_resMap.get(t);return null!=i?i.offsetTex:null}getImageTexByUrl(t,e=0,i=!1,s=!1){if(""==t)return null;e<0&&(e=0);let a=this.m_resMap.get(t);if(null==a){a=new _(t,e),a.powerOf2Fix=s,i&&(a.offsetTex=this.m_texBlock.createImageTex2D(1,1,!1)),this.m_resMap.set(t,a);let r=this.m_texBlock.createImageTex2D(1,1,!1);return r.name=t,a.texture=r,this.m_loadingList.length<6?(this.m_loadingList.push(a),a.startLoad()):this.m_waitLoadList.push(a),r}return a.texture.isDestroyed()&&(a.texture=this.m_texBlock.createImageTex2D(1,1,!1)),a.texture}getCubeTexAndLoadImg(t,e,i=0){if(""==t||null==e||e.length<6)return null;i<0&&(i=0);let s=this.m_cubeDict.get(t);if(null==s){s=new o(e),this.m_cubeDict.set(t,s);let a=this.m_texBlock.createImageCubeTex(8,8);return s.addTex(a,i),a}return s.getTexAt(0)}setRunFlag(t){this.m_runFlag=t}getRunFlag(){return this.m_runFlag}isRunning(){return!0}isStopped(){return!1}run(){let t=0,e=null;if(--this.m_loadDelay,this.m_loadDelay<1){this.m_loadDelay=this.m_loadDelayTime;let i=this.m_loadingList.length;if(i>0)for(;t<i;++t)this.m_loadingList[t].isLoaded()&&(this.m_loadedList.push(this.m_loadingList[t]),this.m_loadingList.splice(t,1),--t,--i);let s=this.m_waitLoadList.length;if(s>0&&i<this.m_loadingQueueMaxLength)for(t=i;t<this.m_loadingQueueMaxLength;++t){if(!(this.m_waitLoadList.length>0))break;e=this.m_waitLoadList.pop(),this.m_loadingList.push(e),e.startLoad()}}if(--this.m_testDelay,this.m_testDelay<1){this.m_testDelay=this.m_testDelayTime;let i=null,s=this.m_loadedList.length;for(t=0;t<s;++t)e=this.m_loadedList[t],i=null!=e.texture?e.texture:e.bytesTex,i.isDestroyed()&&(this.m_resMap.delete(e.getURL()),this.m_loadedList.splice(t,1),e.destroy(),--t,--s)}}getWaitTotal(){return this.m_waitLoadList.length}isLoadedAll(){return this.m_waitLoadList.length<1}}e.default=u},f63e:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s(i("b3bd")),r=s(i("0fc4")),n=s(i("faa5"));class l extends n.default{constructor(){super(),this.m_uniqueName="",this.normalEnabled=!1,this.vtxMatrixTransform=!0}initialize(t){super.initialize(t),this.m_uniqueName="VOX_Default3DShd",this.m_texEnabled&&(this.m_uniqueName+="_tex"),this.vertColorEnabled&&(this.m_uniqueName+="_vtxColor"),this.premultiplyAlpha&&(this.m_uniqueName+="_preMulAlpha"),this.adaptationShaderVersion=!1}buildShader(){let t=this.m_coder;t.addVertLayout("vec3","a_vs"),t.addFragUniform("vec4","u_color"),this.vtxMatrixTransform?(t.addDefine("VOX_VTX_MAT_TRANSFORM"),t.useVertSpaceMats(!0,!0,!0)):t.useVertSpaceMats(!1,!1,!1),this.m_texEnabled&&(this.m_uniform.addDiffuseMap(),t.addVertLayout("vec2","a_uvs"),t.addVarying("vec2","v_uv")),this.normalEnabled&&t.addFragHeadCode("const vec3 direc = normalize(vec3(0.3,0.6,0.9));"),this.vertColorEnabled&&(t.addVertLayout("vec3","a_cvs"),t.addVarying("vec3","v_cv")),t.addFragOutput("vec4","FragColor0"),t.addFragMainCode("\n    FragColor0 = vec4(1.0);\n    #ifdef VOX_USE_2D_MAP\n        //  FragColor0 *= VOX_Texture2D(VOX_DIFFUSE_MAP, vec2(v_uv[0],v_uv[1]));\n        FragColor0 *= VOX_Texture2D(VOX_DIFFUSE_MAP, v_uv.xy);\n    #endif\n    #ifdef VOX_USE_VTX_COLOR\n        FragColor0.xyz *= v_cv.xyz;\n    #endif\n    #ifdef VOX_PREMULTIPLY_ALPHA\n        FragColor0.rgb *= u_color.xyz;\n        FragColor0.a *= u_color.w;\n        FragColor0.rgb *= u_color.aaa;\n    #else\n        FragColor0 *= u_color;\n    #endif\n    #ifdef VOX_USE_NORMAL\n        float nDotL = max(dot(v_worldNormal.xyz, direc), 0.0);\n        FragColor0.xyz = FragColor0.xyz * 0.7 + 0.3 * FragColor0.xyz * vec3(nDotL);\n    #endif\n"),t.addVertMainCode("\n    localPosition = vec4(a_vs.xyz,1.0);\n    #ifdef VOX_VTX_MAT_TRANSFORM\n        worldPosition = u_objMat * localPosition;\n        oWorldPosition = worldPosition;\n        viewPosition = u_viewMat * worldPosition;\n        gl_Position = u_projMat * viewPosition;\n        #ifdef VOX_USE_NORMAL\n            v_worldNormal = normalize( a_nvs.xyz * inverse(mat3(u_objMat)) );\n        #endif\n    #else\n        gl_Position = localPosition;\n        #ifdef VOX_USE_NORMAL\n            v_worldNormal = normalize( a_nvs.xyz );\n        #endif\n    #endif\n\n    #ifdef VOX_USE_2D_MAP\n        v_uv = a_uvs.xy;\n    #endif\n    #ifdef VOX_USE_VTX_COLOR\n        v_cv = a_cvs.xyz;\n    #endif\n")}getUniqueShaderName(){return this.m_uniqueName}}class h extends r.default{constructor(){super(),this.m_data=new Float32Array([1,1,1,1]),this.vertColorEnabled=!1,this.premultiplyAlpha=!1,this.normalEnabled=!1,this.shadowReceiveEnabled=!1,this.vtxMatrixTransform=!0,null==h.s_shdCodeBuffer&&(h.s_shdCodeBuffer=new l)}buildBuf(){let t=h.s_shdCodeBuffer;t.getShaderCodeBuilder().normalEnabled=this.normalEnabled,t.vertColorEnabled=this.vertColorEnabled,t.premultiplyAlpha=this.premultiplyAlpha,t.normalEnabled=this.normalEnabled,t.shadowReceiveEnabled=this.shadowReceiveEnabled,t.vtxMatrixTransform=this.vtxMatrixTransform}getCodeBuf(){return h.s_shdCodeBuffer}setRGB3f(t,e,i){this.m_data[0]=t,this.m_data[1]=e,this.m_data[2]=i}getRGB3f(t){let e=this.m_data;t.setRGB3f(e[0],e[1],e[2])}setRGBA4f(t,e,i,s){this.m_data[0]=t,this.m_data[1]=e,this.m_data[2]=i,this.m_data[3]=s}getRGBA4f(t){t.fromArray4(this.m_data)}setAlpha(t){this.m_data[3]=t}getAlpha(){return this.m_data[3]}setColor(t){t.toArray4(this.m_data)}getColor(t){t.fromArray4(this.m_data)}createSelfUniformData(){let t=new a.default;return t.uniformNameList=["u_color"],t.dataList=[this.m_data],t}}h.s_shdCodeBuffer=null,e.default=h},f928:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i("7918"),r=s(i("8d98")),n=s(i("ffc0")),l=s(i("1f61")),h=s(i("df25"));class _ extends h.default{constructor(t,e,i=!1){super(t,e,i),this.m_type=a.TextureProxyType.Float,this.minFilter=r.default.LINEAR,this.internalFormat=n.default.RGBA16F,this.dataType=l.default.FLOAT,this.unpackAlignment=4}toAlphaFormat(){this.srcFormat=n.default.ALPHA,this.internalFormat=n.default.ALPHA,this.unpackAlignment=1}toRedFormat(){this.srcFormat=n.default.RED,this.internalFormat=n.default.RED,this.unpackAlignment=1}toRGBFormat(){this.srcFormat=n.default.RGB,this.internalFormat=n.default.RGB16F,this.unpackAlignment=1}toRGBAFormat(){this.srcFormat=n.default.RGBA,this.internalFormat=n.default.RGBA,this.unpackAlignment=4}toRGBAFloatFormat(){this.srcFormat=n.default.RGBA,this.internalFormat=n.default.RGBA16F,this.unpackAlignment=4}setDataFromBytes(t,e=0,i=-1,s=-1,a=0,r=0,n=!1){super.setDataFromBytes(t,e,i,s,a,r,n)}setPartDataFromeBytes(t,e,i,s,a,r=0){super.setPartDataFromeBytes(t,e,i,s,a,r)}getPixels(t,e,i,s,a){super.getPixels(t,e,i,s,a)}toString(){return"[FloatTextureProxy(width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=_},faa5:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i("f3a2"),r=s(i("4a54")),n=i("5216"),l=i("3113"),h=i("4efa");class _{constructor(){this.m_coder=null,this.m_shaderCodeObj=null,this.m_texList=null,this.m_texEnabled=!0,this.pipeline=null,this.gamma=!1,this.vertColorEnabled=!1,this.premultiplyAlpha=!1,this.shadowReceiveEnabled=!1,this.lightEnabled=!1,this.fogEnabled=!1,this.envAmbientLightEnabled=!1,this.brightnessOverlayEnabeld=!1,this.glossinessEnabeld=!0,this.pipeTypes=null,this.keysString="",this.adaptationShaderVersion=!0,null==_.s_coder&&(_.s_uniform=new l.ShaderCodeUniform,_.s_coder=new r.default(_.s_uniform),_.s_uniform.__$setCodeBuilder(_.s_coder),_.s_texBulder=new h.ShaderTextureBuilder(_.s_coder))}reset(){this.m_coder=_.s_coder,this.m_uniform=_.s_uniform,this.m_texBuilder=_.s_texBulder,this.m_texture=this.m_uniform,this.m_coder.reset(),this.m_texList=null,this.pipeTypes=null,this.gamma=!1,this.vertColorEnabled=!1,this.premultiplyAlpha=!1,this.shadowReceiveEnabled=!1,this.lightEnabled=!1,this.fogEnabled=!1,this.envAmbientLightEnabled=!1,this.brightnessOverlayEnabeld=!1,this.glossinessEnabeld=!0,this.keysString=""}clear(){this.m_coder=null}getUniform(){return this.m_uniform}getTexture(){return this.m_texture}getTexBuilder(){return this.m_texBuilder}setShaderCodeObject(t){this.m_shaderCodeObj=t}getShaderCodeObject(){return this.m_shaderCodeObj}getShaderCodeObjectUUID(){return a.ShaderCodeUUID.None}getShaderCodeBuilder(){return _.s_coder}static GetPreCompileInfo(){return _.s_coder.getPreCompileInfo()}initialize(t){this.m_texEnabled=t,this.bufInitWithPipeline()}buildDefine(){this.premultiplyAlpha&&(this.m_coder.addDefine("VOX_PREMULTIPLY_ALPHA"),this.keysString+="A"),this.vertColorEnabled&&(this.m_coder.addDefine("VOX_USE_VTX_COLOR"),this.keysString+="UVC"),this.brightnessOverlayEnabeld&&(this.m_coder.addDefine("VOX_USE_BRIGHTNESS_OVERLAY_COLOR"),this.keysString+="UBOC"),this.glossinessEnabeld&&(this.m_coder.addDefine("VOX_USE_GLOSSINESS"),this.keysString+="UG")}buildPipelineParams(){if(null!=this.pipeline){null==this.pipeTypes&&(this.pipeTypes=[]);let t=n.MaterialPipeType;this.lightEnabled&&!this.pipeTypes.includes(t.GLOBAL_LIGHT)&&this.pipeTypes.push(t.GLOBAL_LIGHT),this.shadowReceiveEnabled&&!this.pipeTypes.includes(t.VSM_SHADOW)&&this.pipeTypes.push(t.VSM_SHADOW),this.fogEnabled&&!this.pipeTypes.includes(t.FOG_EXP2)&&this.pipeTypes.push(t.FOG_EXP2),this.envAmbientLightEnabled&&!this.pipeTypes.includes(t.ENV_AMBIENT_LIGHT)&&this.pipeTypes.push(t.ENV_AMBIENT_LIGHT)}}getTexturesFromPipeline(t){null!=this.pipeline&&this.pipeline.getTextures(this.m_coder,t,this.pipeTypes)}bufInitWithPipeline(){null!=this.pipeline&&(this.buildPipelineParams(),this.pipeline.buildSharedUniforms(this.pipeTypes),this.pipeline.createKeys(this.pipeTypes),this.keysString+=this.pipeline.getKeysString())}isTexEanbled(){return this.m_texEnabled}setIRenderTextureList(t){this.m_texList=t}getIRenderTextureList(){return this.m_texList}buildShader(){}getFragShaderCode(){return this.m_coder.buildFragCode()}getVertShaderCode(){return this.m_coder.buildVertCode()}getUniqueShaderName(){throw Error("Illgel operation !!!")}toString(){return"[ShaderCodeBuffer()]"}}e.default=_},fae3:function(t,e,i){"use strict";i.r(e);i("1eb2");var s=i("c807");for(var a in s)["default"].indexOf(a)<0&&function(t){i.d(e,t,(function(){return s[t]}))}(a)},fc07:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s(i("3b73")),r=s(i("2e8a")),n=s(i("78e9"));class l{constructor(){this.m_texNSMap=new Map,this.attriNSList=null,this.attriSizeList=null,this.uniformNameListStr="",this.texUniformNameListStr="",this.attributes=[null,null,null,null,null,null,null,null,null,null,null,null],this.uniforms=null,this.texTotal=0,this.fragOutputTotal=0}reset(){this.attriNSList=null,this.uniformNameListStr="",this.texUniformNameListStr="";let t=0;for(;t<12;++t)this.attributes[t]=null;this.uniforms=null,this.m_texNSMap.clear(),this.texTotal=0}parseVShaderCode(t){let e=new RegExp(";","g");t=t.replace(e,";\n"),t=t.replace("{","{\n"),t=t.replace("}","\n}");let i="\n",s=t.indexOf(i),a=0,l=[],h="",_="",o=new RegExp(" ","g");while(s>=0)h=t.slice(a,s),h.length>0&&(_=h.replace(o,""),0!=_.indexOf("//")&&l.push(h)),a=s+1,s=t.indexOf(i,a);h=t.slice(a,t.length),h.length>0&&(_=h.replace(o,""),0!=_.indexOf("//")&&l.push(h));let u="uniform ",m=l.length,d=null;for(s=0;s<12;++s)this.attributes[s]=null;this.attriNSList=[],this.attriSizeList=[];let c=null;null==this.uniforms&&(this.uniforms=[]),s=0;let f=!1,p=!1;while(s<m)h=l[s],f=h.indexOf("layout")>=0,p=h.indexOf("attribute ")>=0,f&&h.indexOf("location")>0||p?(d=new r.default,d.layoutEnabled=f,d.parseCode(h),this.attributes[d.attriType]=d,this.attriNSList.push(d.name),this.attriSizeList.push(d.typeSize)):h.indexOf(u)>=0&&(c=new n.default,c.parseCode(h)&&(this.uniforms.push(c),this.uniformNameListStr+=c.name+",",c.isTex&&!this.m_texNSMap.has(c.name)&&(this.m_texNSMap.set(c.name,1),this.texUniformNameListStr+=c.name+",",this.texTotal++))),++s}parseFShaderCode(t){let e=new RegExp(";","g");t=t.replace(e,";\n"),t=t.replace("{","{\n"),t=t.replace("}","\n}");let i="\n",s=t.indexOf(i),r=0,l=[],h="",_="",o=new RegExp(" ","g");while(s>=0)h=t.slice(r,s),h.length>0&&(_=h.replace(o,""),0!=_.indexOf("//")&&l.push(h)),r=s+1,s=t.indexOf(i,r);h=t.slice(r,t.length),h.length>0&&(_=_.replace(o,""),0!=_.indexOf("//")&&l.push(h));let u="uniform ",m=l.length,d=null;null==this.uniforms&&(this.uniforms=[]),s=0;while(s<m)h=l[s],h.indexOf(u)>=0&&this.uniformNameListStr.indexOf(u)<0&&(d=new n.default,d.parseCode(h)&&(this.uniforms.push(d),this.uniformNameListStr+=d.name+",",d.isTex&&!this.m_texNSMap.has(d.name)&&(this.m_texNSMap.set(d.name,1),this.texUniformNameListStr+=d.name+",",this.texTotal++))),++s;let c="layout";a.default.IsWebGL1()&&(c="gl_FragData"),s=t.indexOf(c),this.fragOutputTotal=0;while(s>0)this.fragOutputTotal++,s=t.indexOf(c,s+2);this.fragOutputTotal<1&&(this.fragOutputTotal=1)}}e.default=l},fe7f:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i("7918"),r=s(i("ffc0")),n=s(i("df25"));class l extends n.default{constructor(t,e,i=!1){super(t,e,i),this.m_type=a.TextureProxyType.Bytes}toAlphaFormat(){this.srcFormat=r.default.ALPHA,this.internalFormat=r.default.ALPHA,this.unpackAlignment=1}toRedFormat(){this.srcFormat=r.default.RED,this.internalFormat=r.default.RED,this.unpackAlignment=1}toRGBFormat(){this.srcFormat=r.default.RGB,this.internalFormat=r.default.RGB,this.unpackAlignment=3}toRGBAFormat(){this.srcFormat=r.default.RGBA,this.internalFormat=r.default.RGBA,this.unpackAlignment=4}setDataFromBytes(t,e=0,i=-1,s=-1,a=0,r=0,n=!1){super.setDataFromBytes(t,e,i,s,a,r,n)}setPartDataFromeBytes(t,e,i,s,a,r=0){super.setPartDataFromeBytes(t,e,i,s,a,r)}getPixels(t,e,i,s,a){super.getPixels(t,e,i,s,a)}toString(){return"[BytesTextureProxy(width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=l},febe:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s(i("8a0a")),r=i("e08e");class n{constructor(t=a.default.VTX_STATIC_DRAW){this.m_uid=0,this.m_layoutBit=0,this.m_ivs=null,this.m_bufDataUsage=0,this.m_ibufStep=2,this.layoutBit=0,this.vertexVer=0,this.indicesVer=0,this.version=0,this.drawMode=r.RenderDrawMode.ELEMENTS_TRIANGLES,this.bufData=null,this.m_uid=n.s_uid++,this.m_bufDataUsage=t}getUid(){return this.m_uid}getType(){return 0}setBufSortFormat(t){this.m_layoutBit=t}getBufSortFormat(){return this.m_layoutBit}getIBufStep(){return this.m_ibufStep}getBufDataUsage(){return this.m_bufDataUsage}getIvsData(){return this.m_ivs}setUintIVSData(t,e=a.default.VTX_STATIC_DRAW){if(t instanceof Uint16Array){if(this.m_ibufStep=2,t.length>65535)throw Error("its type is not Uint32Array.")}else{if(!(t instanceof Uint32Array))return;this.m_ibufStep=4}this.m_ivs=t,null!=t&&this.indicesVer++}destroy(){this.m_layoutBit=0}}n.s_uid=0,e.default=n},fecb:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s(i("6e01")),r=s(i("8e17"));class n{constructor(){this.m_long=100,this.m_width=100,this.m_height=100,this.m_halfLong=50,this.m_halfWidth=50,this.m_halfHeight=50,this.m_tempV=new r.default,this.min=new r.default,this.max=new r.default,this.version=-1,this.radius=50,this.radius2=2500,this.center=new r.default(0,0,0),this.reset()}getLong(){return this.m_long}getWidth(){return this.m_width}getHeight(){return this.m_height}reset(){const t=this.min,e=this.max;let i=t;i.x=i.y=i.z=a.default.MATH_MAX_POSITIVE,i=e,i.x=i.y=i.z=a.default.MATH_MIN_NEGATIVE}equals(t){return this.min.equalsXYZ(t.min)&&this.max.equalsXYZ(t.max)}setVolume(t,e,i){this.m_width=t,this.m_height=e,this.m_long=i,this.m_halfLong=.5*this.m_long,this.m_halfWidth=.5*this.m_width,this.m_halfHeight=.5*this.m_height,this.max.x=this.center.x+this.m_halfWidth,this.max.y=this.center.y+this.m_halfHeight,this.max.z=this.center.z+this.m_halfLong,this.min.x=this.center.x-this.m_halfWidth,this.min.y=this.center.y-this.m_halfHeight,this.min.z=this.center.z-this.m_halfLong,this.radius2=this.m_halfWidth*this.m_halfWidth+this.m_halfHeight*this.m_halfHeight+this.m_halfLong*this.m_halfLong,this.radius=Math.sqrt(this.radius2)}union(t){return this.addPosition(t.min),this.addPosition(t.max),this}addPosition(t){return this.addXYZ(t.x,t.y,t.z),this}addXYZ(t,e,i){const s=this.min,a=this.max;s.x>t&&(s.x=t),a.x<t&&(a.x=t),s.y>e&&(s.y=e),a.y<e&&(a.y=e),s.z>i&&(s.z=i),a.z<i&&(a.z=i)}addFloat32Arr(t,e=3){let i=t.length;for(let s=0;s<i;)this.addXYZ(t[s],t[s+1],t[s+2]),s+=e}addFloat32AndIndicesArr(t,e){let i,s=e.length;for(let a=0;a<s;a++)i=3*e[a],this.addXYZ(t[i++],t[i++],t[i])}getClosePosition(t,e,i=0){const s=this.min,a=this.max;e.copyFrom(t),e.x<s.x?e.x=s.x+i:e.x>a.x&&(e.x=a.x-i),e.y<s.y?e.y=s.y+i:e.y>a.y&&(e.y=a.y-i),e.z<s.z?e.z=s.z+i:e.z>a.z&&(e.z=a.z-i)}containsV(t){return!(t.x<this.min.x||t.x>this.max.x)&&(!(t.y<this.min.y||t.y>this.max.y)&&!(t.z<this.min.z||t.z>this.max.z))}containsXY(t,e){return!(t<this.min.x||t>this.max.x)&&!(e<this.min.y||e>this.max.y)}containsXZ(t,e){return!(t<this.min.x||t>this.max.x)&&!(e<this.min.z||e>this.max.z)}containsYZ(t,e){return!(t<this.min.y||t>this.max.y)&&!(e<this.min.z||e>this.max.z)}copyFrom(t){return this.radius=t.radius,this.radius2=t.radius2,this.min.copyFrom(t.min),this.max.copyFrom(t.max),this.center.copyFrom(t.center),this.updateVolume(),this}expand(t){return this.min.subtractBy(t),this.max.addBy(t),this}updateVolume(){return this.m_width=this.max.x-this.min.x,this.m_height=this.max.y-this.min.y,this.m_long=this.max.z-this.min.z,this.m_halfLong=.5*this.m_long,this.m_halfWidth=.5*this.m_width,this.m_halfHeight=.5*this.m_height,++this.version,this}updateThis(){this.center.x=.5*this.m_width,this.center.y=.5*this.m_height,this.center.z=.5*this.m_long,this.m_halfLong=this.center.z,this.m_halfWidth=this.center.x,this.m_halfHeight=this.center.y,this.radius2=this.m_halfWidth*this.m_halfWidth+this.m_halfHeight*this.m_halfHeight+this.m_halfLong*this.m_halfLong,this.radius=Math.sqrt(this.radius2),this.center.addBy(this.min),++this.version}update(){this.m_width=this.max.x,this.min.x>this.max.x&&(this.max.x=this.min.x,this.min.x=this.m_width),this.m_width=this.max.x-this.min.x,this.m_height=this.max.y,this.min.y>this.max.y&&(this.max.y=this.min.y,this.min.y=this.m_height),this.m_height=this.max.y-this.min.y,this.m_long=this.max.z,this.min.z>this.max.z&&(this.max.z=this.min.z,this.min.z=this.m_long),this.m_long=this.max.z-this.min.z,this.updateThis()}updateFast(){this.m_width=this.max.x-this.min.x,this.m_height=this.max.y-this.min.y,this.m_long=this.max.z-this.min.z,this.updateThis()}toString(){return"[AABB(min->"+this.min+",size("+this.m_width+","+this.m_height+","+this.m_long+"))]"}sphereIntersect(t,e){this.m_tempV.x=this.center.x-t.x,this.m_tempV.y=this.center.y-t.y,this.m_tempV.z=this.center.z-t.z;let i=this.m_tempV.getLengthSquared();return i<this.radius2||(e+=this.radius,e*=e,e>=i)}}e.default=n},ffc0:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s(i("3b73"));class r{static ToGL(t,e){const i=r;switch(e){case i.RGBA:break;case i.R8:return t.R8;case i.RGB:return t.RGB;case i.RGB8:return t.RGB8;case i.RGBA8:return t.RGBA8;case i.ALPHA:return t.ALPHA;case i.RGB16F:return a.default.IsWebGL2()?t.RGB16F:t.RGB;case i.RGBA16F:return a.default.IsWebGL2()?t.RGBA16F:t.RGBA;case i.RGB32F:return a.default.IsWebGL2()&&t.RGB32F,t.RGB;case i.RGBA32F:return a.default.IsWebGL2()&&t.RGBA32F,t.RGBA;case r.RED:return t.RED;case i.DEPTH_COMPONENT:return t.DEPTH_COMPONENT;case i.DEPTH_STENCIL:return t.DEPTH_STENCIL;default:break}return t.RGBA}}r.R8=101,r.RGB=110,r.RED=111,r.RGBA=121,r.RGB8=122,r.RGBA8=123,r.ALPHA=132,r.RGB16F=331,r.RGBA16F=332,r.RGB32F=341,r.RGBA32F=342,r.DEPTH_COMPONENT=351,r.DEPTH_STENCIL=352,e.default=r}})}));