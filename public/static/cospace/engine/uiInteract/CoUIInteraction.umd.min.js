(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t():"function"===typeof define&&define.amd?define([],t):"object"===typeof exports?exports["CoUIInteraction"]=t():e["CoUIInteraction"]=t()})("undefined"!==typeof self?self:this,(function(){return function(e){var t={};function i(s){if(t[s])return t[s].exports;var n=t[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(s,n,function(t){return e[t]}.bind(null,n));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s="fae3")}({"0d32":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("1c92"),n=i("6b7e");class o{constructor(){this.m_stage3D=null,this.m_dragSwinger=new s.CamDragSwinger,this.m_dragSlider=new n.CamDragSlider,this.m_swing=!0,this.buttonType=0,this.bgEventEnabled=!0}initialize(e,t){if(null==this.m_stage3D){this.m_stage3D=e,this.m_dragSwinger.initialize(e,t),this.m_dragSlider.initialize(e,t);const i=CoRScene.MouseEvent;let s=i.MOUSE_DOWN;this.bgEventEnabled&&(s=i.MOUSE_BG_DOWN);let n=i.MOUSE_UP;1==this.buttonType?(s=this.bgEventEnabled?i.MOUSE_BG_MIDDLE_DOWN:i.MOUSE_MIDDLE_DOWN,n=i.MOUSE_MIDDLE_UP):2==this.buttonType&&(s=this.bgEventEnabled?i.MOUSE_BG_RIGHT_DOWN:i.MOUSE_RIGHT_DOWN,n=i.MOUSE_RIGHT_UP,document.oncontextmenu=function(e){e.preventDefault()}),e.addEventListener(s,this,this.mouseDownListener,!0,!1),e.addEventListener(n,this,this.mouseUpListener,!0,!0)}}setSlideSpeed(e){this.m_dragSlider.slideSpeed=e}enableSwing(){this.m_swing=!0}isEnabledSwing(){return this.m_swing}enableSlide(){this.m_swing=!1}mouseDownListener(e){this.attach()}mouseUpListener(e){this.detach()}attach(){this.m_dragSwinger.attach(),this.m_dragSlider.attach()}detach(){this.m_dragSwinger.detach(),this.m_dragSlider.detach()}runWithYAxis(){this.m_swing?this.m_dragSwinger.runWithYAxis():this.m_dragSlider.run()}runWithZAxis(){this.m_swing?this.m_dragSwinger.runWithZAxis():this.m_dragSlider.run()}}t.default=o},"1c92":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(){this.m_stage3D=null,this.m_camera=null,this.m_mouseX=0,this.m_mouseY=0,this.m_enabled=!1,this.m_rotationSpeed=0,this.m_aotuRotationDelay=100,this.autoRotationEnabled=!1,this.autoRotationSpeed=.2,this.rotationAttenuationEnabled=!1,this.rotationSpeed=.2}initialize(e,t){null==this.m_stage3D&&(this.m_stage3D=e,this.m_camera=t)}attach(){this.m_mouseX=this.m_stage3D.mouseX,this.m_mouseY=this.m_stage3D.mouseY,this.m_enabled=!0,this.m_aotuRotationDelay=100}detach(){this.m_enabled=!1}runWithYAxis(){this.runWithAxis(CoRScene.Vector3D.Y_AXIS)}runWithZAxis(){this.runWithAxis(CoRScene.Vector3D.Z_AXIS)}run(e,t){if(this.m_enabled){let i=this.m_mouseX-this.m_stage3D.mouseX,s=this.m_mouseY-this.m_stage3D.mouseY,n=Math.abs(i),o=Math.abs(s);n>o?n>.5&&(t<1?this.m_camera.swingHorizontalWithAxis(.2*i,e):this.m_camera.swingHorizontal(.2*i)):o>.5&&this.m_camera.swingVertical(-.2*s),this.m_mouseX=this.m_stage3D.mouseX,this.m_mouseY=this.m_stage3D.mouseY}else this.autoRotationEnabled&&(this.m_aotuRotationDelay<0?t<1?this.m_camera.swingHorizontalWithAxis(this.autoRotationSpeed,e):this.m_camera.swingHorizontal(this.autoRotationSpeed):this.m_aotuRotationDelay--)}runWithAxis(e){this.run(e,0)}runWithCameraAxis(){this.run(null,1)}}t.CamDragSwinger=s},"1eb2":function(e,t,i){"use strict";if("undefined"!==typeof window){var s=window.document.currentScript,n=i("8875");s=n(),"currentScript"in document||Object.defineProperty(document,"currentScript",{get:n});var o=s&&s.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);o&&(i.p=o[1])}},"25a4":function(e,t,i){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(i("0d32")),o=s(i("5082"));class r{constructor(){this.m_rscene=null,this.drager=new n.default,this.zoomer=new o.default,this.zoomMinDistance=30,this.cameraCtrlEnabled=!0}initialize(e,t=0,i=!0){if(null==this.m_rscene){this.m_rscene=e,e.enableMouseEvent(!0);const s=this.drager,n=this.zoomer;s.buttonType=t,s.bgEventEnabled=i,s.initialize(e.getStage3D(),e.getCamera()),n.bindCamera(e.getCamera()),n.initialize(e.getStage3D()),n.setLookAtCtrlEnabled(!1)}}enableSwing(){this.drager.enableSwing()}isEnabledSwing(){return this.isEnabledSwing()}enableSlide(){this.drager.enableSlide()}setSyncLookAtEnabled(e){this.zoomer.syncLookAt=e}setLookAtPosition(e){this.zoomer.setLookAtPosition(e)}run(){this.cameraCtrlEnabled&&(this.zoomer.run(this.zoomMinDistance),this.drager.runWithYAxis())}destroy(){}}t.MouseInteraction=r},5082:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(){this.m_camera=null,this.m_touchZoomBoo=!1,this.m_preDis=0,this.m_touchZoomSpd=2,this.m_slideSpd=1,this.m_mouseWheelZoomSpd=6,this.m_fowardDis=0,this.m_initBoo=!0,this.m_lookAtCtrlEnabled=!0,this.m_flagDrag=0,this.m_flagZoom=0,this.m_windowsEnvFlag=!0,this.syncLookAt=!1,this.m_flagType=2;const e=CoRenderer.RendererDevice;this.m_windowsEnvFlag=!(e.IsMobileWeb()||e.IsSafariWeb())}setMobileZoomSpeed(e){this.m_touchZoomSpd=e}seSlideSpeed(e){this.m_slideSpd=e}setMouseWheelZoomSpd(e){this.m_mouseWheelZoomSpd=e}bindCamera(e){this.m_camera=e}initialize(e){if(this.m_initBoo){this.m_initBoo=!1,this.m_tempa=CoRScene.createVec3(),this.m_tempb=CoRScene.createVec3(),this.m_preva=CoRScene.createVec3(),this.m_prevb=CoRScene.createVec3(),this.m_va=CoRScene.createVec3(),this.m_vb=CoRScene.createVec3(),this.m_lookAt=CoRScene.createVec3(),this.m_lookAtPos=CoRScene.createVec3();const t=CoRScene.MouseEvent;e.addEventListener(t.MOUSE_WHEEL,this,this.mouseWheelListener,!0,!0),e.addEventListener(t.MOUSE_MULTI_MOVE,this,this.mouseMultiMoveListener,!0,!0),e.addEventListener(t.MOUSE_MULTI_UP,this,this.mouseMultiUpListener,!0,!0)}}setLookAtCtrlEnabled(e){this.m_lookAtCtrlEnabled=e}mouseWheelListener(e){e.wheelDeltaY>0?this.m_fowardDis+=this.m_mouseWheelZoomSpd:this.m_fowardDis-=this.m_mouseWheelZoomSpd}mouseMultiMoveListener(e){this.setTouchPosArray(e.posArray)}mouseMultiUpListener(e){this.setTouchPosArray(e.posArray)}resetState(){this.m_flagDrag=0,this.m_flagZoom=0,this.m_flagType=0}setTouchPosArray(e){if(null!=e&&e.length>1){const t=CoRScene.Vector3D;let i=0;if(this.m_va.setXYZ(e[0].x,e[0].y,0),this.m_vb.setXYZ(e[1].x,e[1].y,0),this.m_touchZoomBoo){i=t.Distance(this.m_va,this.m_vb),this.m_flagType<1?(this.m_tempa.copyFrom(this.m_va),this.m_tempb.copyFrom(this.m_vb),this.m_tempa.subVecsTo(this.m_va,this.m_preva),this.m_tempb.subVecsTo(this.m_vb,this.m_prevb),this.m_tempa.normalize(),this.m_tempb.normalize(),this.m_tempa.dot(this.m_tempb)>.9?this.m_flagDrag++:this.m_flagZoom++,(this.m_flagDrag>3||this.m_flagZoom>3)&&(this.m_flagType=this.m_flagDrag>this.m_flagZoom?1:2)):this.m_tempa.subVecsTo(this.m_va,this.m_preva);let e=Math.abs(this.m_preDis-i);e>.1&&(this.m_fowardDis=(i-this.m_preDis)*this.m_touchZoomSpd,this.m_preDis=i)}else this.m_touchZoomBoo=!0,this.m_preDis=t.Distance(this.m_va,this.m_vb),this.resetState()}else this.resetState(),this.m_touchZoomBoo=!1;this.m_preva.copyFrom(this.m_va),this.m_prevb.copyFrom(this.m_vb)}setLookAtPosition(e){if(this.syncLookAt){null==e&&(e=this.m_lookAt);let t=CoRScene.Vector3D.DistanceSquared,i=this.m_camera.getLookAtPosition();(t(e,this.m_lookAtPos)>1e-4||t(i,e)>1e-4)&&(this.m_camera.setLookAtPosition(e),this.m_lookAtPos.copyFrom(e))}}run(e){let t=this.m_lookAtCtrlEnabled;if(null!=this.m_camera)if(2==this.m_flagType){const i=CoRScene.Vector3D;if(Math.abs(this.m_fowardDis)>.001){let s=i.Distance(this.m_camera.getPosition(),this.m_camera.getLookAtPosition()),n=this.m_fowardDis;if(this.m_fowardDis>0&&(s>e?(n=s-e,n>this.m_fowardDis&&(n=this.m_fowardDis)):n=0),Math.abs(n)>.1){this.m_camera.forward(n);let e=this.m_lookAtPos;t&&this.m_camera.setLookPosXYZFixUp(e.x,e.y,e.z)}this.m_windowsEnvFlag?this.m_fowardDis*=.95:this.m_fowardDis=0}}else 1==this.m_flagType&&this.m_camera.slideViewOffsetXY(-this.m_tempa.x*this.m_slideSpd,this.m_tempa.y*this.m_slideSpd)}}t.default=s},"6b7e":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(){this.m_stage3D=null,this.m_camera=null,this.slideSpeed=2,this.m_mouseX=0,this.m_mouseY=0,this.m_enabled=!1}initialize(e,t){null==this.m_stage3D&&(this.m_stage3D=e,this.m_camera=t)}attach(){this.m_mouseX=this.m_stage3D.mouseX,this.m_mouseY=this.m_stage3D.mouseY,this.m_enabled=!0}detach(){this.m_enabled=!1}run(){if(this.m_enabled){let e=(this.m_mouseX-this.m_stage3D.mouseX)*this.slideSpeed,t=(this.m_mouseY-this.m_stage3D.mouseY)*this.slideSpeed;this.m_camera.slideViewOffsetXY(e,t),this.m_mouseX=this.m_stage3D.mouseX,this.m_mouseY=this.m_stage3D.mouseY}}}t.CamDragSlider=s},8875:function(e,t,i){var s,n,o;(function(i,r){n=[],s=r,o="function"===typeof s?s.apply(t,n):s,void 0===o||(e.exports=o)})("undefined"!==typeof self&&self,(function(){function e(){var t=Object.getOwnPropertyDescriptor(document,"currentScript");if(!t&&"currentScript"in document&&document.currentScript)return document.currentScript;if(t&&t.get!==e&&document.currentScript)return document.currentScript;try{throw new Error}catch(u){var i,s,n,o=/.*at [^(]*\((.*):(.+):(.+)\)$/gi,r=/@([^@]*):(\d+):(\d+)\s*$/gi,a=o.exec(u.stack)||r.exec(u.stack),m=a&&a[1]||!1,h=a&&a[2]||!1,c=document.location.href.replace(document.location.hash,""),l=document.getElementsByTagName("script");m===c&&(i=document.documentElement.outerHTML,s=new RegExp("(?:[^\\n]+?\\n){0,"+(h-2)+"}[^<]*<script>([\\d\\D]*?)<\\/script>[\\d\\D]*","i"),n=i.replace(s,"$1").trim());for(var _=0;_<l.length;_++){if("interactive"===l[_].readyState)return l[_];if(l[_].src===m)return l[_];if(m===c&&l[_].innerHTML&&l[_].innerHTML.trim()===n)return l[_]}return null}}return e}))},c88f:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(){this.type=0,this.targets=[],this.listeners=[]}addListener(e,t){let i=0;for(i=this.listeners.length-1;i>=0;--i)if(t===this.listeners[i])break;i<0&&(this.targets.push(e),this.listeners.push(t))}removeListener(e,t){for(let i=this.listeners.length-1;i>=0;--i)if(t===this.listeners[i]){this.targets.splice(i,1),this.listeners.splice(i,1);break}}dispatch(e){let t=this.listeners,i=t.length;for(let s=0;s<i;++s)t[s].call(this.targets[s],e)}}class n{constructor(){this.m_evtMap=new Map,this.m_index=-1,this.m_keys=new Uint32Array(8),this.m_code0=-1,this.m_code1=-1}reset(){this.m_code0=-1,this.m_code1=-1,this.m_index=-1,this.m_keys.fill(0)}getCurrKeyCode(){return this.m_index>-1?this.m_keys[this.m_index]:-1}use(e){if(this.m_code0!=e.keyCode){this.m_code0=e.keyCode,this.m_code1=-1,this.m_index++;let t=this.m_keys;t[this.m_index]=e.keyCode;let i=this.createKeysEventType(this.m_keys);const s=this.m_evtMap;let n=s.get(i);null!=n&&(e.keysEventType=i,n.dispatch(e))}}disuse(e){if(this.m_code1!=e.keyCode){this.m_code1=e.keyCode,this.m_code0=-1;let t=this.m_keys;t[this.m_index]=0,this.m_index,this.m_index--,this.m_index<-1&&(this.m_index=-1)}}isEnabled(){return this.m_index>0}createKeysEventType(e){if(null!=e){let t=e.length;if(t>0){t>4&&(t=4);let i=0;for(let s=0;s<t;++s)i|=e[s]<<8*s;return i}}return 0}addEventListener(e,t,i){if(e>0){const n=this.m_evtMap;let o=n.get(e);null==o&&(o=new s,o.type=e,n.set(e,o)),o.addListener(t,i)}}removeEventListener(e,t,i){if(e>0){const s=this.m_evtMap;let n=s.get(e);null!=n&&n.removeListener(t,i)}}}class o{constructor(){this.m_rscene=null,this.m_downMana=new n}initialize(e){if(null==this.m_rscene){this.m_rscene=e;let t=CoRScene.KeyboardEvent;this.m_rscene.addEventListener(t.KEY_DOWN,this,this.keyDown),this.m_rscene.addEventListener(t.KEY_UP,this,this.keyUp),window.onfocus=()=>{this.reset()}}}getCurrDownKeyCode(){return this.m_downMana.getCurrKeyCode()}keyDown(e){this.m_downMana.use(e)}keyUp(e){this.m_downMana.disuse(e),this.m_downMana.isEnabled()}reset(){this.m_downMana.reset()}createKeysEventType(e){return this.m_downMana.createKeysEventType(e)}addKeysDownListener(e,t,i){this.m_downMana.addEventListener(e,t,i)}removeKeysDownListener(e,t,i){this.m_downMana.removeEventListener(e,t,i)}}t.CoKeyboardInteraction=o},d6d0:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("25a4"),n=i("c88f");function o(){return new s.MouseInteraction}function r(){return new n.CoKeyboardInteraction}t.createMouseInteraction=o,t.createKeyboardInteraction=r},fae3:function(e,t,i){"use strict";i.r(t);i("1eb2");var s=i("d6d0");for(var n in s)["default"].indexOf(n)<0&&function(e){i.d(t,e,(function(){return s[e]}))}(n)}})}));