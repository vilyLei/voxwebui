(function(t,e){"object"===typeof exports&&"object"===typeof module?module.exports=e():"function"===typeof define&&define.amd?define([],e):"object"===typeof exports?exports["CoRenderer"]=e():t["CoRenderer"]=e()})("undefined"!==typeof self?self:this,(function(){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(s,r,function(e){return t[e]}.bind(null,r));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s="fae3")}({"030e":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{static Initialize(t,e){let i=this;1==t?(i.OES_standard_derivatives=e.getExtension("OES_standard_derivatives"),i.OES_standard_derivatives,i.EXT_shader_texture_lod=e.getExtension("EXT_shader_texture_lod"),i.EXT_shader_texture_lod,i.WEBGL_draw_buffers=e.getExtension("WEBGL_draw_buffers"),i.WEBGL_draw_buffers,i.OES_vertex_array_object=e.getExtension("OES_vertex_array_object"),i.OES_vertex_array_object,i.ANGLE_instanced_arrays=e.getExtension("ANGLE_instanced_arrays"),i.ANGLE_instanced_arrays,i.EXT_color_buffer_float=e.getExtension("EXT_color_buffer_float"),i.EXT_color_buffer_float,i.EXT_color_buffer_half_float=e.getExtension("EXT_color_buffer_half_float"),i.EXT_color_buffer_half_float,i.OES_texture_half_float=e.getExtension("OES_texture_half_float"),i.OES_texture_half_float,i.OES_texture_half_float_linear=e.getExtension("OES_texture_half_float_linear"),i.OES_texture_half_float_linear,i.OES_texture_float=e.getExtension("OES_texture_float"),i.OES_texture_float,i.OES_element_index_uint=e.getExtension("OES_element_index_uint"),i.OES_element_index_uint,i.EXT_blend_minmax=e.getExtension("EXT_blend_minmax"),i.EXT_blend_minmax):(i.EXT_shader_texture_lod=e.getExtension("EXT_shader_texture_lod"),i.EXT_shader_texture_lod,i.EXT_color_buffer_half_float=e.getExtension("EXT_color_buffer_half_float"),i.EXT_color_buffer_half_float,i.OES_texture_half_float_linear=e.getExtension("OES_texture_half_float_linear"),i.OES_texture_half_float_linear,i.EXT_color_buffer_float=e.getExtension("EXT_color_buffer_float"),i.EXT_color_buffer_float),i.OES_texture_float_linear=e.getExtension("OES_texture_float_linear"),i.OES_texture_float_linear,i.WEBGL_depth_texture=e.getExtension("WEBGL_depth_texture"),i.WEBGL_depth_texture,i.WEBGL_debug_renderer_info=e.getExtension("WEBGL_debug_renderer_info"),i.WEBGL_debug_renderer_info}}s.OES_standard_derivatives=null,s.EXT_shader_texture_lod=null,s.WEBGL_draw_buffers=null,s.OES_vertex_array_object=null,s.ANGLE_instanced_arrays=null,s.EXT_color_buffer_float=null,s.EXT_color_buffer_half_float=null,s.OES_texture_float_linear=null,s.OES_texture_half_float_linear=null,s.OES_texture_half_float=null,s.OES_texture_float=null,s.OES_element_index_uint=null,s.EXT_blend_minmax=null,s.WEBGL_depth_texture=null,s.WEBGL_debug_renderer_info=null,e.default=s},"070b":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(t,e,i,r){this.m_uid=-1,this.m_rBoo=!0,this.m_gBoo=!0,this.m_bBoo=!0,this.m_aBoo=!0,this.m_uid=s.s_uid++,this.m_rBoo=t,this.m_gBoo=e,this.m_bBoo=i,this.m_aBoo=r}getUid(){return this.m_uid}getR(){return this.m_rBoo}getG(){return this.m_gBoo}getB(){return this.m_bBoo}getA(){return this.m_aBoo}use(){s.s_state!=this.m_uid&&(s.Rstate.setColorMask(this.m_rBoo,this.m_gBoo,this.m_bBoo,this.m_aBoo),s.s_state=this.m_uid)}static Create(t,e,i,r,a){if(s.s_stsNameMap.has(t)){let e=s.s_stsNameMap.get(t);return e.getUid()}let n=(e?64:32)|(i?16:8)|(r?4:2)|(a?1:0);if(s.s_stsMap.has(n)){let t=s.s_stsMap.get(n);n=t.getUid()}else{let _=new s(e,i,r,a);n=_.getUid(),s.s_stsMap.set(n,_),s.s_stsNameMap.set(t,_),s.s_states.push(_),++s.s_statesLen}return n}static GetColorMaskByName(t){if(s.s_stsNameMap.has(t)){let e=s.s_stsNameMap.get(t);return e.getUid()}return-1}static UseRenderState(t){s.s_unlocked&&s.Rstate.roColorMask!=t&&t>-1&&t<s.s_statesLen&&s.s_states[t].use()}static UseColorMaskByName(t){let e=s.GetColorMaskByName(t);s.s_unlocked&&s.Rstate.roColorMask!=e&&e>-1&&e<s.s_statesLen&&s.s_states[e].use()}static Lock(){s.s_unlocked=!1}static Unlock(){s.s_unlocked=!0}static Reset(){s.s_state=-1}}s.s_uid=0,s.s_state=-1,s.s_states=[],s.s_statesLen=1,s.s_stsMap=new Map,s.s_stsNameMap=new Map,s.s_unlocked=!0,s.ALL_TRUE_COLOR_MASK=0,s.ALL_FALSE_COLOR_MASK=1,s.Rstate=null,e.RenderColorMask=s},"090c":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("030e")),a=s(i("3b73")),n=s(i("b0ef")),_=s(i("0c85")),l=i("e08e"),h=s(i("e2fe"));class o{constructor(){this.m_mouseEvtDisplather=new _.default,this.m_div=null,this.m_canvas=null,this.m_scissorEnabled=!1,this.m_depthTestEnabled=!0,this.m_stencilTestEnabled=!0,this.m_offcanvas=null,this.m_gl=null,this.m_stage=null,this.m_viewPortRect=new h.default(0,0,800,600),this.m_maxWebGLVersion=2,this.m_webGLVersion=2,this.m_devicePixelRatio=1,this.m_viewEle=new n.default,this.autoSyncRenderBufferAndWindowSize=!0,this.offscreenRenderEnabled=!1,this.m_resizeFlag=!0,this.m_WEBGL_lose_context=null,this.m_displayWidth=0,this.m_displayHeight=0,this.m_rcanvasWidth=0,this.m_rcanvasHeight=0,this.m_resizeCallback=null}contextrestoredHandler(t){}contextlostHandler(t){}setWebGLMaxVersion(t){1!=t&&2!=t||(this.m_maxWebGLVersion=t)}getWebGLVersion(){return this.m_webGLVersion}getDiv(){return this.m_div}setDivStyleLeftAndTop(t,e){this.m_viewEle.setDivStyleLeftAndTop(t,e)}setDivStyleSize(t,e){this.m_viewEle.setDivStyleSize(t,e)}getCanvas(){return this.m_canvas}isDepthTestEnabled(){return this.m_depthTestEnabled}isStencilTestEnabled(){return this.m_stencilTestEnabled}initialize(t,e,i,s=null){this.m_stage=e;var n=null,_=null;try{void 0!=document&&(n=document,_=window)}catch(h){}if(null!=n){this.m_devicePixelRatio=window.devicePixelRatio,a.default.SetDevicePixelRatio(this.m_devicePixelRatio),this.m_viewEle.setDiv(i),this.m_viewEle.createViewEle(n,this.autoSyncRenderBufferAndWindowSize),this.m_div=i=this.m_viewEle.getDiv();let h=this.m_canvas=this.m_viewEle.getCanvas();this.m_devicePixelRatio=window.devicePixelRatio,this.m_mouseEvtDisplather.dpr=this.m_devicePixelRatio;let o=s;null==s?o={depth:this.m_depthTestEnabled,premultipliedAlpha:!1,alpha:!0,antialias:!1,stencil:this.m_stencilTestEnabled,preserveDrawingBuffer:!0,powerPreference:"default"}:(this.m_depthTestEnabled=o.depth,this.m_stencilTestEnabled=o.stencil);let d=null;if(this.offscreenRenderEnabled&&(d=h.transferControlToOffscreen()),this.m_offcanvas=d,2==this.m_maxWebGLVersion&&(this.m_gl=null==d?h.getContext("webgl2",o):d.getContext("webgl2",o),null!=this.m_gl&&(this.m_webGLVersion=2)),null==this.m_gl&&(this.m_gl=null==d?h.getContext("webgl",o)||h.getContext("experimental-webgl",o):d.getContext("webgl",o)||d.getContext("experimental-webgl",o),null!=this.m_gl&&(this.m_webGLVersion=1)),!this.m_gl)throw this.m_webGLVersion=-1,alert("Unable to initialize WebGL. Your browser or machine may not support it."),Error("WebGL initialization failure.");let u=this.m_gl;u.rcuid=t;let m=l.GLStencilFunc;m.NEVER=u.NEVER,m.LESS=u.LESS,m.EQUAL=u.EQUAL,m.GREATER=u.GREATER,m.NOTEQUAL=u.NOTEQUAL,m.GEQUAL=u.GEQUAL,m.ALWAYS=u.ALWAYS;let c=l.GLStencilOp;c.KEEP=u.KEEP,c.ZERO=u.ZERO,c.REPLACE=u.REPLACE,c.INCR=u.INCR,c.INCR_WRAP=u.INCR_WRAP,c.DECR=u.DECR,c.DECR_WRAP=u.DECR_WRAP,c.INVERT=u.INVERT;let f=l.GLBlendMode;f.ZERO=u.ZERO,f.ONE=u.ONE,f.SRC_COLOR=u.SRC_COLOR,f.DST_COLOR=u.DST_COLOR,f.SRC_ALPHA=u.SRC_ALPHA,f.DST_ALPHA=u.DST_ALPHA,f.ONE_MINUS_SRC_ALPHA=u.ONE_MINUS_SRC_ALPHA;let R=l.GLBlendEquation;R.FUNC_ADD=u.FUNC_ADD,R.FUNC_SUBTRACT=u.FUNC_SUBTRACT,R.FUNC_REVERSE_SUBTRACT=u.FUNC_REVERSE_SUBTRACT,R.MIN_EXT=u.MIN_EXT,R.MAX_EXT=u.MAX_EXT,R.MIN=u.MIN,R.MAX=u.MAX;let E=l.CullFaceMode;E.BACK=u.BACK,E.FRONT=u.FRONT,E.FRONT_AND_BACK=u.FRONT_AND_BACK;let p=a.default;p.MAX_TEXTURE_SIZE=this.m_gl.getParameter(this.m_gl.MAX_TEXTURE_SIZE),p.MAX_RENDERBUFFER_SIZE=this.m_gl.getParameter(this.m_gl.MAX_RENDERBUFFER_SIZE);let T=this.m_gl.getParameter(this.m_gl.MAX_VIEWPORT_DIMS);p.MAX_VIEWPORT_WIDTH=T[0],p.MAX_VIEWPORT_HEIGHT=T[1],r.default.Initialize(this.m_webGLVersion,this.m_gl),a.default.Initialize([this.m_webGLVersion]),null!=e&&this.m_mouseEvtDisplather.initialize(h,i,e);let g=r.default.WEBGL_debug_renderer_info;if(null!=g){let t=this.m_gl.getParameter(g.UNMASKED_VENDOR_WEBGL),e=this.m_gl.getParameter(g.UNMASKED_RENDERER_WEBGL);p.GPU_VENDOR=t,p.GPU_RENDERER=e,a.default.IsWinExternalVideoCard()}_.onresize=t=>{this.autoSyncRenderBufferAndWindowSize&&(this.m_resizeFlag=!0,this.updateRenderBufferSize())},h.addEventListener("webglcontextrestored",this.contextrestoredHandler,!1),h.addEventListener("webglcontextlost",this.contextlostHandler,!1),this.updateRenderBufferSize()}}loseContext(){null==this.m_WEBGL_lose_context&&(this.m_WEBGL_lose_context=this.m_gl.getExtension("WEBGL_lose_context")),null==this.m_WEBGL_lose_context&&this.m_WEBGL_lose_context.loseContext()}isContextLost(){return this.m_gl.isContextLost()}getRC(){return this.m_gl}setScissorEnabled(t){t?this.m_scissorEnabled||(this.m_scissorEnabled=!0,this.m_gl.enable(this.m_gl.SCISSOR_TEST)):this.m_scissorEnabled&&(this.m_scissorEnabled=!1,this.m_gl.disable(this.m_gl.SCISSOR_TEST))}setScissorRect(t,e,i,s){this.m_gl.scissor(t,e,i,s)}setResizeCallback(t){this.m_resizeCallback=t}getDevicePixelRatio(){return this.m_devicePixelRatio}resizeBufferSize(t,e){t=Math.floor(t),e=Math.floor(e);let i=window.devicePixelRatio,s=Math.abs(i-this.m_devicePixelRatio)>.01||this.m_resizeFlag;this.m_devicePixelRatio=i,this.m_mouseEvtDisplather.dpr=i,a.default.SetDevicePixelRatio(this.m_devicePixelRatio),this.m_resizeFlag=!1,(this.m_displayWidth!=t||this.m_displayHeight!=e||s)&&(this.m_displayWidth=t,this.m_displayHeight=e,this.m_rcanvasWidth=Math.floor(t*i),this.m_rcanvasHeight=Math.floor(e*i),null==this.m_offcanvas?(this.m_canvas.width=this.m_rcanvasWidth,this.m_canvas.height=this.m_rcanvasHeight):(this.m_offcanvas.width=this.m_rcanvasWidth,this.m_offcanvas.height=this.m_rcanvasHeight),this.m_canvas.style.width=this.m_displayWidth+"px",this.m_canvas.style.height=this.m_displayHeight+"px",null!=this.m_stage&&(this.m_stage.stageWidth=this.m_rcanvasWidth,this.m_stage.stageHeight=this.m_rcanvasHeight,this.m_stage.viewWidth=this.m_displayWidth,this.m_stage.viewHeight=this.m_displayHeight,this.m_stage.pixelRatio=i,this.m_stage.update()),null!=this.m_resizeCallback&&this.m_resizeCallback())}getStage(){return this.m_stage}getStageWidth(){return this.m_stage.stageWidth}getStageHeight(){return this.m_stage.stageHeight}getDisplayWidth(){return this.m_displayWidth}getDisplayHeight(){return this.m_displayHeight}setViewport(t,e,i,s){this.m_viewPortRect.setTo(t,e,i,s)}setViewportSize(t,e){this.m_viewPortRect.setSize(t,e)}testViewPortChanged(t,e,i,s){return this.m_viewPortRect.testEqualWithParams(t,e,i,s)}getViewportX(){return this.m_viewPortRect.x}getViewportY(){return this.m_viewPortRect.y}getViewportWidth(){return this.m_viewPortRect.width}getViewportHeight(){return this.m_viewPortRect.height}getViewPortSize(){return this.m_viewPortRect}getFBOWidth(){return this.m_viewPortRect.width<a.default.MAX_RENDERBUFFER_SIZE?this.m_viewPortRect.width:a.default.MAX_RENDERBUFFER_SIZE}getFBOHeight(){return this.m_viewPortRect.height<a.default.MAX_RENDERBUFFER_SIZE?this.m_viewPortRect.height:a.default.MAX_RENDERBUFFER_SIZE}getRCanvasWidth(){return this.m_rcanvasWidth}getRCanvasHeight(){return this.m_rcanvasHeight}updateRenderBufferSize(){let t=this.m_div.getBoundingClientRect();this.m_canvas.style.width=Math.floor(t.width)+"px",this.m_canvas.style.height=Math.floor(t.height)+"px",t=this.m_div.getBoundingClientRect(),this.resizeBufferSize(t.width,t.height)}}e.default=o},"0c85":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("3b73"));class a{constructor(){this.m_singleDown=!1,this.m_mouseX=0,this.m_mouseY=0,this.m_mouseClickTime=0,this.dpr=1}initMobile(t,e,i){var s=null;try{void 0!=document&&(s=document)}catch(a){}if(null!=s){let t=this;if(e.addEventListener("touchstart",t=>{let e=t.targetTouches,s=0,r=0;if(e.length<2)s=0|this.dpr*t.targetTouches[0].pageX,r=0|this.dpr*t.targetTouches[0].pageY,i.mouseX=s,i.mouseY=i.stageHeight-r,i.mouseViewX=s,i.mouseViewY=r,this.m_singleDown=!0,this.m_mouseX=i.mouseX,this.m_mouseY=i.mouseY,this.m_mouseClickTime=Date.now(),i.mouseDown(1);else{let a=[];for(let i=0;i<e.length;++i)s=0|this.dpr*t.targetTouches[i].pageX,r=0|this.dpr*t.targetTouches[i].pageY,a.push({x:s,y:r});i.mouseMultiDown(a),this.m_singleDown=!1}t.preventDefault(),t.stopPropagation()},!1),e.addEventListener("touchend",t=>{this.m_singleDown=!1;let e=t.targetTouches,s=0,r=0;if(e.length<1)i.mouseUp(1),this.m_mouseClickTime=Date.now()-this.m_mouseClickTime,Math.abs(this.m_mouseX-i.mouseX)<2&&Math.abs(this.m_mouseY-i.mouseY)<2&&this.m_mouseClickTime<900&&(this.m_mouseX=i.mouseX,this.m_mouseY=i.mouseY,i.mouseClick());else{let a=[];for(let i=0;i<e.length;++i)s=0|this.dpr*t.targetTouches[i].pageX,r=0|this.dpr*t.targetTouches[i].pageY,a.push({x:s,y:r});i.mouseMultiUp(a)}t.preventDefault()},!1),e.addEventListener("touchcancel",e=>{t.m_singleDown=!1;e.targetTouches;i.mouseCancel(),e.preventDefault()},!1),e.addEventListener("touchmove",t=>{t.preventDefault();let e=t.targetTouches,s=0,r=0;if(this.m_singleDown&&(s=0|this.dpr*e[0].pageX,r=0|this.dpr*e[0].pageY,i.mouseViewX=s,i.mouseViewY=r,i.mouseX=s,i.mouseY=i.stageHeight-r,i.mouseMove()),e.length>1){let a=[];for(let i=0;i<e.length;++i)s=0|this.dpr*t.targetTouches[i].pageX,r=0|this.dpr*t.targetTouches[i].pageY,a.push({x:s,y:r});i.mouseMultiMove(a)}},{passive:!1},!1),r.default.IsIpadOS()){let t=document.createElement("meta");t.name="viewport",t.content="width=device-width,initial-scale=1.0,minimum-scale=1.0, maximum-scale=1.0, user-scalable=no",document.getElementsByTagName("head")[0].appendChild(t)}}}initialize(t,e,i){r.default.IsMobileWeb()||r.default.IsIpadOS()||this.initPC(t,e,i),this.initMobile(t,e,i)}initPC(t,e,i){var s=null;try{void 0!=document&&(s=document)}catch(r){}if(null!=s){if(void 0==t.onmousewheel&&void 0!=t.addEventListener){let e=function(t){t.wheelDeltaY=-t.detail,i.mouseWheel(t)};t.addEventListener("DOMMouseScroll",e,!1)}t.onmousewheel=t=>{t.preventDefault(),t.stopPropagation(),i.mouseWheel(t)},t.onmousedown=t=>{let s=e.getBoundingClientRect(),r=0|this.dpr*(t.clientX-s.left),a=0|this.dpr*(t.clientY-s.top);i.mouseX=r,i.mouseY=i.stageHeight-a,i.mouseViewX=r,i.mouseViewY=a,this.m_mouseX=i.mouseX,this.m_mouseY=i.mouseY,this.m_mouseClickTime=Date.now(),0==t.button?i.mouseDown(1):1==t.button?i.mouseMiddleDown():2==t.button&&i.mouseRightDown(1)},t.onmouseup=t=>{let s=e.getBoundingClientRect(),r=0|this.dpr*(t.clientX-s.left),a=0|this.dpr*(t.clientY-s.top);i.mouseX=r,i.mouseY=i.stageHeight-a,0==t.button?i.mouseUp(1):1==t.button?i.mouseMiddleUp():2==t.button&&i.mouseRightUp(1)},document.onmouseup=t=>{0==t.button?i.mouseWindowUp(1):1==t.button||2==t.button&&i.mouseWindowRightUp(1)},t.onmousemove=t=>{let s=e.getBoundingClientRect(),r=0|this.dpr*(t.clientX-s.left),a=0|this.dpr*(t.clientY-s.top);i.mouseX=r,i.mouseY=i.stageHeight-a,i.mouseViewX=r,i.mouseViewY=a,i.mouseMove()},t.onclick=t=>{let s=e.getBoundingClientRect(),r=0|this.dpr*(t.clientX-s.left),a=0|this.dpr*(t.clientY-s.top);i.mouseX=r,i.mouseY=i.stageHeight-a,i.mouseViewX=r,i.mouseViewY=a,this.m_mouseClickTime=Date.now()-this.m_mouseClickTime,Math.abs(this.m_mouseX-i.mouseX)<2&&Math.abs(this.m_mouseY-i.mouseY)<2&&this.m_mouseClickTime<900&&(this.m_mouseX=i.mouseX,this.m_mouseY=i.mouseY,0==t.button?i.mouseClick():2==t.button&&i.mouseRightClick())},t.ondblclick=t=>{let s=e.getBoundingClientRect(),r=0|this.dpr*(t.clientX-s.left),a=0|this.dpr*(t.clientY-s.top);i.mouseX=r,i.mouseY=i.stageHeight-a,i.mouseViewX=r,i.mouseViewY=a,0==t.button?i.mouseDoubleClick():t.button}}}}e.default=a},"0e01":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("baae")),a=s(i("29ef")),n=s(i("7499")),_=i("de9d");class l{constructor(){this.camera=null,this.stage=null,this.builder=null,this.vtxBuilder=null,this.uniformContext=null,this.shaderProgramBuilder=null}}e.RendererInstanceContextParam=l;class h{constructor(t){this.m_adapter=null,this.m_renderProxy=null,this.m_materialProxy=null,this.m_cameraNear=.1,this.m_cameraFar=5e3,this.m_cameraFov=45,this.m_rcuid=0,this.m_rcuid=t,this.m_renderProxy=new _.RenderProxy(t)}getRCUid(){return this.m_rcuid}getDiv(){return this.m_adapter.getDiv()}getCanvas(){return this.m_adapter.getCanvas()}getRenderAdapter(){return this.m_adapter}getRenderMaterialProxy(){return this.m_materialProxy}getRenderProxy(){return this.m_renderProxy}getTextureResTotal(){return this.m_renderProxy.Texture.getTextureResTotal()}getTextureAttachTotal(){return this.m_renderProxy.Texture.getAttachTotal()}getDevicePixelRatio(){return this.m_adapter.getDevicePixelRatio()}getStage3D(){return this.m_renderProxy.getStage3D()}getCamera(){return null!=this.m_renderProxy?this.m_renderProxy.getCamera():null}cameraLock(){this.m_renderProxy.cameraLock()}cameraUnlock(){this.m_renderProxy.cameraUnlock()}updateCamera(){null!=this.m_renderProxy&&this.m_renderProxy.updateCamera()}updateCameraDataFromCamera(t){null!=this.m_renderProxy&&this.m_renderProxy.updateCameraDataFromCamera(t)}lockRenderColorMask(){null!=this.m_renderProxy&&this.m_renderProxy.lockRenderColorMask()}unlockRendererColorMask(){null!=this.m_renderProxy&&this.m_renderProxy.unlockRenderState()}useGlobalRenderColorMask(t){null!=this.m_renderProxy&&(this.m_renderProxy.unlockRenderColorMask(),this.m_renderProxy.useRenderColorMask(t),this.m_renderProxy.lockRenderColorMask())}useGlobalRenderColorMaskByName(t){null!=this.m_renderProxy&&(this.m_renderProxy.unlockRenderColorMask(),this.m_renderProxy.useRenderColorMask(a.default.GetRenderColorMaskByName(t)),this.m_renderProxy.lockRenderColorMask())}getRenderColorMaskByName(t){return a.default.GetRenderColorMaskByName(t)}lockRenderState(){null!=this.m_renderProxy&&this.m_renderProxy.lockRenderState()}unlockRenderState(){null!=this.m_renderProxy&&this.m_renderProxy.unlockRenderState()}useGlobalRenderState(t){null!=this.m_renderProxy&&(this.m_renderProxy.unlockRenderState(),this.m_renderProxy.useRenderState(t),this.m_renderProxy.lockRenderState())}useGlobalRenderStateByName(t){null!=this.m_renderProxy&&(this.m_renderProxy.unlockRenderState(),this.m_renderProxy.useRenderState(a.default.GetRenderStateByName(t)),this.m_renderProxy.lockRenderState())}getRenderStateByName(t){return a.default.GetRenderStateByName(t)}lockMaterial(){null!=this.m_materialProxy&&this.m_materialProxy.lockMaterial()}unlockMaterial(){null!=this.m_materialProxy&&this.m_materialProxy.unlockMaterial()}isUnlockMaterial(){return this.m_materialProxy.isUnlockMatrial()}useGlobalMaterial(t,e=!1,i=!1){null!=this.m_materialProxy&&(this.m_materialProxy.unlockMaterial(),e?this.m_materialProxy.unlockTexture():this.m_materialProxy.lockTexture(),this.m_materialProxy.useGlobalMaterial(t,i),this.m_materialProxy.lockMaterial())}updateMaterialUniform(t){this.m_materialProxy.updateMaterialUniform(t)}clearBackBuffer(){this.m_renderProxy.clearBackBuffer()}setScissorRect(t,e,i,s){this.m_adapter.setScissorRect(t,e,i,s)}setScissorEnabled(t){this.m_adapter.setScissorEnabled(t)}setViewPort(t,e,i,s){this.m_renderProxy.setViewPort(t,e,i,s)}synFBOSizeWithViewport(){this.m_adapter.synFBOSizeWithViewport()}asynFBOSizeWithViewport(){this.m_adapter.asynFBOSizeWithViewport()}setFBOSizeFactorWithViewPort(t){this.m_adapter.setFBOSizeFactorWithViewPort(t)}createFBOAt(t,e,i,s,r=!1,a=!1,n=0){this.m_adapter.createFBOAt(t,e,i,s,r,a,n)}bindFBOAt(t,e){this.m_adapter.bindFBOAt(t,e)}setRenderToTexture(t,e=!1,i=!1,s=0){this.m_adapter.setRenderToTexture(t,e,i,s)}useFBO(t=!1,e=!1,i=!1){this.m_adapter.useFBO(t,e,i)}resetFBOAttachmentMask(t){this.m_adapter.resetFBOAttachmentMask(t)}setFBOAttachmentMaskAt(t,e){this.m_adapter.setFBOAttachmentMaskAt(t,e)}setRenderToBackBuffer(){null!=this.m_adapter&&(this.m_adapter.setRenderToBackBuffer(r.default.FRAMEBUFFER),this.m_renderProxy.rshader.resetRenderState(),this.m_materialProxy.renderBegin())}lockViewport(){this.m_adapter.lockViewport()}unlockViewport(){this.m_adapter.unlockViewport()}setClearDepth(t){this.m_adapter.setClearDepth(t)}getClearDepth(){return this.m_adapter.getClearDepth()}getViewportX(){return this.m_adapter.getViewportX()}getViewportY(){return this.m_adapter.getViewportY()}getViewportWidth(){return this.m_adapter.getViewportWidth()}getViewportHeight(){return this.m_adapter.getViewportHeight()}setContextViewSize(t,e){this.m_adapter.setContextViewSize(t,e)}setCameraParam(t,e,i){this.m_cameraFov=t,this.m_cameraNear=e,this.m_cameraFar=i,null!=this.m_renderProxy&&this.m_renderProxy.setCameraParam(t,e,i)}initialize(t,e,i){if(null==this.m_adapter){this.m_renderProxy.setCameraParam(this.m_cameraFov,this.m_cameraNear,this.m_cameraFar),this.m_renderProxy.setWebGLMaxVersion(t.maxWebGLVersion);let s=new _.RenderProxyParam;s.uniformContext=i.uniformContext,s.vtxBufUpdater=i.builder,s.materialUpdater=i.builder,s.vtxBuilder=i.vtxBuilder,this.m_renderProxy.initialize(t,e,i.stage,s),this.m_rcuid=this.m_renderProxy.getRCUid(),i.vtxBuilder.initialize(this.m_rcuid,this.m_renderProxy.getRC(),this.m_renderProxy.getGLVersion()),this.m_adapter=this.m_renderProxy.getRenderAdapter();let r=this.m_renderProxy.getContext();r.setViewport(0,0,r.getRCanvasWidth(),r.getRCanvasHeight())}}initManager(t){null==this.m_materialProxy&&(this.m_materialProxy=new n.default,this.m_materialProxy.setDispBuilder(t))}setClearRGBColor3f(t,e,i){this.m_renderProxy.setClearRGBColor3f(t,e,i)}setClearRGBAColor4f(t,e,i,s){this.m_renderProxy.setClearRGBAColor4f(t,e,i,s)}getClearRGBAColor4f(t){t.fromArray4(this.m_adapter.bgColor)}updateRenderBufferSize(){this.m_adapter.updateRenderBufferSize()}vertexRenderBegin(){this.m_renderProxy.Vertex.renderBegin()}renderBegin(t=!0){null!=this.m_adapter&&(this.m_adapter.unlockViewport(),this.m_adapter.setClearDepth(1),this.m_renderProxy.Vertex.renderBegin(),this.m_materialProxy.renderBegin(),this.m_adapter.update(),this.m_adapter.setClearMaskClearAll(),this.m_adapter.renderBegin(),this.m_renderProxy.status.reset(),a.default.Reset(this.m_renderProxy.getRenderContext()),t&&(this.m_renderProxy.useCameraData(),this.m_renderProxy.updateCameraDataFromCamera(this.m_renderProxy.getCamera())))}resetState(){a.default.ResetState(),this.m_materialProxy.renderBegin()}resetmaterial(){this.m_materialProxy.renderBegin()}resetUniform(){this.m_materialProxy.resetUniform()}runEnd(){}}e.RendererInstanceContext=h,e.default=h},"11e6":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{static AddContainerFlag(t){return 2147483648|t}static RemoveContainerFlag(t){return-2147483649&t}static AddSpaceUid(t,e){return-1048576&t|e}static RemoveSpaceUid(t){return-1048576&t}static GetSpaceUid(t){return 1048575&t}static AddRendererUid(t,e){return-133169153&t|e<<20}static RemoveRendererUid(t){return 133169152|t}static GetRendererUid(t){return t=(133169152&t)>>20,t<127?t:-1}static TestRendererUid(t){return t=(133169152&t)>>20,t<127}static AddSortEnabled(t){return 1073741824|t}static RemoveSortEnabled(t){return-1073741825&t}static TestSortEnabled(t){return 1073741824==(1073741824&t)}static AddRendererLoad(t){return 805306368|t}static RemoveRendererLoad(t){return-805306369&t}static TestSpaceContains(t){return(1048575&t)>0}static TestSpaceEnabled(t){return(1048575&t)<1}static TestSpaceEnabled2(t){return(1048575&t)<1&&2147483648!=(2147483648&t)}static TestContainerEnabled(t){return 133169152==(133169152&t)&&2147483648!=(2147483648&t)}static TestRendererEnabled(t){return 133169152==(938475520&t)&&2147483648!=(2147483648&t)}}s.DEFAULT=133169152,s.CONTAINER_FLAG=2147483648,s.CONTAINER_NOT_FLAG=-2147483649,s.SPACE_FLAG=1048575,s.SPACE_NOT_FLAG=-1048576,s.RENDERER_UID_FLAG=133169152,s.RENDERER_UID_NOT_FLAG=-133169153,s.RENDERER_UID_INVALID=127,s.SORT_FLAG=1073741824,s.SORT_NOT_FLAG=-1073741825,s.RENDERER_LOAD_FLAG=805306368,s.RENDERER_LOAD_NOT_FLAG=-805306369,s.RENDERER_ADN_LOAD_FLAG=938475520,e.default=s},1216:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("baae")),a=s(i("722e")),n=s(i("8333")),_=s(i("6d49")),l=i("e08e"),h=s(i("ffc0")),o=s(i("1f61")),d=i("070b"),u=i("a5ba"),m=s(i("29ef")),c=s(i("e2fe"));class f{constructor(t,e){this.m_rcuid=0,this.m_texResource=null,this.m_gl=null,this.m_fontFaceFlipped=!1,this.m_colorMask={mr:!0,mg:!0,mb:!0,ma:!0},this.m_rcontext=null,this.m_clearMask=0,this.m_fboBuf=null,this.m_fboIndex=0,this.m_fboType=r.default.FRAMEBUFFER,this.m_fboBufList=[null,null,null,null,null,null,null,null],this.m_fboClearBoo=!0,this.m_fboViewportRectBoo=!1,this.m_polygonOffsetFlag=!1,this.m_polygonOffset=!1,this.m_clearDepth=1,this.m_preDepth=0,this.m_viewPortRect=new c.default(0,0,800,600),this.m_fboViewportRect=new c.default(0,0,800,600),this.m_fboSizeFactor=1,this.m_clearStencil=0,this.m_fboBiltRectData=new Uint16Array(8),this.m_fboViewportRectData=new Uint16Array(4),this.m_activeAttachmentTotal=1,this.m_scissorEnabled=!1,this.m_rState=null,this.m_webglVer=2,this.bgColor=new Float32Array([0,0,0,1]),this.uViewProbe=null,this.m_devPRatio=1,this.m_viewportUnlock=!0,this.m_synFBOSizeWithViewport=!1,this.m_texResource=e,this.m_rcuid=t}initialize(t,e,i,s){if(null==this.m_rcontext&&(this.m_webglVer=t.getWebGLVersion(),this.m_rState=i,this.m_rcontext=t,this.m_gl=t.getRC(),this.m_gl.disable(this.m_gl.SCISSOR_TEST),t.isDepthTestEnabled()?this.m_gl.enable(this.m_gl.DEPTH_TEST):this.m_gl.disable(this.m_gl.DEPTH_TEST),t.isStencilTestEnabled()?this.m_gl.enable(this.m_gl.STENCIL_TEST):this.m_gl.disable(this.m_gl.STENCIL_TEST),e.getPolygonOffsetEanbled()?this.enabledPolygonOffset():this.disabledPolygonOffset(),this.m_gl.enable(this.m_gl.CULL_FACE),this.m_gl.cullFace(this.m_gl.BACK),this.m_gl.enable(this.m_gl.BLEND),e.getDitherEanbled()?this.m_gl.enable(this.m_gl.DITHER):this.m_gl.disable(this.m_gl.DITHER),this.m_gl.frontFace(this.m_gl.CCW),this.m_clearMask=this.m_gl.COLOR_BUFFER_BIT|this.m_gl.DEPTH_BUFFER_BIT|this.m_gl.STENCIL_BUFFER_BIT,null==this.uViewProbe)){let t=this.m_viewPortRect,e=this;e.uViewProbe=s,this.uViewProbe.setVec4DataWithArr4([t.x,t.y,t.width,t.height])}}setFrontFaceFlipped(t){this.m_fontFaceFlipped!=t&&(t?this.m_gl.frontFace(this.m_gl.CW):this.m_gl.frontFace(this.m_gl.CCW),this.m_fontFaceFlipped=t)}enabledPolygonOffset(){this.m_polygonOffset||(this.m_polygonOffset=!0,this.m_gl.enable(this.m_gl.POLYGON_OFFSET_FILL))}disabledPolygonOffset(){this.m_polygonOffset&&(this.m_polygonOffset=!1,this.m_gl.disable(this.m_gl.POLYGON_OFFSET_FILL))}setPolygonOffset(t,e=0){this.m_gl.polygonOffset(t,e),this.m_polygonOffsetFlag=!0}resetPolygonOffset(){this.m_polygonOffsetFlag&&(this.m_gl.polygonOffset(0,0),this.m_polygonOffsetFlag=!1)}getDiv(){return this.m_rcontext.getDiv()}getCanvas(){return this.m_rcontext.getCanvas()}setClearDepth(t){this.m_clearDepth=t}getClearDepth(){return this.m_clearDepth}setContextViewSize(t,e){this.m_rcontext.autoSyncRenderBufferAndWindowSize=!1,this.m_rcontext.resizeBufferSize(t,e)}getViewportX(){return this.m_rcontext.getViewportX()}getViewportY(){return this.m_rcontext.getViewportY()}getViewportWidth(){return this.m_rcontext.getViewportWidth()}getViewportHeight(){return this.m_rcontext.getViewportHeight()}getFBOFitWidth(){return this.m_rcontext.getFBOWidth()}getFBOFitHeight(){return this.m_rcontext.getFBOHeight()}getRCanvasWidth(){return this.m_rcontext.getRCanvasWidth()}getRCanvasHeight(){return this.m_rcontext.getRCanvasHeight()}setColorMask(t,e,i,s){this.m_colorMask.mr=t,this.m_colorMask.mg=e,this.m_colorMask.mb=i,this.m_colorMask.ma=s}setClearMaskClearAll(){this.m_clearMask=this.m_gl.COLOR_BUFFER_BIT|this.m_gl.DEPTH_BUFFER_BIT|this.m_gl.STENCIL_BUFFER_BIT}setClearMaskClearOnlyColor(){this.m_clearMask=this.m_gl.COLOR_BUFFER_BIT}setClearMaskClearOnlyDepthAndStencil(){this.m_clearMask=this.m_gl.DEPTH_BUFFER_BIT|this.m_gl.STENCIL_BUFFER_BIT}setScissorRect(t,e,i,s){this.m_scissorEnabled&&this.m_gl.scissor(t,e,i,s)}setScissorEnabled(t){t?this.m_scissorEnabled||(this.m_scissorEnabled=!0,this.m_gl.enable(this.m_gl.SCISSOR_TEST)):this.m_scissorEnabled&&(this.m_scissorEnabled=!1,this.m_gl.disable(this.m_gl.SCISSOR_TEST))}clearDepth(t=1){let e=this.m_rState.getDepthTestMode();this.m_rState.setDepthTestMode(l.DepthTestMode.OPAQUE),this.m_clearDepth=t,this.m_preDepth!==this.m_clearDepth&&(this.m_preDepth=this.m_clearDepth,this.m_gl.clearDepth(this.m_clearDepth)),this.m_gl.clear(this.m_gl.DEPTH_BUFFER_BIT),this.m_rState.setDepthTestMode(e)}clearColor(t){this.m_gl.clearColor(t.r,t.g,t.b,t.a),this.m_gl.clear(this.m_gl.COLOR_BUFFER_BIT)}clear(){this.m_preDepth!==this.m_clearDepth&&(this.m_preDepth=this.m_clearDepth,this.m_gl.clearDepth(this.m_clearDepth)),this.m_rcontext.isStencilTestEnabled()&&this.m_gl.clearStencil(this.m_clearStencil);let t=this.bgColor;this.m_gl.clearColor(t[0],t[1],t[2],t[3]),this.m_gl.clear(this.m_clearMask)}reset(){this.m_rState.setCullFaceMode(l.CullFaceMode.BACK),this.m_rState.setDepthTestMode(l.DepthTestMode.OPAQUE),m.default.Reset(this.m_rcontext)}getRenderContext(){return this.m_rcontext}renderBegin(){null!=this.m_rcontext&&(this.m_fboSizeFactor=1,this.reseizeViewPort(),u.RenderStateObject.Unlock(),u.RenderStateObject.UseRenderState(m.default.NORMAL_STATE),d.RenderColorMask.Unlock(),d.RenderColorMask.UseRenderState(d.RenderColorMask.ALL_TRUE_COLOR_MASK),this.clear())}updateViewPort(){let t=this.m_viewPortRect;this.uViewProbe.setVec4Data(t.x,t.y,t.width,t.height),this.uViewProbe.update(),this.m_gl.viewport(t.x,t.y,t.width,t.height)}checkViewPort(t){let e=this.m_viewPortRect,i=this.m_rcontext.getDevicePixelRatio(),s=e.testEqual(t);s=s||Math.abs(this.m_devPRatio-i)>.01,s&&(this.m_devPRatio=i,e.copyFrom(t),this.updateViewPort())}reseizeViewPort(){this.m_viewportUnlock&&this.checkViewPort(this.m_rcontext.getViewPortSize())}reseizeFBOViewPort(){this.m_viewportUnlock&&this.checkViewPort(this.m_fboViewportRect)}setViewProbeValue(t,e,i,s){this.uViewProbe.setVec4Data(t,e,i,s),this.uViewProbe.update()}lockViewport(){this.m_viewportUnlock=!1}unlockViewport(){this.m_viewportUnlock=!0}renderEnd(){}update(){}updateRenderBufferSize(){this.m_rcontext.updateRenderBufferSize()}destroy(){this.m_rcontext=null,this.m_rState=null}getDevicePixelRatio(){return this.m_rcontext.getDevicePixelRatio()}loseContext(){this.m_rcontext.loseContext()}isContextLost(){return this.m_rcontext.isContextLost()}readPixels(t,e,i,s,r,a,n){this.m_gl.readPixels(t,e,i,s,h.default.ToGL(this.m_gl,r),o.default.ToGL(this.m_gl,a),n)}setFBOViewportRect(t,e,i,s){this.m_fboViewportRectData[0]=t,this.m_fboViewportRectData[1]=e,this.m_fboViewportRectData[2]=i,this.m_fboViewportRectData[3]=s,this.m_fboViewportRectBoo=!0}createFBOAt(t,e,i,s,r=!1,a=!1,n=0){null==this.m_fboBufList[t]&&(t>7&&(t=7),this.m_fboType=e,this.m_fboBuf=new _.default(this.m_rcuid,this.m_texResource,this.m_fboType),this.m_fboBuf.multisampleEnabled=n>0,this.m_fboBuf.multisampleLevel=n,this.m_fboBuf.writeDepthEnabled=r,this.m_fboBuf.writeStencilEnabled=a,this.m_fboBuf.initialize(this.m_gl,i,s),this.m_fboBufList[t]=this.m_fboBuf,this.m_fboBuf.sizeFixed=!0)}resizeFBOAt(t,e,i){t>7?t=7:t<0&&(t=0),null!=this.m_fboBufList[t]&&this.m_fboBufList[t].resize(e,i)}getFBOWidthAt(t){return null!=this.m_fboBufList[t]?this.m_fboBufList[t].getWidth():0}getFBOHeightAt(t){return null!=this.m_fboBufList[t]?this.m_fboBufList[t].getHeight():0}synFBOSizeWithViewport(){this.m_synFBOSizeWithViewport=!0}asynFBOSizeWithViewport(){this.m_synFBOSizeWithViewport=!1}setFBOSizeFactorWithViewPort(t){this.m_fboSizeFactor=t}bindFBOAt(t,e){if(t>7?t=7:t<0&&(t=0),this.m_fboBuf=this.m_fboBufList[t],null==this.m_fboBuf)throw Error("Fatal Error!!! this.m_fboBuf == null.");this.m_fboIndex=t,this.m_fboType=e,this.m_fboBuf.bind(e),this.m_fboClearBoo=!0}clearFBODepthAt(t,e=1){let i=this.m_fboBufList[t];null!=i&&i.clearOnlyDepth(e)}resetFBOAttachmentMask(t){null!=this.m_fboBuf&&this.m_fboBuf.resetAttachmentMask(t)}setFBOAttachmentMaskAt(t,e){null!=this.m_fboBuf&&this.m_fboBuf.setAttachmentMaskAt(t,e)}getFBOAttachmentTotal(){return null!=this.m_fboBuf?this.m_fboBuf.getAttachmentTotal():0}setRenderToTexture(t,e=!1,i=!1,s=0){(s<0||s>=8)&&(s=0),null==t&&0==s?this.setRenderToBackBuffer(r.default.FRAMEBUFFER):(0==s&&(null!=this.m_fboBuf&&(this.m_synFBOSizeWithViewport?this.m_fboBuf.initialize(this.m_gl,Math.floor(this.m_rcontext.getFBOWidth()*this.m_fboSizeFactor),Math.floor(this.m_rcontext.getFBOHeight()*this.m_fboSizeFactor)):this.m_fboViewportRectBoo?this.m_fboBuf.initialize(this.m_gl,this.m_fboViewportRectData[2],this.m_fboViewportRectData[3]):this.m_fboBuf.sizeFixed||this.m_fboBuf.initialize(this.m_gl,t.getWidth(),t.getHeight())),this.m_fboIndex>=0&&null==this.m_fboBuf&&(this.m_fboBuf=new _.default(this.m_rcuid,this.m_texResource,this.m_fboType),this.m_fboBufList[this.m_fboIndex]=this.m_fboBuf,this.m_fboBuf.writeDepthEnabled=e,this.m_fboBuf.writeStencilEnabled=i,this.m_synFBOSizeWithViewport?this.m_fboBuf.initialize(this.m_gl,Math.floor(this.m_rcontext.getFBOWidth()*this.m_fboSizeFactor),Math.floor(this.m_rcontext.getFBOHeight()*this.m_fboSizeFactor)):this.m_fboViewportRectBoo?this.m_fboBuf.initialize(this.m_gl,this.m_fboViewportRectData[2],this.m_fboViewportRectData[3]):this.m_fboBuf.initialize(this.m_gl,t.getWidth(),t.getHeight()))),null!=this.m_fboBuf&&this.m_fboBuf.renderToTexAt(this.m_gl,t,s),this.m_fboClearBoo=!0)}getActiveAttachmentTotal(){return this.m_activeAttachmentTotal}getAttachmentTotal(){return this.m_activeAttachmentTotal}useFBO(t=!1,e=!1,i=!1){if(null!=this.m_fboBuf&&this.m_fboClearBoo){this.m_fboClearBoo=!1,this.m_fboBuf.use(this.m_gl),this.m_activeAttachmentTotal=this.m_fboBuf.getActiveAttachmentTotal(),t&&this.m_fboBuf.clearOnlyColor(this.bgColor),this.m_fboBuf.writeDepthEnabled?this.m_fboBuf.writeStencilEnabled?e&&i?this.m_fboBuf.clearOnlyDepthAndStencil(this.m_clearDepth,4294967295):e?this.m_fboBuf.clearOnlyDepth(this.m_clearDepth):i&&this.m_fboBuf.clearOnlyStencil(255):e&&this.m_fboBuf.clearOnlyDepth(this.m_clearDepth):i&&this.m_fboBuf.writeStencilEnabled&&this.m_fboBuf.clearOnlyStencil(255),1==this.m_webglVer&&this.m_gl.clear(this.m_clearMask);let s=this.m_viewPortRect;this.m_fboBiltRectData[4]=this.m_fboBiltRectData[0]=s.x,this.m_fboBiltRectData[5]=this.m_fboBiltRectData[1]=s.y,this.m_fboBiltRectData[6]=this.m_fboBiltRectData[2]=s.getRight(),this.m_fboBiltRectData[7]=this.m_fboBiltRectData[3]=s.getTop(),this.m_fboViewportRectBoo?(this.m_fboViewportRectBoo=!1,this.m_fboViewportRect.setTo(this.m_fboViewportRectData[0],this.m_fboViewportRectData[1],this.m_fboViewportRectData[2],this.m_fboViewportRectData[3]),this.reseizeFBOViewPort()):(this.m_synFBOSizeWithViewport?this.m_fboViewportRect.setTo(0,0,Math.floor(this.m_rcontext.getFBOWidth()*this.m_fboSizeFactor),Math.floor(this.m_rcontext.getFBOHeight()*this.m_fboSizeFactor)):(this.m_fboBuf.isSizeChanged()&&this.m_fboBuf.initialize(this.m_gl,this.m_fboBuf.getWidth(),this.m_fboBuf.getHeight()),this.m_fboViewportRect.setTo(0,0,this.m_fboBuf.getWidth(),this.m_fboBuf.getHeight())),this.reseizeFBOViewPort())}}setRenderToBackBuffer(t=r.default.FRAMEBUFFER){this.m_activeAttachmentTotal=1,_.default.BindToBackbuffer(this.m_gl,t),this.reseizeViewPort()}bindFBOToDraw(){null!=this.m_fboBuf&&this.m_fboBuf.bind(r.default.DRAW_FRAMEBUFFER)}bindFBOToWrite(){null!=this.m_fboBuf&&this.m_fboBuf.bind(r.default.READ_FRAMEBUFFER)}setBlitFboSrcRect(t,e,i,s){this.m_fboBiltRectData[0]=t,this.m_fboBiltRectData[1]=e,this.m_fboBiltRectData[2]=t+i,this.m_fboBiltRectData[3]=e+s}setBlitFboDstRect(t,e,i,s){this.m_fboBiltRectData[4]=t,this.m_fboBiltRectData[5]=e,this.m_fboBiltRectData[6]=t+i,this.m_fboBiltRectData[7]=e+s}blitFBO(t=0,e=0,i=n.default.COLOR_BUFFER_BIT,s=a.default.NEAREST,l=0,h=0,o=null){t>7&&(t=7),e>7&&(e=7),t>=0&&null!=this.m_fboBufList[t]?this.m_fboBufList[t].bind(r.default.READ_FRAMEBUFFER):_.default.BindToBackbuffer(this.m_gl,r.default.READ_FRAMEBUFFER),e>=0&&null!=this.m_fboBufList[e]?this.m_fboBufList[e].bind(r.default.DRAW_FRAMEBUFFER):_.default.BindToBackbuffer(this.m_gl,r.default.DRAW_FRAMEBUFFER),l>0&&(h<0&&(h=0),null==o&&(o=[0,0,0,1]),this.m_gl.clearBufferfv(l,h,o));let d=this.m_fboBiltRectData;this.m_gl.blitFramebuffer(d[0],d[1],d[2],d[3],d[4],d[5],d[6],d[7],i,s)}}e.default=f},1264:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("11e6")),a=i("e08e"),n=i("eca0");class _{constructor(t,e,i,s){this.m_rpoUnitBuilder=null,this.m_dataBuilder=null,this.m_processBuider=null,this.m_waitList=[],this.m_processUidList=[],this.m_rendererUid=-1,this.m_existencetotal=0,this.m_rprocess=null,this.m_entityManaListener=null,this.version=0,this.m_rendererUid=t,this.m_dataBuilder=e,this.m_rpoUnitBuilder=i,this.m_processBuider=s}setListener(t){this.m_entityManaListener=t}isEmpty(){return this.m_existencetotal<1}isHaveEntity(){return this.m_existencetotal>0}removeEntity(t){this.m_existencetotal--;let e=t.getDisplay();if(null!=e&&null!=e.__$$runit){let t=e.__$ruid,i=this.m_rpoUnitBuilder.getRCRPObj(t);if(null!=i){if(i.count>0)if(i.count<2)i.rprocessUid>-1&&(this.m_rprocess=this.m_processBuider.getNodeByUid(i.rprocessUid),this.m_rprocess.removeDisp(e),i.rprocessUid=-1);else{let t=n.RCRPObj.RenerProcessMaxTotal;for(let s=0;s<t;++s)(i.idsFlag&1<<s)>0&&(this.m_rprocess=this.m_processBuider.getNodeByUid(s),this.m_rprocess.removeDisp(e))}}else this.m_rprocess=this.m_processBuider.getNodeByUid(e.__$$runit.getRPROUid()),this.m_rprocess.removeDisp(e);0==i.count&&(e.__$$rsign,a.DisplayRenderSign.LIVE_IN_RENDERER,e.__$$rsign=a.DisplayRenderSign.NOT_IN_RENDERER,this.m_rpoUnitBuilder.restoreByUid(t)),this.version++}t.__$rseFlag=r.default.RemoveRendererUid(t.__$rseFlag),t.__$rseFlag=r.default.RemoveRendererLoad(t.__$rseFlag),t.__$rseFlag=r.default.RemoveSortEnabled(t.__$rseFlag),null!=this.m_entityManaListener&&this.m_entityManaListener.removeFromRenderer(t,this.m_rendererUid,-1)}addEntity(t,e,i=!1){if(null!=t){let s=t.getDisplay();if(null!=s){if(s.__$$rsign==a.DisplayRenderSign.LIVE_IN_RENDERER&&!this.m_rpoUnitBuilder.testRPNodeNotExists(s.__$ruid,e))return;this.m_rprocess=this.m_processBuider.getNodeByUid(e),t.__$rseFlag=this.m_rprocess.getSortEnabled()?r.default.AddSortEnabled(t.__$rseFlag):r.default.RemoveSortEnabled(t.__$rseFlag),i?(s.__$$rsign==a.DisplayRenderSign.NOT_IN_RENDERER&&(s.__$$rsign=a.DisplayRenderSign.GO_TO_RENDERER),t.__$rseFlag=r.default.AddRendererLoad(t.__$rseFlag),t.__$rseFlag=r.default.AddRendererUid(t.__$rseFlag,this.m_rendererUid),this.m_waitList.push(t),this.m_processUidList.push(e)):this.testValidData(t)?this.ensureAdd(t,s,e):(s.__$$rsign==a.DisplayRenderSign.NOT_IN_RENDERER&&(s.__$$rsign=a.DisplayRenderSign.GO_TO_RENDERER),t.__$rseFlag=r.default.AddRendererLoad(t.__$rseFlag),this.m_waitList.push(t),this.m_processUidList.push(e))}else t.__$rseFlag=r.default.AddRendererUid(t.__$rseFlag,this.m_rendererUid)}return!1}testValidData(t){if(null!=t.getMaterial()&&t.hasMesh()){if(t.getMaterial().hasShaderData())return!0;null!=t.getMaterial().getCodeBuf()&&t.activeDisplay()}return!1}ensureAdd(t,e,i){t.update(),t.__$rseFlag=r.default.AddRendererUid(t.__$rseFlag,this.m_rendererUid),t.__$rseFlag=r.default.RemoveRendererLoad(t.__$rseFlag),t.__$setRenderProxy(this.m_dataBuilder.getRenderProxy()),this.m_existencetotal++,e.__$$rsign==a.DisplayRenderSign.NOT_IN_RENDERER&&(e.__$$rsign=a.DisplayRenderSign.GO_TO_RENDERER),this.m_rprocess=this.m_processBuider.getNodeByUid(i),(e.__$ruid>-1||this.m_dataBuilder.buildGpuDisp(e))&&this.m_rprocess.addDisp(e),null!=this.m_entityManaListener&&this.m_entityManaListener.addToRenderer(t,this.m_rendererUid,i),null!=t.getGlobalBounds()&&(e.__$$runit.bounds=t.getGlobalBounds(),e.__$$runit.pos=e.__$$runit.bounds.center),this.version++}updateWaitList(){let t=this.m_waitList.length,e=null,i=null;for(let s=0;s<t;++s)if(e=this.m_waitList[s],(r.default.RENDERER_LOAD_FLAG&e.__$rseFlag)==r.default.RENDERER_LOAD_FLAG){if(this.testValidData(e)){if(i=e.getDisplay(),i.__$$rsign==a.DisplayRenderSign.LIVE_IN_RENDERER&&!this.m_rpoUnitBuilder.testRPNodeNotExists(i.__$ruid,this.m_processUidList[s])){this.m_waitList.splice(s,1),this.m_processUidList.splice(s,1),--t,--s;continue}this.ensureAdd(e,i,this.m_processUidList[s]),this.m_waitList.splice(s,1),this.m_processUidList.splice(s,1),--t,--s}}else i=e.getDisplay(),null!=i&&i.__$$rsign==a.DisplayRenderSign.GO_TO_RENDERER&&(i.__$$rsign=a.DisplayRenderSign.NOT_IN_RENDERER),e.__$rseFlag=r.default.RemoveRendererLoad(e.__$rseFlag),e.__$rseFlag=r.default.RemoveRendererUid(e.__$rseFlag),e.__$rseFlag=r.default.RemoveSortEnabled(e.__$rseFlag),this.m_waitList.splice(s,1),this.m_processUidList.splice(s,1),--t,--s,null!=this.m_entityManaListener&&this.m_entityManaListener.removeFromRenderer(e,this.m_rendererUid,-1)}update(){this.m_waitList.length>0&&this.updateWaitList(),this.m_dataBuilder.update()}}e.default=_},"1e15":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8a0a")),a=s(i("030e"));class n{constructor(){this.m_rcuid=0,this.m_glVer=2,this.m_rc=null,this.RGBA=0,this.UNSIGNED_BYTE=0,this.TRIANGLE_STRIP=0,this.TRIANGLE_FAN=0,this.TRIANGLES=0,this.LINES=0,this.LINE_STRIP=0,this.UNSIGNED_SHORT=0,this.UNSIGNED_INT=0,this.COLOR=0,this.DEPTH=0,this.STENCIL=0,this.DEPTH_STENCIL=0,this.MAX=0,this.MIN=0,this.RContext=null,this.vroUid=0,this.rioUid=0}getRC(){return this.m_rc}getRCUid(){return this.m_rcuid}createBuf(){return this.m_rc.createBuffer()}deleteBuf(t){this.m_rc.deleteBuffer(t)}bindArrBuf(t){this.m_rc.bindBuffer(this.m_rc.ARRAY_BUFFER,t)}bindEleBuf(t){this.m_rc.bindBuffer(this.m_rc.ELEMENT_ARRAY_BUFFER,t)}arrBufSubData(t,e){this.m_rc.bufferSubData(this.m_rc.ARRAY_BUFFER,e,t)}arrBufData(t,e){this.m_rc.bufferData(this.m_rc.ARRAY_BUFFER,t,r.default.ToGL(this.m_rc,e))}eleBufSubData(t,e){this.m_rc.bufferSubData(this.m_rc.ELEMENT_ARRAY_BUFFER,e,t)}eleBufData(t,e){this.m_rc.bufferData(this.m_rc.ELEMENT_ARRAY_BUFFER,t,r.default.ToGL(this.m_rc,e))}arrBufDataMem(t,e){this.m_rc.bufferData(this.m_rc.ARRAY_BUFFER,t,r.default.ToGL(this.m_rc,e))}eleBufDataMem(t,e){this.m_rc.bufferData(this.m_rc.ELEMENT_ARRAY_BUFFER,t,r.default.ToGL(this.m_rc,e))}useVtxAttribsPtrTypeFloat(t,e,i,s,r,a){this.m_rc.bindBuffer(this.m_rc.ARRAY_BUFFER,e);for(let n=0;n<s;++n)t.vertexAttribPointerTypeFloat(i[n],a,r[n])}useVtxAttribsPtrTypeFloatMulti(t,e,i,s,r,a){for(let n=0;n<s;++n)this.m_rc.bindBuffer(this.m_rc.ARRAY_BUFFER,e[n]),t.vertexAttribPointerTypeFloat(i[n],a,r[n])}createVertexArray(){let t=null;return t=2==this.m_glVer?this.m_rc.createVertexArray():a.default.OES_vertex_array_object.createVertexArrayOES(),t}bindVertexArray(t){return 2==this.m_glVer?this.m_rc.bindVertexArray(t):a.default.OES_vertex_array_object.bindVertexArrayOES(t),t}deleteVertexArray(t){2==this.m_glVer?this.m_rc.deleteVertexArray(t):a.default.OES_vertex_array_object.deleteVertexArrayOES(t)}testVROUid(t){return this.vroUid!=t&&(this.vroUid=t,!0)}testRIOUid(t){return this.rioUid!=t&&(this.rioUid=t,!0)}initialize(t,e,i){this.m_rc=e,this.m_rcuid=t,this.m_glVer=i;let s=this;s.RGBA=e.RGBA,s.UNSIGNED_BYTE=e.UNSIGNED_BYTE,s.TRIANGLE_STRIP=e.TRIANGLE_STRIP,s.TRIANGLE_FAN=e.TRIANGLE_FAN,s.TRIANGLES=e.TRIANGLES,s.LINES=this.m_rc.LINES,s.LINE_STRIP=e.LINE_STRIP,s.UNSIGNED_SHORT=e.UNSIGNED_SHORT,s.UNSIGNED_INT=e.UNSIGNED_INT,s.COLOR=e.COLOR,s.DEPTH=e.DEPTH,s.STENCIL=e.STENCIL,s.DEPTH_STENCIL=e.DEPTH_STENCIL,this.m_glVer>1?(s.MIN=e.MIN,s.MAX=e.MAX):(s.MIN=a.default.EXT_blend_minmax.MIN_EXT,s.MAX=a.default.EXT_blend_minmax.MAX_EXT),s.RContext=e}renderBegin(){this.vroUid=-2,this.rioUid=-3}}e.default=n},"1eb2":function(t,e,i){"use strict";if("undefined"!==typeof window){var s=window.document.currentScript,r=i("8875");s=r(),"currentScript"in document||Object.defineProperty(document,"currentScript",{get:r});var a=s&&s.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);a&&(i.p=a[1])}},"1f61":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("030e"));class a{static ToGL(t,e){switch(e){case a.UNSIGNED_BYTE:return t.UNSIGNED_BYTE;case a.BYTE:return t.BYTE;case a.FLOAT:return t.FLOAT;case a.HALF_FLOAT:return t.HALF_FLOAT;case a.HALF_FLOAT_OES:return null!=r.default.OES_texture_half_float?r.default.OES_texture_half_float.HALF_FLOAT_OES:t.FLOAT;case a.UNSIGNED_SHORT:return t.UNSIGNED_SHORT;case a.UNSIGNED_INT:return t.UNSIGNED_INT;case a.UNSIGNED_SHORT_5_6_5:return t.UNSIGNED_SHORT_5_6_5;case a.UNSIGNED_SHORT_4_4_4_4:return t.UNSIGNED_SHORT_4_4_4_4;case a.UNSIGNED_SHORT_5_5_5_1:return t.UNSIGNED_SHORT_5_5_5_1;case a.UNSIGNED_INT_24_8_WEBGL:return r.default.WEBGL_depth_texture.UNSIGNED_INT_24_8_WEBGL;default:break}return t.UNSIGNED_BYTE}}a.UNSIGNED_BYTE=1108,a.UNSIGNED_SHORT=1109,a.UNSIGNED_INT=1110,a.BYTE=1111,a.FLOAT=1211,a.HALF_FLOAT=1212,a.HALF_FLOAT_OES=1213,a.UNSIGNED_SHORT_5_6_5=1214,a.UNSIGNED_SHORT_4_4_4_4=1215,a.UNSIGNED_SHORT_5_5_5_1=1216,a.UNSIGNED_INT_24_8_WEBGL=1217,e.default=a},2560:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("ab73"));class a{create(t,e){let i=t.getCamera();return e.hasUniformByName(r.default.CameraViewMatUNS)&&e.hasUniformByName(r.default.CameraProjectiveMatUNS)?t.uniformContext.createShaderGlobalUniformFromProbe(i.matUProbe,"u_viewAndProjMat",[r.default.CameraViewMatUNS,r.default.CameraProjectiveMatUNS]):e.hasUniformByName(r.default.CameraViewMatUNS)?t.uniformContext.createShaderGlobalUniformFromProbeAt(i.matUProbe,"u_viewMat",[r.default.CameraViewMatUNS],0):e.hasUniformByName(r.default.CameraProjectiveMatUNS)?t.uniformContext.createShaderGlobalUniformFromProbeAt(i.matUProbe,"u_projMat",[r.default.CameraProjectiveMatUNS],1):null}getIDNS(){return"CameraUniformBuilder"}}e.default=a},"264c":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(t){this.m_begin=null,this.m_end=null,this.m_next=null,this.m_node=null,this.m_nodes=[],this.m_nodesTotal=0,this.m_shader=null,this.m_renderTotal=0,this.m_sorter=null,this.sortEnabled=!0,this.m_shader=t}setSorter(t){this.m_sorter=t}showInfo(){let t="",e=this.m_begin;while(null!=e)t+=e.unit.value+",",e=e.next}clear(){if(null!=this.m_shader){this.m_nodes.length>0&&(this.m_nodes=[]);let t=this.m_begin,e=null;while(null!=t)e=t,t=t.next,e.prev=null,e.next=null;this.m_begin=this.m_end=null,this.m_nodesTotal=0,this.m_renderTotal=0,this.sortEnabled=!0,this.m_shader=null}this.m_sorter=null}update(){this.sortEnabled&&this.sort()}run(t){this.m_shader.resetUniform();let e=null,i=this.m_nodes;for(let s=0;s<this.m_renderTotal;++s)e=i[s],this.m_shader.bindToGpu(e.shdUid),e.run(t),e.partTotal<1?e.drawThis(t):e.drawPart(t)}runLockMaterial(t){this.m_shader.resetUniform();let e=null,i=this.m_nodes;for(let s=0;s<this.m_renderTotal;++s)e=i[s],this.m_shader.bindToGpu(e.shdUid),e.vro.run(),e.runLockMaterial2(null),e.partTotal<1?e.drawThis(t):e.drawPart(t)}sort(){if(this.m_nodesTotal>0){let t=this.m_begin;this.m_nodes.length<this.m_nodesTotal&&(this.m_nodes=new Array(Math.round(1.1*this.m_nodesTotal)+1));let e=0;while(null!=t)t.drawEnabled&&t.unit.drawEnabled&&(this.m_nodes[e]=t.unit,++e),t=t.next;this.m_renderTotal=e;let i=0;null!=this.m_sorter&&(i=this.m_sorter.sortRODisplay(this.m_nodes,e)),i<1&&this.snsort(0,e-1)}}sorting(t,e){let i=this.m_nodes;this.m_node=i[t];let s=this.m_node.value;while(t<e){while(t<e&&i[e].value>=s)--e;i[t]=i[e];while(t<e&&i[t].value<=s)++t;i[e]=i[t]}return i[t]=this.m_node,t}snsort(t,e){if(t<e){let i=this.sorting(t,e);this.snsort(t,i-1),this.snsort(i+1,e)}}getNodesTotal(){return this.m_nodesTotal}getBegin(){return this.m_next=this.m_begin,this.m_begin}getNext(){return null!=this.m_next&&(this.m_next=this.m_next.next),this.m_next}isEmpty(){return this.m_nodesTotal<1}addNode(t){null==t.prev&&null==t.next&&(null==this.m_begin?this.m_end=this.m_begin=t:null!=this.m_end.prev?(this.m_end.next=t,t.prev=this.m_end,this.m_end=t):(this.m_begin.next=t,t.prev=this.m_end,this.m_end=t),this.m_end.next=null,this.m_nodesTotal++)}removeNode(t){null==t.prev&&null==t.next&&t!=this.m_begin||(t==this.m_begin?t==this.m_end?this.m_begin=this.m_end=null:(this.m_begin=t.next,this.m_begin.prev=null):t==this.m_end?(this.m_end=t.prev,this.m_end.next=null):(t.next.prev=t.prev,t.prev.next=t.next),t.prev=null,t.next=null,this.m_nodesTotal--)}}e.default=s},"265e":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.__$ruid=-1,this.drawEnabled=!0,this.uid=-1,this.index=-1,this.drawMode=0,this.ivsIndex=0,this.ivsCount=0,this.insCount=0,this.shdUid=-1,this.vtxUid=-1,this.texMid=-1,this.rtokey=-1,this.prev=null,this.next=null,this.unit=null,this.vro=null,this.tro=null,this.rvroI=-1,this.rtroI=-1}setValue(t){this.unit.value=t}isVsible(){return null==this.unit||this.unit.drawEnabled}updateData(){let t=this.unit;this.drawMode=t.drawMode,this.ivsIndex=t.ivsIndex,this.ivsCount=t.ivsCount,this.insCount=t.insCount,t.drawOffset=t.ivsIndex*t.ibufStep,this.vtxUid=t.vtxUid,this.vro=t.vro,this.shdUid=t.shdUid,this.texMid=t.texMid,this.tro=t.tro}reset(){this.drawEnabled=!0,this.uid=-1,this.index=-1,this.drawMode=0,this.ivsIndex=0,this.ivsCount=0,this.insCount=0,this.shdUid=-1,this.vtxUid=-1,this.texMid=-1,this.rtokey=-1,this.unit=null,this.vro=null,this.tro=null,this.prev=null,this.next=null}toString(){return"[Object RPONode(uid = "+this.uid+", index = "+this.index+", shdUid = "+this.shdUid+", vtxUid = "+this.vtxUid+")]"}}e.default=s},"29ef":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{static CreateBlendMode(t,e,i,r=0){return s.rstb.createBlendMode(t,e,i,r)}static CreateBlendModeSeparate(t,e,i,r=0,a=0,n=0){return s.rstb.createBlendModeSeparate(t,e,i,r,a,n)}static CreateRenderState(t,e,i,r){return s.rstb.createRenderState(t,e,i,r)}static CreateRenderColorMask(t,e,i,r,a){return s.rstb.createRenderColorMask(t,e,i,r,a)}static GetRenderStateByName(t){return s.rstb.getRenderStateByName(t)}static GetRenderColorMaskByName(t){return s.rstb.getRenderColorMaskByName(t)}static UnlockBlendMode(){s.rstb.unlockBlendMode()}static LockBlendMode(t){s.rstb.lockBlendMode(t)}static UnlockDepthTestMode(){s.rstb.unlockDepthTestMode()}static LockDepthTestMode(t){s.rstb.lockDepthTestMode(t)}static ResetState(){s.rstb.resetState()}static Reset(t){s.rstb.reset(t)}static ResetInfo(){}static SetDepthTestEnable(t){s.rstb.setDepthTestEnable(t)}static SetBlendEnable(t){s.rstb.setBlendEnable(t)}}e.default=s},"2be1":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.m_nodesTotal=0,this.m_nodes=[],this.m_flags=[],this.m_freeIdList=[]}createNode(){return null}restoreUid(t){}getFreeId(){return this.m_freeIdList.length>0?this.m_freeIdList.pop():-1}getNodeByUid(t){return this.m_nodes[t]}create(){let t=null,e=this.getFreeId();return e>=0?(t=this.m_nodes[e],t.uid=e,this.m_flags[e]=s.S_BUSY):(t=this.createNode(),this.m_nodes.push(t),this.m_flags.push(s.S_BUSY),t.uid=this.m_nodesTotal,this.m_nodesTotal++),t}restore(t){return null!=t&&t.uid>=0&&this.m_flags[t.uid]==s.S_BUSY&&(this.restoreUid(t.uid),this.m_freeIdList.push(t.uid),this.m_flags[t.uid]=s.S_FREE,t.reset(),!0)}restoreByUid(t){return t>=0&&t<this.m_nodesTotal&&this.m_flags[t]==s.S_BUSY&&(this.restoreUid(t),this.m_freeIdList.push(t),this.m_flags[t]=s.S_FREE,this.m_nodes[t].reset(),!0)}}s.S_BUSY=1,s.S_FREE=0,e.default=s},3024:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("3077"));class a extends r.default{constructor(t,e){super(t),this.m_datafs=null,this.m_vec4Total=1,e<1&&(e=1),this.m_vec4Total=e,this.m_datafs=new Float32Array(4*e),this.addVec4Data(this.m_datafs,this.m_vec4Total)}destroy(){super.destroy(),this.m_datafs=null}}e.default=a},3077:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("644c"));class a{constructor(t){this.m_uid=a.s_uid++,this.m_slot=null,this.m_fsList=null,this.m_fsIndex=0,this.m_slotBeginIndex=-1,this.rst=-1,this.uniformsTotal=0,this.uniformNames=null,this.uniformTypes=null,this.dataSizeList=null,this.bindSlot(t)}bindSlot(t){this.rst>=0&&this.reset(),null==this.m_fsList&&(this.m_fsList=[],this.uniformTypes=[],this.dataSizeList=[]),this.m_slot=t,this.rst=1,this.m_slotBeginIndex=t.index,this.m_fsIndex=t.index}getUid(){return this.m_uid}getSlotBeginIndex(){return this.m_slotBeginIndex}getRCUid(){return this.m_slot.getRCUid()}getFS32At(t){return this.m_fsList[t]}setFS32At(t,e){this.m_fsList[e]=t}setVec4DataAt(t,e,i,s,r){let a=this.m_fsList[t];a[0]=e,a[1]=i,a[2]=s,a[3]=r}setVec4Data(t,e,i,s){let r=this.m_fsList[0];r[0]=t,r[1]=e,r[2]=i,r[3]=s}setVec4DataAtWithArr4(t,e){this.m_fsList[t].set(e,0)}setVec4DataWithArr4(t){this.m_fsList[0].set(t,0)}addVec4Data(t,e){t.length,this.m_fsList.push(t),this.uniformTypes.push(r.default.SHADER_VEC4),this.dataSizeList.push(e),this.m_slot.dataList[this.m_fsIndex]=t,this.m_fsIndex++,this.uniformsTotal++,this.m_slot.index++}addMat4Data(t,e){this.m_fsList.push(t),this.uniformTypes.push(r.default.SHADER_MAT4),this.dataSizeList.push(e),this.m_slot.dataList[this.m_fsIndex]=t,this.m_fsIndex++,this.uniformsTotal++,this.m_slot.index++}isEnabled(){return this.rst>=0}update(){if(this.rst++,this.uniformsTotal<2)this.m_slot.flagList[this.m_slotBeginIndex]=this.rst;else for(let t=this.m_slotBeginIndex;t<=this.m_fsIndex;++t)this.m_slot.flagList[t]=this.rst}reset(){this.rst=-1,this.m_slotBeginIndex=-1,this.uniformsTotal=0,this.m_fsIndex=0,null!=this.m_fsList&&(this.m_fsList=null,this.uniformTypes=null,this.dataSizeList=null),this.m_slot=null}destroy(){this.reset()}}a.s_uid=0,e.default=a},"36cb":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i("e08e"),a=s(i("ab73")),n=i("b02c"),_=s(i("4f27")),l=s(i("b30a")),h=s(i("9156")),o=i("670e");class d{constructor(t){this.m_emptyTRO=null,this.m_shader=null,this.m_rpoUnitBuilder=null,this.m_processBuider=null,this.m_roVtxBuild=null,this.m_rc=null,this.m_vtxRes=null,this.m_texRes=null,this.m_deferredVbufs=[],this.m_deferredTROs=[],this.m_deferredTextures=[],this.m_haveDeferredUpdate=!1,this.m_shdpBuilder=null,this.m_shdpBuilder=t}initialize(t,e,i,s){null==this.m_shader&&(this.m_rc=t,this.m_vtxRes=t.Vertex,this.m_texRes=t.Texture,this.m_shader=new l.default(t.getRCUid(),t.getRC(),t.getRenderAdapter(),this.m_shdpBuilder),this.m_rpoUnitBuilder=e,this.m_processBuider=i,this.m_roVtxBuild=s,this.m_emptyTRO=new n.EmptyTexRenderObj(this.m_texRes),this.m_shdUniformTool=new _.default,this.m_shdUniformTool.initialize())}getRenderProxy(){return this.m_rc}getRenderShader(){return this.m_shader}getTextureResource(){return this.m_texRes}updateTextureData(t,e){this.m_texRes.hasResUid(t.getResUid())&&(e?(this.m_deferredTextures.push(t),this.m_haveDeferredUpdate=!0):t.__$updateToGpu(this.m_texRes))}updateDispTRO(t,e){t.__$ruid>-1&&(e?(this.m_deferredTROs.push(t),this.m_haveDeferredUpdate=!0):this.updateTextureTRO(t))}createTRO(t,e){if(null!=t){for(let e=0;e<t.length;++e)null!=t[e]&&t[e].__$setRenderProxy(this.m_rc);return n.TextureRenderObj.Create(this.m_texRes,t,e)}return null}updateTextureTRO(t){if(null!=t.__$$runit){let e=t.getMaterial();if(null!=e){let i=this.m_texRes,s=t.__$$runit,r=n.TextureRenderObj.GetByMid(i.getRCUid(),e.__$troMid);if(null!=s.tro&&(null==r||s.tro.getMid()!=r.getMid())){let t=this.m_shdpBuilder.findShdProgramByShdData(e.getShaderData());null!=t&&(t.getTexTotal()>0?(null==r&&(r=this.createTRO(e.getTextureList(),t.getTexTotal())),s.tro!=r&&(null!=s.tro&&s.tro.__$detachThis(),s.tro=r,r.__$attachThis(),s.texMid=s.tro.getMid(),this.m_processBuider.rejoinRunitForTro(s),e.__$troMid=s.tro.getMid())):s.tro!=this.m_emptyTRO&&(null!=s.tro&&s.tro.__$detachThis(),s.tro=this.m_emptyTRO,s.texMid=s.tro.getMid(),this.m_processBuider.rejoinRunitForTro(s),e.__$troMid=s.texMid))}}}}updateDispMaterial(t,e){let i=null;if(e.__$ruid>=0){let s=this.m_rc,r=e.getMaterial();if(null!=r){if(null==r.getShaderData()){let t=r.getTextureList(),e=null!=t&&null!=t&&t.length>0;r.initializeByCodeBuf(e)}i=this.m_shdpBuilder.create(r.getShaderData()),i.upload(s.RContext,s.getUid()),t.shdUid=i.getUid();let n=null;if(i.getTexTotal()>0?(n=this.createTRO(r.getTextureList(),i.getTexTotal()),t.tro!=n&&(null!=t.tro&&t.tro.__$detachThis(),t.tro=n,n.__$attachThis(),t.texMid=t.tro.getMid(),t.__$rprouid>=0&&this.m_processBuider.rejoinRunitForTro(t),r.__$troMid=t.tro.getMid())):t.tro!=this.m_emptyTRO&&(null!=t.tro&&t.tro.__$detachThis(),t.tro=this.m_emptyTRO,t.texMid=t.tro.getMid(),t.__$rprouid>=0&&this.m_processBuider.rejoinRunitForTro(t),r.__$troMid=t.texMid),null==this.m_shader.getSharedUniformByShd(i)){let t=this.createsharedMList(r,i);if(null!=t)for(let e=0;e<t.length;++e)t[e].program=i.getGPUProgram();this.m_shader.setSharedUniformByShd(i,this.m_shdUniformTool.buildShared(t,s,i))}let _=i.hasUniformByName(a.default.LocalTransformMatUNS);null==r.__$uniform&&(r.__$uniform=this.m_shdUniformTool.buildLocalFromData(r.createSelfUniformData(),i)),_&&null!=e.getTransform()&&(t.transUniform=h.default.GetTransUniform(e.getTransform(),i)),null==t.transUniform?(t.transUniform=this.m_shdUniformTool.buildLocalFromTransformV(_?e.getMatrixFS32():null,i),h.default.SetTransUniform(e.getTransform(),t.transUniform,i)):t.transUniform=this.m_shdUniformTool.updateLocalFromTransformV(t.transUniform,_?e.getMatrixFS32():null,i),t.polygonOffset=r.getPolygonOffset(),t.uniform=r.__$uniform}}return i}updateVtxDataToGpuByUid(t,e){this.m_vtxRes.updateDataToGpu(t,e)}updateDispVbuf(t,e){if(t.__$ruid>-1)if(e)this.m_deferredVbufs.push(t),this.m_haveDeferredUpdate=!0;else{let e=t.__$$runit;if(null!=e&&e.vtxUid!=t.vbuf.getUid()){let i=e.vtxUid,s=this.m_vtxRes;s.hasResUid(i)&&s.__$detachRes(i),e.vro.__$detachThis(),this.buildVtxRes(t,e,this.m_shdpBuilder.findShdProgramByUid(e.shdUid)),e.__$rprouid>=0&&this.m_processBuider.rejoinRunitForVro(e)}}}buildVtxRes(t,e,i){if(null!=t.vbuf){let s=this.m_vtxRes;e.ivsIndex=t.ivsIndex,e.ivsCount=t.ivsCount,e.insCount=t.insCount,e.visible=t.visible,e.setVisible(t.visible),e.drawMode=t.drawMode,e.renderState=t.renderState,e.rcolorMask=t.rcolorMask,e.trisNumber=t.trisNumber;let r,a=t.getVtxResUid(),n=!0,_=t.getVtxResVer();if(s.hasResUid(a)?(r=s.getVertexRes(a),n=r.version!=_,n&&(s.destroyRes(a),r.rcuid=s.getRCUid(),r.resUid=a)):(r=new o.GpuVtxObject,r.rcuid=s.getRCUid(),r.resUid=a,s.addVertexRes(r)),n){let e=null==t.ivbuf?t.vbuf:t.ivbuf;r.indices.ibufStep=e.getIBufStep(),r.indices.initialize(this.m_roVtxBuild,e),r.createVertex(this.m_roVtxBuild,i,t.vbuf),r.version=_}s.__$attachRes(a),e.vro=r.createVRO(this.m_roVtxBuild,i,!0),e.indicesRes=e.vro.indicesRes,e.vro.__$attachThis(),e.vtxUid=a,e.ibufStep=e.vro.ibufStep,e.ibufType=4!=e.ibufStep?this.m_rc.UNSIGNED_SHORT:this.m_rc.UNSIGNED_INT}}buildGpuDisp(t){if(t.__$ruid<0&&null!=t.getMaterial()){t.__$$rsign=r.DisplayRenderSign.LIVE_IN_RENDERER;let e=this.m_rpoUnitBuilder.create();if(t.__$ruid=e.uid,t.__$$runit=e,null!=t.getPartGroup()){e.partGroup=t.getPartGroup().slice(0),e.partTotal=e.partGroup.length;let i=e.partGroup;for(let t=0,s=e.partTotal;t<s;)t++,i[t++]*=e.ibufStep}return e.setDrawFlag(t.renderState,t.rcolorMask),this.buildVtxRes(t,e,this.updateDispMaterial(e,t)),!0}return!1}update(){if(this.m_haveDeferredUpdate){this.m_haveDeferredUpdate=!1;let t=this.m_deferredVbufs.length,e=0;if(t>0){for(;e<t;++e)this.updateDispVbuf(this.m_deferredVbufs[e],!1);this.m_deferredVbufs=[]}if(t=this.m_deferredTROs.length,t>0){for(e=0;e<t;++e)this.updateTextureTRO(this.m_deferredTROs[e]);this.m_deferredTROs=[]}if(t=this.m_deferredTextures.length,t>0){for(e=0;e<t;++e)this.m_deferredTextures[e].__$updateToGpu(this.m_texRes);this.m_deferredTextures=[]}}}createsharedMList(t,e){let i=t.createSharedUniforms();if(null==i){let s=t.createSharedUniformsData();if(null!=s&&s.length>0){i=[];for(let t=0;t<s.length;++t)if(null!=s[t]){let r=this.m_shdUniformTool.buildLocalFromData(s[t],e);i.push(r)}i.length<1&&(i=null)}}return i}updateGlobalMaterial(t,e=!1){if(null!=t){let i=this.m_rc,s=null,r=null,a=null,n=!1;null==t.getShaderData()?(a=t.getTextureList(),n=null!=a&&a.length>0,t.initializeByCodeBuf(n)):a=t.getTextureList(),r=this.m_shdpBuilder.create(t.getShaderData()),r.upload(i.RContext,i.getUid());let _=r.getTexTotal();if(_>0&&(s=this.createTRO(a,_)),null==this.m_shader.getSharedUniformByShd(r)){let e=this.createsharedMList(t,r);if(null!=e)for(let t=0;t<e.length;++t)e[t].program=r.getGPUProgram();this.m_shader.setSharedUniformByShd(r,this.m_shdUniformTool.buildShared(e,i,r))}null==t.__$uniform&&(t.__$uniform=this.m_shdUniformTool.buildLocalFromData(t.createSelfUniformData(),r)),this.m_shader.__$globalUniform=t.__$uniform,this.m_shader.bindToGpu(r.getUid()),e&&null!=t.__$uniform&&this.m_shader.useUniform(t.__$uniform),null!=s&&s.run()}}reset(){this.m_deferredVbufs=[],this.m_deferredTROs=[]}}e.default=d},"3b73":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{static SetWebBodyColor(t="white"){const e=document.body;e.style.background=t}static SetLanguage(t){s.s_language=t}static GetLanguage(){return""!=s.s_language||(s.s_language=navigator.language),s.s_language}static SetThreadEnabled(t){s.s_threadEnabled=t}static GetThreadEnabled(){return s.s_threadEnabled}static GetDebugEnabled(){return s.s_debugEnabled}static SetDebugEnabled(t){s.s_debugEnabled=t}static SetDevicePixelRatio(t){s.s_devicePixelRatio=t}static GetDevicePixelRatio(){return s.s_devicePixelRatio}static Initialize(t){s.s_inited&&(s.s_inited=!1,s.s_WEBGL_VER=t[0],s.TestMobileWeb(),s.s_language=navigator.language+"")}static IsWindowsPCOS(){return!(s.IsSafariWeb()||s.IsMobileWeb())}static IsWinExternalVideoCard(){if(s.s_winExternalVideoCardFlag>0)return 2==s.s_winExternalVideoCardFlag;let t=s.IsSafariWeb()||s.IsMobileWeb();return t||(t=s.GPU_RENDERER.indexOf("Intel(R)")<0),s.s_winExternalVideoCardFlag=t?2:1,2==s.s_winExternalVideoCardFlag}static TestSafariWeb(){return/Safari/.test(navigator.userAgent)&&/Mac OS/.test(navigator.userAgent)}static IsWebGL1(){return 1==s.s_WEBGL_VER}static IsWebGL2(){return 2==s.s_WEBGL_VER}static IsMobileWeb(){return s.s_mobileFlag>0?2==s.s_mobileFlag:s.TestMobileWeb()}static IsSafariWeb(){return s.s_safariFlag>0||(s.s_safariFlag=s.TestSafariWeb()?2:1),2==s.s_safariFlag}static IsIOS(){if(s.s_IOS_Flag>0)return 2==s.s_IOS_Flag;let t=!1;return t=!!/iPad|iPhone|iPod/.test(navigator.platform)||void 0!=navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform),s.s_IOS_Flag=t?2:1,t}static IsIpadOS(){if(s.s_IPad_Flag>0)return 2==s.s_IPad_Flag;let t=navigator.maxTouchPoints>0&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform);return!t&&/iPod|iPad|iPadPro|iPodPro/i.test(navigator.userAgent)&&(t=!0),s.s_IPad_Flag=t?2:1,t}static IsAndroidOS(){if(s.s_Android_Flag>0)return 2==s.s_Android_Flag;let t=s.TestMobileWeb();return t=!(!t||!/Android|Linux/i.test(navigator.userAgent)),s.s_Android_Flag=t?2:1,t}static TestMobileWeb(){return s.s_mobileFlag>0?2==s.s_mobileFlag:/mobile/.test(location.href)?(s.s_mobileFlag=2,2==s.s_mobileFlag):/Android/i.test(navigator.userAgent)?/Mobile/i.test(navigator.userAgent)?(s.s_mobileFlag=2,2==s.s_mobileFlag):(s.s_mobileFlag=1,2==s.s_mobileFlag):/webOS|iPhone|iPod|iPad|iPodPro|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?(s.s_mobileFlag=2,2==s.s_mobileFlag):(s.s_mobileFlag=1,2==s.s_mobileFlag)}}s.s_inited=!0,s.s_WEBGL_VER=2,s.s_devicePixelRatio=1,s.s_mobileFlag=0,s.s_safariFlag=0,s.s_Android_Flag=0,s.s_IOS_Flag=0,s.s_IPad_Flag=0,s.s_winExternalVideoCardFlag=0,s.s_language="",s.s_debugEnabled=!0,s.GPU_VENDOR="unknown",s.GPU_RENDERER="unknown",s.MAX_TEXTURE_SIZE=4096,s.MAX_RENDERBUFFER_SIZE=4096,s.MAX_VIEWPORT_WIDTH=4096,s.MAX_VIEWPORT_HEIGHT=4096,s.SHOWLOG_ENABLED=!1,s.SHADERCODE_TRACE_ENABLED=!1,s.VERT_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED=!0,s.FRAG_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED=!0,s.s_threadEnabled=!0,e.default=s},"3c81":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("2be1")),a=s(i("7696"));class n extends r.default{setCreateParams(t,e,i,s,r,a){this.m_shader=t,this.m_rpoNodeBuilder=e,this.m_rpoUnitBuilder=i,this.m_vtxResource=s,this.m_batchEnabled=r,this.m_fixedState=a}createNode(){return new a.default(this.m_shader,this.m_rpoNodeBuilder,this.m_rpoUnitBuilder,this.m_vtxResource,this.m_batchEnabled,this.m_fixedState)}rejoinRunitForTro(t){this.getNodeByUid(t.__$rprouid).rejoinRunitForTro(t)}rejoinRunitForVro(t){this.getNodeByUid(t.__$rprouid).rejoinRunitForVro(t)}}e.default=n},"442e":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("2be1")),a=s(i("265e"));class n extends r.default{createNode(){return new a.default}createRPONode(){return new a.default}}e.default=n},"45db":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8def")),a=s(i("fa60"));class n{constructor(){this.m_vtx=null,this.m_typeList=null,this.m_offsetList=null,this.m_sizeList=null,this.m_vtxUid=-1,this.m_gpuBufs=[],this.m_gpuBufsTotal=0,this.m_type=0,this.m_attribsTotal=0,this.m_wholeStride=0,this.m_bufIVS=null,this.m_vroList=[],this.m_vroListLen=0,this.m_attachCount=0}static create(t,e,i){let s,r=i.getUid(),a=n.s_map;return a.has(r)?s=a.get(r):(s=new n,a.set(r,s),s.initialize(t,e,i)),s}__$attachThis(){++this.m_attachCount}__$detachThis(){this.m_attachCount,--this.m_attachCount,this.m_attachCount<1&&(this.m_attachCount=0)}getAttachCount(){return this.m_attachCount}updateToGpu(t){let e=this.m_gpuBufs.length;if(e>0){let i=this.m_vtx;if(this.version!=i.vertexVer){let s,r=i.getBufDataUsage(),a=this.m_sizeList;for(let n=0;n<e;++n)s=i.getF32DataAt(n),a[n]>=s.length?(t.bindArrBuf(this.m_gpuBufs[n]),t.arrBufSubData(s,0)):(t.bindArrBuf(this.m_gpuBufs[n]),t.arrBufData(s,r),a[n]=s.length);this.version=i.vertexVer}}}uploadCombined(t,e){let i=this.m_vtx,s=i.getF32DataAt(0);if(this.m_gpuBufs.push(t.createBuf()),t.bindArrBuf(this.m_gpuBufs[0]),t.arrBufData(s,i.getBufDataUsage()),this.m_gpuBufsTotal=1,this.m_sizeList=[s.length],null==this.m_typeList){this.m_bufIVS=e.getLocationIVS(),this.m_wholeStride=0,this.m_typeList=new Array(this.m_attribsTotal),this.m_offsetList=new Array(this.m_attribsTotal);let t=i.getBufTypeList(),s=i.getBufSizeList();if(null!=t)for(let e=0;e<this.m_attribsTotal;++e)this.m_offsetList[e]=this.m_wholeStride,this.m_wholeStride+=4*s[e],this.m_typeList[e]=t[e];else for(let i=0;i<this.m_attribsTotal;++i)this.m_offsetList[i]=this.m_wholeStride,this.m_wholeStride+=4*e.getLocationSizeByIndex(i),this.m_typeList[i]=e.getLocationTypeByIndex(i)}}uploadSeparated(t,e){let i=this.m_vtx,s=0,r=null,a=i.getBufDataUsage();if(this.m_gpuBufsTotal=this.m_vtx.getBuffersTotal(),this.m_sizeList=new Array(this.m_attribsTotal),this.m_bufIVS=e.getLocationIVS(),null==i.bufData)for(;s<this.m_attribsTotal;++s)r=t.createBuf(),this.m_gpuBufs.push(r),t.bindArrBuf(r),t.arrBufData(i.getF32DataAt(s),a),this.m_sizeList[s]=i.getF32DataAt(s).length;else{let e=null,n=0,_=0,l=0,h=0;for(;s<this.m_attribsTotal;++s){for(r=t.createBuf(),this.m_gpuBufs.push(r),t.bindArrBuf(r),t.arrBufDataMem(i.bufData.getAttributeDataTotalBytesAt(s),a),l=0,h=0,_=i.bufData.getAttributeDataTotalAt(s),n=0;n<_;++n)e=i.bufData.getAttributeDataAt(s,n),h+=e.length,t.arrBufSubData(e,l),l+=e.byteLength;this.m_sizeList[s]=h}}if(null==this.m_typeList){this.m_typeList=new Array(this.m_attribsTotal),this.m_offsetList=new Array(this.m_attribsTotal);let t=i.getBufTypeList(),s=i.getBufSizeList();if(null!=t)for(let e=0;e<this.m_attribsTotal;++e)this.m_offsetList[e]=this.m_wholeStride,this.m_wholeStride+=4*s[e],this.m_typeList[e]=t[e];else for(let i=0;i<this.m_attribsTotal;++i)this.m_offsetList[i]=this.m_wholeStride,this.m_wholeStride+=4*e.getLocationSizeByIndex(i),this.m_typeList[i]=e.getLocationTypeByIndex(i);this.m_wholeStride=0}}initialize(t,e,i){if(this.m_gpuBufs.length<1&&null!=i){this.version=i.vertexVer,this.m_vtx=i,this.m_vtxUid=i.getUid(),this.m_type=i.getType();let s=i.getBufTypeList();if(this.m_attribsTotal=null!=s?s.length:e.getLocationsTotal(),e.getLocationsTotal()!=i.getAttribsTotal()){let t="shdp.getLocationsTotal() is "+e.getLocationsTotal()+" != vtx.getAttribsTotal(), shdp has "+e.getLocationsTotal()+", vtx has "+i.getAttribsTotal();t+="\n这可能会导致渲染过程无法正常使用所有的 vtx buffers"}this.m_type<1?this.uploadCombined(t,e):this.uploadSeparated(t,e);let r=i.getBufSortFormat();if(r>0){let t=new Array(12),e=0;for(let i=0;i<10;++i){const s=1<<i;(s&r)>0&&(t[i+1]=e++)}this.m_bufIVS=t}}}getVROMid(t,e,i,s){let r=(131+t.getRCUid())*this.m_vtxUid;return i&&(r=131*r+1),r=131*r+e.getMid(),r=131*r+s,r}createVRO(t,e,i,s){let n=e.getLocationsTotal();if(this.m_attribsTotal*n>0&&n<=this.m_attribsTotal){let _=this.getVROMid(t,e,i,s.getUid()),l=0,h=a.default.GetByMid(_);if(null!=h)return h;const o=this.m_bufIVS;if(i){let i=a.default.Create(t,_,this.m_vtx.getUid());if(i.indicesRes=s,i.vao=t.createVertexArray(),t.bindVertexArray(i.vao),this.m_type<1){t.bindArrBuf(this.m_gpuBufs[0]);const i=e.getLocationTypes();for(l=0;l<i.length;++l){const t=o[i[l]];e.vertexAttribPointerTypeFloat(this.m_typeList[t],this.m_wholeStride,this.m_offsetList[t])}}else{const i=e.getLocationTypes();for(l=0;l<i.length;++l){const s=o[i[l]];t.bindArrBuf(this.m_gpuBufs[s]),e.vertexAttribPointerTypeFloat(this.m_typeList[s],0,0)}}h=i,i.ibuf=s.getGpuBuf(),t.bindVertexArray(null)}else{let i=r.default.Create(t,_,this.m_vtx.getUid());for(i.indicesRes=s,i.shdp=e,i.attribTypes=[],i.wholeOffsetList=[],i.wholeStride=this.m_wholeStride,this.m_type<1?i.vbuf=this.m_gpuBufs[0]:i.vbufs=this.m_gpuBufs,l=0;l<n;++l)e.testVertexAttribPointerType(this.m_typeList[l])&&(i.attribTypes.push(this.m_typeList[l]),i.wholeOffsetList.push(0));i.attribTypesLen=i.attribTypes.length,i.ibuf=s.getGpuBuf(),h=i}return this.m_vroList.push(h),++this.m_vroListLen,h}return null}destroy(t){if(this.m_attachCount<1){if(this.m_gpuBufs.length>0){this.m_bufIVS=null,this.m_type=-1;let e=0;for(;e<this.m_vroListLen;++e)this.m_vroList[e].restoreThis();for(this.m_vroList=[],this.m_vroListLen=0,e=0;e<this.m_attribsTotal;++e)t.deleteBuf(this.m_gpuBufs[e]),this.m_gpuBufs[e]=null;this.m_attribsTotal=0,this.m_gpuBufs=[]}this.m_vtxUid>=0&&(n.s_map.delete(this.m_vtxUid),this.m_vtxUid=-1)}}}n.s_map=new Map,e.ROVertexRes=n},"4d4b":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("3b73"));e.RendererDevice=r.default;const a=s(i("29ef"));e.RendererState=a.default;const n=i("0e01");e.RendererInstanceContextParam=n.RendererInstanceContextParam,e.RendererInstanceContext=n.RendererInstanceContext;const _=s(i("d958"));function l(){return new _.default}e.RendererInstance=_.default,e.createRendererInstance=l},"4f27":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("3b73")),a=i("d53d"),n=s(i("2560")),_=s(i("83d1")),l=s(i("a7ed")),h=s(i("857b")),o=s(i("e87b"));class d extends a.ShaderUniform{use(t){}useByLocation(t,e,i,s){}useByShd(t,e){}updateData(){}destroy(){}}d.EmptyUniform=new d;class u{constructor(){this.m_initFlag=!0,this.m_uniformDict=new Map,this.m_builders=[],this.m_buildersTot=0,this.m_emptyUniform=new a.ShaderUniform}appendUniformBuilder(t){this.m_uniformDict.has(t.getIDNS())||(this.m_builders.push(t),this.m_uniformDict.set(t.getIDNS(),t),this.m_buildersTot=this.m_builders.length)}initialize(){this.m_initFlag&&(this.m_initFlag=!1,this.appendUniformBuilder(new n.default),this.appendUniformBuilder(new l.default),this.appendUniformBuilder(new h.default),this.appendUniformBuilder(new _.default),this.appendUniformBuilder(new o.default))}addSharedUniformBuilder(t){null==t||this.m_uniformDict.has(t.getIDNS())||(this.m_builders.push(t),this.m_uniformDict.set(t.getIDNS(),t),++this.m_buildersTot)}removeSharedUniformBuilder(t){if(null!=t&&this.m_uniformDict.has(t.getIDNS())){for(let e=0;e<this.m_buildersTot;++e)if(t==this.m_builders[e]){this.m_builders.splice(e,1),--this.m_buildersTot;break}this.m_uniformDict.delete(t.getIDNS())}}removeSharedUniformBuilderByName(t){if(this.m_uniformDict.has(t)){let e=this.m_uniformDict.get(t);for(let t=0;t<this.m_buildersTot;++t)if(e==this.m_builders[t]){this.m_builders.splice(t,1),--this.m_buildersTot;break}this.m_uniformDict.delete(t)}}buildShared(t,e,i){let s,r=null,a=null,n=this.m_builders,_=0,l=this.m_buildersTot,h=null;for(;_<l;++_)h=n[_].create(e,i),null!=h&&(null!=a?a.next=h:null==r&&(r=h),a=h);if(null==t)s=r;else if(null!=r){for(let e=0;e<t.length;++e)a.next=t[e],a=a.next;s=r}if(null==s)s=d.EmptyUniform;else{let t=s,e=0;while(null!=t){if(null!=t.uniformNameList&&null==t.locations)for(t.types=[],t.locations=[],t.uniformSize=t.uniformNameList.length,e=0;e<t.uniformSize;++e)t.types.push(i.getUniformTypeByNS(t.uniformNameList[e])),t.locations.push(i.getUniformLocationByNS(t.uniformNameList[e]));t=t.next}}return s}buildLocalFromTransformV(t,e){if(null!=t){let i;return i=new a.ShaderMat4Uniform,i.uniformSize=0,i.uniformNameList=[],i.types=[],i.locations=[],i.dataList=[],i.dataSizeList=[],i.uniformSize+=1,i.uniformNameList.push("u_objMat"),i.types.push(e.getUniformTypeByNS("u_objMat")),i.locations.push(e.getUniformLocationByNS("u_objMat")),i.dataList.push(t),i.dataSizeList.push(1),i}return this.m_emptyUniform}updateLocalFromTransformV(t,e,i){if(null!=e){let s,r=t;return null==r?(r=new a.ShaderMat4Uniform,s=r,s.uniformSize=0,s.uniformNameList=[],s.types=[],s.locations=[],s.dataList=[],s.dataSizeList=[],s.uniformSize+=1,s.uniformNameList.push("u_objMat"),s.types.push(i.getUniformTypeByNS("u_objMat")),s.locations.push(i.getUniformLocationByNS("u_objMat")),s.dataList.push(e),s.dataSizeList.push(1)):(s=r,s.locations=[],s.locations.push(i.getUniformLocationByNS("u_objMat"))),s}return this.m_emptyUniform}buildLocalFromData(t,e){if(null!=t){let i;i=r.default.IsWebGL1()?new a.ShaderUniformV1:new a.ShaderUniformV2,i.uns=t.uns,i.uniformNameList=[],i.types=[],i.locations=[],i.dataList=[],i.dataSizeList=[],i.uniformSize=0;let s=t,n=0;while(null!=s){if(null!=s.uniformNameList&&null==s.locations)for(i.uniformSize+=s.uniformNameList.length,n=0;n<i.uniformSize;++n)i.uniformNameList.push(s.uniformNameList[n]),i.types.push(e.getUniformTypeByNS(s.uniformNameList[n])),i.locations.push(e.getUniformLocationByNS(s.uniformNameList[n])),i.dataList.push(s.dataList[n]),i.dataSizeList.push(e.getUniformLengthByNS(s.uniformNameList[n]));s=s.next}return i}return d.EmptyUniform}}e.default=u},5326:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(t,e=256){this.m_total=256,this.m_rcuid=0,this.index=0,this.dataList=null,this.flagList=null,this.m_rcuid=t,this.m_total=e,this.flagList=new Uint16Array(this.m_total),this.dataList=new Array(this.m_total);for(let i=0;i<this.m_total;++i)this.dataList[i]=null,this.flagList[i]=0}getRCUid(){return this.m_rcuid}}e.UniformDataSlot=s},"53d3":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(t){let e=this;e.NORMAL_STATE=t.NORMAL_STATE,e.BACK_CULLFACE_NORMAL_STATE=t.BACK_CULLFACE_NORMAL_STATE,e.FRONT_CULLFACE_NORMAL_STATE=t.FRONT_CULLFACE_NORMAL_STATE,e.NONE_CULLFACE_NORMAL_STATE=t.NONE_CULLFACE_NORMAL_STATE,e.ALL_CULLFACE_NORMAL_STATE=t.ALL_CULLFACE_NORMAL_STATE,e.BACK_NORMAL_ALWAYS_STATE=t.BACK_NORMAL_ALWAYS_STATE,e.BACK_TRANSPARENT_STATE=t.BACK_TRANSPARENT_STATE,e.BACK_TRANSPARENT_ALWAYS_STATE=t.BACK_TRANSPARENT_ALWAYS_STATE,e.NONE_TRANSPARENT_STATE=t.NONE_TRANSPARENT_STATE,e.NONE_TRANSPARENT_ALWAYS_STATE=t.NONE_TRANSPARENT_ALWAYS_STATE,e.FRONT_CULLFACE_GREATER_STATE=t.FRONT_CULLFACE_GREATER_STATE,e.BACK_ADD_BLENDSORT_STATE=t.BACK_ADD_BLENDSORT_STATE,e.BACK_ADD_ALWAYS_STATE=t.BACK_ADD_ALWAYS_STATE,e.BACK_ALPHA_ADD_ALWAYS_STATE=t.BACK_ALPHA_ADD_ALWAYS_STATE,e.NONE_ADD_ALWAYS_STATE=t.NONE_ADD_ALWAYS_STATE,e.NONE_ADD_BLENDSORT_STATE=t.NONE_ADD_BLENDSORT_STATE,e.NONE_ALPHA_ADD_ALWAYS_STATE=t.NONE_ALPHA_ADD_ALWAYS_STATE,e.FRONT_ADD_ALWAYS_STATE=t.FRONT_ADD_ALWAYS_STATE,e.FRONT_TRANSPARENT_STATE=t.FRONT_TRANSPARENT_STATE,e.FRONT_TRANSPARENT_ALWAYS_STATE=t.FRONT_TRANSPARENT_ALWAYS_STATE,e.NONE_CULLFACE_NORMAL_ALWAYS_STATE=t.NONE_CULLFACE_NORMAL_ALWAYS_STATE,e.BACK_ALPHA_ADD_BLENDSORT_STATE=t.BACK_ALPHA_ADD_BLENDSORT_STATE}}e.RenderingState=s},"56c5":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("030e"));class a{static SetRenderer(t){a.m_rc=t.getRC(),a.m_webGLVer=t.getWebGLVersion();let e=a;1==a.m_webGLVer&&null!=r.default.WEBGL_draw_buffers?e.COLOR_ATTACHMENT0=r.default.WEBGL_draw_buffers.COLOR_ATTACHMENT0_WEBGL:e.COLOR_ATTACHMENT0=a.m_rc.COLOR_ATTACHMENT0}static DrawBuffers(t){2==a.m_webGLVer?a.m_rc.drawBuffers(t):null!=r.default.WEBGL_draw_buffers&&r.default.WEBGL_draw_buffers.drawBuffersWEBGL(t)}}a.m_rc=null,a.m_webGLVer=2,a.COLOR_ATTACHMENT0=0,e.default=a},"5deb":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{static GetValue(t,e){switch(e){case s.TEXTURE_2D:return t.TEXTURE_2D;case s.TEXTURE_2D_ARRAY:return t.TEXTURE_2D_ARRAY;case s.TEXTURE_CUBE:return t.TEXTURE_CUBE_MAP;case s.TEXTURE_3D:return t.TEXTURE_3D;default:break}return t.TEXTURE_2D}}s.TEXTURE_2D=20,s.TEXTURE_2D_ARRAY=22,s.TEXTURE_SHADOW_2D=23,s.TEXTURE_CUBE=25,s.TEXTURE_3D=30,e.default=s},"5f3c":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("3b73")),a=s(i("df9d")),n=i("070b"),_=i("a5ba");class l{constructor(t){this.m_uid=-1,this.m_nodeLinker=new a.default,this.m_shader=null,this.index=-1,this.shdUid=-1,this.procuid=-1,this.batchEnabled=!0,this.fixedState=!0,this.runMode=0,this.rpoNodeBuilder=null,this.rpoUnitBuilder=null,this.vtxResource=null,this.m_shader=t,this.m_uid=l.s_uid++}showInfo(){this.m_nodeLinker.showInfo()}addNode(t){this.m_nodeLinker.addNodeAndSort(t)}rejoinNode(t){this.m_nodeLinker.containsNode(t)&&(this.m_nodeLinker.removeNodeAndSort(t),this.m_nodeLinker.addNodeAndSort(t))}removeNode(t){this.m_nodeLinker.removeNodeAndSort(t)}isEmpty(){return null==this.m_nodeLinker.getBegin()}run(t){switch(this.runMode){case 2:this.run2(t);break;case 1:this.run1(t);break;case 0:this.run0(t);break;default:break}}run0(t){let e=this.m_nodeLinker.getBegin();if(null!=e){this.m_shader.bindToGpu(this.shdUid),this.m_shader.resetUniform();let i=null;while(null!=e)e.drawEnabled&&(i=e.unit,i.drawEnabled&&(i.run(t),i.partTotal<1?i.drawThis(t):i.drawPart(t))),e=e.next}}run1(t){let e=this.m_nodeLinker.getBegin();if(null!=e){this.m_shader.bindToGpu(this.shdUid),this.m_shader.resetUniform();let i=null,s=this.m_nodeLinker.getVtxTotalAt(e.rvroI),r=this.m_nodeLinker.getTexTotalAt(e.rtroI),a=s>0,n=r>0;while(null!=e)s<1&&(s=this.m_nodeLinker.getVtxTotalAt(e.rvroI),a=!0),s--,r<1&&(r=this.m_nodeLinker.getTexTotalAt(e.rtroI),n=!0),r--,e.drawEnabled&&(i=e.unit,i.drawEnabled&&(a&&(e.vro.run(),a=!1),n&&(e.tro.run(),n=!1),i.run2(t),i.partTotal<1?i.drawThis(t):i.drawPart(t))),e=e.next}}run2(t){let e=this.m_nodeLinker.getBegin();if(null!=e){this.m_shader.bindToGpu(this.shdUid),this.m_shader.resetUniform();let i=null;_.RenderStateObject.UseRenderState(e.unit.renderState),n.RenderColorMask.UseRenderState(e.unit.rcolorMask);let s=this.m_nodeLinker.getVtxTotalAt(e.rvroI),r=this.m_nodeLinker.getTexTotalAt(e.rtroI),a=s>0,l=r>0;while(null!=e)s<0&&(s=this.m_nodeLinker.getVtxTotalAt(e.rvroI),a=!0),s--,r<0&&(r=this.m_nodeLinker.getTexTotalAt(e.rtroI),l=!0),r--,e.drawEnabled&&(i=e.unit,i.drawEnabled&&(a&&(e.vro.run(),a=!1),l&&(e.tro.run(),l=!1),null!=i.ubo&&i.ubo.run(t),this.m_shader.useTransUniform(i.transUniform),this.m_shader.useUniform(i.uniform),i.partTotal<1?i.drawThis(t):i.drawPart(t))),e=e.next}}runLockMaterial(t){let e=this.m_nodeLinker.getBegin();if(null!=e){this.m_shader.bindToGpu(this.shdUid),this.m_shader.resetUniform();let i=this.m_shader.isTextureUnLocked();t.Texture.unlocked=i;let s=null;if(this.batchEnabled){let r=this.m_nodeLinker.getVtxTotalAt(e.rvroI),a=r>0;while(null!=e)r<1&&(r=this.m_nodeLinker.getVtxTotalAt(e.rvroI),a=!0),r--,s=e.unit,e.drawEnabled&&s.drawEnabled&&(a&&(e.vro.run(),a=!1),i&&e.tro.run(),s.runLockMaterial2(null),s.partTotal<1?s.drawThis(t):s.drawPart(t)),e=e.next}else while(null!=e)s=e.unit,e.drawEnabled&&s.drawEnabled&&(s.runLockMaterial(),i&&e.tro.run(),s.partTotal<1?s.drawThis(t):s.drawPart(t)),e=e.next;t.Texture.unlocked=!1}}drawUnit(t,e,i){e.drawEnabled&&(this.m_shader.bindToGpu(e.shdUid),e.run(t),e.partTotal<1?e.drawThis(t):e.drawPart(t))}drawLockMaterialByUnit(t,e,i,s,a){if(e.drawEnabled){if(a&&this.m_shader.resetUniform(),r.default.IsMobileWeb()){let t=this.vtxResource.getVROByResUid(i.getVtxResUid(),this.m_shader.getCurrentShd(),!0);t.run()}else e.vro.run();e.runLockMaterial2(s?this.m_shader.__$globalUniform:null),e.partTotal<1?e.drawThis(t):e.drawPart(t)}}reset(){let t=this.m_nodeLinker.getBegin(),e=null;if(null!=t){let i;while(null!=t)e=t,t=t.next,this.rpoUnitBuilder.setRPNodeParam(e.__$ruid,this.procuid,-1),e.reset(),i=e.unit,this.rpoNodeBuilder.restore(e)&&this.rpoUnitBuilder.restore(i)}this.index=-1,this.shdUid=-1,this.procuid=-1,this.m_nodeLinker.clear(),this.rpoNodeBuilder=null,this.rpoUnitBuilder=null,this.vtxResource=null}destroy(){this.reset()}getUid(){return this.m_uid}toString(){return"[RPOBlock(uid = "+this.m_uid+", index = "+this.index+", shdUid = "+this.shdUid+")]"}}l.s_uid=0,e.default=l},"644c":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{static GetTypeByTypeNS(t){const e=s;switch(t){case"mat4":return e.SHADER_MAT4;case"mat3":return e.SHADER_MAT3;case"mat2":return e.SHADER_MAT2;case"float":return e.SHADER_FLOAT;case"int":return e.SHADER_INT;case"vec4":return e.SHADER_VEC4;case"vec3":return e.SHADER_VEC3;case"vec2":return e.SHADER_VEC2;case"vec4[]":return e.SHADER_VEC4FV;case"vec3[]":return e.SHADER_VEC3FV;case"vec2[]":return e.SHADER_VEC2FV;case"sampler2D":return e.SHADER_SAMPLER2D;case"sampler3D":return e.SHADER_SAMPLER3D;case"samplerCube":return e.SHADER_SAMPLERCUBE;default:break}return s.SHADER_UNDEFINED}static GetTypeNSByType(t){const e=s;switch(t){case e.SHADER_MAT4:return"mat4";case e.SHADER_MAT3:return"mat3";case e.SHADER_MAT2:return"mat2";case e.SHADER_FLOAT:return"float";case e.SHADER_VEC4:return"vec4";case e.SHADER_VEC3:return"vec3";case e.SHADER_VEC2:return"vec2";case e.SHADER_SAMPLER2D:return"sampler2D";case e.SHADER_SAMPLER3D:return"sampler3D";case e.SHADER_SAMPLERCUBE:return"samplerCube";case e.SHADER_UNDEFINED:return"undefined";default:break}return""}}s.ATTRINS_VTX_VS="a_vs",s.ATTRINS_VTX_UVS="a_uvs",s.ATTRINS_VTX_NVS="a_nvs",s.ATTRINS_VTX_CVS="a_cvs",s.UNIFORMNS_OBJ_MAT_NS="u_objMat",s.UNIFORMNS_VIEW_MAT_NS="u_viewMat",s.UNIFORMNS_PROJ_MAT_NS="u_projMat",s.SHADER_UNDEFINED=3010,s.SHADER_VEC2=3011,s.SHADER_VEC3=3012,s.SHADER_VEC4=3013,s.SHADER_VEC2FV=3014,s.SHADER_VEC3FV=3015,s.SHADER_VEC4FV=3016,s.SHADER_MAT2=3017,s.SHADER_MAT3=3018,s.SHADER_MAT4=3019,s.SHADER_FLOAT=3020,s.SHADER_INT=3021,s.SHADER_MAT2FV=3022,s.SHADER_MAT3FV=3023,s.SHADER_MAT4FV=3024,s.SHADER_SAMPLER2D=3031,s.SHADER_SAMPLERCUBE=3032,s.SHADER_SAMPLER3D=3033,s.SHADER_PRECISION_LOWP=3101,s.SHADER_PRECISION_MEDIUMP=3111,s.SHADER_PRECISION_HIGHP=3121,s.UNIFORM_TEX_SAMPLER2D="sampler2D",s.UNIFORM_TEX_SAMPLERCUBE="samplerCube",s.UNIFORM_TEX_SAMPLER3D="sampler3D",s.UNIFORMNS_TEX_SAMPLER_0="u_sampler0",s.UNIFORMNS_TEX_SAMPLER_1="u_sampler1",s.UNIFORMNS_TEX_SAMPLER_2="u_sampler2",s.UNIFORMNS_TEX_SAMPLER_3="u_sampler3",s.UNIFORMNS_TEX_SAMPLER_4="u_sampler4",s.UNIFORMNS_TEX_SAMPLER_5="u_sampler5",s.UNIFORMNS_TEX_SAMPLER_6="u_sampler6",s.UNIFORMNS_TEX_SAMPLER_7="u_sampler7",s.UNIFORMNS_TEX_SAMPLER_LIST=[s.UNIFORMNS_TEX_SAMPLER_0,s.UNIFORMNS_TEX_SAMPLER_1,s.UNIFORMNS_TEX_SAMPLER_2,s.UNIFORMNS_TEX_SAMPLER_3,s.UNIFORMNS_TEX_SAMPLER_4,s.UNIFORMNS_TEX_SAMPLER_5,s.UNIFORMNS_TEX_SAMPLER_6,s.UNIFORMNS_TEX_SAMPLER_7],e.default=s},"670e":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("45db"),r=i("8ae4");class a{constructor(){this.m_uid=a.s_uid++,this.m_attachCount=0,this.version=-1,this.waitDelTimes=0,this.rcuid=0,this.resUid=0,this.vertex=null,this.indices=new r.ROIndicesRes}createVertex(t,e,i){this.vertex=s.ROVertexRes.create(t,e,i),this.vertex.__$attachThis()}__$attachThis(){++this.m_attachCount}__$detachThis(){--this.m_attachCount,this.m_attachCount<1&&(this.m_attachCount=0)}getAttachCount(){return this.m_attachCount}createVRO(t,e,i){let s=this.vertex.createVRO(t,e,i,this.indices);return s.ibufStep=this.indices.ibufStep,s}updateToGpu(t){this.indices.updateToGpu(t),this.vertex.updateToGpu(t)}destroy(t){this.getAttachCount()<1&&this.resUid>=0&&(null!=this.vertex&&(this.vertex.__$detachThis(),this.vertex.destroy(t),this.vertex=null),this.indices.destroy(t),this.resUid=-1)}}a.s_uid=0,e.GpuVtxObject=a},"6d49":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("3b73")),a=s(i("baae")),n=s(i("ffc0")),_=s(i("5deb")),l=s(i("56c5"));class h{constructor(t,e,i){this.m_uid=-1,this.m_rcuid=0,this.m_COLOR_ATTACHMENT0=0,this.m_fbo=null,this.m_depthStencilRBO=null,this.m_depthRBO=null,this.m_colorRBO=null,this.m_width=512,this.m_height=512,this.m_bufferLType=0,this.m_gl=null,this.m_fboTarget=0,this.m_texTargetTypes=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.m_attachmentMaskList=[!0,!0,!0,!0,!0,!0,!0,!0],this.m_preAttachTotal=0,this.m_preAttachIndex=0,this.m_activeAttachmentTotal=0,this.m_attachmentIndex=0,this.m_clearDepthArr=new Float32Array(1),this.m_clearColorArr=new Float32Array(4),this.m_stencilValueArr=new Int16Array(4),this.m_fboSizeChanged=!1,this.textureLevel=0,this.sizeFixed=!1,this.writeDepthEnabled=!0,this.writeStencilEnabled=!1,this.multisampleEnabled=!1,this.multisampleLevel=0,this.m_preAttachments=new Uint32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),this.m_preTragets=new Uint32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),this.m_preFTIndex=0,this.m_haveDepthTex=!1,this.m_resizeW=2,this.m_resizeH=2,this.m_rcuid=t,this.m_texRes=e,this.m_bufferLType=i,this.m_uid=h.s_uid++}getUid(){return this.m_uid}resetAttachmentMask(t){let e=this.m_attachmentMaskList.length-1;while(e>=0)this.m_attachmentMaskList[e]=t,--e}setAttachmentMaskAt(t,e){this.m_attachmentMaskList[t]=e}getActiveAttachmentTotal(){return this.m_haveDepthTex?this.m_activeAttachmentTotal-1:this.m_activeAttachmentTotal}getAttachmentTotal(){return this.m_attachmentMaskList.length}bindToBackbuffer(t){switch(t){case a.default.DRAW_FRAMEBUFFER:this.m_gl.bindFramebuffer(this.m_gl.DRAW_FRAMEBUFFER,null);break;case a.default.READ_FRAMEBUFFER:this.m_gl.indFramebuffer(this.m_gl.READ_FRAMEBUFFER,null);break;default:this.m_gl.bindFramebuffer(this.m_gl.FRAMEBUFFER,null)}}bind(t){if(null!=this.m_fbo)switch(t){case a.default.DRAW_FRAMEBUFFER:this.m_gl.bindFramebuffer(this.m_gl.DRAW_FRAMEBUFFER,this.m_fbo);break;case a.default.READ_FRAMEBUFFER:this.m_gl.bindFramebuffer(this.m_gl.READ_FRAMEBUFFER,this.m_fbo);break;default:this.m_gl.bindFramebuffer(this.m_gl.FRAMEBUFFER,this.m_fbo)}}getFBO(){return this.m_fbo}getDepthStencilRBO(){return this.m_depthStencilRBO}getDepthRBO(){return this.m_depthRBO}getWidth(){return this.m_width}getHeight(){return this.m_height}getFramebufferType(){return this.m_bufferLType}renderToTexAt(t,e,i){let s=null!=e?e.internalFormat:-1;this.m_gl=t,0==i&&(this.m_preFTIndex=0,this.m_haveDepthTex=!1,this.m_gl.bindFramebuffer(this.m_fboTarget,this.m_fbo),s!=n.default.DEPTH_COMPONENT&&s!=n.default.DEPTH_STENCIL&&(this.m_activeAttachmentTotal=0,this.m_attachmentIndex=0));let r=-1,a=null;null!=e?(r=e.getTargetType(),a=this.m_texRes.getGpuBuffer(e.getResUid()),e.uploadFromFbo(this.m_texRes,this.m_width,this.m_height)):r=this.m_texTargetTypes[this.m_activeAttachmentTotal],this.framebufferTextureBind(t,r,s,a)}glFramebufferTex2D(t,e){let i=this.m_gl;i.framebufferTexture2D(this.m_fboTarget,t,i.TEXTURE_2D,e,0),this.m_preAttachments[this.m_preFTIndex]=t,this.m_preTragets[this.m_preFTIndex]=i.TEXTURE_2D,this.m_preFTIndex++}glFramebufferTexCube(t,e,i){let s=this.m_gl;s.framebufferTexture2D(this.m_fboTarget,t,s.TEXTURE_CUBE_MAP_POSITIVE_X+e,i,0),this.m_preAttachments[this.m_preFTIndex]=t,this.m_preTragets[this.m_preFTIndex]=s.TEXTURE_CUBE_MAP_POSITIVE_X+e,this.m_preFTIndex++}framebufferTexture2D(t,e,i,s){let r=-1;switch(i){case n.default.DEPTH_COMPONENT:this.m_haveDepthTex=!0,r=this.m_gl.DEPTH_ATTACHMENT;break;case n.default.DEPTH_STENCIL:this.m_haveDepthTex=!0,r=this.m_gl.DEPTH_STENCIL_ATTACHMENT;break;default:r=this.m_COLOR_ATTACHMENT0+this.m_attachmentIndex;break}r>0&&(this.m_attachmentMaskList[this.m_activeAttachmentTotal]?(this.glFramebufferTex2D(r,s),++this.m_attachmentIndex,this.m_texTargetTypes[this.m_activeAttachmentTotal]=null!=s?e:0):this.m_texTargetTypes[this.m_activeAttachmentTotal]=0,++this.m_activeAttachmentTotal)}framebufferTextureBind(t,e,i,s){switch(e){case _.default.TEXTURE_2D:this.framebufferTexture2D(t,e,i,s);break;case _.default.TEXTURE_CUBE:let r=0;for(let t=0;t<6;++t)this.m_attachmentMaskList[t]?(this.glFramebufferTexCube(this.m_COLOR_ATTACHMENT0+this.m_attachmentIndex,t,s),++this.m_attachmentIndex,this.m_texTargetTypes[this.m_activeAttachmentTotal+t]=null!=s?e:0,r++):this.m_texTargetTypes[this.m_activeAttachmentTotal+t]=0;r=r>0?r:6,this.m_activeAttachmentTotal+=r;break;case _.default.TEXTURE_SHADOW_2D:this.m_attachmentMaskList[this.m_activeAttachmentTotal]?(this.glFramebufferTex2D(this.m_gl.DEPTH_ATTACHMENT,s),this.m_texTargetTypes[this.m_activeAttachmentTotal]=null!=s?e:0):this.m_texTargetTypes[this.m_activeAttachmentTotal]=0,++this.m_activeAttachmentTotal;break;default:break}}reset(){this.m_preAttachTotal=-1,this.m_preAttachIndex=-1}use(t){if(this.m_gl=t,null!=this.m_fbo){if(this.m_activeAttachmentTotal>1){if(this.m_preAttachIndex!=this.m_attachmentIndex){let t=[],e=0;for(;e<this.m_attachmentIndex;++e)t.push(this.m_COLOR_ATTACHMENT0+e);if(this.m_preAttachIndex>this.m_attachmentIndex)for(;e<this.m_preAttachIndex;++e)this.m_gl.framebufferTexture2D(this.m_fboTarget,this.m_preAttachments[e],this.m_preTragets[e],null,0);l.default.DrawBuffers(t),this.m_preAttachIndex=this.m_attachmentIndex}}else if(this.m_preAttachIndex!=this.m_attachmentIndex){if(this.m_preAttachIndex>this.m_attachmentIndex)for(let e=1;e<this.m_preAttachIndex;++e)this.m_gl.framebufferTexture2D(this.m_fboTarget,this.m_preAttachments[e],this.m_preTragets[e],null,0);let t=[this.m_COLOR_ATTACHMENT0];l.default.DrawBuffers(t),this.m_preAttachIndex=this.m_attachmentIndex}this.m_preAttachTotal=this.m_activeAttachmentTotal}}clearOnlyColor(t){if(null!=this.m_fbo)if(r.default.IsWebGL2())if(this.m_clearColorArr[0]=t[0],this.m_clearColorArr[1]=t[1],this.m_clearColorArr[2]=t[2],this.m_clearColorArr[3]=t[3],this.m_preAttachTotal>1)for(let e=0;e<this.m_preAttachTotal;++e)this.m_gl.clearBufferfv(this.m_gl.COLOR,e,this.m_clearColorArr);else this.m_gl.clearBufferfv(this.m_gl.COLOR,0,this.m_clearColorArr);else this.m_gl.clearColor(t[0],t[1],t[2],t[3])}clearOnlyDepth(t=1){r.default.IsWebGL2()?(this.m_clearDepthArr[0]=t,this.m_gl.clearBufferfv(this.m_gl.DEPTH,0,this.m_clearDepthArr)):this.m_gl.clearDepth(t)}clearOnlyStencil(t){this.m_stencilValueArr[0]=t,this.m_gl.clearBufferuiv(this.m_gl.STENCIL,0,this.m_stencilValueArr)}clearOnlyDepthAndStencil(t,e){this.m_gl.clearBufferfi(this.m_gl.DEPTH_STENCIL,0,t,e)}invalidateFramebuffer(){}resize(t,e){this.m_resizeW==t&&this.m_resizeH==e||(this.m_fboSizeChanged=!0,this.m_resizeW=t,this.m_resizeH=e)}initialize(t,e,i){this.m_gl=t,this.m_COLOR_ATTACHMENT0=l.default.COLOR_ATTACHMENT0,this.m_fboSizeChanged&&(e=this.m_resizeW,i=this.m_resizeH),null==this.m_fbo?this.createNewFBO(t,e,i):this.m_width==e&&this.m_height==i||this.createNewFBO(t,e,i),this.m_fboSizeChanged=!1}isSizeChanged(){return this.m_fboSizeChanged}destroy(t){null!=this.m_fbo&&(null!=this.m_depthStencilRBO&&(t.deleteFramebuffer(this.m_depthStencilRBO),this.m_depthStencilRBO=null),null!=this.m_depthRBO&&(t.deleteFramebuffer(this.m_depthRBO),this.m_depthRBO=null),null!=this.m_colorRBO&&(t.deleteFramebuffer(this.m_colorRBO),this.m_colorRBO=null),t.deleteFramebuffer(this.m_fbo),this.m_fbo=null),this.m_gl=null,this.m_fboTarget=0,this.m_fboSizeChanged=!1}buildDepthStencilRBO(t,e,i){null==this.m_depthStencilRBO&&(this.m_depthStencilRBO=t.createRenderbuffer()),this.multisampleEnabled?(t.bindRenderbuffer(t.RENDERBUFFER,this.m_depthStencilRBO),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.DEPTH_STENCIL,e,i),t.framebufferRenderbuffer(this.m_fboTarget,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,this.m_depthStencilRBO),null==this.m_colorRBO&&(this.m_colorRBO=t.createRenderbuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.m_colorRBO),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.RGBA8,e,i),t.framebufferRenderbuffer(this.m_fboTarget,this.m_COLOR_ATTACHMENT0,t.RENDERBUFFER,this.m_colorRBO)):(t.bindRenderbuffer(t.RENDERBUFFER,this.m_depthStencilRBO),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,e,i),t.framebufferRenderbuffer(this.m_fboTarget,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,this.m_depthStencilRBO))}buildDepthRBO(t,e,i){null==this.m_depthRBO&&(this.m_depthRBO=t.createRenderbuffer()),this.multisampleEnabled?(t.bindRenderbuffer(t.RENDERBUFFER,this.m_depthRBO),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.DEPTH_COMPONENT24,e,i),t.framebufferRenderbuffer(this.m_fboTarget,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.m_depthRBO),null==this.m_colorRBO&&(this.m_colorRBO=t.createRenderbuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.m_colorRBO),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.RGBA8,e,i),t.framebufferRenderbuffer(this.m_fboTarget,this.m_COLOR_ATTACHMENT0,t.RENDERBUFFER,this.m_colorRBO)):(t.bindRenderbuffer(t.RENDERBUFFER,this.m_depthRBO),r.default.IsWebGL2()?t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT24,e,i):t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,e,i),t.framebufferRenderbuffer(this.m_fboTarget,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.m_depthRBO))}buildStencilRBO(t,e,i){null==this.m_depthStencilRBO&&(null==this.m_depthStencilRBO&&(this.m_depthStencilRBO=t.createRenderbuffer()),this.multisampleEnabled?(t.bindRenderbuffer(t.RENDERBUFFER,this.m_depthStencilRBO),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.STENCIL_INDEX8,e,i),t.framebufferRenderbuffer(this.m_fboTarget,t.STENCIL_ATTACHMENT,t.RENDERBUFFER,this.m_depthStencilRBO),null==this.m_colorRBO&&(this.m_colorRBO=t.createRenderbuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.m_colorRBO),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.RGBA8,e,i),t.framebufferRenderbuffer(this.m_fboTarget,this.m_COLOR_ATTACHMENT0,t.RENDERBUFFER,this.m_colorRBO)):(t.bindRenderbuffer(t.RENDERBUFFER,this.m_depthStencilRBO),t.renderbufferStorage(t.RENDERBUFFER,t.STENCIL_INDEX8,e,i),t.framebufferRenderbuffer(this.m_fboTarget,t.STENCIL_ATTACHMENT,t.RENDERBUFFER,this.m_depthStencilRBO)))}buildColorRBO(t,e,i){this.multisampleEnabled&&(null==this.m_colorRBO&&(this.m_colorRBO=t.createRenderbuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.m_colorRBO),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.RGBA8,e,i),t.framebufferRenderbuffer(this.m_fboTarget,this.m_COLOR_ATTACHMENT0,t.RENDERBUFFER,this.m_colorRBO))}createNewFBO(t,e,i){let s=null==this.m_fbo;switch(this.m_preAttachTotal=this.m_activeAttachmentTotal=0,this.m_preAttachIndex=this.m_attachmentIndex=0,this.m_width=e,this.m_height=i,this.m_resizeW=e,this.m_resizeH=i,s&&(this.m_fbo=t.createFramebuffer()),this.m_bufferLType){case a.default.DRAW_FRAMEBUFFER:this.m_fboTarget=t.DRAW_FRAMEBUFFER;break;case a.default.READ_FRAMEBUFFER:this.m_fboTarget=t.READ_FRAMEBUFFER;break;default:this.m_fboTarget=t.FRAMEBUFFER;break}if(t.bindFramebuffer(this.m_fboTarget,this.m_fbo),this.writeDepthEnabled?this.writeStencilEnabled?null==this.m_depthStencilRBO&&this.buildDepthStencilRBO(t,e,i):this.buildDepthRBO(t,e,i):this.writeStencilEnabled?this.buildStencilRBO(t,e,i):this.buildColorRBO(t,e,i),s){t.checkFramebufferStatus(this.m_fboTarget);t.FRAMEBUFFER_COMPLETE}h.BindToBackbuffer(t,this.m_bufferLType)}static BindToBackbuffer(t,e){switch(e){case a.default.DRAW_FRAMEBUFFER:t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null);break;case a.default.READ_FRAMEBUFFER:t.indFramebuffer(t.READ_FRAMEBUFFER,null);break;default:t.bindFramebuffer(t.FRAMEBUFFER,null);break}}}h.s_uid=0,e.default=h},"722e":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{}s.NEAREST=4001,s.LINEAR=4002,s.LINEAR_MIPMAP_LINEAR=4003,s.NEAREST_MIPMAP_NEAREST=4004,s.LINEAR_MIPMAP_NEAREST=4005,s.NEAREST_MIPMAP_LINEAR=4006,e.default=s},7279:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("3b73")),a=s(i("d53d"));class n extends a.default{constructor(t){super(),this.m_slot=null,this.m_slotFlags=null,this.m_slotDatas=null,this.slotId=0,this.slotIndex=0,this.uniformsTotal=0,this.locationIndexList=null,this.locations=null,this.rst=0,this.always=!1,this.m_slot=t,this.m_slotFlags=this.m_slot.flagList,this.m_slotDatas=this.m_slot.dataList}applyData(){}clone(){let t=new n(this.m_slot);return t.types=this.types.slice(0),t.uniformNameList=this.uniformNameList.slice(0),t.dataSizeList=this.dataSizeList.slice(0),t.slotIndex=this.slotIndex,t.uniformsTotal=this.uniformsTotal,t.slotId=this.slotId,t.always=this.always,t.rst=this.rst,t}copyDataFromProbe(t){this.types=t.uniformTypes.slice(0),this.dataSizeList=t.dataSizeList.slice(0),this.slotIndex=t.getSlotBeginIndex(),this.uniformsTotal=t.uniformsTotal,this.slotId=t.getRCUid()}copyDataFromProbeAt(t,e){null==this.types&&(this.types=[],this.dataSizeList=[]),this.slotIndex=e.getSlotBeginIndex()+t,this.uniformsTotal=1,this.slotId=e.getRCUid(),this.types[0]=e.uniformTypes[t],this.dataSizeList[0]=e.dataSizeList[t]}use(t){if(this.always||this.rst!=this.m_slotFlags[this.slotIndex]){this.rst=this.m_slotFlags[this.slotIndex];let e=0,i=this.m_slotDatas;if(r.default.IsWebGL1())for(;e<this.uniformsTotal;++e)t.useUniformV1(this.locations[e],this.types[e],i[this.slotIndex+e],this.dataSizeList[e]);else for(;e<this.uniformsTotal;++e)t.useUniformV2(this.locations[e],this.types[e],i[this.slotIndex+e],this.dataSizeList[e],0)}}destroy(){this.types=null,this.dataSizeList=null,this.slotIndex=-1,this.uniformsTotal=0,this.m_slot=null,this.m_slotFlags=null,this.m_slotDatas=null}}e.default=n},7499:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.m_dispBuilder=null,this.m_shader=null,this.m_texRes=null}setDispBuilder(t){null==this.m_dispBuilder&&(this.m_dispBuilder=t,this.m_shader=t.getRenderShader(),this.m_texRes=t.getTextureResource())}unlockMaterial(){this.m_shader.unlock(),this.m_texRes.unlocked=!0}lockMaterial(){this.m_shader.lock(),this.m_texRes.unlocked=!1}isUnlockMatrial(){return this.m_texRes.unlocked}unlockTexture(){this.m_shader.textureUnlock()}lockTexture(){this.m_shader.textureLock()}renderBegin(){this.m_shader.renderBegin(),this.m_texRes.renderBegin()}resetUniform(){this.m_shader.resetUniform()}useGlobalMaterial(t,e=!1){null!=t&&this.m_dispBuilder.updateGlobalMaterial(t,e)}updateMaterialUniform(t){this.m_shader.updateUniform(t.__$uniform)}}e.default=s},"74c3":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(t,e,i){this.m_resMap=new Map,this.m_freeMap=new Map,this.m_updateIds=[],this.m_vtxResTotal=0,this.m_attachTotal=0,this.m_delay=128,this.m_haveDeferredUpdate=!1,this.m_vtxUpdateTotal=16,this.m_rcuid=0,this.m_gl=null,this.m_vtxBuilder=null,this.unlocked=!0,this.m_rcuid=t,this.m_gl=e,this.m_vtxBuilder=i}setVtxUpdateTimesTotal(t){this.m_vtxUpdateTotal=t>4?t:4}createResByParams3(t,e,i,s){return!1}getRCUid(){return this.m_rcuid}getRC(){return this.m_gl}hasResUid(t){return this.m_resMap.has(t)}bindToGpu(t){}getGpuBuffer(t){return null}renderBegin(){this.m_vtxBuilder.renderBegin()}getVertexResTotal(){return this.m_vtxResTotal}updateDataToGpu(t,e){e?(this.m_updateIds.push(t),this.m_haveDeferredUpdate=!0):this.m_resMap.has(t)&&this.m_resMap.get(t).updateToGpu(this.m_vtxBuilder)}addVertexRes(t){this.m_resMap.has(t.resUid)||(t.waitDelTimes=0,this.m_resMap.set(t.resUid,t),this.m_vtxResTotal++)}getVertexRes(t){return this.m_resMap.get(t)}destroyRes(t){this.m_resMap.has(t)&&this.m_resMap.get(t).destroy(this.m_vtxBuilder)}__$attachRes(t){if(this.m_resMap.has(t)){this.m_attachTotal++;let e=this.m_resMap.get(t);e.getAttachCount()<1&&this.m_freeMap.has(t)&&this.m_freeMap.delete(t),e.waitDelTimes=0,e.__$attachThis()}}__$detachRes(t){if(this.m_resMap.has(t)&&this.m_resMap.has(t)){let e=this.m_resMap.get(t);e.getAttachCount()>0&&(this.m_attachTotal--,e.__$detachThis(),e.getAttachCount()<1&&this.m_freeMap.set(t,e))}}getVROByResUid(t,e,i){let s=this.m_resMap.get(t);return null!=s?s.createVRO(this.m_vtxBuilder,e,i):null}update(){if(this.m_haveDeferredUpdate){let t=this.m_updateIds.length;if(t>0){let e;t>this.m_vtxUpdateTotal&&(t=this.m_vtxUpdateTotal);for(let i=0;i<t;++i)e=this.m_updateIds.shift(),this.m_resMap.has(e)&&this.m_resMap.get(e).updateToGpu(this.m_vtxBuilder)}else this.m_haveDeferredUpdate=!1}if(this.m_delay--,this.m_delay<1){this.m_delay=128;for(const[t,e]of this.m_freeMap)e.waitDelTimes++,e.getAttachCount()<1?e.waitDelTimes>5&&(this.m_resMap.delete(e.resUid),this.m_freeMap.delete(e.resUid),e.destroy(this.m_vtxBuilder),this.m_vtxResTotal--):this.m_freeMap.delete(e.resUid)}}}e.ROVertexResource=s,e.default=s},7696:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("264c")),a=s(i("5f3c")),n=s(i("9156"));class _{constructor(t,e,i,s,r,a){this.m_rcuid=-1,this.m_rpIndex=-1,this.m_nodesLen=0,this.m_enabled=!0,this.m_blockList=[],this.m_blockListLen=0,this.m_blockFList=new Int8Array(_.s_max_shdTotal),this.m_blockFListLen=_.s_max_shdTotal,this.m_shader=null,this.m_rpoNodeBuilder=null,this.m_rpoUnitBuilder=null,this.m_vtxResource=null,this.m_fixBlock=null,this.m_sortBlock=null,this.m_sorter=null,this.m_batchEnabled=!0,this.m_fixedState=!0,this.m_sortEnabled=!1,this.m_version=0,this.uid=-1,this.m_shader=t,this.m_rpoNodeBuilder=e,this.m_rpoUnitBuilder=i,this.m_vtxResource=s,this.m_fixBlock=this.createBlock(),this.m_batchEnabled=r,this.m_fixedState=a;for(let n=0;n<this.m_blockFListLen;++n)this.m_blockFList[n]=-1}createBlock(){let t=new a.default(this.m_shader);return t.rpoNodeBuilder=this.m_rpoNodeBuilder,t.rpoUnitBuilder=this.m_rpoUnitBuilder,t.vtxResource=this.m_vtxResource,t}setRenderParam(t,e){this.m_blockListLen<1&&(this.m_batchEnabled=t,this.m_fixedState=e)}setRendererParam(t,e){this.m_rc=t,this.m_rcuid=t.getRCUid(),this.m_rpIndex=e}getUid(){return this.uid}getRCUid(){return this.m_rcuid}getRPIndex(){return this.m_rpIndex}hasSorter(){return null!=this.m_sorter}setSorter(t){this.m_sorter=t,null!=this.m_sortBlock&&this.m_sortBlock.setSorter(t)}setSortEnabled(t){this.m_nodesLen<1?this.m_sortEnabled=t:null!=this.m_sortBlock&&(this.m_sortBlock.sortEnabled=t)}getSortEnabled(){return this.m_sortEnabled}getUnitsTotal(){return this.m_nodesLen}addNodeToBlock(t){let e=null;if(t.shdUid>=_.s_max_shdTotal)throw Error("Shader uid >= "+_.s_max_shdTotal);this.m_blockFList[t.shdUid]<0?(e=this.createBlock(),e.batchEnabled=this.m_batchEnabled,e.fixedState=this.m_fixedState,e.batchEnabled?e.fixedState?e.runMode=2:e.runMode=1:e.runMode=0,e.shdUid=t.shdUid,e.index=this.m_blockListLen,e.procuid=this.m_rpIndex,this.m_blockList.push(e),this.m_blockFList[t.shdUid]=this.m_blockListLen,++this.m_blockListLen):e=this.m_blockList[this.m_blockFList[t.shdUid]],t.index=e.index,e.addNode(t)}rejoinRunitForTro(t){let e=this.m_rpoNodeBuilder.getNodeByUid(t.__$rpuid);null!=e&&(e.tro=t.tro,e.texMid=e.unit.texMid,this.m_blockList[e.index].rejoinNode(e))}rejoinRunitForVro(t){let e=this.m_rpoNodeBuilder.getNodeByUid(t.__$rpuid);null!=e&&(e.drawMode=t.drawMode,e.ivsIndex=t.ivsIndex,e.ivsCount=t.ivsCount,e.insCount=t.insCount,t.drawOffset=t.ivsIndex*t.ibufStep,e.vtxUid=t.vtxUid,e.vro=t.vro,this.m_blockList[e.index].rejoinNode(e),this.m_version++)}addDisp(t){if(null!=t&&null!=t.__$$runit&&t.__$$runit.getRPROUid()<0&&t.__$$runit.getRPROUid()!=this.uid){let e=this.m_rpoNodeBuilder.create();e.unit=this.m_rpoUnitBuilder.getNodeByUid(t.__$ruid),e.unit.shader=this.m_shader,e.unit.__$rprouid=this.uid,t.__$rpuid=e.uid,e.__$ruid=t.__$ruid,e.unit.__$rpuid=e.uid,e.updateData(),++this.m_nodesLen,this.m_rpoUnitBuilder.setRPNodeParam(t.__$ruid,this.getUid(),e.uid),this.m_sortEnabled?(null!=this.m_sortBlock||(this.m_sortBlock=new r.default(this.m_shader),this.m_sortBlock.setSorter(this.m_sorter)),this.m_sortBlock.addNode(e)):this.addNodeToBlock(e),this.m_version++}}updateDispMateiral(t){if(null!=t.__$$runit){let e=t.__$$runit.getRPOUid(),i=this.m_rpoNodeBuilder.getNodeByUid(e);i.shdUid=i.unit.shdUid,i.texMid=i.unit.texMid,i.tro=i.unit.tro;let s=this.m_blockList[i.index];s.removeNode(i),this.addNodeToBlock(i)}}removeDisp(t){if(null!=t&&null!=t.__$$runit){let e=t.__$$runit.getRPOUid(),i=this.m_rpoNodeBuilder.getNodeByUid(e);if(null!=i){let e=i.unit,s=e.transUniform;if(null!=s&&n.default.RemoveTransUniform(s.key),null==this.m_sortBlock){let t=this.m_blockList[i.index];t.removeNode(i)}else this.m_sortBlock.removeNode(i);this.m_rpoUnitBuilder.setRPNodeParam(t.__$ruid,this.getUid(),-1),--this.m_nodesLen,this.m_rpoNodeBuilder.restore(i)&&this.m_rpoUnitBuilder.restore(e),this.m_vtxResource.__$detachRes(t.getVtxResUid()),t.__$$runit=null,t.__$ruid=-1,this.m_version++}}}getStatus(){return this.m_version}removeDispUnit(t){if(null!=t&&t.__$ruid>-1){let e=t.__$$runit.getRPOUid(),i=this.m_rpoNodeBuilder.getNodeByUid(e);if(null!=i){if(null==this.m_sortBlock){let t=this.m_blockList[i.index];t.removeNode(i)}else this.m_sortBlock.removeNode(i);this.m_rpoUnitBuilder.setRPNodeParam(t.__$ruid,this.m_rpIndex,-1),i.unit.__$rprouid=-1,--this.m_nodesLen,this.m_rpoNodeBuilder.restore(i)}}}update(){this.m_enabled&&this.m_nodesLen>0&&null!=this.m_sortBlock&&this.m_sortBlock.update()}run(){if(this.m_enabled&&this.m_nodesLen>0){let t=this.m_rc;if(null==this.m_sortBlock)if(this.m_shader.isUnLocked())for(let e=0;e<this.m_blockListLen;++e)this.m_blockList[e].run(t);else for(let e=0;e<this.m_blockListLen;++e)this.m_blockList[e].runLockMaterial(t);else this.m_shader.isUnLocked()?this.m_sortBlock.run(t):this.m_sortBlock.runLockMaterial(t)}}drawDisp(t,e=!1,i=!0){if(null!=t){let s=t.__$$runit;null!=s&&(this.m_shader.isUnLocked()?(i&&this.m_shader.resetUniform(),this.m_fixBlock.drawUnit(this.m_rc,s,t)):this.m_fixBlock.drawLockMaterialByUnit(this.m_rc,s,t,e,i))}}drawLockMaterialByDisp(t,e=!1,i=!0){if(null!=t){let s=t.__$$runit;null!=s&&this.m_fixBlock.drawLockMaterialByUnit(this.m_rc,s,t,e,i)}}reset(){this.m_sortEnabled=!1,this.m_nodesLen=0,this.uid=-1,this.m_rpIndex=-1,this.m_rcuid=-1,this.m_rpIndex=-1;let t=0;for(;t<this.m_blockListLen;++t)this.m_blockList[t].reset();this.m_blockListLen=0,this.m_blockList=[],this.m_rpoNodeBuilder=null,this.m_rpoUnitBuilder=null,this.m_vtxResource=null,this.m_rc=null,null!=this.m_sortBlock&&(this.m_sortBlock.clear(),this.m_sortBlock=null)}showInfo(){let t=0;for(;t<this.m_blockListLen;++t)this.m_blockList[t].showInfo()}destroy(){this.reset()}setEnabled(t){this.m_enabled=t}getEnabled(){return this.m_enabled}toString(){return"[RenderProcess(uid = "+this.m_rpIndex+")]"}}_.s_max_shdTotal=1024,e.default=_},8171:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(t){this.m_rstate=null,this.m_rstate=t}setDepthTestEnable(t){this.m_rstate.setDepthTestEnable(t)}setStencilFunc(t,e,i){this.m_rstate.setStencilFunc(t,e,i)}setStencilMask(t){this.m_rstate.setStencilMask(t)}setStencilOp(t,e,i){this.m_rstate.setStencilOp(t,e,i)}}e.Stencil=s},8333:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{}s.COLOR_BUFFER_BIT=131,s.DEPTH_BUFFER_BIT=132,s.STENCIL_BUFFER_BIT=133,e.default=s},"83d1":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("ab73"));class a{create(t,e){let i=r.default.StageParam;return e.hasUniformByName(i.name)?t.uniformContext.createShaderGlobalUniformFromProbe(t.getStage3D().uProbe,i.name,[i.name]):null}getIDNS(){return"StageParamUniformBuilder"}}e.default=a},"857b":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("ab73"));class a{create(t,e){let i=r.default.CameraPosParam;return e.hasUniformByName(i.name)?t.uniformContext.createShaderGlobalUniformFromProbe(t.getCamera().ucameraPosProbe,i.name,[i.name]):null}getIDNS(){return"CameraPosUniformBuilder"}}e.default=a},8875:function(t,e,i){var s,r,a;(function(i,n){r=[],s=n,a="function"===typeof s?s.apply(e,r):s,void 0===a||(t.exports=a)})("undefined"!==typeof self&&self,(function(){function t(){var e=Object.getOwnPropertyDescriptor(document,"currentScript");if(!e&&"currentScript"in document&&document.currentScript)return document.currentScript;if(e&&e.get!==t&&document.currentScript)return document.currentScript;try{throw new Error}catch(m){var i,s,r,a=/.*at [^(]*\((.*):(.+):(.+)\)$/gi,n=/@([^@]*):(\d+):(\d+)\s*$/gi,_=a.exec(m.stack)||n.exec(m.stack),l=_&&_[1]||!1,h=_&&_[2]||!1,o=document.location.href.replace(document.location.hash,""),d=document.getElementsByTagName("script");l===o&&(i=document.documentElement.outerHTML,s=new RegExp("(?:[^\\n]+?\\n){0,"+(h-2)+"}[^<]*<script>([\\d\\D]*?)<\\/script>[\\d\\D]*","i"),r=i.replace(s,"$1").trim());for(var u=0;u<d.length;u++){if("interactive"===d[u].readyState)return d[u];if(d[u].src===l)return d[u];if(l===o&&d[u].innerHTML&&d[u].innerHTML.trim()===r)return d[u]}return null}}return t}))},"8a0a":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("ca6c"));class a{static ToGL(t,e){const i=a;switch(e){case i.VTX_STATIC_DRAW:return t.STATIC_DRAW;case i.VTX_DYNAMIC_DRAW:return t.DYNAMIC_DRAW;case i.VTX_STREAM_DRAW:return t.STREAM_DRAW;case i.VTX_STATIC_READ:return t.STATIC_READ;case i.VTX_DYNAMIC_READ:return t.DYNAMIC_READ;case i.VTX_STREAM_READ:return t.STREAM_READ;case i.VTX_STATIC_COPY:return t.STATIC_COPY;case i.VTX_DYNAMIC_COPY:return t.DYNAMIC_COPY;case i.VTX_STREAM_COPY:return t.STREAM_COPY;default:break}return t.STATIC_DRAW}static GetVBufTypeByNS(t){const e=a;switch(t){case e.VBUF_VS_NS:return e.VBUF_VS;case e.VBUF_UVS_NS:return e.VBUF_UVS;case e.VBUF_NVS_NS:return e.VBUF_NVS;case e.VBUF_CVS_NS:return e.VBUF_CVS;case e.VBUF_VS2_NS:return e.VBUF_VS2;case e.VBUF_UVS2_NS:return e.VBUF_UVS2;case a.VBUF_NVS2_NS:return a.VBUF_NVS2;case e.VBUF_CVS2_NS:return e.VBUF_CVS2;case e.VBUF_TVS_NS:return e.VBUF_TVS;case e.VBUF_TVS2_NS:return e.VBUF_TVS2;default:}return-1}static GetVBufNSByType(t){const e=a;switch(t){case e.VBUF_VS:return e.VBUF_VS_NS;case e.VBUF_UVS:return e.VBUF_UVS_NS;case e.VBUF_NVS:return e.VBUF_NVS_NS;case e.VBUF_CVS:return e.VBUF_CVS_NS;case e.VBUF_VS2:return e.VBUF_VS2_NS;case e.VBUF_UVS2:return e.VBUF_UVS2_NS;case e.VBUF_NVS2:return e.VBUF_NVS2_NS;case e.VBUF_CVS2:return e.VBUF_CVS2_NS;case e.VBUF_TVS:return e.VBUF_TVS_NS;case e.VBUF_TVS2:return e.VBUF_TVS2_NS;default:}return""}static GetVBufAttributeTypeByNS(t){return a.GetVBufTypeByNS(t)-3e3}static GetVBufAttributeTypeByVBufType(t){return t-3e3}}a.VTXTYPE_GL_POINTS=101,a.VTXTYPE_GL_LINES=102,a.VTXTYPE_GL_LINE_STRIP=103,a.VTXTYPE_GL_TRIANGLES=111,a.VTX_STATIC_DRAW=0,a.VTX_DYNAMIC_DRAW=1,a.VTX_STREAM_DRAW=2,a.VTX_STATIC_READ=3,a.VTX_DYNAMIC_READ=4,a.VTX_STREAM_READ=5,a.VTX_STATIC_COPY=6,a.VTX_DYNAMIC_COPY=7,a.VTX_STREAM_COPY=8,a.VBUF_VS=3001,a.VBUF_UVS=3002,a.VBUF_NVS=3003,a.VBUF_CVS=3004,a.VBUF_TVS=3005,a.VBUF_VS2=3006,a.VBUF_UVS2=3007,a.VBUF_NVS2=3008,a.VBUF_CVS2=3009,a.VBUF_TVS2=3010,a.VBUF_VS_INDEX=r.default.BIT_ONE_0,a.VBUF_UVS_INDEX=r.default.BIT_ONE_1,a.VBUF_NVS_INDEX=r.default.BIT_ONE_2,a.VBUF_CVS_INDEX=r.default.BIT_ONE_3,a.VBUF_TVS_INDEX=r.default.BIT_ONE_4,a.VBUF_VS2_INDEX=r.default.BIT_ONE_5,a.VBUF_UVS2_INDEX=r.default.BIT_ONE_6,a.VBUF_NVS2_INDEX=r.default.BIT_ONE_7,a.VBUF_CVS2_INDEX=r.default.BIT_ONE_8,a.VBUF_TVS2_INDEX=r.default.BIT_ONE_9,a.VBUF_VS_NS="a_vs",a.VBUF_VS2_NS="a_vs2",a.VBUF_UVS_NS="a_uvs",a.VBUF_UVS2_NS="a_uvs2",a.VBUF_NVS_NS="a_nvs",a.VBUF_NVS2_NS="a_nvs2",a.VBUF_CVS_NS="a_cvs",a.VBUF_CVS2_NS="a_cvs2",a.VBUF_TVS_NS="a_tvs",a.VBUF_TVS2_NS="a_tvs2";class n{}n.FLAT=210,n.GOURAND=310,e.VtxNormalType=n,e.default=a},"8ae4":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.m_uid=s.s_uid++,this.m_vtx=null,this.m_vtxUid=0,this.m_gpuBuf=null,this.m_ivsSize=0,this.version=-1,this.ibufStep=0}getUid(){return this.m_uid}getVtxUid(){return this.m_vtxUid}getGpuBuf(){return this.m_gpuBuf}getVTCount(){return this.m_ivsSize}updateToGpu(t){if(null!=this.m_gpuBuf&&this.m_ivsSize>0){let e=this.m_vtx;this.version!=e.indicesVer&&(this.m_ivs=e.getIvsData(),t.bindEleBuf(this.m_gpuBuf),this.m_ivsSize>=this.m_ivs.length?t.eleBufSubData(this.m_ivs,e.getBufDataUsage()):t.eleBufData(this.m_ivs,e.getBufDataUsage()),this.m_ivsSize=this.m_ivs.length,this.version=e.indicesVer)}}initialize(t,e){if(null==this.m_gpuBuf&&null!=e.getIvsData())if(this.version=e.indicesVer,this.m_vtx=e,this.m_vtxUid=e.getUid(),this.m_ivs=e.getIvsData(),this.m_gpuBuf=t.createBuf(),t.bindEleBuf(this.m_gpuBuf),null==e.bufData)t.eleBufData(this.m_ivs,e.getBufDataUsage()),this.m_ivsSize=this.m_ivs.length;else{t.eleBufDataMem(e.bufData.getIndexDataTotalBytes(),e.getBufDataUsage());let i=null,s=0;this.m_ivsSize=0;for(let r=0,a=e.bufData.getIndexDataTotal();r<a;++r)i=e.bufData.getIndexDataAt(r),t.eleBufSubData(i,s),s+=i.byteLength,this.m_ivsSize+=i.length}}destroy(t){null!=this.m_gpuBuf&&(this.m_vtx=null,t.deleteBuf(this.m_gpuBuf),this.m_gpuBuf=null,this.m_ivs=null,this.m_ivsSize=0)}}s.s_uid=0,e.ROIndicesRes=s},"8def":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("919c"));class a extends r.default{constructor(){super(),this.shdp=null,this.vbufs=null,this.vbuf=null,this.attribTypes=null,this.wholeOffsetList=null,this.attribTypesLen=0,this.updateUnlocked=!0,this.wholeStride=0,this.m_uid=a.s_uid++}run(){this.m_rc.testVROUid(this.m_uid)&&(null!=this.vbuf?this.m_rc.useVtxAttribsPtrTypeFloat(this.shdp,this.vbuf,this.attribTypes,this.attribTypesLen,this.wholeOffsetList,this.wholeStride):this.m_rc.useVtxAttribsPtrTypeFloatMulti(this.shdp,this.vbufs,this.attribTypes,this.attribTypesLen,this.wholeOffsetList,this.wholeStride),this.m_rc.testRIOUid(this.m_vtxUid)&&this.m_rc.bindEleBuf(this.ibuf))}__$destroy(){r.default.s_midMap.delete(this.m_mid),this.m_mid=0,this.m_vtxUid=-1,this.m_rc=null,this.shdp=null,this.vbufs=null,this.vbuf=null,this.ibuf=null,this.attribTypes=null,this.attribTypesLen=0,this.wholeStride=0}restoreThis(){a.Restore(this)}toString(){return"VertexRenderObj(uid = "+this.m_uid+", type="+this.m_mid+")"}static HasMid(t){return r.default.s_midMap.has(t)}static GetByMid(t){return r.default.s_midMap.get(t)}static GetFreeId(){return a.s_freeIdList.length>0?a.s_freeIdList.pop():-1}static Create(t,e,i){let s=null,n=a.GetFreeId();return n>=0?(s=a.s_unitList[n],a.s_unitFlagList[n]=a.s_FLAG_BUSY,s.setMidAndBufUid(e,i)):(s=new a,s.setMidAndBufUid(e,i),a.s_unitList.push(s),a.s_unitFlagList.push(a.s_FLAG_BUSY),a.s_unitListLen++),s.setRC(t),r.default.s_midMap.set(e,s),s}static Restore(t){if(null!=t&&t.m_attachCount<1&&a.s_unitFlagList[t.getUid()]==a.s_FLAG_BUSY){let e=t.getUid();a.s_freeIdList.push(e),a.s_unitFlagList[e]=a.s_FLAG_FREE,t.__$destroy()}}}a.s_uid=0,a.s_FLAG_BUSY=1,a.s_FLAG_FREE=0,a.s_unitFlagList=[],a.s_unitListLen=0,a.s_unitList=[],a.s_freeIdList=[],e.default=a},9156:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{static SetTransUniform(t,e,i){let r=131*(t.getUid()+1)+i.getUid();s.s_transMap.has(r)||(s.s_transMap.set(r,e),e.key=r)}static GetTransUniform(t,e){if(t.getUid()<0)throw Error("mat.getUid() < 0");let i=131*(t.getUid()+1)+e.getUid();return s.s_transMap.has(i)?s.s_transMap.get(i):null}static HasTransUniform(t,e){let i=131*(t.getUid()+1)+e.getUid();return s.s_transMap.has(i)}static RemoveTransUniform(t){s.s_transMap.has(t)&&s.s_transMap.delete(t)}}s.s_transMap=new Map,e.default=s},"919c":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.m_uid=0,this.m_mid=0,this.m_vtxUid=0,this.m_rc=null,this.indicesRes=null,this.ibuf=null,this.ibufStep=2,this.m_attachCount=0}getVTCount(){return null!=this.indicesRes?this.indicesRes.getVTCount():0}setRC(t){this.m_rc=t}setMidAndBufUid(t,e){this.m_mid=t,this.m_vtxUid=e,this.m_attachCount=0}getUid(){return this.m_uid}getVtxUid(){return this.m_vtxUid}getMid(){return this.m_mid}run(){}__$attachThis(){++this.m_attachCount}__$detachThis(){--this.m_attachCount,this.m_attachCount<1&&(this.m_attachCount=0)}__$destroy(){s.s_midMap.delete(this.m_mid),this.m_mid=0,this.m_vtxUid=-1,this.ibuf=null,this.m_rc=null,this.indicesRes=null}restoreThis(){}static HasMid(t){return s.s_midMap.has(t)}static GetByMid(t){return s.s_midMap.get(t)}__$resetVRO(){s.s_mid=-1}}s.s_mid=0,s.s_midMap=new Map,e.default=s},"984e":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.waitDelTimes=0,this.rcuid=0,this.resUid=0,this.width=0,this.height=0,this.depth=0,this.sampler=0,this.texBuf=null,this.m_attachCount=0}__$attachThis(){++this.m_attachCount}__$detachThis(){--this.m_attachCount,this.m_attachCount<1&&(this.m_attachCount=0)}bindToGpu(t){t.bindTexture(this.sampler,this.texBuf)}getAttachCount(){return this.m_attachCount}}class r{constructor(t,e){this.m_resMap=new Map,this.m_freeMap=new Map,this.m_texResTotal=0,this.m_attachTotal=0,this.m_delay=128,this.m_rcuid=0,this.m_gl=null,this.texMid=-1,this.unlocked=!0,this.m_rcuid=t,this.m_gl=e}createBuf(){return this.m_gl.createTexture()}createResByParams3(t,e,i,r){if(!this.m_resMap.has(t)){let a=new s;return a.rcuid=this.getRCUid(),a.resUid=t,a.width=e,a.height=i,a.sampler=r,a.texBuf=this.createBuf(),a.texBuf.resUid=t,this.addTextureRes(a),!0}return!1}getRCUid(){return this.m_rcuid}getRC(){return this.m_gl}hasResUid(t){return this.m_resMap.has(t)}renderBegin(){this.texMid=-1}getTextureResTotal(){return this.m_texResTotal}addTextureRes(t){this.m_resMap.has(t.resUid)||(t.waitDelTimes=0,this.m_resMap.set(t.resUid,t),this.m_texResTotal++)}getGpuBuffer(t){return this.m_resMap.has(t)?this.m_resMap.get(t).texBuf:null}bindToGpu(t){this.m_resMap.has(t)&&this.m_resMap.get(t).bindToGpu(this.m_gl)}getAttachTotal(){return this.m_attachTotal}__$attachRes(t){if(this.m_resMap.has(t)){this.m_attachTotal++;let e=this.m_resMap.get(t);e.getAttachCount()<1&&this.m_freeMap.has(t)&&this.m_freeMap.delete(t),e.waitDelTimes=0,e.__$attachThis()}}__$detachRes(t){if(this.m_resMap.has(t)&&this.m_resMap.has(t)){let e=this.m_resMap.get(t);e.getAttachCount()>0&&(this.m_attachTotal--,e.__$detachThis(),e.getAttachCount()<1&&this.m_freeMap.set(t,e))}}update(){if(this.m_delay--,this.m_delay<1){this.m_delay=128;for(const[t,e]of this.m_freeMap)e.waitDelTimes++,e.waitDelTimes>5&&(this.m_resMap.delete(e.resUid),this.m_freeMap.delete(e.resUid),this.m_gl.deleteTexture(e.texBuf),e.texBuf=null,this.m_texResTotal--)}}}e.default=r},"9f82":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.sdkVer=0,this.version=0,this.drawCallTimes=0,this.drawTrisNumber=0,this.povNumber=0}reset(){this.drawCallTimes=0,this.drawTrisNumber=0,this.povNumber=0}}e.RPStatus=s},a5ba:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("e08e");class r{constructor(t,e,i){this.m_uid=-1,this.m_cullFaceMode=0,this.m_blendMode=0,this.m_depthTestMode=0,this.m_shadowMode=0,this.m_uid=r.s_uid++,this.m_cullFaceMode=t,this.m_blendMode=e,this.m_depthTestMode=i}getUid(){return this.m_uid}getCullFaceMode(){return this.m_cullFaceMode}getDepthTestMode(){return this.m_depthTestMode}getBlendMode(){return this.m_blendMode}use(){if(r.s_state!=this.m_uid){r.Rstate.setCullFaceMode(this.m_cullFaceMode);r.s_blendModes[r.m_blendMode];r.m_blendMode<0?r.Rstate.setBlendMode(this.m_blendMode,r.s_blendModes[this.m_blendMode]):r.Rstate.setBlendMode(r.m_blendMode,r.s_blendModes[r.m_blendMode]),r.s_depthTestMode<0?r.Rstate.setDepthTestMode(this.m_depthTestMode):r.Rstate.setDepthTestMode(r.s_depthTestMode),r.s_state=this.m_uid}}static CreateBlendModeSeparate(t,e,i,a,n,_=0,l=0){if(null!=t&&""!=t){let h;if(r.s_blendModeNameMap.has(t))return h=r.s_blendModeNameMap.get(t),r.s_blendModeIndexMap.get(h);_<1&&(_=s.GLBlendEquation.FUNC_ADD),l<1&&(l=s.GLBlendEquation.FUNC_ADD);let o=1;if(h=31,h=131*h+e,h=131*h+i,a>0&&n>0&&(h=131*h+a,h=131*h+n,o=1),r.s_blendModeIndexMap.has(h))return r.s_blendModeNameMap.set(t,h),r.s_blendModeIndexMap.get(h);let d=++r.s_blendModeIndex;r.s_blendModeNameMap.set(t,h),r.s_blendModeIndexMap.set(h,d);let u=[o,_,l,e,i,a,n];return r.s_blendModes[d]=u,d}return 0}static CreateBlendMode(t,e,i,a=0){if(null!=t&&""!=t){let n;if(r.s_blendModeNameMap.has(t))return n=r.s_blendModeNameMap.get(t),r.s_blendModeIndexMap.get(n);a<1&&(a=s.GLBlendEquation.FUNC_ADD);let _=0;if(n=31,n=131*n+e,n=131*n+i,r.s_blendModeIndexMap.has(n))return r.s_blendModeIndexMap.get(n);let l=++r.s_blendModeIndex;r.s_blendModeNameMap.set(t,n),r.s_blendModeIndexMap.set(n,l);let h=[_,a,0,e,i,0,0];return r.s_blendModes[l]=h,l}return 0}static Create(t,e,i,s){if(r.s_stsNameMap.has(t)){let e=r.s_stsNameMap.get(t);return e.getUid()}let a=31;if(a=131*a+s,a=131*a+i,a=131*a+e,r.s_stsMap.has(a)){let t=r.s_stsMap.get(a);a=t.getUid()}else{let n=new r(e,i,s);a=n.getUid(),r.s_stsMap.set(a,n),r.s_stsNameMap.set(t,n),r.s_states.push(n),++r.s_statesLen}return a}static GetRenderStateByName(t){if(r.s_stsNameMap.has(t)){let e=r.s_stsNameMap.get(t);return e.getUid()}return-1}static UseRenderState(t){r.s_unlocked&&r.s_state!=t&&t>-1&&t<r.s_statesLen&&r.s_states[t].use()}static UseRenderStateByName(t){if(r.s_unlocked){let e=r.GetRenderStateByName(t);r.s_state!=e&&e>-1&&e<r.s_statesLen&&r.s_states[e].use()}}static UnlockBlendMode(){r.m_blendMode=r.s_preBlendMode}static LockBlendMode(t){r.s_preBlendMode=r.m_blendMode,r.m_blendMode=t}static UnlockDepthTestMode(){r.s_depthTestMode=r.s_preDepthTestMode}static LockDepthTestMode(t){r.s_preDepthTestMode=r.s_depthTestMode,r.s_depthTestMode=t}static Lock(){r.s_unlocked=!1}static Unlock(){r.s_unlocked=!0}static Reset(){r.s_state=-1}}r.s_uid=0,r.s_state=-1,r.s_states=[],r.s_statesLen=1,r.m_blendMode=-1,r.s_depthTestMode=-1,r.s_stsMap=new Map,r.s_stsNameMap=new Map,r.s_blendModeNameMap=new Map,r.s_blendModeIndexMap=new Map,r.s_blendModeIndex=0,r.s_blendModes=new Array(256),r.s_unlocked=!0,r.Rstate=null,r.s_preBlendMode=-1,r.s_preDepthTestMode=-1,e.RenderStateObject=r},a7ed:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("ab73"));class a{create(t,e){let i=r.default.FrustumParam;return e.hasUniformByName(i.name)?t.uniformContext.createShaderGlobalUniformFromProbe(t.getCamera().ufrustumProbe,i.name,[i.name]):null}getIDNS(){return"FrustumUniformBuilder"}}e.default=a},ab73:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.type="vec4",this.data=null,this.name="u_vsmParams",this.arrayLength=3}}class r{constructor(){this.type="vec4",this.data=new Float32Array([.1,.1,.1,1,1,.1,600,3500,.3,0,.9,5e-4,0,0,800,800,-500,-500,1e3,1e3]),this.name="u_envLightParams",this.arrayLength=5}}class a{constructor(){this.type="mat4",this.data=null,this.name="u_shadowMat",this.arrayLength=0}}class n{constructor(){this.type="vec4",this.data=null,this.name="u_stageParam",this.arrayLength=0}}class _{constructor(){this.type="vec4",this.data=null,this.name="u_viewParam",this.arrayLength=0}}class l{constructor(){this.type="vec4",this.data=null,this.name="u_frustumParam",this.arrayLength=0}}class h{constructor(){this.type="vec4",this.data=null,this.name="u_cameraPosition",this.arrayLength=0}}class o{constructor(){this.type="vec4",this.positionName="u_lightPositions",this.colorName="u_lightColors"}}class d{}d.LocalTransformMatUNS="u_objMat",d.CameraViewMatUNS="u_viewMat",d.CameraProjectiveMatUNS="u_projMat",d.FrustumParam=new l,d.CameraPosParam=new h,d.StageParam=new n,d.ViewportParam=new _,d.ShadowMatrix=new a,d.ShadowVSMParams=new s,d.GlobalLight=new o,d.EnvLightParams=new r,e.default=d},b02c:function(t,e,i){"use strict";function s(t){let e=1;while(e<t)e<<=1;return e}Object.defineProperty(e,"__esModule",{value:!0});class r{constructor(t,e){this.m_uid=-1,this.m_mid=-1,this.m_texTotal=0,this.m_gtexList=null,this.m_samplers=null,this.m_texList=null,this.m_rcuid=0,this.m_texRes=null,this.direct=!0,this.m_attachCount=0,this.m_rcuid=t,this.m_uid=r.s_uid++,this.m_mid=e}__$setParam(t,e){this.m_rcuid=t,this.m_mid=e}getRCUid(){return this.m_rcuid}getMid(){return this.m_mid}getTexTotal(){return this.m_texTotal}collectTexList(t,e,i){this.m_texRes=t;let r=0;if(this.direct)if(this.m_texTotal<1&&e.length>0){let a,n=s(e.length);this.m_samplers=new Uint16Array(n),this.m_gtexList=new Array(n),this.m_texList=e;while(r<i)a=e[r],a.__$attachThis(),a.__$$upload(t),this.m_samplers[r]=a.getSampler(),this.m_gtexList[r]=this.m_texRes.getGpuBuffer(a.getResUid()),this.m_texRes.__$attachRes(a.getResUid()),r++;this.m_texTotal=r}else this.m_texTotal=0;else this.m_texTotal=i;while(r<e.length)e[r++].__$attachThis()}run(){if(this.m_texRes.unlocked&&this.m_texRes.texMid!=this.m_mid){this.m_texRes.texMid=this.m_mid;let t=this.m_texRes.getRC(),e=t.TEXTURE0;if(this.direct)for(let i=0;i<this.m_texTotal;++i)t.activeTexture(e++),t.bindTexture(this.m_samplers[i],this.m_gtexList[i]);else{let i=this.m_texList;for(let s=0;s<this.m_texTotal;++s)t.activeTexture(e++),i[s].__$$use(this.m_texRes)}}}getUid(){return this.m_uid}__$attachThis(){++this.m_attachCount}__$detachThis(){--this.m_attachCount,this.m_attachCount<1&&(this.m_attachCount=0,r.Restore(this))}reset(){if(null!=this.m_texList)for(let t=0,e=this.m_texList.length;t<e;++t)this.m_texList[t].__$detachThis(),this.m_texRes.__$detachRes(this.m_texList[t].getResUid()),this.m_gtexList[t]=null;this.m_texTotal=0,this.m_texList=null,this.m_texRes=null}toString(){return"TextureRenderObj(uid = "+this.m_uid+", mid="+this.m_mid+")"}static Create(t,e,i){let s=e.length;if(s>0&&i>0){if(s<i)throw Error("There are fewer textures than in the shader : (need "+i+",but only have "+s+") !!!");let a=31,n=0,_=!0;while(n<i)a=131*a+e[n].getUid(),e[n].isDirect()||(_=!1),++n;let l=r.s_troMaps[t.getRCUid()],h=null;return l.has(a)?h=l.get(a):(h=r.s_freeTROList.length<1?new r(t.getRCUid(),a):r.s_freeTROList.pop(),h.collectTexList(t,e,i),l.set(a,h)),h.__$setParam(t.getRCUid(),a),h.direct=_,h}return null}static Restore(t){t.getMid()>-1&&(r.s_troMaps[t.getRCUid()].delete(t.getMid()),t.__$setParam(0,0),r.s_freeTROList.push(t),t.reset())}static GetByMid(t,e){return r.s_troMaps[t].get(e)}}r.s_uid=0,r.s_troMaps=[new Map,new Map,new Map,new Map,new Map,new Map,new Map,new Map],r.s_freeTROList=[],r.s_unloacked=!0,r.s_preMid=-1,e.TextureRenderObj=r;class a{constructor(t){this.m_texRes=null,this.m_texRes=t}run(){this.m_texRes.renderBegin()}getMid(){return 1}__$attachThis(){}__$detachThis(){}}e.EmptyTexRenderObj=a,e.default=r},b0ef:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.m_canvas=null,this.m_div=null,this.m_divW=-1,this.m_divH=-1,this.resized=!0}setDiv(t){this.m_div=t}createViewEle(t,e){null==this.m_div&&(this.m_div=document.getElementById("voxEngineDiv")),null==this.m_div&&(this.m_div=t.createElement("div"),this.m_div.style.width="400px",this.m_div.style.height="300px",document.body.appendChild(this.m_div)),this.m_div.style.display="bolck",this.m_div.style.position="absolute",""==this.m_div.style.left&&(this.m_div.style.left="0px",this.m_div.style.top="0px"),e&&(this.m_div.style.width="100%",this.m_div.style.height="100%"),null==this.m_canvas&&(this.m_canvas=document.createElement("canvas"),this.m_div.appendChild(this.m_canvas),this.m_canvas.width=800,this.m_canvas.height=600,this.m_canvas.style.display="bolck",this.m_canvas.style.left="0px",this.m_canvas.style.top="0px",this.m_canvas.style.position="absolute")}setDivStyleLeftAndTop(t,e){this.m_div.style.left=t+"px",this.m_div.style.top=e+"px"}setDivStyleSize(t,e){this.m_divW==t&&this.m_divH==e||(this.m_div.style.width=t+"px",this.m_div.style.height=e+"px",this.resized=!0)}getDiv(){return this.m_div}getCanvas(){return this.m_canvas}}e.default=s},b30a:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("644c"));class a{constructor(t,e,i,s){this.m_sharedUniformList=[],this.m_unlocked=!0,this.m_texUnlocked=!1,this.m_preuid=-1,this.m_currShd=null,this.m_fragOutputTotal=1,this.m_rcuid=-1,this.m_rc=null,this.m_gpuProgram=null,this.m_adapter=null,this.m_guniform=null,this.m_uniform=null,this.m_transformUniform=null,this.m_shdProgramBuilder=null,this.drawFlag=-1,this.__$globalUniform=null,this.m_rcuid=t,this.m_rc=e,this.m_adapter=i,this.m_shdProgramBuilder=s}createResByParams3(t,e,i,s){return!1}getRC(){return this.m_rc}getGPUProgram(){return this.m_gpuProgram}getRCUid(){return this.m_rcuid}useTransUniform(t){this.m_transformUniform!=t&&(this.m_transformUniform=t,t.use(this))}useUniform(t){this.m_uniform!=t&&(this.m_uniform=t,t.use(this))}updateUniform(t){null!=t&&t.use(this)}unlock(){this.m_unlocked=!0,this.__$globalUniform=null}isUnLocked(){return this.m_unlocked}lock(){this.m_unlocked=!1}textureUnlock(){this.m_texUnlocked=!0}isTextureUnLocked(){return this.m_texUnlocked}textureLock(){this.m_texUnlocked=!1}setSharedUniformByShd(t,e){this.m_sharedUniformList[t.getUid()]=e}getSharedUniformByShd(t){return this.m_sharedUniformList[t.getUid()]}getCurrFragOutputTotal(){return this.m_fragOutputTotal}hasResUid(t){return this.m_shdProgramBuilder.hasUid(t)}bindToGpu(t){if(this.m_unlocked&&this.m_shdProgramBuilder.containsUid(t))if(this.m_preuid!=t){this.m_preuid=t;let e=this.m_shdProgramBuilder.findShdProgramByUid(t);this.m_fragOutputTotal=e.getFragOutputTotal(),this.m_fragOutputTotal,this.getActiveAttachmentTotal(),this.m_gpuProgram=e.getGPUProgram(),this.m_rc.useProgram(this.m_gpuProgram),e.useTexLocation();let i=this.m_sharedUniformList[e.getUid()];this.m_guniform=i;while(null!=i)i.use(this),i=i.next;this.m_currShd=e}else if(null==this.m_guniform&&null!=this.m_currShd){let t=this.m_sharedUniformList[this.m_currShd.getUid()];this.m_guniform=t;while(null!=t)t.use(this),t=t.next}}getGpuBuffer(t){return null}getCurrentShd(){return this.m_currShd}getCurrentShdUid(){return this.m_preuid}resetUniform(){this.m_uniform=null,this.m_transformUniform=null,this.m_guniform=null}resetRenderState(){this.drawFlag=-1}renderBegin(){this.m_fragOutputTotal=1,this.m_preuid=-1,this.m_currShd=null,this.drawFlag=-1}update(){}destroy(){this.m_rc=null,this.m_adapter=null}useUniformToCurrentShd(t){this.m_uniform!=t&&(this.m_uniform,t.useByShd(this,this.m_currShd))}useUniform2ToCurrentShd(t,e){this.m_uniform!=t&&(this.m_uniform,t.useByShd(this,this.m_currShd)),this.m_transformUniform!=e&&(this.m_transformUniform,e.useByShd(this,this.m_currShd))}useUniformMat4(t,e){this.m_rc.uniformMatrix4fv(t,!1,e)}useUniformV2(t,e,i,s,a){const n=r.default,_=this.m_rc;switch(e){case n.SHADER_MAT4:_.uniformMatrix4fv(t,!1,i,a,16*s);break;case n.SHADER_MAT3:_.uniformMatrix3fv(t,!1,i,0,9*s);break;case n.SHADER_VEC4FV:_.uniform4fv(t,i,a,4*s);break;case n.SHADER_VEC3FV:_.uniform3fv(t,i,a,3*s);break;case n.SHADER_VEC4:_.uniform4f(t,i[0],i[1],i[2],i[3]);break;case n.SHADER_VEC3:_.uniform3f(t,i[0],i[1],i[2]);break;case n.SHADER_VEC2:_.uniform2f(t,i[0],i[1]);break;default:break}}useUniformV1(t,e,i,s){const a=r.default,n=this.m_rc;switch(e){case a.SHADER_MAT4:n.uniformMatrix4fv(t,!1,i);break;case a.SHADER_MAT3:n.uniformMatrix3fv(t,!1,i);break;case a.SHADER_VEC4FV:n.uniform4fv(t,i,4*s);break;case a.SHADER_VEC3FV:n.uniform3fv(t,i,3*s);break;case a.SHADER_VEC4:n.uniform4f(t,i[0],i[1],i[2],i[3]);break;case a.SHADER_VEC3:n.uniform3f(t,i[0],i[1],i[2]);break;case a.SHADER_VEC2:n.uniform2f(t,i[0],i[1]);break;default:break}}getActiveAttachmentTotal(){return this.m_adapter.getActiveAttachmentTotal()}}e.default=a},baae:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{}s.FRAMEBUFFER=71,s.DRAW_FRAMEBUFFER=72,s.READ_FRAMEBUFFER=73,e.default=s},c62b:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("e08e"),r=i("070b"),a=i("a5ba");class n{constructor(){this.uid=-1,this.value=-1,this.__$rpuid=-1,this.__$rprouid=-1,this.shader=null,this.pos=null,this.bounds=null,this.ibufType=0,this.ibufStep=2,this.ivsIndex=0,this.ivsCount=0,this.insCount=0,this.drawOffset=0,this.partTotal=0,this.partGroup=null,this.trisNumber=0,this.visible=!0,this.drawEnabled=!0,this.drawMode=0,this.renderState=0,this.rcolorMask=0,this.drawFlag=0,this.vro=null,this.transUniform=null,this.uniform=null,this.shdUid=-1,this.vtxUid=-1,this.tro=null,this.texMid=-1,this.ubo=null,this.polygonOffset=null}testDrawFlag(){this.shader.drawFlag!=this.drawFlag&&(this.shader.drawFlag=this.drawFlag,a.RenderStateObject.UseRenderState(this.renderState),r.RenderColorMask.UseRenderState(this.rcolorMask))}getUid(){return this.uid}getRPOUid(){return this.__$rpuid}getRPROUid(){return this.__$rprouid}getShaderUid(){return this.shdUid}setIvsParam(t,e){this.ivsIndex=t,this.ivsCount=e,this.drawOffset=t*this.ibufStep,this.drawEnabled=this.visible&&this.ivsCount>0}setVisible(t){this.visible=t,this.drawEnabled=t&&this.ivsCount>0}setDrawFlag(t,e){this.renderState=t,this.rcolorMask=e,this.drawFlag=(e<<10)+t}drawThis(t){const e=t.status;e.drawCallTimes++,e.drawTrisNumber+=this.trisNumber;let i=this.indicesRes.getVTCount();this.ivsCount<=i&&(i=this.ivsCount),null!=this.polygonOffset?t.setPolygonOffset(this.polygonOffset[0],this.polygonOffset[1]):t.resetPolygonOffset();const r=s.RenderDrawMode;let a=t.RContext;switch(this.drawMode){case r.ELEMENTS_TRIANGLES:a.drawElements(t.TRIANGLES,i,this.ibufType,this.drawOffset);break;case r.ELEMENTS_LINES:a.drawElements(t.LINES,i,this.ibufType,this.drawOffset);break;case r.ELEMENTS_TRIANGLE_STRIP:a.drawElements(t.TRIANGLE_STRIP,i,this.ibufType,this.drawOffset);break;case r.ELEMENTS_INSTANCED_TRIANGLES:a.drawElementsInstanced(t.TRIANGLES,i,this.ibufType,this.drawOffset,this.insCount);break;case r.ELEMENTS_TRIANGLE_FAN:a.drawElements(t.TRIANGLE_FAN,i,this.ibufType,this.drawOffset);break;case r.ARRAYS_LINES:a.drawArrays(t.LINES,this.ivsIndex,this.ivsCount);break;case r.ARRAYS_LINE_STRIP:a.drawArrays(t.LINE_STRIP,this.ivsIndex,this.ivsCount);break;default:break}}drawPart(t){const e=t.status;e.drawCallTimes++,e.drawTrisNumber+=this.trisNumber;let i=this.indicesRes.getVTCount();this.ivsCount<=i&&(i=this.ivsCount),null!=this.polygonOffset?t.setPolygonOffset(this.polygonOffset[0],this.polygonOffset[1]):t.resetPolygonOffset();const r=s.RenderDrawMode;let a=0,n=t.RContext;switch(this.drawMode){case r.ELEMENTS_TRIANGLES:for(;a<this.partTotal;)n.drawElements(t.TRIANGLES,this.partGroup[a++],this.ibufType,this.partGroup[a++]);break;case r.ELEMENTS_LINES:for(;a<this.partTotal;)n.drawElements(t.LINES,this.partGroup[a++],this.ibufType,this.partGroup[a++]);break;case r.ELEMENTS_TRIANGLE_STRIP:n.drawElements(t.TRIANGLE_STRIP,this.ivsCount,this.ibufType,this.drawOffset);break;case r.ELEMENTS_INSTANCED_TRIANGLES:n.drawElementsInstanced(t.TRIANGLES,this.ivsCount,this.ibufType,this.drawOffset,this.insCount);break;case r.ELEMENTS_TRIANGLE_FAN:n.drawElements(t.TRIANGLE_FAN,this.ivsCount,this.ibufType,this.drawOffset);break;case r.ARRAYS_LINES:n.drawArrays(t.LINES,this.ivsIndex,this.ivsCount);break;case r.ARRAYS_LINE_STRIP:n.drawArrays(t.LINE_STRIP,this.ivsIndex,this.ivsCount);break;default:break}}run2(t){null!=this.ubo&&this.ubo.run(t),this.shader.useTransUniform(this.transUniform),this.shader.useUniform(this.uniform),this.testDrawFlag()}run(t){null!=this.ubo&&this.ubo.run(t),this.vro.run(),this.tro.run(),this.shader.useTransUniform(this.transUniform),this.shader.useUniform(this.uniform),this.testDrawFlag()}runLockMaterial2(t){this.testDrawFlag(),this.shader.useUniform2ToCurrentShd(null==t?this.uniform:t,this.transUniform)}runLockMaterial(){this.vro.run(),this.testDrawFlag(),this.shader.useUniform2ToCurrentShd(this.uniform,this.transUniform)}reset(){this.indicesRes=null,this.polygonOffset=null,this.vro.__$detachThis(),this.vro=null,this.tro.__$detachThis(),this.tro=null,this.texMid=-1,this.__$rprouid=-1,this.ubo=null,this.shdUid=-1,this.vtxUid=-1,this.uniform=null,this.transUniform=null,this.partGroup=null,this.ivsIndex=0,this.ivsCount=0,this.insCount=0,this.partTotal=0,this.drawMode=0,this.drawFlag=0,this.renderState=0,this.rcolorMask=0,this.drawEnabled=!0,this.shader=null,this.bounds=null,this.pos=null}destroy(){this.reset()}}e.default=n},ca6c:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{static PushThreeBitValueToInt(t,e){return(t<<3)+e}static PopThreeBitValueFromInt(t){return s.value=7&t,t>>3}static ContainsBit(t,e){return(e&t)>0}static RemoveBit(t,e){return~e&t}static AddBit(t,e){return e|t}static AssembleFromIntArray(t){let e=0,i=t.length;for(let s=0;s<i;++s)t[s]>0&&(e|=1<<s);return e}}s.BIT_ZERO=0,s.BIT_ONE_0=1,s.BIT_ONE_1=2,s.BIT_ONE_2=4,s.BIT_ONE_3=8,s.BIT_ONE_4=16,s.BIT_ONE_5=32,s.BIT_ONE_6=64,s.BIT_ONE_7=128,s.BIT_ONE_8=256,s.BIT_ONE_9=512,s.BIT_ONE_10=1024,s.BIT_ONE_11=2048,s.value=0,e.default=s},d53d:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.uns="",this.key=-1,this.program=null,this.types=null,this.uniformSize=0,this.uniformNameList=null,this.locations=null,this.dataSizeList=null,this.dataList=null,this.calcModels=null,this.always=!0,this.next=null}getDataRefFromUniformName(t){if(null!=this.uniformNameList){let e=this.uniformNameList,i=e.length;for(let s=0;s<i;++s)if(t==e[s])return this.dataList[s]}return null}setDataRefFromUniformName(t,e){if(null!=this.uniformNameList){let i=this.uniformNameList,s=i.length;for(let r=0;r<s;++r)if(t==i[r]){this.dataList[r]=e;break}}}copyDataFromProbe(t){this.types=[],this.dataSizeList=[];for(let e=0;e<t.uniformsTotal;++e)this.types.push(t.uniformTypes[e]),this.dataSizeList.push(t.dataSizeList[e]);this.uniformSize=t.uniformsTotal}useByLocation(t,e,i,s){}useByShd(t,e){}use(t){}updateData(){}destroy(){}}e.ShaderUniform=s;class r extends s{constructor(){super()}use(t){let e=0;for(;e<this.uniformSize;++e)t.useUniformV1(this.locations[e],this.types[e],this.dataList[e],this.dataSizeList[e])}useByLocation(t,e,i,s){t.useUniformV1(i,e,this.dataList[s],this.dataSizeList[s])}useByShd(t,e){let i=0;for(;i<this.uniformSize;++i)t.useUniformV1(e.getUniformLocationByNS(this.uniformNameList[i]),this.types[i],this.dataList[i],this.dataSizeList[i])}updateData(){if(null!=this.calcModels){let t=this.calcModels.length,e=null;for(let i=0;i<t;++i)e=this.calcModels[i],e.buildData(),e.updateMaterialDataList(this.dataList),e.initializeParam()}}destroy(){let t=0,e=this.dataList.length;for(;t<e;++t)this.dataList[t]=null;if(null!=this.calcModels)for(e=this.calcModels.length,t=0;t<e;++t)this.calcModels[t].destroy(),this.calcModels[t]=null;this.dataList=null,this.types=null,this.locations=null,this.dataSizeList=null,this.calcModels=null}}e.ShaderUniformV1=r;class a extends s{constructor(){super()}use(t){let e=0;for(;e<this.uniformSize;++e)t.useUniformV2(this.locations[e],this.types[e],this.dataList[e],this.dataSizeList[e],0)}useByLocation(t,e,i,s){t.useUniformV2(i,e,this.dataList[s],this.dataSizeList[s],0)}useByShd(t,e){let i=0;for(;i<this.uniformSize;++i)t.useUniformV2(e.getUniformLocationByNS(this.uniformNameList[i]),this.types[i],this.dataList[i],this.dataSizeList[i],0)}updateData(){if(null!=this.calcModels){let t=this.calcModels.length,e=null;for(let i=0;i<t;++i)e=this.calcModels[i],e.buildData(),e.updateMaterialDataList(this.dataList),e.initializeParam()}}destroy(){let t=0,e=this.dataList.length;for(;t<e;++t)this.dataList[t]=null;if(null!=this.calcModels)for(e=this.calcModels.length,t=0;t<e;++t)this.calcModels[t].destroy(),this.calcModels[t]=null;this.dataList=null,this.types=null,this.locations=null,this.dataSizeList=null,this.calcModels=null,this.program=null}}e.ShaderUniformV2=a;class n extends s{constructor(){super()}use(t){t.useUniformMat4(this.locations[0],this.dataList[0])}useByLocation(t,e,i,s){t.useUniformMat4(i,this.dataList[0])}useByShd(t,e){t.useUniformMat4(e.getUniformLocationByNS(this.uniformNameList[0]),this.dataList[0])}destroy(){this.dataList[0]=null,this.dataList=null,this.types=null,this.locations=null,this.dataSizeList=null}}e.ShaderMat4Uniform=n,e.default=s},d872:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i("5326"),a=s(i("3077")),n=s(i("3024")),_=s(i("7279"));class l{constructor(t,e=256){this.m_rcuid=0,this.m_udSlot=null,this.m_rcuid=t,this.m_udSlot=new r.UniformDataSlot(t,e)}getRCUid(){return this.m_rcuid}createShaderUniformProbe(){let t=new a.default(this.m_udSlot);return t}createUniformVec4Probe(t){let e=new n.default(this.m_udSlot,t);return e}createGlobalUinformFromProbe(t,e=null){let i=this.createShaderGlobalUniform();return this.updateGlobalUinformDataFromProbe(i,t,e),i}updateGlobalUinformDataFromProbe(t,e,i=null){let s=t;s.uniformNameList=null!=i?i:e.uniformNames,s.copyDataFromProbe(e),e.update()}createShaderGlobalUniform(){let t=new _.default(this.m_udSlot);return t}createShaderGlobalUniformFromProbe(t,e,i=null){let s=new _.default(this.m_udSlot);return s.uns=e,s.uniformNameList=null!=i?i:t.uniformNames,s.copyDataFromProbe(t),t.update(),s}createShaderGlobalUniformFromProbeAt(t,e,i=null,s){let r=new _.default(this.m_udSlot);return r.uns=e,r.uniformNameList=null!=i?i:t.uniformNames,s<0?r.copyDataFromProbe(t):r.copyDataFromProbeAt(s,t),t.update(),r}cloneShaderGlobalUniform(t){let e=t;return e.clone()}}e.ShaderUniformContext=l},d958:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("11e6")),a=i("d872"),n=s(i("36cb")),_=s(i("3c81")),l=s(i("1e15")),h=i("0e01"),o=i("eca0"),d=s(i("442e")),u=s(i("1264"));class m{constructor(){this.___$$$$$$$Author="VilyLei(vily313@126.com)",this.m_uid=-1,this.m_entity3DMana=null,this.m_processes=[],this.m_processesLen=0,this.m_sprocesses=[],this.m_sprocessesLen=0,this.m_renderProxy=null,this.m_adapter=null,this.m_dataBuilder=null,this.m_renderInsContext=null,this.m_batchEnabled=!0,this.m_processFixedState=!0,this.m_rpoUnitBuilder=new o.RPOUnitBuilder,this.m_rpoNodeBuilder=new d.default,this.m_processBuider=new _.default,this.m_roVtxBuilder=null,this.m_stage3D=null,this.m_fixProcess=null,this.m_uid=m.s_uid++,this.m_renderInsContext=new h.RendererInstanceContext(this.m_uid)}__$setStage3D(t){null!=t&&null==this.m_stage3D&&(this.m_stage3D=t)}getUid(){return this.m_uid}getRCUid(){return this.m_uid}getRPONodeBuilder(){return this.m_rpoNodeBuilder}getDataBuilder(){return this.m_dataBuilder}getRendererContext(){return this.m_renderInsContext}getRenderProxy(){return null!=this.m_renderProxy||(this.m_renderProxy=this.m_renderInsContext.getRenderProxy()),this.m_renderProxy}getStage3D(){return this.m_renderProxy.getStage3D()}getViewX(){return this.m_adapter.getViewportX()}getViewY(){return this.m_adapter.getViewportY()}getViewWidth(){return this.m_adapter.getViewportWidth()}getViewHeight(){return this.m_adapter.getViewportHeight()}getCamera(){return this.m_renderInsContext.getCamera()}createCamera(){return null}useCamera(t,e=!1){}useMainCamera(){}updateCamera(){null!=this.m_renderProxy&&this.m_renderProxy.updateCamera()}initialize(t=null,e=null,i=null){if(null==this.m_dataBuilder&&null!=e){this.m_batchEnabled=t.batchEnabled,this.m_processFixedState=t.processFixedState,this.m_renderProxy=this.m_renderInsContext.getRenderProxy(),this.m_uid=this.m_renderProxy.getUid(),this.m_dataBuilder=new n.default(i),this.m_roVtxBuilder=new l.default,this.m_renderInsContext.setCameraParam(t.camProjParam.x,t.camProjParam.y,t.camProjParam.z);let s=new h.RendererInstanceContextParam;s.uniformContext=new a.ShaderUniformContext(this.m_renderProxy.getRCUid()),s.camera=e,s.stage=this.m_stage3D,s.builder=this.m_dataBuilder,s.vtxBuilder=this.m_roVtxBuilder,s.shaderProgramBuilder=i,this.m_renderInsContext.initialize(t,e,s),this.m_adapter=this.m_renderProxy.getRenderAdapter(),this.m_dataBuilder.initialize(this.m_renderProxy,this.m_rpoUnitBuilder,this.m_processBuider,this.m_roVtxBuilder),this.m_renderProxy.rshader=this.m_dataBuilder.getRenderShader(),this.m_renderInsContext.initManager(this.m_dataBuilder),this.m_entity3DMana=new u.default(this.m_uid,this.m_dataBuilder,this.m_rpoUnitBuilder,this.m_processBuider),this.m_fixProcess=this.createSeparatedProcess(),this.appendProcess(this.m_batchEnabled,this.m_processFixedState)}}getRendererStatus(){return this.m_entity3DMana.version}update(){this.m_renderProxy.Texture.update(),this.m_renderProxy.Vertex.update(),this.m_entity3DMana.update()}updateAllProcess(){for(let t=0;t<this.m_processesLen;++t)this.m_processes[t].update()}updateProcessAt(t){t>-1&&t<this.m_processesLen&&this.m_processes[t].update()}setEntityManaListener(t){this.m_entity3DMana.setListener(t)}addEntity(t,e=0,i=!0){null!=t&&t.__$testRendererEnabled()&&e>-1&&e<this.m_processesLen&&this.m_entity3DMana.addEntity(t,this.m_processes[e].getUid(),i)}addEntityToProcess(t,e,i=!0){null!=e&&null!=t&&t.__$testRendererEnabled()&&e.getRCUid()==this.m_uid&&this.m_entity3DMana.addEntity(t,e.getUid(),i)}moveEntityToProcessAt(t,e){if(null!=t&&t.getRendererUid()==this.m_uid&&t.isInRendererProcess()&&e>-1&&e<this.m_processesLen){let i=t.getDisplay().__$$runit.getRPROUid(),s=this.m_processBuider.getNodeByUid(i),a=this.m_processes[e];s!=a&&(s.removeDispUnit(t.getDisplay()),t.__$rseFlag=a.getSortEnabled()?r.default.AddSortEnabled(t.__$rseFlag):r.default.RemoveSortEnabled(t.__$rseFlag),a.addDisp(t.getDisplay()))}}moveEntityToProcess(t,e){if(null!=e&&null!=t&&t.getRendererUid()==this.m_uid&&t.isInRendererProcess()){let i=t.getDisplay().__$$runit.getRPROUid(),s=this.m_processBuider.getNodeByUid(i);if(s!=e){let i=e;s.removeDispUnit(t.getDisplay()),t.__$rseFlag=e.getSortEnabled()?r.default.AddSortEnabled(t.__$rseFlag):r.default.RemoveSortEnabled(t.__$rseFlag),i.addDisp(t.getDisplay())}}}removeEntity(t){null!=t&&t.getRendererUid()==this.m_uid&&(this.m_entity3DMana.removeEntity(t),t.__$setRenderProxy(null))}removeEntityFromProcess(t,e){null!=e&&e.getRCUid()==this.m_uid&&null!=t&&t.getRendererUid()==this.m_uid&&(e.removeDisp(t.getDisplay()),t.__$setRenderProxy(null))}removeEntityByProcessIndex(t,e){e>=0&&e<this.m_processesLen&&null!=t&&t.getRendererUid()==this.m_uid&&(this.m_processes[e].removeDisp(t.getDisplay()),t.__$setRenderProxy(null))}setProcessSortEnabledAt(t,e){t>=0&&t<this.m_processesLen&&this.m_processes[t].setSortEnabled(e)}setProcessSortEnabled(t,e){if(null!=t&&t.getRCUid()==this.m_uid){let i=t;i.setSortEnabled(e)}}getRenderProcessAt(t){return this.m_processes[t]}appendProcess(t=!0,e=!1){this.m_processBuider.setCreateParams(this.m_dataBuilder.getRenderShader(),this.m_rpoNodeBuilder,this.m_rpoUnitBuilder,this.m_renderProxy.Vertex,t,e);let i=this.m_processBuider.create();return this.m_processes.push(i),i.setRendererParam(this.m_renderProxy,this.m_processesLen),++this.m_processesLen,i}createSeparatedProcess(t=!0,e=!1){this.m_processBuider.setCreateParams(this.m_dataBuilder.getRenderShader(),this.m_rpoNodeBuilder,this.m_rpoUnitBuilder,this.m_renderProxy.Vertex,t,e);let i=this.m_processBuider.create();return this.m_sprocesses.push(i),i.setRendererParam(this.m_renderProxy,this.m_sprocessesLen),i}setRendererProcessParam(t,e,i){t>-1&&t<this.m_processesLen&&this.m_processes[t].setRenderParam(e,i)}getProcessAt(t){return t>-1&&t<this.m_processesLen?this.m_processes[t]:null}showInfoAt(t){t>-1&&t<this.m_processesLen&&this.m_processes[t].showInfo()}getProcessesTotal(){return this.m_processesLen}updateMaterialUniformToCurrentShd(t){this.m_dataBuilder.getRenderShader().useUniformToCurrentShd(t.__$uniform)}drawEntityByLockMaterial(t,e=!1,i=!0){null!=t&&t.getVisible()&&t.getRendererUid()==this.m_uid&&!this.m_renderProxy.isContextLost()&&this.m_fixProcess.drawLockMaterialByDisp(t.getDisplay(),e,i)}drawEntity(t,e=!1,i=!0){null!=t&&t.getVisible()&&!this.m_renderProxy.isContextLost()&&(t.getRendererUid()==this.m_uid?this.m_fixProcess.drawDisp(t.getDisplay(),e,i):t.__$testRendererEnabled()&&this.m_entity3DMana.addEntity(t,this.m_fixProcess.getUid(),!1))}runAt(t){this.m_renderProxy.isContextLost()||this.m_processes[t].run()}runProcess(t){t.getRCUid()!=this.m_uid||this.m_renderProxy.isContextLost()||t.run()}runFromIndexTo(t){if(!this.m_renderProxy.isContextLost())for(let e=t;e<this.m_processesLen;++e)this.m_processes[e].run()}run(){if(this.m_entity3DMana.isHaveEntity()&&!this.m_renderProxy.isContextLost())for(let t=0;t<this.m_processesLen;++t)this.m_processes[t].run()}getRenderUnitsTotal(){let t=0;for(let e=0;e<this.m_processesLen;++e)t+=this.m_processes[e].getUnitsTotal();return t}renderflush(){this.m_renderProxy.flush()}toString(){return"[RendererInstance(uid = "+this.m_uid+")]"}}m.s_uid=0,e.RendererInstance=m,e.default=m},de9d:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("e2fe")),a=s(i("722e")),n=s(i("8333")),_=i("e7f2"),l=i("070b"),h=i("a5ba"),o=s(i("090c")),d=s(i("1216")),u=s(i("56c5")),m=s(i("030e")),c=s(i("74c3")),f=s(i("984e")),R=s(i("e035")),E=s(i("29ef")),p=i("8171"),T=s(i("919c")),g=i("e602"),S=i("53d3"),A=i("9f82");class b{constructor(){this.materialUpdater=null,this.vtxBufUpdater=null,this.vtxBuilder=null,this.uniformContext=null}}e.RenderProxyParam=b;class L{constructor(t){this.RGBA=0,this.UNSIGNED_BYTE=0,this.TRIANGLE_STRIP=0,this.TRIANGLE_FAN=0,this.TRIANGLES=0,this.LINES=0,this.LINE_STRIP=0,this.UNSIGNED_SHORT=0,this.UNSIGNED_INT=0,this.COLOR=0,this.DEPTH=0,this.STENCIL=0,this.DEPTH_STENCIL=0,this.MAX=0,this.MIN=0,this.RContext=null,this.RDrawState=null,this.Vertex=null,this.Texture=null,this.VtxBufUpdater=null,this.MaterialUpdater=null,this.uniformContext=null,this.adapter=null,this.stencil=null,this.renderingState=null,this.colorMask=null,this.rshader=null,this.status=new A.RPStatus,this.m_uid=0,this.m_camUBO=null,this.m_adapter=null,this.m_adapterContext=new o.default,this.m_rc=null,this.m_perspectiveEnabled=!0,this.m_viewPortRect=new r.default(0,0,800,600),this.m_cameraNear=.1,this.m_cameraFar=5e3,this.m_cameraFov=45,this.m_maxWebGLVersion=2,this.m_WEBGL_VER=2,this.m_camera=null,this.m_camSwitched=!1,this.m_autoSynViewAndStage=!0,this.m_initMainCamera=!0,this.m_uid=t}getRC(){return this.m_rc}getUid(){return this.m_uid}getRCUid(){return this.m_uid}isAutoSynViewAndStage(){return this.m_autoSynViewAndStage}enableSynViewAndStage(){this.m_autoSynViewAndStage=!0}lockViewport(){this.m_adapter.lockViewport()}unlockViewport(){this.m_adapter.unlockViewport()}getDiv(){return this.m_adapter.getDiv()}getCanvas(){return this.m_adapter.getCanvas()}cameraLock(){this.m_camera.lock()}cameraUnlock(){this.m_camera.unlock()}getCamera(){return this.m_camera}updateCamera(){return this.m_camera.update()}createCameraUBO(t){}updateCameraDataFromCamera(t){null!=t&&(this.m_camSwitched||t!=this.m_camera)&&(this.m_camSwitched=t!=this.m_camera,t.updateCamMatToUProbe(this.m_camera.matUProbe),null!=this.m_camUBO&&(this.m_camUBO.setSubDataArrAt(0,t.matUProbe.getFS32At(0)),this.m_camUBO.setSubDataArrAt(16,t.matUProbe.getFS32At(1))))}useCameraData(){null!=this.m_camUBO&&this.m_camUBO.run()}getActiveAttachmentTotal(){return this.m_adapter.getActiveAttachmentTotal()}drawInstanced(t,e,i){2==this.m_WEBGL_VER?this.m_rc.drawElementsInstanced(this.TRIANGLES,t,this.UNSIGNED_SHORT,e,i):m.default.ANGLE_instanced_arrays.drawElementsInstancedANGLE(this.TRIANGLES,t,e,i)}createUBOBufferByBytesCount(t){let e=this.m_rc.createBuffer();return this.m_rc.bindBuffer(this.m_rc.UNIFORM_BUFFER,e),this.m_rc.bufferData(this.m_rc.UNIFORM_BUFFER,t,this.m_rc.DYNAMIC_DRAW),e}createUBOBufferByDataArray(t){let e=this.m_rc.createBuffer();return this.m_rc.bindBuffer(this.m_rc.UNIFORM_BUFFER,e),this.m_rc.bufferData(this.m_rc.UNIFORM_BUFFER,t,this.m_rc.DYNAMIC_DRAW),e}bindUBOBuffer(t){this.m_rc.bindBuffer(this.m_rc.UNIFORM_BUFFER,t)}deleteUBOBuffer(t){this.m_rc.deleteBuffer(t)}bufferDataUBOBuffer(t){this.m_rc.bufferData(this.m_rc.UNIFORM_BUFFER,t,this.m_rc.STATIC_DRAW)}bindBufferBaseUBOBuffer(t,e){this.m_rc.bindBufferBase(this.m_rc.UNIFORM_BUFFER,t,e)}setWebGLMaxVersion(t){1!=t&&2!=t||(this.m_maxWebGLVersion=t)}getContext(){return this.m_adapterContext}getStage3D(){return this.m_adapterContext.getStage()}getRenderAdapter(){return this.m_adapter}getRenderContext(){return this.m_adapter.getRenderContext()}setCameraParam(t,e,i){this.m_cameraFov=t,this.m_cameraNear=e,this.m_cameraFar=i}getMouseXYWorldRay(t,e){let i=this.m_adapterContext.getStage();this.m_camera.getWorldPickingRayByScreenXY(i.mouseX,i.mouseY,t,e)}testViewPortChanged(t,e,i,s){return this.m_viewPortRect.testEqualWithParams(t,e,i,s)}testRCViewPortChanged(t,e,i,s){return this.m_adapterContext.testViewPortChanged(t,e,i,s)}getViewX(){return this.m_viewPortRect.x}getViewY(){return this.m_viewPortRect.y}getViewWidth(){return this.m_viewPortRect.width}getViewHeight(){return this.m_viewPortRect.height}setViewPort(t,e,i,s){this.m_autoSynViewAndStage=!1,this.m_viewPortRect.setTo(t,e,i,s);let r=this.m_adapterContext.getStage();null!=r&&(r.setViewPort(i,e,i,s),this.updateCameraView()),this.m_adapterContext.setViewport(t,e,i,s)}setRCViewPort(t,e,i,s,r=!1){this.m_autoSynViewAndStage=r,this.m_adapterContext.setViewport(t,e,i,s)}reseizeRCViewPort(){this.m_adapter.unlockViewport(),this.m_adapter.reseizeViewPort()}updateCameraView(){if(null!=this.m_camera){let t=this.m_viewPortRect;this.m_camera.setViewXY(t.x,t.y),this.m_camera.setViewSize(t.width,t.height)}}resizeCallback(){if(this.m_autoSynViewAndStage){let t=this.m_viewPortRect;t.setSize(this.m_adapterContext.getRCanvasWidth(),this.m_adapterContext.getRCanvasHeight()),this.createMainCamera(),this.m_adapterContext.setViewport(t.x,t.y,t.width,t.height),this.updateCameraView()}}createMainCamera(){if(this.m_initMainCamera){this.m_initMainCamera=!1,this.m_camera.uniformEnabled=!0;let t=this.m_viewPortRect;this.m_perspectiveEnabled?this.m_camera.perspectiveRH(Math.PI*this.m_cameraFov/180,t.width/t.height,this.m_cameraNear,this.m_cameraFar):this.m_camera.orthoRH(this.m_cameraNear,this.m_cameraFar,-.5*t.height,.5*t.height,-.5*t.width,.5*t.width),this.updateCameraView()}}readPixels(t,e,i,s,r,a,n){this.m_adapter.readPixels(t,e,i,s,r,a,n)}getGLVersion(){return this.m_WEBGL_VER}buildCameraParam(){let t=this.m_camera;null==t.matUProbe&&(t.matUProbe=this.uniformContext.createShaderUniformProbe(),t.matUProbe.addMat4Data(new Float32Array(16),1),t.matUProbe.addMat4Data(new Float32Array(16),1)),null==t.ufrustumProbe&&(t.ufrustumProbe=this.uniformContext.createShaderUniformProbe(),t.ufrustumProbe.addVec4Data(new Float32Array([t.getZNear(),t.getZFar(),.5*t.getNearPlaneWidth(),.5*t.getNearPlaneHeight()]),1)),null==t.ucameraPosProbe&&(t.ucameraPosProbe=this.uniformContext.createShaderUniformProbe(),t.ucameraPosProbe.addVec4Data(new Float32Array([500,500,500,1]),1))}initialize(t,e,i,s){if(null!=this.m_rc)return;this.m_camera=e;let r=t.camPosition,l=t.camLookAtPos,h=t.camUpDirect;null!=i&&(i.uProbe=s.uniformContext.createUniformVec4Probe(1)),this.m_perspectiveEnabled=t.cameraPerspectiveEnabled,this.m_adapterContext.autoSyncRenderBufferAndWindowSize=t.autoSyncRenderBufferAndWindowSize,this.m_adapterContext.setResizeCallback(()=>{this.resizeCallback()}),this.m_adapterContext.setWebGLMaxVersion(this.m_maxWebGLVersion),this.m_adapterContext.initialize(this.m_uid,i,t.getDiv(),t.getRenderContextAttri()),this.m_WEBGL_VER=this.m_adapterContext.getWebGLVersion(),this.m_rc=this.m_adapterContext.getRC();let o=this,A=this.m_rc,b=new c.default(this.m_uid,A,s.vtxBuilder),L=new f.default(this.m_uid,A);this.m_vtxRes=b,o.Vertex=b,o.Texture=L,o.MaterialUpdater=s.materialUpdater,o.VtxBufUpdater=s.vtxBufUpdater,o.uniformContext=s.uniformContext;let B=new _.RODrawState;B.setRenderContext(this.m_adapterContext);let x=E.default;(new R.default).initialize(x,B,new T.default),o.RState=B,o.RContext=this.m_rc,o.stencil=new p.Stencil(B),o.renderingState=new S.RenderingState(E.default),o.colorMask=new g.RenderingColorMask(E.default),this.buildCameraParam();let M=this.m_viewPortRect;if(M.setSize(this.m_adapterContext.getRCanvasWidth(),this.m_adapterContext.getRCanvasHeight()),this.m_adapter=new d.default(this.m_uid,L),this.m_adapter.initialize(this.m_adapterContext,t,B,this.uniformContext.createUniformVec4Probe(1)),o.adapter=this.m_adapter,this.m_autoSynViewAndStage){let t=this.m_adapterContext.getStage();null!=t&&M.setSize(M.width,M.height)}this.createMainCamera(),this.m_adapterContext.setViewport(M.x,M.y,M.width,M.height),this.m_camera.lookAtRH(r,l,h),this.m_camera.update(),o.RGBA=A.RGBA,o.UNSIGNED_BYTE=A.UNSIGNED_BYTE,o.TRIANGLE_STRIP=A.TRIANGLE_STRIP,o.TRIANGLE_FAN=A.TRIANGLE_FAN,o.TRIANGLES=A.TRIANGLES,o.LINES=this.m_rc.LINES,o.LINE_STRIP=A.LINE_STRIP,o.UNSIGNED_SHORT=A.UNSIGNED_SHORT,o.UNSIGNED_INT=A.UNSIGNED_INT,o.COLOR=A.COLOR,o.DEPTH=A.DEPTH,o.STENCIL=A.STENCIL,o.DEPTH_STENCIL=A.DEPTH_STENCIL,this.m_WEBGL_VER>1?(o.MIN=A.MIN,o.MAX=A.MAX):(o.MIN=m.default.EXT_blend_minmax.MIN_EXT,o.MAX=m.default.EXT_blend_minmax.MAX_EXT);let N=a.default;N.NEAREST=A.NEAREST,N.LINEAR=A.LINEAR,N.LINEAR_MIPMAP_LINEAR=A.LINEAR_MIPMAP_LINEAR,N.NEAREST_MIPMAP_NEAREST=A.NEAREST_MIPMAP_NEAREST,N.LINEAR_MIPMAP_NEAREST=A.LINEAR_MIPMAP_NEAREST,N.NEAREST_MIPMAP_LINEAR=A.NEAREST_MIPMAP_LINEAR;let U=n.default;U.COLOR_BUFFER_BIT=A.COLOR_BUFFER_BIT,U.DEPTH_BUFFER_BIT=A.DEPTH_BUFFER_BIT,U.STENCIL_BUFFER_BIT=A.STENCIL_BUFFER_BIT,u.default.SetRenderer(this.m_adapterContext)}flush(){this.m_rc.flush()}setClearRGBColor3f(t,e,i){let s=this.m_adapter.bgColor;s[0]=t,s[1]=e,s[2]=i}setClearColor(t){t.toArray4(this.m_adapter.bgColor)}setClearUint24Color(t,e=1){let i=this.m_adapter.bgColor;i[0]=(t>>16&255)/255,i[1]=(t>>8&255)/255,i[2]=(255&t)/255,i[3]=e}setClearRGBAColor4f(t,e,i,s){let r=this.m_adapter.bgColor;r[0]=t,r[1]=e,r[2]=i,r[3]=s}getClearRGBAColor4f(t){t.fromArray4(this.m_adapter.bgColor)}getViewportWidth(){return this.m_adapter.getViewportWidth()}getViewportHeight(){return this.m_adapter.getViewportHeight()}setRenderToBackBuffer(){this.m_adapter.setRenderToBackBuffer()}clearBackBuffer(){this.m_adapter.clear()}clearDepth(t=1){this.m_adapter.clearDepth(t)}renderBegin(){this.m_camera.update(),this.m_adapter.renderBegin()}renderEnd(){}useRenderStateByName(t){h.RenderStateObject.UseRenderStateByName(t)}setScissorEnabled(t){this.m_adapterContext.setScissorEnabled(t)}setScissorRect(t,e,i,s){this.m_adapterContext.setScissorRect(t,e,i,s)}useRenderColorMask(t){l.RenderColorMask.UseRenderState(t)}unlockRenderColorMask(){l.RenderColorMask.Unlock()}lockRenderColorMask(){l.RenderColorMask.Lock()}useRenderState(t){h.RenderStateObject.UseRenderState(t)}unlockRenderState(){h.RenderStateObject.Unlock()}lockRenderState(){h.RenderStateObject.Lock()}setVtxUpdateTimesTotal(t){this.m_vtxRes.setVtxUpdateTimesTotal(t)}setFrontFaceFlipped(t){this.m_adapter.setFrontFaceFlipped(t)}enabledPolygonOffset(){this.m_adapter.enabledPolygonOffset()}disabledPolygonOffset(){this.m_adapter.disabledPolygonOffset()}setPolygonOffset(t,e=0){this.m_adapter.setPolygonOffset(t,e)}resetPolygonOffset(){this.m_adapter.resetPolygonOffset()}loseContext(){this.m_adapter.loseContext()}isContextLost(){return this.m_adapter.isContextLost()}setViewProbeValue(t,e,i,s){this.m_adapter.setViewProbeValue(t,e,i,s)}toString(){return"[Object RenderProxy()]"}}e.RenderProxy=L,e.default=L},df9d:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.m_uid=-1,this.m_begin=null,this.m_end=null,this.m_unitMap=new Map,this.m_unitTexMap=new Map,this.m_FLAG_BUSY=1,this.m_FLAG_FREE=0,this.m_vtxFlagList=[],this.m_vtxIndexFlagList=[],this.m_vtxfreeIList=[],this.m_vtxList=[],this.m_vtxListLen=0,this.m_texFlagList=[],this.m_texIndexFlagList=[],this.m_texfreeIList=[],this.m_texList=[],this.m_texListLen=0,this.m_uid=s.s_uid++}getFreeVtxId(){return this.m_vtxfreeIList.length>0?this.m_vtxfreeIList.pop():-1}getVtxIndex(){let t=-1,e=this.getFreeVtxId();return e>=0?(t=e,this.m_vtxList[e]=0,this.m_vtxFlagList[e]=this.m_FLAG_BUSY):(t=this.m_vtxListLen,this.m_vtxList.push(0),this.m_vtxIndexFlagList.push(this.m_FLAG_FREE),this.m_vtxFlagList.push(this.m_FLAG_BUSY),this.m_vtxListLen++),t}restoreVtxIndex(t){this.m_vtxFlagList[t]==this.m_FLAG_BUSY&&(this.m_vtxfreeIList.push(t),this.m_vtxFlagList[t]=this.m_FLAG_FREE,this.m_vtxList[t]=0)}attachVtxAt(t){++this.m_vtxList[t]}detachVtxAt(t){this.m_vtxList[t]>0&&(--this.m_vtxList[t],this.m_vtxList[t]<1&&this.restoreVtxIndex(t))}getVtxTotalAt(t){return this.m_vtxList[t]}getFreeTexId(){return this.m_texfreeIList.length>0?this.m_texfreeIList.pop():-1}getTexIndex(){let t=-1,e=this.getFreeTexId();return e>=0?(t=e,this.m_texList[e]=0,this.m_texFlagList[e]=this.m_FLAG_BUSY):(t=this.m_texListLen,this.m_texList.push(0),this.m_texIndexFlagList.push(this.m_FLAG_FREE),this.m_texFlagList.push(this.m_FLAG_BUSY),this.m_texListLen++),t}restoreTexIndex(t){this.m_texFlagList[t]==this.m_FLAG_BUSY&&(this.m_texfreeIList.push(t),this.m_texFlagList[t]=this.m_FLAG_FREE,this.m_texList[t]=0)}attachTexAt(t){++this.m_texList[t]}detachTexAt(t){this.m_texList[t]>0&&(--this.m_texList[t],this.m_texList[t]<1&&this.restoreTexIndex(t))}getTexTotalAt(t){return this.m_texList[t]}destroy(){this.clear()}clear(){this.m_begin=this.m_end=null,this.m_unitMap=new Map,this.m_unitTexMap=new Map,this.m_vtxFlagList=[],this.m_vtxIndexFlagList=[],this.m_vtxList=[],this.m_vtxfreeIList=[],this.m_vtxListLen=0,this.m_texFlagList=[],this.m_texIndexFlagList=[],this.m_texList=[],this.m_texfreeIList=[],this.m_texListLen=0}getBegin(){return this.m_begin}containsNode(t){let e=this.m_unitMap.get(t.vtxUid);if(null!=e){let i=131*(31+e.rvroI);return i*=i+e.texMid,t.rtokey==i}return!1}addNodeAndSort(t){let e=this.m_unitMap.get(t.vtxUid);if(null==e){this.m_unitMap.set(t.vtxUid,t),t.rvroI=this.getVtxIndex(),this.attachVtxAt(t.rvroI);let e=131*(31+t.rvroI);e*=e+t.texMid,t.rtokey=e,t.rtroI=this.getTexIndex(),this.m_unitTexMap.set(e,t.rtroI),this.attachTexAt(t.rtroI)}else{t.rvroI=e.rvroI,this.attachVtxAt(t.rvroI);let i=131*(31+t.rvroI);if(i*=i+t.texMid,this.m_unitTexMap.has(i)?t.rtroI=this.m_unitTexMap.get(i):(t.rtroI=this.getTexIndex(),this.m_unitTexMap.set(i,t.rtroI)),t.rtokey=i,this.attachTexAt(t.rtroI),e!=this.m_end)if(e.texMid==t.texMid)e.next.prev=t,t.next=e.next,t.prev=e,e.next=t;else while(null!=e){if(e.vtxUid!=t.vtxUid){e=e.prev,e.next.prev=t,t.next=e.next,t.prev=e,e.next=t;break}if(e.texMid==t.texMid){e.next.prev=t,t.next=e.next,t.prev=e,e.next=t;break}if(e.next==this.m_end){this.m_end.vtxUid!=t.vtxUid?(e.next.prev=t,t.next=e.next,t.prev=e,e.next=t):e=null;break}e=e.next}else e=null}null==e&&(null==this.m_begin?this.m_end=this.m_begin=t:null!=this.m_end.prev?(this.m_end.next=t,t.prev=this.m_end,this.m_end=t):(this.m_begin.next=t,t.prev=this.m_end,this.m_end=t),this.m_end.next=null)}showInfo(){let t=this.getBegin();if(null!=t){let e="",i="",s="";while(null!=t)e+=t.vtxUid+",",i+=t.texMid+",",s+=t.ivsCount+",",t=t.next}}removeNodeAndSort(t){let e=this.m_unitMap.get(t.vtxUid);e!=t?e=null:(this.m_unitMap.set(t.vtxUid,null),null!=t.next&&t.next.vtxUid==t.vtxUid?this.m_unitMap.set(t.vtxUid,t.next):null!=t.prev&&t.prev.vtxUid==t.vtxUid?this.m_unitMap.set(t.vtxUid,t.prev):this.m_unitMap.delete(t.vtxUid)),t==this.m_begin?t==this.m_end?this.m_begin=this.m_end=null:(this.m_begin=t.next,this.m_begin.prev=null):t==this.m_end?(this.m_end=t.prev,this.m_end.next=null):(t.next.prev=t.prev,t.prev.next=t.next),this.detachVtxAt(t.rvroI),this.detachTexAt(t.rtroI),t.prev=null,t.next=null}addNode(t){null==this.m_begin?this.m_end=this.m_begin=t:null!=this.m_end.prev?(this.m_end.next=t,t.prev=this.m_end,this.m_end=t):(this.m_begin.next=t,t.prev=this.m_end,this.m_end=t),this.m_end.next=null}removeNode(t){t==this.m_begin?t==this.m_end?this.m_begin=this.m_end=null:(this.m_begin=t.next,this.m_begin.prev=null):t==this.m_end?(this.m_end=t.prev,this.m_end.next=null):(t.next.prev=t.prev,t.prev.next=t.next),t.prev=null,t.next=null}}s.s_uid=0,e.default=s},e035:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("070b"),r=i("a5ba"),a=i("e08e");class n{constructor(){this.m_inited=!0}buildToRST(t){let e=new n;e.initialize(t,this.m_Rstate,this.m_VRO)}initialize(t,e,i){if(this.m_inited&&null==t.rstb){t.rstb=this,this.m_inited=!1,this.m_Rstate=e,this.m_VRO=i;const _=r.RenderStateObject,l=s.RenderColorMask,h=a.GLBlendMode,o=a.GLBlendEquation,d=a.CullFaceMode,u=a.DepthTestMode,m=a.RenderBlendMode;t.Rstate=e,t.VRO=i,l.Rstate=e,_.Rstate=e,t.COLOR_MASK_ALL_TRUE=l.Create("all_true",!0,!0,!0,!0),t.COLOR_MASK_ALL_FALSE=l.Create("all_false",!1,!1,!1,!1),t.COLOR_MASK_RED_TRUE=l.Create("red_true",!0,!1,!1,!1),t.COLOR_MASK_GREEN_TRUE=l.Create("green_true",!1,!0,!1,!1),t.COLOR_MASK_BLUE_TRUE=l.Create("blue_true",!1,!1,!0,!1),t.COLOR_MASK_ALPHA_TRUE=l.Create("alpha_true",!1,!1,!1,!0),t.COLOR_MASK_RED_FALSE=l.Create("red_false",!1,!0,!0,!0),t.COLOR_MASK_GREEN_FALSE=l.Create("green_false",!0,!1,!0,!0),t.COLOR_MASK_BLUE_FALSE=l.Create("blue_false",!0,!0,!1,!0),t.COLOR_MASK_ALPHA_FALSE=l.Create("alpha_false",!0,!0,!0,!1),n.m_rbmInited&&(n.m_rbmInited=!1,m.NORMAL=_.CreateBlendMode("NORMAL",h.ONE,h.ZERO,o.FUNC_ADD),m.OPAQUE=_.CreateBlendMode("OPAQUE",h.ONE,h.ZERO,o.FUNC_ADD),m.TRANSPARENT=_.CreateBlendMode("TRANSPARENT",h.SRC_ALPHA,h.ONE_MINUS_SRC_ALPHA,o.FUNC_ADD),m.ALPHA_ADD=_.CreateBlendMode("ALPHA_ADD",h.ONE,h.ONE_MINUS_SRC_ALPHA,o.FUNC_ADD),m.ADD=_.CreateBlendMode("ADD",h.SRC_ALPHA,h.ONE,o.FUNC_ADD),m.ADD_LINEAR=_.CreateBlendMode("ADD_LINEAR",h.ONE,h.ONE,o.FUNC_ADD),m.INVERSE_ALPHA=_.CreateBlendMode("INVERSE_ALPHA",h.ONE,h.SRC_ALPHA,o.FUNC_ADD),m.BLAZE=_.CreateBlendMode("BLAZE",h.SRC_COLOR,h.ONE,o.FUNC_ADD),m.OVERLAY=_.CreateBlendMode("OVERLAY",h.DST_COLOR,h.DST_ALPHA,o.FUNC_ADD),m.OVERLAY2=_.CreateBlendMode("OVERLAY2",h.DST_COLOR,h.SRC_ALPHA,o.FUNC_ADD)),t.NORMAL_STATE=_.Create("normal",d.BACK,m.NORMAL,u.OPAQUE),t.BACK_CULLFACE_NORMAL_STATE=t.NORMAL_STATE,t.FRONT_CULLFACE_NORMAL_STATE=_.Create("front_normal",d.FRONT,m.NORMAL,u.OPAQUE),t.NONE_CULLFACE_NORMAL_STATE=_.Create("none_normal",d.NONE,m.NORMAL,u.OPAQUE),t.ALL_CULLFACE_NORMAL_STATE=_.Create("all_cull_normal",d.FRONT_AND_BACK,m.NORMAL,u.OPAQUE),t.BACK_NORMAL_ALWAYS_STATE=_.Create("back_normal_always",d.BACK,m.NORMAL,u.ALWAYS),t.BACK_TRANSPARENT_STATE=_.Create("back_transparent",d.BACK,m.TRANSPARENT,u.TRANSPARENT_SORT),t.BACK_TRANSPARENT_ALWAYS_STATE=_.Create("back_transparent_always",d.BACK,m.TRANSPARENT,u.ALWAYS),t.NONE_TRANSPARENT_STATE=_.Create("none_transparent",d.NONE,m.TRANSPARENT,u.TRANSPARENT_SORT),t.NONE_TRANSPARENT_ALWAYS_STATE=_.Create("none_transparent_always",d.NONE,m.TRANSPARENT,u.ALWAYS),t.FRONT_CULLFACE_GREATER_STATE=_.Create("front_greater",d.FRONT,m.NORMAL,u.TRUE_GREATER),t.BACK_ADD_BLENDSORT_STATE=_.Create("back_add_blendSort",d.BACK,m.ADD,u.TRANSPARENT_SORT),t.BACK_ADD_ALWAYS_STATE=_.Create("back_add_always",d.BACK,m.ADD,u.ALWAYS),t.BACK_ALPHA_ADD_ALWAYS_STATE=_.Create("back_alpha_add_always",d.BACK,m.ALPHA_ADD,u.ALWAYS),t.NONE_ADD_ALWAYS_STATE=_.Create("none_add_always",d.NONE,m.ADD,u.ALWAYS),t.NONE_ADD_BLENDSORT_STATE=_.Create("none_add_blendSort",d.NONE,m.ADD,u.TRANSPARENT_SORT),t.NONE_ALPHA_ADD_ALWAYS_STATE=_.Create("none_alpha_add_always",d.NONE,m.ALPHA_ADD,u.ALWAYS),t.FRONT_ADD_ALWAYS_STATE=_.Create("front_add_always",d.FRONT,m.ADD,u.ALWAYS),t.FRONT_TRANSPARENT_STATE=_.Create("front_transparent",d.FRONT,m.TRANSPARENT,u.TRANSPARENT_SORT),t.FRONT_TRANSPARENT_ALWAYS_STATE=_.Create("front_transparent_always",d.FRONT,m.TRANSPARENT,u.ALWAYS),t.NONE_CULLFACE_NORMAL_ALWAYS_STATE=_.Create("none_normal_always",d.NONE,m.NORMAL,u.ALWAYS),t.BACK_ALPHA_ADD_BLENDSORT_STATE=_.Create("back_alpha_add_blendSort",d.BACK,m.ALPHA_ADD,u.TRANSPARENT_SORT)}}createBlendMode(t,e,i,s=0){return r.RenderStateObject.CreateBlendMode(t,e,i,s)}createBlendModeSeparate(t,e,i,s=0,a=0,n=0){return r.RenderStateObject.CreateBlendModeSeparate(t,e,i,s,a,n)}createRenderState(t,e,i,s){return r.RenderStateObject.Create(t,e,i,s)}createRenderColorMask(t,e,i,r,a){return s.RenderColorMask.Create(t,e,i,r,a)}getRenderStateByName(t){return r.RenderStateObject.GetRenderStateByName(t)}getRenderColorMaskByName(t){return s.RenderColorMask.GetColorMaskByName(t)}unlockBlendMode(){r.RenderStateObject.UnlockBlendMode()}lockBlendMode(t){r.RenderStateObject.LockBlendMode(t)}unlockDepthTestMode(){r.RenderStateObject.UnlockDepthTestMode()}lockDepthTestMode(t){r.RenderStateObject.LockDepthTestMode(t)}resetState(){s.RenderColorMask.Reset(),r.RenderStateObject.Reset(),this.m_Rstate.reset(),this.m_VRO.__$resetVRO()}reset(t){s.RenderColorMask.Reset(),r.RenderStateObject.Reset(),this.m_Rstate.setRenderContext(t),this.m_Rstate.reset()}resetInfo(){}setDepthTestEnable(t){this.m_Rstate.setDepthTestEnable(t)}setBlendEnable(t){this.m_Rstate.setBlendEnable(t)}}n.m_rbmInited=!0,e.default=n},e08e:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{}s.ELEMENTS_TRIANGLES=1,s.ELEMENTS_TRIANGLE_STRIP=2,s.ELEMENTS_TRIANGLE_FAN=3,s.ELEMENTS_INSTANCED_TRIANGLES=4,s.ARRAYS_LINES=5,s.ARRAYS_LINE_STRIP=6,s.ARRAYS_POINTS=7,s.ELEMENTS_LINES=8,s.DISABLE=0,e.RenderDrawMode=s;class r{}r.NORMAL=1,r.OPAQUE=1,r.TRANSPARENT=2,r.ALPHA_ADD=3,r.ADD=4,r.ADD_LINEAR=5,r.INVERSE_ALPHA=6,r.BLAZE=7,r.OVERLAY=8,r.OVERLAY2=8,r.DISABLE=0,e.RenderBlendMode=r;class a{}a.NEVER=1,a.LESS=1,a.EQUAL=1,a.GREATER=1,a.NOTEQUAL=1,a.GEQUAL=1,a.ALWAYS=1,e.GLStencilFunc=a;class n{}n.KEEP=1,n.ZERO=1,n.REPLACE=1,n.INCR=1,n.INCR_WRAP=1,n.DECR=1,n.DECR_WRAP=1,n.INVERT=1,e.GLStencilOp=n;class _{}_.ZERO=1,_.ONE=1,_.SRC_COLOR=1,_.DST_COLOR=1,_.SRC_ALPHA=1,_.DST_ALPHA=1,_.ONE_MINUS_SRC_ALPHA=1,e.GLBlendMode=_;class l{}l.FUNC_ADD=1,l.FUNC_SUBTRACT=1,l.FUNC_REVERSE_SUBTRACT=1,l.MIN_EXT=1,l.MAX_EXT=1,l.MIN=1,l.MAX=1,e.GLBlendEquation=l;class h{}h.BACK=1,h.FRONT=2,h.FRONT_AND_BACK=3,h.NONE=0,h.DISABLE=0,e.CullFaceMode=h;class o{}o.NEVER=1,o.ALWAYS=2,o.SKY=3,o.TRUE_LESS_EQUAL=3,o.OPAQUE=4,o.TRUE_LESS=4,o.OPAQUE_OVERHEAD=5,o.FALSE_EQUAL=5,o.FALSE_LESS=6,o.BLEND=6,o.BLEND_SORT=6,o.TRANSPARENT_SORT=6,o.TRUE_LEQUAL=7,o.WIRE_FRAME=7,o.FALSE_LEQUAL=8,o.DECALS=8,o.NEXT_LAYER=11,o.WIRE_FRAME_NEXT=12,o.TRUE_EQUAL=13,o.TRUE_GREATER=14,o.TRUE_GEQUAL=15,o.DISABLE=0,e.DepthTestMode=o,function(t){t[t["NOT_IN_RENDERER"]=-1]="NOT_IN_RENDERER",t[t["GO_TO_RENDERER"]=1]="GO_TO_RENDERER",t[t["LIVE_IN_RENDERER"]=2]="LIVE_IN_RENDERER"}(e.DisplayRenderSign||(e.DisplayRenderSign={}))},e2fe:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(t=0,e=0,i=100,s=100){this.m_right=100,this.m_top=100,this.x=0,this.y=0,this.width=100,this.height=100,this.x=t,this.y=e,this.width=i,this.height=s,this.update()}copyFrom(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.m_right=t.m_right,this.m_top=t.m_top}clone(){return new s(this.x,this.y,this.width,this.height)}containsXY(t,e){return!(t<this.x||t>this.m_right)&&!(e<this.y||e>this.m_top)}contains(t){return t.x>=this.x&&t.m_right<=this.m_right&&t.y>=this.y&&(t.m_top,this.m_top),!0}intersect(t){return!(t.x>this.m_right)&&(!(t.m_right<this.x)&&(!(t.y>this.m_top)&&!(t.m_top<this.y)))}setTo(t,e,i,s){this.x=t,this.y=e,this.width=i,this.height=s,this.m_right=this.width+this.x,this.m_top=this.height+this.y}setSize(t,e){this.width=t,this.height=e,this.m_right=this.width+this.x,this.m_top=this.height+this.y}testEqual(t){return this.x!=t.x||this.y!=t.y||this.width!=t.width||this.height!=t.height}testEqualWithParams(t,e,i,s){return this.x!=t||this.y!=e||this.width!=i||this.height!=s}update(){this.m_right=this.width+this.x,this.m_top=this.height+this.y}flipY(t){this.y=this.y,this.m_right=this.width+this.x,this.m_top=this.height+this.y}getX(){return this.x}getY(){return this.y}getRight(){return this.m_right}getTop(){return this.m_top}}e.default=s},e602:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(t){let e=this;e.ALL_TRUE=t.COLOR_MASK_ALL_TRUE,e.ALL_FALSE=t.COLOR_MASK_ALL_FALSE,e.RED_TRUE=t.COLOR_MASK_RED_TRUE,e.GREEN_TRUE=t.COLOR_MASK_GREEN_TRUE,e.BLUE_TRUE=t.COLOR_MASK_BLUE_TRUE,e.ALPHA_TRUE=t.COLOR_MASK_ALPHA_TRUE,e.RED_FALSE=t.COLOR_MASK_RED_FALSE,e.GREEN_FALSE=t.COLOR_MASK_GREEN_FALSE,e.BLUE_FALSE=t.COLOR_MASK_BLUE_FALSE,e.ALPHA_FALSE=t.COLOR_MASK_ALPHA_FALSE}}e.RenderingColorMask=s},e7f2:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("e08e");class r{constructor(){this.stencilMask=-1}}class a{constructor(){this.m_units=new Array(128),this.m_unit=null,this.m_blendMode=s.RenderBlendMode.NORMAL,this.m_cullMode=s.CullFaceMode.NONE,this.m_depthTestType=s.DepthTestMode.DISABLE,this.m_cullDisabled=!0,this.m_context=null,this.m_gl=null,this.roColorMask=-11}reset(){this.roColorMask=-11}setRenderContext(t){this.m_context=t,this.m_gl=t.getRC();let e=this.m_gl.rcuid;this.m_unit=this.m_units[e],null==this.m_unit&&(this.m_unit=this.m_units[e]=new r)}setColorMask(t,e,i,s){this.m_gl.colorMask(t,e,i,s)}setStencilFunc(t,e,i){this.m_gl.stencilFunc(t,e,i)}setStencilMask(t){this.m_unit.stencilMask!=t&&t>=0&&(this.m_unit.stencilMask=t,this.m_gl.stencilMask(t))}setStencilOp(t,e,i){this.m_gl.stencilOp(t,e,i)}setDepthTestEnable(t){t?this.m_gl.enable(this.m_gl.DEPTH_TEST):this.m_gl.disable(this.m_gl.DEPTH_TEST)}setCullFaceEnable(t){t?this.m_gl.enable(this.m_gl.CULL_FACE):this.m_gl.disable(this.m_gl.CULL_FACE)}setBlendEnable(t){t?this.m_gl.enable(this.m_gl.BLEND):this.m_gl.disable(this.m_gl.BLEND)}setCullFaceMode(t){this.m_cullMode!=t&&(this.m_cullMode=t,t!=s.CullFaceMode.NONE?(this.m_cullDisabled&&(this.m_cullDisabled=!1,this.m_gl.enable(this.m_gl.CULL_FACE)),this.m_gl.cullFace(t)):this.m_cullDisabled||(this.m_cullDisabled=!0,this.m_gl.disable(this.m_gl.CULL_FACE)))}setBlendMode(t,e){this.m_blendMode!=t&&(this.m_blendMode=t,t>0?e[0]<1?(this.m_gl.blendEquation(e[1]),this.m_gl.blendFunc(e[3],e[4])):(this.m_gl.blendEquationSeparate(e[1],e[2]),this.m_gl.blendFuncSeparate(e[3],e[4],e[5],e[6])):this.m_gl.disable(this.m_gl.BLEND))}getDepthTestMode(){return this.m_depthTestType}setDepthTestMode(t){if(this.m_depthTestType!=t){const e=this.m_gl,i=s.DepthTestMode;switch(this.m_depthTestType=t,t){case i.ALWAYS:e.depthMask(!1),e.depthFunc(e.ALWAYS);break;case i.SKY:e.depthMask(!0),e.depthFunc(e.LEQUAL);break;case i.OPAQUE:e.depthMask(!0),e.depthFunc(e.LESS);break;case i.OPAQUE_OVERHEAD:e.depthMask(!1),e.depthFunc(e.EQUAL);break;case i.DECALS:e.depthMask(!1),e.depthFunc(e.LEQUAL);break;case i.BLEND:e.depthMask(!1),e.depthFunc(e.LESS);break;case i.WIRE_FRAME:e.depthMask(!0),e.depthFunc(e.LEQUAL);break;case i.NEXT_LAYER:e.depthMask(!1),e.depthFunc(e.ALWAYS);break;case i.TRUE_EQUAL:e.depthMask(!0),e.depthFunc(e.EQUAL);break;case i.TRUE_GREATER:e.depthMask(!0),e.depthFunc(e.GREATER);break;case i.TRUE_GEQUAL:e.depthMask(!0),e.depthFunc(e.GEQUAL);break;case i.WIRE_FRAME_NEXT:break;default:break}}}}e.RODrawState=a},e87b:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("ab73"));class a{create(t,e){let i=r.default.ViewportParam;return e.hasUniformByName(i.name)?t.uniformContext.createShaderGlobalUniformFromProbe(t.getRenderAdapter().uViewProbe,i.name,[i.name]):null}getIDNS(){return"ViewParamUniformBuilder"}}e.default=a},eca0:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("2be1")),a=s(i("c62b"));class n{constructor(){this.idsFlag=0,this.count=0,this.rprocessUid=-1}reset(){this.idsFlag=0}}n.RenerProcessMaxTotal=16,e.RCRPObj=n;class _ extends r.default{constructor(){super(...arguments),this.m_rcpoList=[]}createNode(){let t=new n;return t.reset(),this.m_rcpoList.push(t),new a.default}restoreUid(t){this.m_rcpoList[t].reset()}testRPNodeExists(t,e){return(this.m_rcpoList[t].idsFlag&1<<e)>0}testRPNodeNotExists(t,e){return(this.m_rcpoList[t].idsFlag&1<<e)<1}setRPNodeParam(t,e,i){let s=this.m_rcpoList[t],r=1<<e;return i>-1?(s.idsFlag&r)<1&&(++s.count,s.rprocessUid=e,s.idsFlag=s.idsFlag|r):(s.idsFlag&r)>0&&(--s.count,s.idsFlag=s.idsFlag&~r),s.count}getRCRPObj(t){return this.m_rcpoList[t]}}e.RPOUnitBuilder=_},fa60:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("919c"));class a extends r.default{constructor(){super(),this.vao=null,this.m_uid=a.s_uid++}run(){this.m_rc.testVROUid(this.m_uid)&&(this.m_rc.bindVertexArray(this.vao),(this.m_rc.testRIOUid(this.m_vtxUid)||r.default.s_mid!=this.m_mid)&&(r.default.s_mid=this.m_mid,this.m_rc.bindEleBuf(this.ibuf)))}__$destroy(){r.default.s_midMap.delete(this.m_mid),this.m_mid=0,this.m_vtxUid=-1,this.ibuf=null,this.vao=null,this.m_rc=null}restoreThis(){null!=this.vao&&this.m_rc.deleteVertexArray(this.vao),a.Restore(this)}static HasMid(t){return r.default.s_midMap.has(t)}static GetByMid(t){return r.default.s_midMap.get(t)}static GetFreeId(){return a.s_freeIdList.length>0?a.s_freeIdList.pop():-1}static Create(t,e,i){let s=null,n=a.GetFreeId();return n>=0?(s=a.s_unitList[n],a.s_unitFlagList[n]=a.s_FLAG_BUSY,s.setMidAndBufUid(e,i)):(s=new a,s.setMidAndBufUid(e,i),a.s_unitList.push(s),a.s_unitFlagList.push(a.s_FLAG_BUSY),a.s_unitListLen++),s.setRC(t),r.default.s_midMap.set(e,s),s}static Restore(t){if(null!=t&&t.m_attachCount<1&&a.s_unitFlagList[t.getUid()]==a.s_FLAG_BUSY){let e=t.getUid();a.s_freeIdList.push(e),a.s_unitFlagList[e]=a.s_FLAG_FREE,t.__$destroy()}}}a.s_uid=0,a.s_FLAG_BUSY=1,a.s_FLAG_FREE=0,a.s_unitFlagList=[],a.s_unitListLen=0,a.s_unitList=[],a.s_freeIdList=[],e.default=a},fae3:function(t,e,i){"use strict";i.r(e);i("1eb2");var s=i("4d4b");for(var r in s)["default"].indexOf(r)<0&&function(t){i.d(e,t,(function(){return s[t]}))}(r)},ffc0:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("3b73"));class a{static ToGL(t,e){const i=a;switch(e){case i.RGBA:break;case i.R8:return t.R8;case i.RGB:return t.RGB;case i.RGB8:return t.RGB8;case i.RGBA8:return t.RGBA8;case i.ALPHA:return t.ALPHA;case i.RGB16F:return r.default.IsWebGL2()?t.RGB16F:t.RGB;case i.RGBA16F:return r.default.IsWebGL2()?t.RGBA16F:t.RGBA;case i.RGB32F:return r.default.IsWebGL2()&&t.RGB32F,t.RGB;case i.RGBA32F:return r.default.IsWebGL2()&&t.RGBA32F,t.RGBA;case a.RED:return t.RED;case i.DEPTH_COMPONENT:return t.DEPTH_COMPONENT;case i.DEPTH_STENCIL:return t.DEPTH_STENCIL;default:break}return t.RGBA}}a.R8=101,a.RGB=110,a.RED=111,a.RGBA=121,a.RGB8=122,a.RGBA8=123,a.ALPHA=132,a.RGB16F=331,a.RGBA16F=332,a.RGB32F=341,a.RGBA32F=342,a.DEPTH_COMPONENT=351,a.DEPTH_STENCIL=352,e.default=a}})}));