(function(t,e){"object"===typeof exports&&"object"===typeof module?module.exports=e():"function"===typeof define&&define.amd?define([],e):"object"===typeof exports?exports["CoRenderer"]=e():t["CoRenderer"]=e()})("undefined"!==typeof self?self:this,(function(){return function(t){var e={};function s(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}return s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)s.d(i,r,function(e){return t[e]}.bind(null,r));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s="fae3")}({"030e":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static Initialize(t,e){let s=this;1==t?(s.OES_standard_derivatives=e.getExtension("OES_standard_derivatives"),s.OES_standard_derivatives,s.EXT_shader_texture_lod=e.getExtension("EXT_shader_texture_lod"),s.EXT_shader_texture_lod,s.WEBGL_draw_buffers=e.getExtension("WEBGL_draw_buffers"),s.WEBGL_draw_buffers,s.OES_vertex_array_object=e.getExtension("OES_vertex_array_object"),s.OES_vertex_array_object,s.ANGLE_instanced_arrays=e.getExtension("ANGLE_instanced_arrays"),s.ANGLE_instanced_arrays,s.EXT_color_buffer_float=e.getExtension("EXT_color_buffer_float"),s.EXT_color_buffer_float,s.EXT_color_buffer_half_float=e.getExtension("EXT_color_buffer_half_float"),s.EXT_color_buffer_half_float,s.OES_texture_half_float=e.getExtension("OES_texture_half_float"),s.OES_texture_half_float,s.OES_texture_half_float_linear=e.getExtension("OES_texture_half_float_linear"),s.OES_texture_half_float_linear,s.OES_texture_float=e.getExtension("OES_texture_float"),s.OES_texture_float,s.OES_element_index_uint=e.getExtension("OES_element_index_uint"),s.OES_element_index_uint,s.EXT_blend_minmax=e.getExtension("EXT_blend_minmax"),s.EXT_blend_minmax):(s.EXT_shader_texture_lod=e.getExtension("EXT_shader_texture_lod"),s.EXT_shader_texture_lod,s.EXT_color_buffer_half_float=e.getExtension("EXT_color_buffer_half_float"),s.EXT_color_buffer_half_float,s.OES_texture_half_float_linear=e.getExtension("OES_texture_half_float_linear"),s.OES_texture_half_float_linear,s.EXT_color_buffer_float=e.getExtension("EXT_color_buffer_float"),s.EXT_color_buffer_float),s.OES_texture_float_linear=e.getExtension("OES_texture_float_linear"),s.OES_texture_float_linear,s.WEBGL_depth_texture=e.getExtension("WEBGL_depth_texture"),s.WEBGL_depth_texture,s.WEBGL_debug_renderer_info=e.getExtension("WEBGL_debug_renderer_info"),s.WEBGL_debug_renderer_info}}i.OES_standard_derivatives=null,i.EXT_shader_texture_lod=null,i.WEBGL_draw_buffers=null,i.OES_vertex_array_object=null,i.ANGLE_instanced_arrays=null,i.EXT_color_buffer_float=null,i.EXT_color_buffer_half_float=null,i.OES_texture_float_linear=null,i.OES_texture_half_float_linear=null,i.OES_texture_half_float=null,i.OES_texture_float=null,i.OES_element_index_uint=null,i.EXT_blend_minmax=null,i.WEBGL_depth_texture=null,i.WEBGL_debug_renderer_info=null,e.default=i},"070b":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t,e,s,r){this.m_uid=-1,this.m_rBoo=!0,this.m_gBoo=!0,this.m_bBoo=!0,this.m_aBoo=!0,this.m_uid=i.s_uid++,this.m_rBoo=t,this.m_gBoo=e,this.m_bBoo=s,this.m_aBoo=r}getUid(){return this.m_uid}getR(){return this.m_rBoo}getG(){return this.m_gBoo}getB(){return this.m_bBoo}getA(){return this.m_aBoo}use(){i.s_state!=this.m_uid&&(i.Rstate.setColorMask(this.m_rBoo,this.m_gBoo,this.m_bBoo,this.m_aBoo),i.s_state=this.m_uid)}static Create(t,e,s,r,a){if(i.s_stsNameMap.has(t)){let e=i.s_stsNameMap.get(t);return e.getUid()}let n=(e?64:32)|(s?16:8)|(r?4:2)|(a?1:0);if(i.s_stsMap.has(n)){let t=i.s_stsMap.get(n);n=t.getUid()}else{let l=new i(e,s,r,a);n=l.getUid(),i.s_stsMap.set(n,l),i.s_stsNameMap.set(t,l),i.s_states.push(l),++i.s_statesLen}return n}static GetColorMaskByName(t){if(i.s_stsNameMap.has(t)){let e=i.s_stsNameMap.get(t);return e.getUid()}return-1}static UseRenderState(t){i.s_unlocked&&i.Rstate.roColorMask!=t&&t>-1&&t<i.s_statesLen&&i.s_states[t].use()}static UseColorMaskByName(t){let e=i.GetColorMaskByName(t);i.s_unlocked&&i.Rstate.roColorMask!=e&&e>-1&&e<i.s_statesLen&&i.s_states[e].use()}static Lock(){i.s_unlocked=!1}static Unlock(){i.s_unlocked=!0}static Reset(){i.s_state=-1}}i.s_uid=0,i.s_state=-1,i.s_states=[],i.s_statesLen=1,i.s_stsMap=new Map,i.s_stsNameMap=new Map,i.s_unlocked=!0,i.ALL_TRUE_COLOR_MASK=0,i.ALL_FALSE_COLOR_MASK=1,i.Rstate=null,e.RenderColorMask=i},"090c":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("030e")),a=i(s("3b73")),n=i(s("b0ef")),l=i(s("0c85")),h=s("e08e"),_=i(s("e2fe"));class o{constructor(){this.m_sysEvt=new l.default,this.m_div=null,this.m_canvas=null,this.m_scissorEnabled=!1,this.m_depthTestEnabled=!0,this.m_stencilTestEnabled=!0,this.m_offcanvas=null,this.m_gl=null,this.m_stage=null,this.m_viewPortRect=new _.default(0,0,800,600),this.m_maxWebGLVersion=2,this.m_webGLVersion=2,this.m_dpr=1,this.m_viewEle=new n.default,this.autoSyncRenderBufferAndWindowSize=!0,this.offscreenRenderEnabled=!1,this.bodyBgColor="",this.m_ctxAttri=null,this.m_glVersion=0,this.m_param=null,this.m_resizeFlag=!0,this.m_glLoseCtx=null,this.m_displayWidth=0,this.m_displayHeight=0,this.m_rcanvasWidth=0,this.m_rcanvasHeight=0,this.m_resizeCallback=null}contextrestoredHandler(t){}contextlostHandler(t){}syncHtmlBodyColor(t,e,s){this.bodyBgColor=this.m_viewEle.getCSSHEXRGB(t,e,s)}setWebGLMaxVersion(t){1!=t&&2!=t||(this.m_maxWebGLVersion=t)}getWebGLVersion(){return this.m_webGLVersion}getDiv(){return this.m_div}getCanvas(){return this.m_offcanvas?this.m_offcanvas:this.m_canvas}setDivStyleLeftAndTop(t,e){this.m_viewEle.setDivStyleLeftAndTop(t,e)}setDivStyleSize(t,e){this.m_viewEle.setDivStyleSize(t,e)}isDepthTestEnabled(){return this.m_depthTestEnabled}isStencilTestEnabled(){return this.m_stencilTestEnabled}buildGLCtx(t,e){this.m_gl=null;let s=null;if(this.offscreenRenderEnabled&&(t instanceof OffscreenCanvas||(s=t.transferControlToOffscreen(),t=s)),this.m_offcanvas=s=t,2==this.m_maxWebGLVersion&&(this.m_gl=null==s?t.getContext("webgl2",e):s.getContext("webgl2",e),this.m_gl&&(this.m_webGLVersion=2)),null==this.m_gl&&(this.m_gl=null==s?t.getContext("webgl",e)||t.getContext("experimental-webgl",e):s.getContext("webgl",e)||s.getContext("experimental-webgl",e),null!=this.m_gl&&(this.m_webGLVersion=1)),!this.m_gl)throw this.m_webGLVersion=-1,alert("Unable to initialize WebGL. Your browser or machine may not support it."),Error("WebGL initialization failure.");this.m_gl.version=this.m_glVersion,t.version=this.m_glVersion,this.m_glVersion++,t.addEventListener("webglcontextrestored",this.contextrestoredHandler,!1),t.addEventListener("webglcontextlost",this.contextlostHandler,!1),r.default.Initialize(this.m_webGLVersion,this.m_gl)}initialize(t,e,s){this.m_stage=e;var i=null;try{document&&(i=document,window)}catch(n){}if(this.m_param=s,null!=i){this.m_dpr=window.devicePixelRatio;let e=s.getDiv();a.default.SetDevicePixelRatio(this.m_dpr),this.m_viewEle.setDiv(e),this.m_viewEle.createViewEle(i,this.autoSyncRenderBufferAndWindowSize,s.divW,s.divH,s.autoAttachingHtmlDoc,this.offscreenRenderEnabled),this.m_div=e=this.m_viewEle.getDiv();let n=this.m_canvas=this.m_viewEle.getCanvas();this.m_dpr=window.devicePixelRatio,this.m_sysEvt.dpr=this.m_dpr;const l=s.getRenderContextAttri();let _=l;null==l?_={depth:this.m_depthTestEnabled,premultipliedAlpha:!1,alpha:!0,antialias:!1,stencil:this.m_stencilTestEnabled,preserveDrawingBuffer:!0,powerPreference:"default"}:(this.m_depthTestEnabled=_.depth,this.m_stencilTestEnabled=_.stencil),this.m_ctxAttri=_,this.buildGLCtx(n,_);let o=this.m_gl;o.rcuid=t;let d=h.GLStencilFunc;d.NEVER=o.NEVER,d.LESS=o.LESS,d.EQUAL=o.EQUAL,d.GREATER=o.GREATER,d.NOTEQUAL=o.NOTEQUAL,d.GEQUAL=o.GEQUAL,d.ALWAYS=o.ALWAYS;let u=h.GLStencilOp;u.KEEP=o.KEEP,u.ZERO=o.ZERO,u.REPLACE=o.REPLACE,u.INCR=o.INCR,u.INCR_WRAP=o.INCR_WRAP,u.DECR=o.DECR,u.DECR_WRAP=o.DECR_WRAP,u.INVERT=o.INVERT;let m=h.GLBlendMode;m.ZERO=o.ZERO,m.ONE=o.ONE,m.SRC_COLOR=o.SRC_COLOR,m.DST_COLOR=o.DST_COLOR,m.SRC_ALPHA=o.SRC_ALPHA,m.DST_ALPHA=o.DST_ALPHA,m.ONE_MINUS_SRC_ALPHA=o.ONE_MINUS_SRC_ALPHA;let c=h.GLBlendEquation;c.FUNC_ADD=o.FUNC_ADD,c.FUNC_SUBTRACT=o.FUNC_SUBTRACT,c.FUNC_REVERSE_SUBTRACT=o.FUNC_REVERSE_SUBTRACT,c.MIN_EXT=o.MIN_EXT,c.MAX_EXT=o.MAX_EXT,c.MIN=o.MIN,c.MAX=o.MAX;let f=h.CullFaceMode;f.BACK=o.BACK,f.FRONT=o.FRONT,f.FRONT_AND_BACK=o.FRONT_AND_BACK;let p=a.default;p.MAX_TEXTURE_SIZE=this.m_gl.getParameter(this.m_gl.MAX_TEXTURE_SIZE),p.MAX_RENDERBUFFER_SIZE=this.m_gl.getParameter(this.m_gl.MAX_RENDERBUFFER_SIZE);let R=this.m_gl.getParameter(this.m_gl.MAX_VIEWPORT_DIMS);p.MAX_VIEWPORT_WIDTH=R[0],p.MAX_VIEWPORT_HEIGHT=R[1],a.default.Initialize([this.m_webGLVersion]);let E=r.default.WEBGL_debug_renderer_info;if(E){let t=o.getParameter(E.UNMASKED_VENDOR_WEBGL),e=o.getParameter(E.UNMASKED_RENDERER_WEBGL);p.GPU_VENDOR=t,p.GPU_RENDERER=e,a.default.IsWinExternalVideoCard()}this.initEvt(),this.updateRenderBufferSize()}}setCanvas(t){let e=this.m_canvas;this.m_viewEle.setCanvas(t);let s=this.m_viewEle.getCanvas();return e!=s&&(this.m_offcanvas=null,this.m_canvas=s,this.buildGLCtx(s,this.m_ctxAttri),this.m_glLoseCtx=null,this.initEvt()),e!=s}initEvt(){if(this.m_param.sysEvtReceived){this.m_sysEvt.initialize(this.m_canvas,this.m_div,this.m_stage);let t=t=>{this.autoSyncRenderBufferAndWindowSize&&(this.m_resizeFlag=!0,this.updateRenderBufferSize())};this.m_sysEvt.sysEvt.addWindowResizeEvt(this,t)}}loseContext(){this.m_glLoseCtx||(this.m_glLoseCtx=this.m_gl.getExtension("WEBGL_lose_context"),this.m_glLoseCtx.loseContext())}isContextLost(){return this.m_gl.isContextLost()}getRC(){return this.m_gl}setScissorEnabled(t){t?this.m_scissorEnabled||(this.m_scissorEnabled=!0,this.m_gl.enable(this.m_gl.SCISSOR_TEST)):this.m_scissorEnabled&&(this.m_scissorEnabled=!1,this.m_gl.disable(this.m_gl.SCISSOR_TEST))}setScissorRect(t,e,s,i){this.m_gl.scissor(t,e,s,i)}setResizeCallback(t){this.m_resizeCallback=t}getDevicePixelRatio(){return this.m_dpr}resizeBufferSize(t,e,s=!0){s?(t=2*Math.round(.5*t),e=2*Math.round(.5*e)):(t=Math.round(t),e=Math.round(e));let i=s?window.devicePixelRatio:1,r=Math.abs(i-this.m_dpr)>.01||this.m_resizeFlag;if(this.m_dpr=i,this.m_sysEvt.dpr=i,a.default.SetDevicePixelRatio(this.m_dpr),this.m_resizeFlag=!1,this.m_displayWidth!=t||this.m_displayHeight!=e||r){this.m_displayWidth=t,this.m_displayHeight=e,s?(this.m_rcanvasWidth=2*Math.round(t*i*.5),this.m_rcanvasHeight=2*Math.round(e*i*.5)):(this.m_rcanvasWidth=Math.round(t*i),this.m_rcanvasHeight=Math.round(e*i)),null==this.m_offcanvas?(this.m_canvas.width=this.m_rcanvasWidth,this.m_canvas.height=this.m_rcanvasHeight):(this.m_offcanvas.width=this.m_rcanvasWidth,this.m_offcanvas.height=this.m_rcanvasHeight),this.m_canvas.style.width=this.m_displayWidth+"px",this.m_canvas.style.height=this.m_displayHeight+"px";const r=this.m_stage;r&&(r.stageWidth=this.m_rcanvasWidth,r.stageHeight=this.m_rcanvasHeight,r.viewWidth=this.m_displayWidth,r.viewHeight=this.m_displayHeight,r.pixelRatio=i,r.update()),null!=this.m_resizeCallback&&this.m_resizeCallback()}}getStage(){return this.m_stage}getStageWidth(){return this.m_stage.stageWidth}getStageHeight(){return this.m_stage.stageHeight}getDisplayWidth(){return this.m_displayWidth}getDisplayHeight(){return this.m_displayHeight}setViewport(t,e,s,i){this.m_viewPortRect.setTo(t,e,s,i)}setViewportSize(t,e){this.m_viewPortRect.setSize(t,e)}testViewPortChanged(t,e,s,i){return this.m_viewPortRect.testEqualWithParams(t,e,s,i)}getViewportX(){return this.m_viewPortRect.x}getViewportY(){return this.m_viewPortRect.y}getViewportWidth(){return this.m_viewPortRect.width}getViewportHeight(){return this.m_viewPortRect.height}getViewPortSize(){return this.m_viewPortRect}getFBOWidth(){return this.m_viewPortRect.width<a.default.MAX_RENDERBUFFER_SIZE?this.m_viewPortRect.width:a.default.MAX_RENDERBUFFER_SIZE}getFBOHeight(){return this.m_viewPortRect.height<a.default.MAX_RENDERBUFFER_SIZE?this.m_viewPortRect.height:a.default.MAX_RENDERBUFFER_SIZE}getRCanvasWidth(){return this.m_rcanvasWidth}getRCanvasHeight(){return this.m_rcanvasHeight}updateRenderBufferSize(t=!0){const e=this.m_div;if(e.parentElement){let t=e.getBoundingClientRect();t=e.getBoundingClientRect(),this.resizeBufferSize(t.width,t.height)}else{const t=this.m_offcanvas?this.m_offcanvas:this.m_canvas;this.resizeBufferSize(t.width,t.height,!1)}}}e.default=o},"0c85":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73"));class a{constructor(){this.ls=[],this.funcs=[]}add(t,e){let s=0,i=this.ls;for(;s<this.ls.length;++s)if(t==i[s])break;s>=this.ls.length&&(i.push(t),this.funcs.push(e))}remove(t){let e=this.ls;for(let s=0;s<this.ls.length;++s)if(t==e[s]){e.splice(s,1),this.funcs.splice(s,1);break}}run(t){for(let e=0;e<this.ls.length;++e)this.funcs[e](t)}}class n{constructor(){this.evts=null}init(){if(null==this.evts){this.evts=[];for(let t=0;t<2;++t)this.evts.push(new a)}var t=null,e=null;document&&(t=document,e=window,t.onmouseup=t=>{this.evts[1].run(t)}),e&&(e.onresize=t=>{this.evts[0].run(t)})}addWindowResizeEvt(t,e){this.evts[0].add(t,e)}removeWindowResizeEvt(t){this.evts[0].remove(t)}addDocMouUpEvt(t,e){this.evts[1].add(t,e)}removeDocMouUpEvt(t){this.evts[1].remove(t)}}class l{constructor(){this.m_singleDown=!1,this.m_mouseX=0,this.m_mouseY=0,this.m_mouseClickTime=0,this.sysEvt=null,this.dpr=1,this.m_canvas=null,this.sysEvt=l.s_sevt,this.sysEvt.init()}initMobile(t,e,s){var i=null;try{document&&(i=document)}catch(a){}if(i){let t=this;if(e.addEventListener("touchstart",t=>{let e=t.targetTouches,i=0,r=0;if(e.length<2)i=0|this.dpr*t.targetTouches[0].pageX,r=0|this.dpr*t.targetTouches[0].pageY,s.mouseX=i,s.mouseY=s.stageHeight-r,s.mouseViewX=i,s.mouseViewY=r,this.m_singleDown=!0,this.m_mouseX=s.mouseX,this.m_mouseY=s.mouseY,this.m_mouseClickTime=Date.now(),s.mouseDown(1);else{let a=[];for(let s=0;s<e.length;++s)i=0|this.dpr*t.targetTouches[s].pageX,r=0|this.dpr*t.targetTouches[s].pageY,a.push({x:i,y:r});s.mouseMultiDown(a),this.m_singleDown=!1}t.preventDefault(),t.stopPropagation()},!1),e.addEventListener("touchend",t=>{this.m_singleDown=!1;let e=t.targetTouches,i=0,r=0;if(e.length<1)s.mouseUp(1),this.m_mouseClickTime=Date.now()-this.m_mouseClickTime,Math.abs(this.m_mouseX-s.mouseX)<2&&Math.abs(this.m_mouseY-s.mouseY)<2&&this.m_mouseClickTime<900&&(this.m_mouseX=s.mouseX,this.m_mouseY=s.mouseY,s.mouseClick());else{let a=[];for(let s=0;s<e.length;++s)i=0|this.dpr*t.targetTouches[s].pageX,r=0|this.dpr*t.targetTouches[s].pageY,a.push({x:i,y:r});s.mouseMultiUp(a)}t.preventDefault()},!1),e.addEventListener("touchcancel",e=>{t.m_singleDown=!1;e.targetTouches;s.mouseCancel(),e.preventDefault()},!1),e.addEventListener("touchmove",t=>{t.preventDefault();let e=t.targetTouches,i=0,r=0;if(this.m_singleDown&&(i=0|this.dpr*e[0].pageX,r=0|this.dpr*e[0].pageY,s.mouseViewX=i,s.mouseViewY=r,s.mouseX=i,s.mouseY=s.stageHeight-r,s.mouseMove()),e.length>1){let a=[];for(let s=0;s<e.length;++s)i=0|this.dpr*t.targetTouches[s].pageX,r=0|this.dpr*t.targetTouches[s].pageY,a.push({x:i,y:r});s.mouseMultiMove(a)}},{passive:!1},!1),r.default.IsIpadOS()){let t=document.createElement("meta");t.name="viewport",t.content="width=device-width,initial-scale=1.0,minimum-scale=1.0, maximum-scale=1.0, user-scalable=no",document.getElementsByTagName("head")[0].appendChild(t)}}}initialize(t,e,s){r.default.IsMobileWeb()||r.default.IsIpadOS()||this.initPC(t,e,s),this.initMobile(t,e,s)}initPC(t,e,s){var i=null;if(null!=this.m_canvas){let t=this.m_canvas;t.onmousewheel=null,t.onmousedown=null,t.onmouseup=null,t.onmousemove=null,t.onclick=null,t.canvas=null}try{void 0!=document&&(i=document)}catch(r){}if(null!=i){if(this.m_canvas=t,void 0==t.onmousewheel&&void 0!=t.addEventListener){let e=function(t){t.wheelDeltaY=-t.detail,s.mouseWheel(t)};t.addEventListener("DOMMouseScroll",e,!1)}t.onmousewheel=t=>{t.preventDefault(),t.stopPropagation(),s.mouseWheel(t)},t.onmousedown=t=>{let i=e.getBoundingClientRect(),r=0|this.dpr*(t.clientX-i.left),a=0|this.dpr*(t.clientY-i.top);s.mouseX=r,s.mouseY=s.stageHeight-a,s.mouseViewX=r,s.mouseViewY=a,this.m_mouseX=s.mouseX,this.m_mouseY=s.mouseY,this.m_mouseClickTime=Date.now(),0==t.button?s.mouseDown(1):1==t.button?s.mouseMiddleDown():2==t.button&&s.mouseRightDown(1)},t.onmouseup=t=>{let i=e.getBoundingClientRect(),r=0|this.dpr*(t.clientX-i.left),a=0|this.dpr*(t.clientY-i.top);s.mouseX=r,s.mouseY=s.stageHeight-a,0==t.button?s.mouseUp(1):1==t.button?s.mouseMiddleUp():2==t.button&&s.mouseRightUp(1)};let i=t=>{0==t.button?s.mouseWindowUp(1):1==t.button||2==t.button&&s.mouseWindowRightUp(1)};this.sysEvt.addDocMouUpEvt(this,i),t.onmousemove=t=>{let i=e.getBoundingClientRect(),r=0|this.dpr*(t.clientX-i.left),a=0|this.dpr*(t.clientY-i.top);s.mouseX=r,s.mouseY=s.stageHeight-a,s.mouseViewX=r,s.mouseViewY=a,s.mouseMove()},t.onclick=t=>{let i=e.getBoundingClientRect(),r=0|this.dpr*(t.clientX-i.left),a=0|this.dpr*(t.clientY-i.top);s.mouseX=r,s.mouseY=s.stageHeight-a,s.mouseViewX=r,s.mouseViewY=a,this.m_mouseClickTime=Date.now()-this.m_mouseClickTime,Math.abs(this.m_mouseX-s.mouseX)<2&&Math.abs(this.m_mouseY-s.mouseY)<2&&this.m_mouseClickTime<900&&(this.m_mouseX=s.mouseX,this.m_mouseY=s.mouseY,0==t.button?s.mouseClick():2==t.button&&s.mouseRightClick())},t.ondblclick=t=>{let i=e.getBoundingClientRect(),r=0|this.dpr*(t.clientX-i.left),a=0|this.dpr*(t.clientY-i.top);s.mouseX=r,s.mouseY=s.stageHeight-a,s.mouseViewX=r,s.mouseViewY=a,0==t.button?s.mouseDoubleClick():t.button}}}}l.s_sevt=new n,e.default=l},"0e01":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("baae")),a=i(s("29ef")),n=i(s("7499")),l=s("de9d");class h{constructor(){this.camera=null,this.stage=null,this.builder=null,this.vtxBuilder=null,this.uniformContext=null,this.shaderProgramBuilder=null}}e.RendererInstanceContextParam=h;class _{constructor(t){this.m_adapter=null,this.m_renderProxy=null,this.m_materialProxy=null,this.m_cameraNear=.1,this.m_cameraFar=5e3,this.m_cameraFov=45,this.m_rcuid=0,this.m_rcuid=t,this.m_renderProxy=new l.RenderProxy(t)}getRCUid(){return this.m_rcuid}getDiv(){return this.m_adapter.getDiv()}getCanvas(){return this.m_adapter.getCanvas()}getRenderAdapter(){return this.m_adapter}getRenderMaterialProxy(){return this.m_materialProxy}getRenderProxy(){return this.m_renderProxy}getTextureResTotal(){return this.m_renderProxy.Texture.getTextureResTotal()}getTextureAttachTotal(){return this.m_renderProxy.Texture.getAttachTotal()}getDevicePixelRatio(){return this.m_adapter.getDevicePixelRatio()}getStage3D(){return this.m_renderProxy.getStage3D()}getCamera(){return null!=this.m_renderProxy?this.m_renderProxy.getCamera():null}cameraLock(){this.m_renderProxy.cameraLock()}cameraUnlock(){this.m_renderProxy.cameraUnlock()}updateCamera(){null!=this.m_renderProxy&&this.m_renderProxy.updateCamera()}updateCameraDataFromCamera(t){null!=this.m_renderProxy&&this.m_renderProxy.updateCameraDataFromCamera(t)}lockRenderColorMask(){null!=this.m_renderProxy&&this.m_renderProxy.lockRenderColorMask()}unlockRendererColorMask(){null!=this.m_renderProxy&&this.m_renderProxy.unlockRenderState()}useGlobalRenderColorMask(t){null!=this.m_renderProxy&&(this.m_renderProxy.unlockRenderColorMask(),this.m_renderProxy.useRenderColorMask(t),this.m_renderProxy.lockRenderColorMask())}useGlobalRenderColorMaskByName(t){null!=this.m_renderProxy&&(this.m_renderProxy.unlockRenderColorMask(),this.m_renderProxy.useRenderColorMask(a.default.GetRenderColorMaskByName(t)),this.m_renderProxy.lockRenderColorMask())}getRenderColorMaskByName(t){return a.default.GetRenderColorMaskByName(t)}lockRenderState(){null!=this.m_renderProxy&&this.m_renderProxy.lockRenderState()}unlockRenderState(){null!=this.m_renderProxy&&this.m_renderProxy.unlockRenderState()}useGlobalRenderState(t){null!=this.m_renderProxy&&(this.m_renderProxy.unlockRenderState(),this.m_renderProxy.useRenderState(t),this.m_renderProxy.lockRenderState())}useGlobalRenderStateByName(t){null!=this.m_renderProxy&&(this.m_renderProxy.unlockRenderState(),this.m_renderProxy.useRenderState(a.default.GetRenderStateByName(t)),this.m_renderProxy.lockRenderState())}getRenderStateByName(t){return a.default.GetRenderStateByName(t)}lockMaterial(){null!=this.m_materialProxy&&this.m_materialProxy.lockMaterial()}unlockMaterial(){null!=this.m_materialProxy&&this.m_materialProxy.unlockMaterial()}isUnlockMaterial(){return this.m_materialProxy.isUnlockMatrial()}useGlobalMaterial(t,e=!1,s=!1){null!=this.m_materialProxy&&(this.m_materialProxy.unlockMaterial(),e?this.m_materialProxy.unlockTexture():this.m_materialProxy.lockTexture(),this.m_materialProxy.useGlobalMaterial(t,s),this.m_materialProxy.lockMaterial())}updateMaterialUniform(t){this.m_materialProxy.updateMaterialUniform(t)}clearBackBuffer(){this.m_renderProxy.clearBackBuffer()}setScissorRect(t,e,s,i){this.m_adapter.setScissorRect(t,e,s,i)}setScissorEnabled(t){this.m_adapter.setScissorEnabled(t)}setViewPort(t,e,s,i){this.m_renderProxy.setViewPort(t,e,s,i)}synFBOSizeWithViewport(){this.m_adapter.synFBOSizeWithViewport()}asynFBOSizeWithViewport(){this.m_adapter.asynFBOSizeWithViewport()}setFBOSizeFactorWithViewPort(t){this.m_adapter.setFBOSizeFactorWithViewPort(t)}createFBOAt(t,e,s,i,r=!1,a=!1,n=0){this.m_adapter.createFBOAt(t,e,s,i,r,a,n)}bindFBOAt(t,e){this.m_adapter.bindFBOAt(t,e)}setRenderToTexture(t,e=!1,s=!1,i=0){this.m_adapter.setRenderToTexture(t,e,s,i)}useFBO(t=!1,e=!1,s=!1){this.m_adapter.useFBO(t,e,s)}resetFBOAttachmentMask(t){this.m_adapter.resetFBOAttachmentMask(t)}setFBOAttachmentMaskAt(t,e){this.m_adapter.setFBOAttachmentMaskAt(t,e)}setRenderToBackBuffer(){this.m_adapter&&(this.m_adapter.setRenderToBackBuffer(r.default.FRAMEBUFFER),this.m_renderProxy.rshader.resetRenderState(),this.m_materialProxy.renderBegin())}lockViewport(){this.m_adapter.lockViewport()}unlockViewport(){this.m_adapter.unlockViewport()}setClearDepth(t){this.m_adapter.setClearDepth(t)}getClearDepth(){return this.m_adapter.getClearDepth()}getViewportX(){return this.m_adapter.getViewportX()}getViewportY(){return this.m_adapter.getViewportY()}getViewportWidth(){return this.m_adapter.getViewportWidth()}getViewportHeight(){return this.m_adapter.getViewportHeight()}setContextViewSize(t,e){this.m_adapter.setContextViewSize(t,e)}setCameraParam(t,e,s){this.m_cameraFov=t,this.m_cameraNear=e,this.m_cameraFar=s,null!=this.m_renderProxy&&this.m_renderProxy.setCameraParam(t,e,s)}initialize(t,e,s){if(null==this.m_adapter){this.m_renderProxy.setCameraParam(this.m_cameraFov,this.m_cameraNear,this.m_cameraFar),this.m_renderProxy.setWebGLMaxVersion(t.maxWebGLVersion);let i=new l.RenderProxyParam;i.uniformContext=s.uniformContext,i.vtxBufUpdater=s.builder,i.materialUpdater=s.builder,i.vtxBuilder=s.vtxBuilder,this.m_renderProxy.initialize(t,e,s.stage,i),this.m_rcuid=this.m_renderProxy.getRCUid(),s.vtxBuilder.initialize(this.m_rcuid,this.m_renderProxy.getRC(),this.m_renderProxy.getGLVersion()),this.m_adapter=this.m_renderProxy.getRenderAdapter();let r=this.m_renderProxy.getContext();r.setViewport(0,0,r.getRCanvasWidth(),r.getRCanvasHeight())}}initManager(t){null==this.m_materialProxy&&(this.m_materialProxy=new n.default,this.m_materialProxy.setDispBuilder(t))}setClearRGBColor3f(t,e,s){this.m_renderProxy.setClearRGBColor3f(t,e,s)}setClearRGBAColor4f(t,e,s,i){this.m_renderProxy.setClearRGBAColor4f(t,e,s,i)}getClearRGBAColor4f(t){t.fromArray4(this.m_adapter.bgColor)}updateRenderBufferSize(){this.m_adapter.updateRenderBufferSize()}vertexRenderBegin(){this.m_renderProxy.Vertex.renderBegin()}renderBegin(t=!0){null!=this.m_adapter&&(this.m_adapter.unlockViewport(),this.m_adapter.setClearDepth(1),this.m_renderProxy.Vertex.renderBegin(),this.m_materialProxy.renderBegin(),this.m_adapter.update(),this.m_adapter.setClearMaskClearAll(),this.m_adapter.renderBegin(),this.m_renderProxy.status.reset(),a.default.Reset(this.m_renderProxy.getRenderContext()),t&&(this.m_renderProxy.useCameraData(),this.m_renderProxy.updateCameraDataFromCamera(this.m_renderProxy.getCamera())))}resetState(){a.default.ResetState(),this.m_materialProxy.renderBegin()}resetmaterial(){this.m_materialProxy.renderBegin()}resetUniform(){this.m_materialProxy.resetUniform()}runEnd(){}}e.RendererInstanceContext=_,e.default=_},"11e6":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static AddContainerFlag(t){return 2147483648|t}static RemoveContainerFlag(t){return-2147483649&t}static AddSpaceUid(t,e){return-1048576&t|e}static RemoveSpaceUid(t){return-1048576&t}static GetSpaceUid(t){return 1048575&t}static AddRendererUid(t,e){return-133169153&t|e<<20}static RemoveRendererUid(t){return 133169152|t}static GetRendererUid(t){return t=(133169152&t)>>20,t<127?t:-1}static TestRendererUid(t){return t=(133169152&t)>>20,t<127}static AddSortEnabled(t){return 1073741824|t}static RemoveSortEnabled(t){return-1073741825&t}static TestSortEnabled(t){return 1073741824==(1073741824&t)}static AddRendererLoad(t){return 805306368|t}static RemoveRendererLoad(t){return-805306369&t}static TestSpaceContains(t){return(1048575&t)>0}static TestSpaceEnabled(t){return(1048575&t)<1}static TestSpaceEnabled2(t){return(1048575&t)<1&&2147483648!=(2147483648&t)}static TestContainerEnabled(t){return 133169152==(133169152&t)&&2147483648!=(2147483648&t)}static TestRendererEnabled(t){return 133169152==(938475520&t)&&2147483648!=(2147483648&t)}}i.DEFAULT=133169152,i.CONTAINER_FLAG=2147483648,i.CONTAINER_NOT_FLAG=-2147483649,i.SPACE_FLAG=1048575,i.SPACE_NOT_FLAG=-1048576,i.RENDERER_UID_FLAG=133169152,i.RENDERER_UID_NOT_FLAG=-133169153,i.RENDERER_UID_INVALID=127,i.SORT_FLAG=1073741824,i.SORT_NOT_FLAG=-1073741825,i.RENDERER_LOAD_FLAG=805306368,i.RENDERER_LOAD_NOT_FLAG=-805306369,i.RENDERER_ADN_LOAD_FLAG=938475520,e.default=i},1216:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("baae")),a=i(s("722e")),n=i(s("8333")),l=i(s("6d49")),h=s("e08e"),_=i(s("ffc0")),o=i(s("1f61")),d=s("070b"),u=s("a5ba"),m=i(s("29ef")),c=i(s("e2fe"));class f{constructor(t,e){this.m_rcuid=0,this.m_texResource=null,this.m_gl=null,this.m_fontFaceFlipped=!1,this.m_colorMask={mr:!0,mg:!0,mb:!0,ma:!0},this.m_rtx=null,this.m_clearMask=0,this.m_fboBuf=null,this.m_fboIndex=0,this.m_fboType=r.default.FRAMEBUFFER,this.m_fboBufList=[null,null,null,null,null,null,null,null],this.m_fboClearBoo=!0,this.m_fboViewportRectBoo=!1,this.m_polygonOffsetFlag=!1,this.m_polygonOffset=!1,this.m_clearDepth=1,this.m_preDepth=0,this.m_viewPortRect=new c.default(0,0,800,600),this.m_fboViewportRect=new c.default(0,0,800,600),this.m_fboSizeFactor=1,this.m_clearStencil=0,this.m_fboBiltRectData=new Uint16Array(8),this.m_fboViewportRectData=new Uint16Array(4),this.m_activeAttachmentTotal=1,this.m_scissorEnabled=!1,this.m_rState=null,this.m_webglVer=2,this.m_syncBgColor=!0,this.m_bodyBgColor="",this.bgColor=new Float32Array([0,0,0,1]),this.uViewProbe=null,this.m_param=null,this.m_devPRatio=1,this.m_viewportUnlock=!0,this.m_synFBOSizeWithViewport=!1,this.m_texResource=e,this.m_rcuid=t}setSyncBgColor(t){this.m_syncBgColor=t}getSyncBgColor(){return this.m_syncBgColor}syncHtmlBodyColor(){if(this.m_rtx){const t=this.bgColor;this.m_rtx.syncHtmlBodyColor(t[0],t[1],t[2])}}initGLCtx(t,e){e.getScissorTestEanbled()?this.m_gl.enable(this.m_gl.SCISSOR_TEST):this.m_gl.disable(this.m_gl.SCISSOR_TEST),t.isDepthTestEnabled()?this.m_gl.enable(this.m_gl.DEPTH_TEST):this.m_gl.disable(this.m_gl.DEPTH_TEST),t.isStencilTestEnabled()?this.m_gl.enable(this.m_gl.STENCIL_TEST):this.m_gl.disable(this.m_gl.STENCIL_TEST),e.getPolygonOffsetEanbled()?this.enabledPolygonOffset():this.disabledPolygonOffset(),this.m_gl.enable(this.m_gl.CULL_FACE),this.m_gl.cullFace(this.m_gl.BACK),this.m_gl.enable(this.m_gl.BLEND),this.m_gl.enable(this.m_gl.BLEND),e.getDitherEanbled()?this.m_gl.enable(this.m_gl.DITHER):this.m_gl.disable(this.m_gl.DITHER),this.m_gl.frontFace(this.m_gl.CCW)}updateGLCtx(){this.m_gl=this.m_rtx.getRC(),this.initGLCtx(this.m_rtx,this.m_param)}initialize(t,e,s,i){if(null==this.m_rtx&&(this.m_syncBgColor=e.syncBgColor,this.m_webglVer=t.getWebGLVersion(),this.m_rState=s,this.m_rtx=t,this.m_param=e,this.m_gl=t.getRC(),this.initGLCtx(t,e),this.m_clearMask=this.m_gl.COLOR_BUFFER_BIT|this.m_gl.DEPTH_BUFFER_BIT|this.m_gl.STENCIL_BUFFER_BIT,null==this.uViewProbe)){let t=this.m_viewPortRect,e=this;e.uViewProbe=i,this.uViewProbe.setVec4DataWithArr4([t.x,t.y,t.width,t.height])}}setFrontFaceFlipped(t){this.m_fontFaceFlipped!=t&&(t?this.m_gl.frontFace(this.m_gl.CW):this.m_gl.frontFace(this.m_gl.CCW),this.m_fontFaceFlipped=t)}enabledPolygonOffset(){this.m_polygonOffset||(this.m_polygonOffset=!0,this.m_gl.enable(this.m_gl.POLYGON_OFFSET_FILL))}disabledPolygonOffset(){this.m_polygonOffset&&(this.m_polygonOffset=!1,this.m_gl.disable(this.m_gl.POLYGON_OFFSET_FILL))}setPolygonOffset(t,e=0){this.m_gl.polygonOffset(t,e),this.m_polygonOffsetFlag=!0}resetPolygonOffset(){this.m_polygonOffsetFlag&&(this.m_gl.polygonOffset(0,0),this.m_polygonOffsetFlag=!1)}getDiv(){return this.m_rtx.getDiv()}getCanvas(){return this.m_rtx.getCanvas()}setClearDepth(t){this.m_clearDepth=t}getClearDepth(){return this.m_clearDepth}setContextViewSize(t,e){this.m_rtx.autoSyncRenderBufferAndWindowSize=!1,this.m_rtx.resizeBufferSize(t,e)}getViewportX(){return this.m_rtx.getViewportX()}getViewportY(){return this.m_rtx.getViewportY()}getViewportWidth(){return this.m_rtx.getViewportWidth()}getViewportHeight(){return this.m_rtx.getViewportHeight()}getFBOFitWidth(){return this.m_rtx.getFBOWidth()}getFBOFitHeight(){return this.m_rtx.getFBOHeight()}getRCanvasWidth(){return this.m_rtx.getRCanvasWidth()}getRCanvasHeight(){return this.m_rtx.getRCanvasHeight()}setColorMask(t,e,s,i){this.m_colorMask.mr=t,this.m_colorMask.mg=e,this.m_colorMask.mb=s,this.m_colorMask.ma=i}setClearMaskClearAll(){this.m_clearMask=this.m_gl.COLOR_BUFFER_BIT|this.m_gl.DEPTH_BUFFER_BIT|this.m_gl.STENCIL_BUFFER_BIT}setClearMaskClearOnlyColor(){this.m_clearMask=this.m_gl.COLOR_BUFFER_BIT}setClearMaskClearOnlyDepthAndStencil(){this.m_clearMask=this.m_gl.DEPTH_BUFFER_BIT|this.m_gl.STENCIL_BUFFER_BIT}setScissorRect(t,e,s,i){this.m_scissorEnabled&&this.m_gl.scissor(t,e,s,i)}setScissorEnabled(t){t?this.m_scissorEnabled||(this.m_scissorEnabled=!0,this.m_gl.enable(this.m_gl.SCISSOR_TEST)):this.m_scissorEnabled&&(this.m_scissorEnabled=!1,this.m_gl.disable(this.m_gl.SCISSOR_TEST))}clearDepth(t=1){let e=this.m_rState.getDepthTestMode();this.m_rState.setDepthTestMode(h.DepthTestMode.OPAQUE),this.m_clearDepth=t,this.m_preDepth!==this.m_clearDepth&&(this.m_preDepth=this.m_clearDepth,this.m_gl.clearDepth(this.m_clearDepth)),this.m_gl.clear(this.m_gl.DEPTH_BUFFER_BIT),this.m_rState.setDepthTestMode(e)}clearColor(t){this.m_rtx.syncHtmlBodyColor(t.r,t.g,t.b),this.syncHtmlColor(),this.m_gl.clearColor(t.r,t.g,t.b,t.a),this.m_gl.clear(this.m_gl.COLOR_BUFFER_BIT)}syncHtmlColor(){if(this.m_syncBgColor&&document&&this.m_bodyBgColor!=this.m_rtx.bodyBgColor){this.m_bodyBgColor=this.m_rtx.bodyBgColor;const t=document.body;t.style.background=this.m_bodyBgColor}}clear(){this.m_preDepth!==this.m_clearDepth&&(this.m_preDepth=this.m_clearDepth,this.m_gl.clearDepth(this.m_clearDepth)),this.m_rtx.isStencilTestEnabled()&&this.m_gl.clearStencil(this.m_clearStencil),this.syncHtmlColor();const t=this.bgColor;this.m_gl.clearColor(t[0],t[1],t[2],t[3]),this.m_gl.clear(this.m_clearMask)}reset(){this.m_rState.setCullFaceMode(h.CullFaceMode.BACK),this.m_rState.setDepthTestMode(h.DepthTestMode.OPAQUE),m.default.Reset(this.m_rtx)}getRenderContext(){return this.m_rtx}renderBegin(){null!=this.m_rtx&&(this.m_fboSizeFactor=1,this.reseizeViewPort(),u.RenderStateObject.Unlock(),u.RenderStateObject.UseRenderState(m.default.NORMAL_STATE),d.RenderColorMask.Unlock(),d.RenderColorMask.UseRenderState(d.RenderColorMask.ALL_TRUE_COLOR_MASK),this.clear())}updateViewPort(){let t=this.m_viewPortRect;this.uViewProbe.setVec4Data(t.x,t.y,t.width,t.height),this.uViewProbe.update(),this.m_gl.viewport(t.x,t.y,t.width,t.height)}checkViewPort(t){let e=this.m_viewPortRect,s=this.m_rtx.getDevicePixelRatio(),i=e.testEqual(t);i=i||Math.abs(this.m_devPRatio-s)>.01,i&&(this.m_devPRatio=s,e.copyFrom(t),this.updateViewPort())}reseizeViewPort(){this.m_viewportUnlock&&this.checkViewPort(this.m_rtx.getViewPortSize())}reseizeFBOViewPort(){this.m_viewportUnlock&&this.checkViewPort(this.m_fboViewportRect)}setViewProbeValue(t,e,s,i){this.uViewProbe.setVec4Data(t,e,s,i),this.uViewProbe.update()}lockViewport(){this.m_viewportUnlock=!1}unlockViewport(){this.m_viewportUnlock=!0}renderEnd(){}update(){}updateRenderBufferSize(t=!0){this.m_rtx.updateRenderBufferSize(t)}destroy(){this.m_rtx=null,this.m_rState=null}getDevicePixelRatio(){return this.m_rtx.getDevicePixelRatio()}loseContext(){this.m_rtx.loseContext()}isContextLost(){return this.m_rtx.isContextLost()}readPixels(t,e,s,i,r,a,n){this.m_gl.readPixels(t,e,s,i,_.default.ToGL(this.m_gl,r),o.default.ToGL(this.m_gl,a),n)}setFBOViewportRect(t,e,s,i){this.m_fboViewportRectData[0]=t,this.m_fboViewportRectData[1]=e,this.m_fboViewportRectData[2]=s,this.m_fboViewportRectData[3]=i,this.m_fboViewportRectBoo=!0}createFBOAt(t,e,s,i,r=!1,a=!1,n=0){null==this.m_fboBufList[t]&&(t>7&&(t=7),this.m_fboType=e,this.m_fboBuf=new l.default(this.m_rcuid,this.m_texResource,this.m_fboType),this.m_fboBuf.multisampleEnabled=n>0,this.m_fboBuf.multisampleLevel=n,this.m_fboBuf.writeDepthEnabled=r,this.m_fboBuf.writeStencilEnabled=a,this.m_fboBuf.initialize(this.m_gl,s,i),this.m_fboBufList[t]=this.m_fboBuf,this.m_fboBuf.sizeFixed=!0)}resizeFBOAt(t,e,s){t>7?t=7:t<0&&(t=0),null!=this.m_fboBufList[t]&&this.m_fboBufList[t].resize(e,s)}getFBOWidthAt(t){return null!=this.m_fboBufList[t]?this.m_fboBufList[t].getWidth():0}getFBOHeightAt(t){return null!=this.m_fboBufList[t]?this.m_fboBufList[t].getHeight():0}synFBOSizeWithViewport(){this.m_synFBOSizeWithViewport=!0}asynFBOSizeWithViewport(){this.m_synFBOSizeWithViewport=!1}setFBOSizeFactorWithViewPort(t){this.m_fboSizeFactor=t}bindFBOAt(t,e){if(t>7?t=7:t<0&&(t=0),this.m_fboBuf=this.m_fboBufList[t],null==this.m_fboBuf)throw Error("Fatal Error!!! this.m_fboBuf == null.");this.m_fboIndex=t,this.m_fboType=e,this.m_fboBuf.bind(e),this.m_fboClearBoo=!0}clearFBODepthAt(t,e=1){let s=this.m_fboBufList[t];null!=s&&s.clearOnlyDepth(e)}resetFBOAttachmentMask(t){null!=this.m_fboBuf&&this.m_fboBuf.resetAttachmentMask(t)}setFBOAttachmentMaskAt(t,e){null!=this.m_fboBuf&&this.m_fboBuf.setAttachmentMaskAt(t,e)}getFBOAttachmentTotal(){return null!=this.m_fboBuf?this.m_fboBuf.getAttachmentTotal():0}isFBORunning(){return l.default.IsFBORunning(this.m_rcuid)}setRenderToTexture(t,e=!1,s=!1,i=0){(i<0||i>=8)&&(i=0),null==t&&0==i?this.setRenderToBackBuffer(r.default.FRAMEBUFFER):(0==i&&(null!=this.m_fboBuf&&(this.m_synFBOSizeWithViewport?this.m_fboBuf.initialize(this.m_gl,Math.floor(this.m_rtx.getFBOWidth()*this.m_fboSizeFactor),Math.floor(this.m_rtx.getFBOHeight()*this.m_fboSizeFactor)):this.m_fboViewportRectBoo?this.m_fboBuf.initialize(this.m_gl,this.m_fboViewportRectData[2],this.m_fboViewportRectData[3]):this.m_fboBuf.sizeFixed||this.m_fboBuf.initialize(this.m_gl,t.getWidth(),t.getHeight())),this.m_fboIndex>=0&&null==this.m_fboBuf&&(this.m_fboBuf=new l.default(this.m_rcuid,this.m_texResource,this.m_fboType),this.m_fboBufList[this.m_fboIndex]=this.m_fboBuf,this.m_fboBuf.writeDepthEnabled=e,this.m_fboBuf.writeStencilEnabled=s,this.m_synFBOSizeWithViewport?this.m_fboBuf.initialize(this.m_gl,Math.floor(this.m_rtx.getFBOWidth()*this.m_fboSizeFactor),Math.floor(this.m_rtx.getFBOHeight()*this.m_fboSizeFactor)):this.m_fboViewportRectBoo?this.m_fboBuf.initialize(this.m_gl,this.m_fboViewportRectData[2],this.m_fboViewportRectData[3]):this.m_fboBuf.initialize(this.m_gl,t.getWidth(),t.getHeight()))),this.m_fboBuf&&this.m_fboBuf.renderToTexAt(this.m_gl,t,i),this.m_fboClearBoo=!0)}getActiveAttachmentTotal(){return this.m_activeAttachmentTotal}getAttachmentTotal(){return this.m_activeAttachmentTotal}useFBO(t=!1,e=!1,s=!1){if(null!=this.m_fboBuf&&this.m_fboClearBoo){if(this.m_fboClearBoo=!1,this.m_fboBuf.use(this.m_gl),this.m_activeAttachmentTotal=this.m_fboBuf.getActiveAttachmentTotal(),t&&this.m_fboBuf.clearOnlyColor(this.bgColor),this.m_fboBuf.writeDepthEnabled?this.m_fboBuf.writeStencilEnabled?e&&s?this.m_fboBuf.clearOnlyDepthAndStencil(this.m_clearDepth,4294967295):e?this.m_fboBuf.clearOnlyDepth(this.m_clearDepth):s&&this.m_fboBuf.clearOnlyStencil(255):e&&this.m_fboBuf.clearOnlyDepth(this.m_clearDepth):s&&this.m_fboBuf.writeStencilEnabled&&this.m_fboBuf.clearOnlyStencil(255),1==this.m_webglVer){const i=this.m_gl;let r=0;t&&(r|=i.COLOR_BUFFER_BIT),e&&(r|=i.DEPTH_BUFFER_BIT),s&&(r|=i.STENCIL_BUFFER_BIT),r>0&&i.clear(r)}let i=this.m_viewPortRect;this.m_fboBiltRectData[4]=this.m_fboBiltRectData[0]=i.x,this.m_fboBiltRectData[5]=this.m_fboBiltRectData[1]=i.y,this.m_fboBiltRectData[6]=this.m_fboBiltRectData[2]=i.getRight(),this.m_fboBiltRectData[7]=this.m_fboBiltRectData[3]=i.getTop(),this.m_fboViewportRectBoo?(this.m_fboViewportRectBoo=!1,this.m_fboViewportRect.setTo(this.m_fboViewportRectData[0],this.m_fboViewportRectData[1],this.m_fboViewportRectData[2],this.m_fboViewportRectData[3]),this.reseizeFBOViewPort()):(this.m_synFBOSizeWithViewport?this.m_fboViewportRect.setTo(0,0,Math.floor(this.m_rtx.getFBOWidth()*this.m_fboSizeFactor),Math.floor(this.m_rtx.getFBOHeight()*this.m_fboSizeFactor)):(this.m_fboBuf.isSizeChanged()&&this.m_fboBuf.initialize(this.m_gl,this.m_fboBuf.getWidth(),this.m_fboBuf.getHeight()),this.m_fboViewportRect.setTo(0,0,this.m_fboBuf.getWidth(),this.m_fboBuf.getHeight())),this.reseizeFBOViewPort())}}setRenderToBackBuffer(t=r.default.FRAMEBUFFER){this.m_activeAttachmentTotal=1,l.default.BindToBackbuffer(this.m_gl,t,this.m_rcuid),this.reseizeViewPort()}bindFBOToDraw(){null!=this.m_fboBuf&&this.m_fboBuf.bind(r.default.DRAW_FRAMEBUFFER)}bindFBOToWrite(){null!=this.m_fboBuf&&this.m_fboBuf.bind(r.default.READ_FRAMEBUFFER)}setBlitFboSrcRect(t,e,s,i){this.m_fboBiltRectData[0]=t,this.m_fboBiltRectData[1]=e,this.m_fboBiltRectData[2]=t+s,this.m_fboBiltRectData[3]=e+i}setBlitFboDstRect(t,e,s,i){this.m_fboBiltRectData[4]=t,this.m_fboBiltRectData[5]=e,this.m_fboBiltRectData[6]=t+s,this.m_fboBiltRectData[7]=e+i}blitFBO(t=0,e=0,s=n.default.COLOR_BUFFER_BIT,i=a.default.NEAREST,h=0,_=0,o=null){t>7&&(t=7),e>7&&(e=7),t>=0&&null!=this.m_fboBufList[t]?this.m_fboBufList[t].bind(r.default.READ_FRAMEBUFFER):l.default.BindToBackbuffer(this.m_gl,r.default.READ_FRAMEBUFFER,this.m_rcuid),e>=0&&null!=this.m_fboBufList[e]?this.m_fboBufList[e].bind(r.default.DRAW_FRAMEBUFFER):l.default.BindToBackbuffer(this.m_gl,r.default.DRAW_FRAMEBUFFER,this.m_rcuid),h>0&&(_<0&&(_=0),null==o&&(o=[0,0,0,1]),this.m_gl.clearBufferfv(h,_,o));let d=this.m_fboBiltRectData;this.m_gl.blitFramebuffer(d[0],d[1],d[2],d[3],d[4],d[5],d[6],d[7],s,i)}}e.default=f},1264:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("11e6")),a=s("e08e"),n=s("eca0");class l{constructor(t,e,s,i){this.m_rpoUnitBuilder=null,this.m_dataBuilder=null,this.m_processBuider=null,this.m_waitList=[],this.m_processUidList=[],this.m_rendererUid=-1,this.m_existencetotal=0,this.m_rprocess=null,this.m_entityManaListener=null,this.version=0,this.m_rendererUid=t,this.m_dataBuilder=e,this.m_rpoUnitBuilder=s,this.m_processBuider=i}setListener(t){this.m_entityManaListener=t}isEmpty(){return this.m_existencetotal<1}isHaveEntity(){return this.m_existencetotal>0}removeEntity(t){this.m_existencetotal--;let e=t.getDisplay();if(null!=e&&null!=e.__$$runit){const t=e.__$$runit.rentity;let s=t.__$getParent(),i=0;while(s){if(!s.hasParent()&&s.getREType()>=20){const t=this.m_processBuider.getNodeByUid(s.__$wprocuid);t.forceRemoveDisp(e),i=1;break}s=s.getParent()}let r=e.__$ruid,l=this.m_rpoUnitBuilder.getRCRPObj(r);if(i<1)if(l){if(l.count>0)if(l.count<2)l.rprocessUid>-1&&(this.m_rprocess=this.m_processBuider.getNodeByUid(l.rprocessUid),this.m_rprocess.removeDisp(e),l.rprocessUid=-1);else{let t=n.RCRPObj.RenerProcessMaxTotal;for(let s=0;s<t;++s)(l.idsFlag&1<<s)>0&&(this.m_rprocess=this.m_processBuider.getNodeByUid(s),this.m_rprocess.removeDisp(e))}}else this.m_rprocess=this.m_processBuider.getNodeByUid(e.__$$runit.getRPROUid()),this.m_rprocess.removeDisp(e);(i>0||0==l.count)&&(e.__$$rsign,a.DisplayRenderSign.LIVE_IN_RENDERER,e.__$$rsign=a.DisplayRenderSign.NOT_IN_RENDERER,this.m_rpoUnitBuilder.restoreByUid(r)),this.version++}t.__$rseFlag=r.default.RemoveRendererUid(t.__$rseFlag),t.__$rseFlag=r.default.RemoveRendererLoad(t.__$rseFlag),t.__$rseFlag=r.default.RemoveSortEnabled(t.__$rseFlag),this.m_entityManaListener&&this.m_entityManaListener.removeFromRenderer(t,this.m_rendererUid,-1)}addEntity(t,e,s=!1){if(null!=t){let i=t.getDisplay();if(null!=i){if(i.__$$rsign==a.DisplayRenderSign.LIVE_IN_RENDERER&&!this.m_rpoUnitBuilder.testRPNodeNotExists(i.__$ruid,e))return;this.m_rprocess=this.m_processBuider.getNodeByUid(e),t.__$rseFlag=this.m_rprocess.getSortEnabled()?r.default.AddSortEnabled(t.__$rseFlag):r.default.RemoveSortEnabled(t.__$rseFlag),s?(i.__$$rsign==a.DisplayRenderSign.NOT_IN_RENDERER&&(i.__$$rsign=a.DisplayRenderSign.GO_TO_RENDERER),t.__$rseFlag=r.default.AddRendererLoad(t.__$rseFlag),t.__$rseFlag=r.default.AddRendererUid(t.__$rseFlag,this.m_rendererUid),this.m_waitList.push(t),this.m_processUidList.push(e)):this.testValidData(t)?this.ensureAdd(t,i,e):(i.__$$rsign==a.DisplayRenderSign.NOT_IN_RENDERER&&(i.__$$rsign=a.DisplayRenderSign.GO_TO_RENDERER),t.__$rseFlag=r.default.AddRendererLoad(t.__$rseFlag),this.m_waitList.push(t),this.m_processUidList.push(e))}else t.__$rseFlag=r.default.AddRendererUid(t.__$rseFlag,this.m_rendererUid)}return!1}testValidData(t){let e=t.getMaterial();if(null!=e&&t.hasMesh()){if(e.hasShaderData())return!0;null!=e.getCodeBuf()&&t.activeDisplay()}return!1}addContainer(t,e){const s=this.m_processBuider.getNodeByUid(e);s.addContainer(t)}removeContainer(t,e){const s=this.m_processBuider.getNodeByUid(e);s.removeContainer(t)}ensureAdd(t,e,s){t.update(),t.__$rseFlag=r.default.AddRendererUid(t.__$rseFlag,this.m_rendererUid),t.__$rseFlag=r.default.RemoveRendererLoad(t.__$rseFlag),t.__$setRenderProxy(this.m_dataBuilder.getRenderProxy()),this.m_existencetotal++,e.__$$rsign==a.DisplayRenderSign.NOT_IN_RENDERER&&(e.__$$rsign=a.DisplayRenderSign.GO_TO_RENDERER),this.m_rprocess=this.m_processBuider.getNodeByUid(s),(e.__$ruid>-1||this.m_dataBuilder.buildGpuDisp(e,t))&&this.m_rprocess.addDisp(e),null!=this.m_entityManaListener&&this.m_entityManaListener.addToRenderer(t,this.m_rendererUid,s);const i=t.getGlobalBounds();i&&(e.__$$runit.bounds=i,e.__$$runit.pos=i.center),this.version++}updateWaitList(){let t=this.m_waitList.length,e=null,s=null;for(let i=0;i<t;++i)if(e=this.m_waitList[i],(r.default.RENDERER_LOAD_FLAG&e.__$rseFlag)==r.default.RENDERER_LOAD_FLAG){if(this.testValidData(e)){if(s=e.getDisplay(),s.__$$rsign==a.DisplayRenderSign.LIVE_IN_RENDERER&&!this.m_rpoUnitBuilder.testRPNodeNotExists(s.__$ruid,this.m_processUidList[i])){this.m_waitList.splice(i,1),this.m_processUidList.splice(i,1),--t,--i;continue}this.ensureAdd(e,s,this.m_processUidList[i]),this.m_waitList.splice(i,1),this.m_processUidList.splice(i,1),--t,--i}}else s=e.getDisplay(),null!=s&&s.__$$rsign==a.DisplayRenderSign.GO_TO_RENDERER&&(s.__$$rsign=a.DisplayRenderSign.NOT_IN_RENDERER),e.__$rseFlag=r.default.RemoveRendererLoad(e.__$rseFlag),e.__$rseFlag=r.default.RemoveRendererUid(e.__$rseFlag),e.__$rseFlag=r.default.RemoveSortEnabled(e.__$rseFlag),this.m_waitList.splice(i,1),this.m_processUidList.splice(i,1),--t,--i,null!=this.m_entityManaListener&&this.m_entityManaListener.removeFromRenderer(e,this.m_rendererUid,-1)}update(){this.m_waitList.length>0&&this.updateWaitList(),this.m_dataBuilder.update()}}e.default=l},"13b1":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.ELEMENTS_TRIANGLES=1,i.ELEMENTS_TRIANGLE_STRIP=2,i.ELEMENTS_TRIANGLE_FAN=3,i.ELEMENTS_INSTANCED_TRIANGLES=4,i.ARRAYS_LINES=5,i.ARRAYS_LINE_STRIP=6,i.ARRAYS_POINTS=7,i.ELEMENTS_LINES=8,i.ELEMENTS_INSTANCED_LINES=9,i.ELEMENTS_LINES_STRIP=10,i.ELEMENTS_INSTANCED_TRIANGLES_STRIP=11,i.ELEMENTS_INSTANCED_LINES_STRIP=12,i.DISABLE=0,e.default=i},"1e15":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8a0a")),a=i(s("030e"));class n{constructor(){this.m_rcuid=0,this.m_glVer=2,this.m_rc=null,this.vroUid=0,this.rioUid=0}setGLCtx(t){this.m_rc=t}getRC(){return this.m_rc}getRCUid(){return this.m_rcuid}createBuf(){return this.m_rc.createBuffer()}deleteBuf(t){this.m_rc.deleteBuffer(t)}bindArrBuf(t){this.m_rc.bindBuffer(this.m_rc.ARRAY_BUFFER,t)}bindEleBuf(t){this.m_rc.bindBuffer(this.m_rc.ELEMENT_ARRAY_BUFFER,t)}arrBufSubData(t,e){this.m_rc.bufferSubData(this.m_rc.ARRAY_BUFFER,e,t)}arrBufData(t,e){this.m_rc.bufferData(this.m_rc.ARRAY_BUFFER,t,r.default.ToGL(this.m_rc,e))}eleBufSubData(t,e){this.m_rc.bufferSubData(this.m_rc.ELEMENT_ARRAY_BUFFER,e,t)}eleBufData(t,e){this.m_rc.bufferData(this.m_rc.ELEMENT_ARRAY_BUFFER,t,r.default.ToGL(this.m_rc,e))}arrBufDataMem(t,e){this.m_rc.bufferData(this.m_rc.ARRAY_BUFFER,t,r.default.ToGL(this.m_rc,e))}eleBufDataMem(t,e){this.m_rc.bufferData(this.m_rc.ELEMENT_ARRAY_BUFFER,t,r.default.ToGL(this.m_rc,e))}useVtxAttribsPtrTypeFloat(t,e,s,i,r,a){this.m_rc.bindBuffer(this.m_rc.ARRAY_BUFFER,e);for(let n=0;n<i;++n)t.vertexAttribPointerTypeFloat(s[n],a,r[n])}useVtxAttribsPtrTypeFloatMulti(t,e,s,i,r,a){for(let n=0;n<i;++n)this.m_rc.bindBuffer(this.m_rc.ARRAY_BUFFER,e[n]),t.vertexAttribPointerTypeFloat(s[n],a,r[n])}createVertexArray(){let t=null;return t=2==this.m_glVer?this.m_rc.createVertexArray():a.default.OES_vertex_array_object.createVertexArrayOES(),t}bindVertexArray(t){return 2==this.m_glVer?this.m_rc.bindVertexArray(t):a.default.OES_vertex_array_object.bindVertexArrayOES(t),t}deleteVertexArray(t){2==this.m_glVer?this.m_rc.deleteVertexArray(t):a.default.OES_vertex_array_object.deleteVertexArrayOES(t)}testVROUid(t){return this.vroUid!=t&&(this.vroUid=t,!0)}testRIOUid(t){return this.rioUid!=t&&(this.rioUid=t,!0)}initialize(t,e,s){this.m_rc=e,this.m_rcuid=t,this.m_glVer=s;let i=this;i.RGBA=e.RGBA,i.UNSIGNED_BYTE=e.UNSIGNED_BYTE,i.TRIANGLE_STRIP=e.TRIANGLE_STRIP,i.TRIANGLE_FAN=e.TRIANGLE_FAN,i.TRIANGLES=e.TRIANGLES,i.LINES=e.LINES,i.LINE_STRIP=e.LINE_STRIP,i.UNSIGNED_SHORT=e.UNSIGNED_SHORT,i.UNSIGNED_INT=e.UNSIGNED_INT,i.COLOR=e.COLOR,i.DEPTH=e.DEPTH,i.STENCIL=e.STENCIL,i.DEPTH_STENCIL=e.DEPTH_STENCIL,this.setGLCtx(e)}renderBegin(){this.vroUid=-2,this.rioUid=-3}}e.default=n},"1eb2":function(t,e,s){"use strict";if("undefined"!==typeof window){var i=window.document.currentScript,r=s("8875");i=r(),"currentScript"in document||Object.defineProperty(document,"currentScript",{get:r});var a=i&&i.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);a&&(s.p=a[1])}},"1f32":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},"1f61":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("030e"));class a{static ToGL(t,e){switch(e){case a.UNSIGNED_BYTE:return t.UNSIGNED_BYTE;case a.BYTE:return t.BYTE;case a.FLOAT:return t.FLOAT;case a.HALF_FLOAT:return t.HALF_FLOAT;case a.HALF_FLOAT_OES:return null!=r.default.OES_texture_half_float?r.default.OES_texture_half_float.HALF_FLOAT_OES:t.FLOAT;case a.UNSIGNED_SHORT:return t.UNSIGNED_SHORT;case a.UNSIGNED_INT:return t.UNSIGNED_INT;case a.UNSIGNED_SHORT_5_6_5:return t.UNSIGNED_SHORT_5_6_5;case a.UNSIGNED_SHORT_4_4_4_4:return t.UNSIGNED_SHORT_4_4_4_4;case a.UNSIGNED_SHORT_5_5_5_1:return t.UNSIGNED_SHORT_5_5_5_1;case a.UNSIGNED_INT_24_8_WEBGL:return r.default.WEBGL_depth_texture.UNSIGNED_INT_24_8_WEBGL;default:break}return t.UNSIGNED_BYTE}}a.UNSIGNED_BYTE=1108,a.UNSIGNED_SHORT=1109,a.UNSIGNED_INT=1110,a.BYTE=1111,a.FLOAT=1211,a.HALF_FLOAT=1212,a.HALF_FLOAT_OES=1213,a.UNSIGNED_SHORT_5_6_5=1214,a.UNSIGNED_SHORT_4_4_4_4=1215,a.UNSIGNED_SHORT_5_5_5_1=1216,a.UNSIGNED_INT_24_8_WEBGL=1217,e.default=a},2560:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("ab73"));class a{create(t,e){let s=t.getCamera();return e.hasUniformByName(r.default.CameraViewMatUNS)&&e.hasUniformByName(r.default.CameraProjectiveMatUNS)?t.uniformContext.createShaderGlobalUniformFromProbe(s.matUProbe,"u_viewAndProjMat",[r.default.CameraViewMatUNS,r.default.CameraProjectiveMatUNS]):e.hasUniformByName(r.default.CameraViewMatUNS)?t.uniformContext.createShaderGlobalUniformFromProbeAt(s.matUProbe,"u_viewMat",[r.default.CameraViewMatUNS],0):e.hasUniformByName(r.default.CameraProjectiveMatUNS)?t.uniformContext.createShaderGlobalUniformFromProbeAt(s.matUProbe,"u_projMat",[r.default.CameraProjectiveMatUNS],1):null}getIDNS(){return"CameraUniformBuilder"}}e.default=a},"264c":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("265e")),a=i(s("5f3c")),n=i(s("34cd")),l=i(s("e39a"));class h{destroy(){this.container=null,this.node.unit.reset(),this.node.reset(),this.node=null}}class _ extends a.default{constructor(t){super(t),this.m_begin=null,this.m_end=null,this.m_next=null,this.m_unit=null,this.m_units=[],this.m_unitsTotal=0,this.m_renderTotal=0,this.m_nodeConts=[],this.m_passProc=new n.default,this.m_shdUpdate=!1}showInfo(){let t="",e=this.m_begin;while(e)t+=e.unit.value+",",e=e.next}clear(){if(this.m_shader){this.m_units.length>0&&(this.m_units=[]);let t=this.m_begin,e=null;while(null!=t)e=t,t=t.next,e.prev=null,e.next=null;this.m_begin=this.m_end=null,this.m_unitsTotal=0,this.m_renderTotal=0,this.sortEnabled=!0,this.m_shader=null}this.m_sorter=null}update(){this.sortEnabled&&this.sort()}addContainer(t){let e=0;const s=this.m_nodeConts;for(;e<s.length;++e)if(s[e].container==t)break;if(e>=s.length){let e=new l.default;e.shader=this.m_shader,e.rentity=t,e.retype=t.getREType(),e.bounds=t.getGlobalBounds(),e.pos=e.bounds.center;let i=new r.default;i.unit=e,this.addNode(i);let a=new h;return a.container=t,a.node=i,s.push(a),!0}return!1}removeContainer(t){let e=0;const s=this.m_nodeConts;for(;e<s.length;++e)if(s[e].container==t){const t=s[e].node;this.removeNode(t),s[e].destroy(),s.splice(e,1);break}if(e>=s.length){let e=new l.default;e.shader=this.m_shader,e.rentity=t,e.retype=t.getREType();let s=new r.default;return s.unit=e,this.removeNode(s),!0}return!1}run(t){this.m_shader.resetUniform();let e=null,s=this.m_units;this.m_shdUpdate=!1;const i=this.m_passProc;i.shader=this.m_shader;for(let r=0;r<this.m_renderTotal;++r)e=s[r],e.retype<12?e.rendering&&(this.m_shader.bindToGpu(e.shdUid),e.updateVtx(),e.drawing&&(e.rgraph&&e.rgraph.isEnabled()?(i.units=[e],i.rc=t,i.vtxFlag=!0,i.texFlag=!0,e.rgraph.run(i),this.m_shdUpdate=!0):(this.m_shdUpdate&&(e.applyShader(!0),this.m_shdUpdate=!1),e.run(t),e.draw(t)))):e.run(t)}runLockMaterial(t){this.m_shader.resetUniform();let e=null,s=this.m_units;for(let i=0;i<this.m_renderTotal;++i)e=s[i],e.retype<12?e.rendering&&(this.m_shader.bindToGpu(e.shdUid),e.updateVtx(),e.drawing&&(e.vro.run(),e.runLockMaterial2(null),e.draw(t))):e.runLockMaterial2(null)}sort(){if(this.m_unitsTotal>0){let t=this.m_begin;this.m_units.length<this.m_unitsTotal&&(this.m_units=new Array(Math.round(1.1*this.m_unitsTotal)+1));let e=0;while(null!=t){const s=t.unit;s.retype<12?s.rendering&&s.drawing&&(this.m_units[e]=s,++e):(this.m_units[e]=s,++e),t=t.next}this.m_renderTotal=e;let s=0;const i=this.m_sorter;i&&(s=i.sortRODisplay(this.m_units,e)),s<1&&this.snsort(0,e-1)}}sorting(t,e){let s=this.m_units;this.m_unit=s[t];let i=this.m_unit.value;while(t<e){while(t<e&&s[e].value>=i)--e;s[t]=s[e];while(t<e&&s[t].value<=i)++t;s[e]=s[t]}return s[t]=this.m_unit,t}snsort(t,e){if(t<e){let s=this.sorting(t,e);this.snsort(t,s-1),this.snsort(s+1,e)}}getNodesTotal(){return this.m_unitsTotal}getBegin(){return this.m_next=this.m_begin,this.m_begin}getNext(){return null!=this.m_next&&(this.m_next=this.m_next.next),this.m_next}isEmpty(){return this.m_unitsTotal<1}addNode(t){null==t.prev&&null==t.next&&(null==this.m_begin?this.m_end=this.m_begin=t:null!=this.m_end.prev?(this.m_end.next=t,t.prev=this.m_end,this.m_end=t):(this.m_begin.next=t,t.prev=this.m_end,this.m_end=t),this.m_end.next=null,this.m_unitsTotal++)}removeNode(t){null==t.prev&&null==t.next&&t!=this.m_begin||(t==this.m_begin?t==this.m_end?this.m_begin=this.m_end=null:(this.m_begin=t.next,this.m_begin.prev=null):t==this.m_end?(this.m_end=t.prev,this.m_end.next=null):(t.next.prev=t.prev,t.prev.next=t.next),t.prev=null,t.next=null,this.m_unitsTotal--)}}e.default=_},"265e":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.__$ruid=-1,this.uid=-1,this.index=-1,this.shdUid=-1,this.vtxUid=-1,this.texMid=-1,this.rtokey=-1,this.prev=null,this.next=null,this.unit=null,this.vro=null,this.tro=null,this.rvroI=-1,this.rtroI=-1}updateData(){const t=this.unit;this.vtxUid=t.vtxUid,this.vro=t.vro,this.shdUid=t.shdUid,this.texMid=t.texMid,this.tro=t.tro}reset(){this.uid=-1,this.index=-1,this.shdUid=-1,this.vtxUid=-1,this.texMid=-1,this.rtokey=-1,this.unit=null,this.vro=null,this.tro=null,this.prev=null,this.next=null}}e.default=i},"29ef":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static CreateBlendMode(t,e,s,r=0){return i.rstb.createBlendMode(t,e,s,r)}static CreateBlendModeSeparate(t,e,s,r=0,a=0,n=0){return i.rstb.createBlendModeSeparate(t,e,s,r,a,n)}static CreateRenderState(t,e,s,r){return i.rstb.createRenderState(t,e,s,r)}static CreateRenderColorMask(t,e,s,r,a){return i.rstb.createRenderColorMask(t,e,s,r,a)}static GetRenderStateByName(t){return i.rstb.getRenderStateByName(t)}static GetRenderColorMaskByName(t){return i.rstb.getRenderColorMaskByName(t)}static UnlockBlendMode(){i.rstb.unlockBlendMode()}static LockBlendMode(t){i.rstb.lockBlendMode(t)}static UnlockDepthTestMode(){i.rstb.unlockDepthTestMode()}static LockDepthTestMode(t){i.rstb.lockDepthTestMode(t)}static ResetState(){i.rstb.resetState()}static Reset(t){i.rstb.reset(t)}static ResetInfo(){}static SetDepthTestEnable(t){i.rstb.setDepthTestEnable(t)}static SetBlendEnable(t){i.rstb.setBlendEnable(t)}}e.default=i},"2be1":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.m_nodesTotal=0,this.m_nodes=[],this.m_flags=[],this.m_freeIdList=[]}createNode(){return null}restoreUid(t){}getFreeTotal(){return this.m_freeIdList.length}hasFreeNode(){return this.m_freeIdList.length>0}getFreeId(){return this.m_freeIdList.length>0?this.m_freeIdList.pop():-1}getNodeByUid(t){return this.m_nodes[t]}getNodes(){return this.m_nodes}create(){let t=null,e=this.getFreeId();return e>=0?(t=this.m_nodes[e],t.uid=e,this.m_flags[e]=i.S_BUSY):(t=this.createNode(),this.m_nodes.push(t),this.m_flags.push(i.S_BUSY),t.uid=this.m_nodesTotal,this.m_nodesTotal++),t}restore(t){return null!=t&&t.uid>=0&&this.m_flags[t.uid]==i.S_BUSY&&(this.restoreUid(t.uid),this.m_freeIdList.push(t.uid),this.m_flags[t.uid]=i.S_FREE,t.reset(),!0)}restoreByUid(t){return t>=0&&t<this.m_nodesTotal&&this.m_flags[t]==i.S_BUSY&&(this.restoreUid(t),this.m_freeIdList.push(t),this.m_flags[t]=i.S_FREE,this.m_nodes[t].reset(),!0)}destroy(){this.m_nodes=[],this.m_freeIdList=[],this.m_flags=[],this.m_nodesTotal=0}}i.S_BUSY=1,i.S_FREE=0,e.default=i},3024:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3077"));class a extends r.default{constructor(t,e){super(t),this.m_datafs=null,this.m_vec4Total=1,e<1&&(e=1),this.m_vec4Total=e,this.m_datafs=new Float32Array(4*e),this.addVec4Data(this.m_datafs,this.m_vec4Total)}destroy(){super.destroy(),this.m_datafs=null}}e.default=a},3077:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("644c"));class a{constructor(t){this.m_uid=a.s_uid++,this.m_slot=null,this.m_fsList=null,this.m_fsIndex=0,this.m_slotBeginIndex=-1,this.rst=-1,this.uniformsTotal=0,this.uniformNames=null,this.uniformTypes=null,this.dataSizeList=null,this.bindSlot(t)}bindSlot(t){this.rst>=0&&this.reset(),null==this.m_fsList&&(this.m_fsList=[],this.uniformTypes=[],this.dataSizeList=[]),this.m_slot=t,this.rst=1,this.m_slotBeginIndex=t.index,this.m_fsIndex=t.index}getUid(){return this.m_uid}getSlotBeginIndex(){return this.m_slotBeginIndex}getRCUid(){return this.m_slot.getRCUid()}getFS32At(t){return this.m_fsList[t]}setFS32At(t,e){this.m_fsList[e]=t}setVec4DataAt(t,e,s,i,r){let a=this.m_fsList[t];a[0]=e,a[1]=s,a[2]=i,a[3]=r}setVec4Data(t,e,s,i){let r=this.m_fsList[0];r[0]=t,r[1]=e,r[2]=s,r[3]=i}setVec4DataAtWithArr4(t,e){this.m_fsList[t].set(e,0)}setVec4DataWithArr4(t){this.m_fsList[0].set(t,0)}addVec4Data(t,e){t.length,this.m_fsList.push(t),this.uniformTypes.push(r.default.SHADER_VEC4),this.dataSizeList.push(e),this.m_slot.dataList[this.m_fsIndex]=t,this.m_fsIndex++,this.uniformsTotal++,this.m_slot.index++}addMat4Data(t,e){this.m_fsList.push(t),this.uniformTypes.push(r.default.SHADER_MAT4),this.dataSizeList.push(e),this.m_slot.dataList[this.m_fsIndex]=t,this.m_fsIndex++,this.uniformsTotal++,this.m_slot.index++}isEnabled(){return this.rst>=0}update(){if(this.rst++,this.uniformsTotal<2)this.m_slot.flagList[this.m_slotBeginIndex]=this.rst;else for(let t=this.m_slotBeginIndex;t<=this.m_fsIndex;++t)this.m_slot.flagList[t]=this.rst}reset(){this.rst=-1,this.m_slotBeginIndex=-1,this.uniformsTotal=0,this.m_fsIndex=0,null!=this.m_fsList&&(this.m_fsList=null,this.uniformTypes=null,this.dataSizeList=null),this.m_slot=null}destroy(){this.reset()}}a.s_uid=0,e.default=a},3420:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=i(s("df9d")),n=s("070b"),l=s("a5ba"),h=i(s("5f3c")),_=i(s("34cd"));class o extends h.default{constructor(t){super(t),this.m_nodeLinker=new a.default,this.m_runs=new Array(5),this.m_passProc=new _.default,this.m_shdUpdate=!1;const e=this.m_runs;e.fill(null),e[0]=this.run0.bind(this),e[1]=this.run1.bind(this),e[2]=this.run2.bind(this)}showInfo(){this.m_nodeLinker.showInfo()}addNode(t){this.m_nodeLinker.addNodeAndSort(t)}rejoinNode(t){this.m_nodeLinker.containsNode(t)&&(this.m_nodeLinker.removeNodeAndSort(t),this.m_nodeLinker.addNodeAndSort(t))}removeNode(t){this.m_nodeLinker.removeNodeAndSort(t)}isEmpty(){return null==this.m_nodeLinker.getBegin()}run(t){this.m_runs[this.runMode](t)}run0(t){let e=this.m_nodeLinker.getBegin();if(null!=e){this.m_shader.bindToGpu(this.shdUid),this.m_shader.resetUniform();let s=null;this.m_shdUpdate=!1;const i=this.m_passProc;i.shader=this.m_shader;while(e)s=e.unit,s.rendering&&(s.updateVtx(),s.drawing&&(s.rgraph&&s.rgraph.isEnabled()?(i.units=[s],i.rc=t,i.vtxFlag=!0,i.texFlag=!0,s.rgraph.run(i),this.m_shdUpdate=!0):(this.m_shdUpdate&&(s.applyShader(!0),this.m_shdUpdate=!1),s.run(t),s.draw(t)))),e=e.next}}run1(t){let e=this.m_nodeLinker.getBegin();if(null!=e){this.m_shader.bindToGpu(this.shdUid),this.m_shader.resetUniform();const s=this.m_passProc;s.shader=this.m_shader;let i=this.m_nodeLinker,r=null,a=i.getVtxTotalAt(e.rvroI),n=i.getTexTotalAt(e.rtroI),l=a>0,h=n>0;this.m_shdUpdate=!1;while(null!=e)a<1&&(a=i.getVtxTotalAt(e.rvroI),l=!0),a--,n<1&&(n=i.getTexTotalAt(e.rtroI),h=!0),n--,r=e.unit,r.rendering&&(l=r.updateVtx()||l,r.drawing&&(r.rgraph&&r.rgraph.isEnabled()?(s.units=[r],s.rc=t,s.vtxFlag=l,s.texFlag=h,r.rgraph.run(s),this.m_shdUpdate=!0):this.draw1(t,r,l,h),l=!1,h=!1)),e=e.next}}draw1(t,e,s,i){this.m_shdUpdate&&(e.applyShader(!0),this.m_shdUpdate=!1),s&&(e.vro.run(),s=!1),i&&(e.tro.run(),i=!1),e.run2(t),e.draw(t)}run2(t){let e=this.m_nodeLinker.getBegin();if(null!=e){const s=this.m_shader;s.bindToGpu(this.shdUid),s.resetUniform();let i=null;l.RenderStateObject.UseRenderState(e.unit.renderState),n.RenderColorMask.UseRenderState(e.unit.rcolorMask);let r=this.m_nodeLinker.getVtxTotalAt(e.rvroI),a=this.m_nodeLinker.getTexTotalAt(e.rtroI),h=r>0,_=a>0;while(e)r<0&&(r=this.m_nodeLinker.getVtxTotalAt(e.rvroI),h=!0),r--,a<0&&(a=this.m_nodeLinker.getTexTotalAt(e.rtroI),_=!0),a--,i=e.unit,i.rendering&&(h=i.updateVtx()||h,i.drawing&&(h&&(i.vro.run(),h=!1),_&&(i.tro.run(),_=!1),null!=i.ubo&&i.ubo.run(t),s.useTransUniform(i.transUniform),s.useUniform(i.uniform),i.draw(t))),e=e.next}}runLockMaterial(t){let e=this.m_nodeLinker.getBegin();if(e){this.m_shader.bindToGpu(this.shdUid),this.m_shader.resetUniform();let s=this.m_shader.isTextureUnLocked();t.Texture.unlocked=s;let i=null;if(this.batchEnabled){let r=this.m_nodeLinker.getVtxTotalAt(e.rvroI),a=r>0;while(null!=e)r<1&&(r=this.m_nodeLinker.getVtxTotalAt(e.rvroI),a=!0),r--,i=e.unit,i.rendering&&(a=i.updateVtx()||a,i.drawing&&(a&&(i.vro.run(),a=!1),s&&i.tro.run(),i.runLockMaterial2(null),i.draw(t))),e=e.next}else while(null!=e)i=e.unit,i.rendering&&(i.updateVtx(),i.drawing&&(i.runLockMaterial(),s&&e.tro.run(),i.draw(t))),e=e.next;t.Texture.unlocked=!1}}drawUnit(t,e,s){e.updateVtx(),e.drawing&&(this.m_shader.bindToGpu(e.shdUid),e.updateVtx(),e.run(t),e.draw(t))}drawLockMaterialByUnit(t,e,s,i,a){if(e.updateVtx(),e.drawing){a&&this.m_shader.resetUniform();let n=e.vro;r.default.IsMobileWeb()&&(n=this.vtxResource.getVROByResUid(s.getVtxResUid(),this.m_shader.getCurrentShd(),!0)),n.run(),e.runLockMaterial2(i?this.m_shader.__$globalUniform:null),e.draw(t)}}reset(){let t=this.m_nodeLinker.getBegin(),e=null;if(null!=t){let s;while(null!=t)e=t,t=t.next,this.rpoUnitBuilder.setRPNodeParam(e.__$ruid,this.procuid,-1),e.reset(),s=e.unit,this.rpoNodeBuilder.restore(e)&&this.rpoUnitBuilder.restore(s)}this.m_nodeLinker.clear(),this.m_runs.fill(null),super.reset()}destroy(){super.destroy()}}e.default=o},"34cd":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("fd5e"));class a{constructor(){this.rc=null,this.vtxFlag=!1,this.texFlag=!1,this.units=null,this.materials=null}resetUniform(){this.shader.resetUniform()}resetTransUniform(){this.shader.resetTransUniform()}createMaterialWrapper(t,e){const s=this.rc;let i=new r.default;return i.rdataBuilder=s.rdataBuilder,i.hostUnit=e,i.bindMaterial(t),i}run(){const t=this.units;if(null!=t){const e=this.rc;let s=this.vtxFlag,i=this.texFlag;const r=this.materials;if(null==r||r.length<1)for(let a=0,n=t.length;a<n;++a){const r=t[a];s=r.updateVtx()||s,s&&(r.vro.run(),s=!1),i&&(r.tro.run(),i=!1),r.run2(e),r.draw(e)}else{const i=r.length;for(let a=0,n=t.length;a<n;++a){const n=a<i?r[a]:r[i-1];if(n.isEnabled()){const i=t[a];i.copyMaterialFrom(n.unit),i.applyShader(!0),s=i.updateVtx()||s,s&&(i.vro.run(),s=!1),i.tro.run(),i.run2(e),i.draw(e)}}}}}destroy(){this.materials=null,null!=this.units&&(this.units=null)}}e.default=a},"36cb":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("e08e"),a=i(s("ab73")),n=s("b02c"),l=i(s("4f27")),h=i(s("b30a")),_=i(s("9156")),o=s("670e"),d=i(s("744d"));class u{constructor(t){this.m_emptyTRO=null,this.m_shader=null,this.m_rpoUnitBuilder=null,this.m_processBuider=null,this.m_roVtxBuild=null,this.m_rc=null,this.m_vtxRes=null,this.m_texRes=null,this.m_deferredVbufs=[],this.m_deferredTROs=[],this.m_deferredTextures=[],this.m_haveDeferredUpdate=!1,this.m_shdpBuilder=null,this.transPool=new _.default,this.m_emptyVDRInfo=new d.default,this.m_shdpBuilder=t}initialize(t,e,s,i){null==this.m_shader&&(this.m_rc=t,this.m_vtxRes=t.Vertex,this.m_texRes=t.Texture,this.m_shader=new h.default(t.getRCUid(),t.getRC(),t.getRenderAdapter(),this.m_shdpBuilder),t.rshader=this.m_shader,t.rdataBuilder=this,this.m_rpoUnitBuilder=e,this.m_processBuider=s,this.m_roVtxBuild=i,this.m_emptyTRO=new n.EmptyTexRenderObj(this.m_texRes),this.m_shdUniformTool=new l.default,this.m_shdUniformTool.initialize())}setGLCtx(t){this.transPool.clear(),n.TextureRenderObj.Clear(this.m_rc.getRCUid())}getRenderProxy(){return this.m_rc}getRenderShader(){return this.m_shader}getTextureResource(){return this.m_texRes}updateTextureData(t,e){this.m_texRes.hasResUid(t.getResUid())&&(e?(this.m_deferredTextures.push(t),this.m_haveDeferredUpdate=!0):t.__$updateToGpu(this.m_texRes))}updateDispTRO(t,e){t.__$ruid>-1&&(e?(this.m_deferredTROs.push(t),this.m_haveDeferredUpdate=!0):this.updateTextureTRO(t))}createTRO(t,e){if(t){for(let e=0;e<t.length;++e)t[e]&&t[e].__$setRenderProxy(this.m_rc);return n.TextureRenderObj.Create(this.m_texRes,t,e)}return null}updateTextureTRO(t){if(null!=t.__$$runit){let e=t.getMaterial();if(null!=e){let s=this.m_texRes,i=t.__$$runit,r=n.TextureRenderObj.GetByMid(s.getRCUid(),e.__$troMid);if(null!=i.tro&&(null==r||i.tro.getMid()!=r.getMid())){let t=this.m_shdpBuilder.findShdProgramByShdData(e.getShaderData());null!=t&&(t.getTexTotal()>0?(null==r&&(r=this.createTRO(e.getTextureList(),t.getTexTotal())),i.tro!=r&&(null!=i.tro&&i.tro.__$detachThis(),i.tro=r,r.__$attachThis(),i.texMid=i.tro.getMid(),this.m_processBuider.rejoinRunitForTro(i),e.__$troMid=i.tro.getMid())):i.tro!=this.m_emptyTRO&&(null!=i.tro&&i.tro.__$detachThis(),i.tro=this.m_emptyTRO,i.texMid=i.tro.getMid(),this.m_processBuider.rejoinRunitForTro(i),e.__$troMid=i.texMid))}}}}updateDispMaterial(t,e,s=null){let i=null;const r=this.m_rc;if(e){if(null==e.getShaderData()){let t=e.getTextureList(),s=null!=t&&null!=t&&t.length>0;e.initializeByCodeBuf(s)}i=this.m_shdpBuilder.create(e.getShaderData(),r),i.upload(r.RContext,r.getUid()),t.shdUid=i.getUid();let n=null;if(i.getTexTotal()>0?(n=this.createTRO(e.getTextureList(),i.getTexTotal()),t.tro!=n&&(null!=t.tro&&t.tro.__$detachThis(),t.tro=n,n.__$attachThis(),t.texMid=t.tro.getMid(),t.__$rprouid>=0&&this.m_processBuider.rejoinRunitForTro(t),e.__$troMid=t.tro.getMid())):t.tro!=this.m_emptyTRO&&(null!=t.tro&&t.tro.__$detachThis(),t.tro=this.m_emptyTRO,t.texMid=t.tro.getMid(),t.__$rprouid>=0&&this.m_processBuider.rejoinRunitForTro(t),e.__$troMid=t.texMid),null==this.m_shader.getSharedUniformByShd(i)){let t=this.createsharedMList(e,i);if(t)for(let e=0;e<t.length;++e)t[e].program=i.getGPUProgram();this.m_shader.setSharedUniformByShd(i,this.m_shdUniformTool.buildShared(t,r,i))}let l=i.hasUniformByName(a.default.LocalTransformMatUNS);null==e.__$uniform&&(e.__$uniform=this.m_shdUniformTool.buildLocalFromData(e.createSelfUniformData(),i));const h=s&&s.__$ruid>=0;l&&h&&null!=s.getTransform()&&(t.transUniform=this.transPool.getTransUniform(s.getTransform(),i)),h&&(null==t.transUniform?(t.transUniform=this.m_shdUniformTool.buildLocalFromTransformV(l?s.getMatrixFS32():null,i),this.transPool.setTransUniform(s.getTransform(),t.transUniform,i)):t.transUniform=this.m_shdUniformTool.updateLocalFromTransformV(t.transUniform,l?s.getMatrixFS32():null,i)),t.polygonOffset=e.getPolygonOffset(),t.uniform=e.__$uniform}return i}updateVtxDataToGpuByUid(t,e){this.m_vtxRes.updateDataToGpu(t,e)}updateDispVbuf(t,e){if(t.__$ruid>-1)if(e)this.m_deferredVbufs.push(t),this.m_haveDeferredUpdate=!0;else{let e=t.__$$runit;if(null!=e&&e.vtxUid!=t.vbuf.getUid()){let s=e.vtxUid,i=this.m_vtxRes;i.hasResUid(s)&&i.__$detachRes(s),e.vro.__$detachThis(),this.buildVtxRes(t,e,this.m_shdpBuilder.findShdProgramByUid(e.shdUid)),e.__$rprouid>=0&&this.m_processBuider.rejoinRunitForVro(e)}}}buildVtxRes(t,e,s){if(null!=t.vbuf){let i=this.m_vtxRes;e.renderState=t.renderState,e.rcolorMask=t.rcolorMask;let r,a=t.getVtxResUid(),n=!0,l=t.getVtxResVer();if(i.hasResUid(a)?(r=i.getVertexRes(a),n=r.version!=l,n&&(i.destroyRes(a),r.rcuid=i.getRCUid(),r.resUid=a)):(r=new o.GpuVtxObject,r.rcuid=i.getRCUid(),r.resUid=a,i.addVertexRes(r)),n){let e=null==t.ivbuf?t.vbuf:t.ivbuf;r.indices.initialize(this.m_rc,this.m_roVtxBuild,e,t),r.createVertex(this.m_roVtxBuild,s,t.vbuf),r.version=l}i.__$attachRes(a),e.vro=r.createVRO(this.m_roVtxBuild,s,!0),e.indicesRes=e.vro.indicesRes,e.vro.__$attachThis(),e.vtxUid=a;let h=t.getMaterial();h.vtxInfo?(e.vdrInfo=h.vtxInfo,e.rdp=e.indicesRes.initRdp.clone()):(e.vdrInfo=this.m_emptyVDRInfo,e.rdp=e.indicesRes.initRdp),e.rgraph=h.graph,e.setVisible(t.visible)}}createRPOUnit(){return this.m_rpoUnitBuilder.create()}restoreRPOUnit(t){return this.m_rpoUnitBuilder.restore(t)}buildGpuDisp(t,e){if(t.__$ruid<0&&null!=t.getMaterial()){t.__$$rsign=r.DisplayRenderSign.LIVE_IN_RENDERER;let s=this.m_rpoUnitBuilder.create();s.rentity=e,s.retype=e.getREType(),t.__$ruid=s.uid,t.__$$runit=s,s.rendering=t.rendering,s.shader=this.m_shader;const i=t.getPartGroup();if(i){s.partGroup=i.slice(0),s.partTotal=i.length;let t=s.partGroup,e=s.indicesRes.rdp.rd.stride;for(let i=0,r=s.partTotal;i<r;)i++,t[i++]*=e}return s.partTotal<1?s.draw=s.__$$drawThis:s.draw=s.__$$drawPart,s.setDrawFlag(t.renderState,t.rcolorMask),t.__$ruid>=0?this.buildVtxRes(t,s,this.updateDispMaterial(s,t.getMaterial(),t)):this.buildVtxRes(t,s,null),e&&e.intoRendererListener&&e.intoRendererListener(),!0}return!1}update(){if(this.m_haveDeferredUpdate){this.m_haveDeferredUpdate=!1;let t=this.m_deferredVbufs.length,e=0;if(t>0){for(;e<t;++e)this.updateDispVbuf(this.m_deferredVbufs[e],!1);this.m_deferredVbufs=[]}if(t=this.m_deferredTROs.length,t>0){for(e=0;e<t;++e)this.updateTextureTRO(this.m_deferredTROs[e]);this.m_deferredTROs=[]}if(t=this.m_deferredTextures.length,t>0){for(e=0;e<t;++e)this.m_deferredTextures[e].__$updateToGpu(this.m_texRes);this.m_deferredTextures=[]}}}createsharedMList(t,e){let s=t.createSharedUniforms();if(null==s){let i=t.createSharedUniformsData();if(null!=i&&i.length>0){s=[];for(let t=0;t<i.length;++t)if(null!=i[t]){let r=this.m_shdUniformTool.buildLocalFromData(i[t],e);s.push(r)}s.length<1&&(s=null)}}return s}updateGlobalMaterial(t,e=!1){if(null!=t){let s=this.m_rc,i=null,r=null,a=null,n=!1;null==t.getShaderData()?(a=t.getTextureList(),n=null!=a&&a.length>0,t.initializeByCodeBuf(n)):a=t.getTextureList(),r=this.m_shdpBuilder.create(t.getShaderData(),s),r.upload(s.RContext,s.getUid());let l=r.getTexTotal();if(l>0&&(i=this.createTRO(a,l)),null==this.m_shader.getSharedUniformByShd(r)){let e=this.createsharedMList(t,r);if(null!=e)for(let t=0;t<e.length;++t)e[t].program=r.getGPUProgram();this.m_shader.setSharedUniformByShd(r,this.m_shdUniformTool.buildShared(e,s,r))}null==t.__$uniform&&(t.__$uniform=this.m_shdUniformTool.buildLocalFromData(t.createSelfUniformData(),r)),this.m_shader.__$globalUniform=t.__$uniform,this.m_shader.bindToGpu(r.getUid()),e&&null!=t.__$uniform&&this.m_shader.useUniform(t.__$uniform),null!=i&&i.run()}}reset(){this.m_deferredVbufs=[],this.m_deferredTROs=[]}}e.default=u},"3b73":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static SetWebBodyColor(t="white"){const e=document.body;e.style.background=t}static SetLanguage(t){i.s_language=t}static IsChineseLanguage(){let t=i.GetLanguage();return"zh-CN"==t}static GetLanguage(){return""!=i.s_language||(i.s_language=navigator.language),i.s_language}static SetThreadEnabled(t){i.s_threadEnabled=t}static GetThreadEnabled(){return i.s_threadEnabled}static GetDebugEnabled(){return i.s_debugEnabled}static SetDebugEnabled(t){i.s_debugEnabled=t}static SetDevicePixelRatio(t){i.s_devicePixelRatio=t}static GetDevicePixelRatio(){return i.s_devicePixelRatio}static Initialize(t){i.s_inited&&(i.s_inited=!1,i.s_WEBGL_VER=t[0],i.TestMobileWeb(),i.s_language=navigator.language+"")}static IsWindowsPCOS(){return!(i.IsSafariWeb()||i.IsMobileWeb())}static IsWinExternalVideoCard(){if(i.s_winExternalVideoCardFlag>0)return 2==i.s_winExternalVideoCardFlag;let t=i.IsSafariWeb()||i.IsMobileWeb();return t||(t=i.GPU_RENDERER.indexOf("Intel(R)")<0),i.s_winExternalVideoCardFlag=t?2:1,2==i.s_winExternalVideoCardFlag}static TestSafariWeb(){return/Safari/.test(navigator.userAgent)&&/Mac OS/.test(navigator.userAgent)}static IsWebGL1(){return 1==i.s_WEBGL_VER}static IsWebGL2(){return 2==i.s_WEBGL_VER}static IsMobileWeb(){return i.s_mobileFlag>0?2==i.s_mobileFlag:i.TestMobileWeb()}static IsSafariWeb(){return i.s_safariFlag>0||(i.s_safariFlag=i.TestSafariWeb()?2:1),2==i.s_safariFlag}static IsIOS(){if(i.s_IOS_Flag>0)return 2==i.s_IOS_Flag;let t=!1;return t=!!/iPad|iPhone|iPod/.test(navigator.platform)||void 0!=navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform),i.s_IOS_Flag=t?2:1,t}static IsIpadOS(){if(i.s_IPad_Flag>0)return 2==i.s_IPad_Flag;let t=navigator.maxTouchPoints>0&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform);return!t&&/iPod|iPad|iPadPro|iPodPro/i.test(navigator.userAgent)&&(t=!0),i.s_IPad_Flag=t?2:1,t}static IsAndroidOS(){if(i.s_Android_Flag>0)return 2==i.s_Android_Flag;let t=i.TestMobileWeb();return t=!(!t||!/Android|Linux/i.test(navigator.userAgent)),i.s_Android_Flag=t?2:1,t}static TestMobileWeb(){return i.s_mobileFlag>0?2==i.s_mobileFlag:/mobile/.test(location.href)?(i.s_mobileFlag=2,2==i.s_mobileFlag):/Android/i.test(navigator.userAgent)?/Mobile/i.test(navigator.userAgent)?(i.s_mobileFlag=2,2==i.s_mobileFlag):(i.s_mobileFlag=1,2==i.s_mobileFlag):/webOS|iPhone|iPod|iPad|iPodPro|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?(i.s_mobileFlag=2,2==i.s_mobileFlag):(i.s_mobileFlag=1,2==i.s_mobileFlag)}}i.s_inited=!0,i.s_WEBGL_VER=2,i.s_devicePixelRatio=1,i.s_mobileFlag=0,i.s_safariFlag=0,i.s_Android_Flag=0,i.s_IOS_Flag=0,i.s_IPad_Flag=0,i.s_winExternalVideoCardFlag=0,i.s_language="",i.s_debugEnabled=!0,i.GPU_VENDOR="unknown",i.GPU_RENDERER="unknown",i.MAX_TEXTURE_SIZE=4096,i.MAX_RENDERBUFFER_SIZE=4096,i.MAX_VIEWPORT_WIDTH=4096,i.MAX_VIEWPORT_HEIGHT=4096,i.SHOWLOG_ENABLED=!1,i.SHADERCODE_TRACE_ENABLED=!1,i.VERT_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED=!0,i.FRAG_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED=!0,i.s_threadEnabled=!0,e.default=i},"3c81":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("2be1")),a=i(s("7696"));class n extends r.default{setCreateParams(t,e,s,i,r,a){this.m_shader=t,this.m_rpoNodeBuilder=e,this.m_rpoUnitBuilder=s,this.m_vtxResource=i,this.m_batchEnabled=r,this.m_fixedState=a}createNode(){return new a.default(this.m_shader,this.m_rpoNodeBuilder,this.m_rpoUnitBuilder,this.m_vtxResource,this.m_batchEnabled,this.m_fixedState)}rejoinRunitForTro(t){this.getNodeByUid(t.__$rprouid).rejoinRunitForTro(t)}rejoinRunitForVro(t){this.getNodeByUid(t.__$rprouid).rejoinRunitForVro(t)}}e.default=n},"442e":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("2be1")),a=i(s("c62b")),n=i(s("265e"));class l extends r.default{createNode(){return new n.default}createRPONode(){return new n.default}createRPOUnit(){return new a.default}}e.default=l},"45db":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8def")),a=i(s("fa60"));class n{constructor(){this.m_vtx=null,this.m_typeList=null,this.m_offsetList=null,this.m_sizeList=null,this.m_verList=null,this.m_vtxUid=-1,this.m_gpuBufs=[],this.m_gpuBufsTotal=0,this.m_type=0,this.m_attribsTotal=0,this.m_wholeStride=0,this.m_bufIVS=null,this.m_vroList=[],this.m_vroListLen=0,this.m_attachCount=0}static create(t,e,s){let i,r=s.getUid(),a=n.s_map;return a.has(r)?i=a.get(r):(i=new n,a.set(r,i),i.initialize(t,e,s)),i}__$attachThis(){++this.m_attachCount}__$detachThis(){this.m_attachCount,--this.m_attachCount,this.m_attachCount<1&&(this.m_attachCount=0)}getAttachCount(){return this.m_attachCount}updateToGpu(t){let e=this.m_gpuBufs.length;if(e>0){let s=this.m_vtx;if(this.version!=s.vertexVer){let i=null,r=s.getBufDataUsage(),a=this.m_sizeList;for(let n=0;n<e;++n){const e=s.getF32DataVerAt(n);this.m_verList[n]!=e&&(this.m_verList[n]=e,i=s.getF32DataAt(n),a[n]>=i.byteLength?(t.bindArrBuf(this.m_gpuBufs[n]),t.arrBufSubData(i,0)):(t.bindArrBuf(this.m_gpuBufs[n]),t.arrBufData(i,r),a[n]=i.byteLength))}this.version=s.vertexVer}}}uploadCombined(t,e){let s=this.m_vtx,i=s.getF32DataAt(0);if(this.m_gpuBufs.push(t.createBuf()),t.bindArrBuf(this.m_gpuBufs[0]),t.arrBufData(i,s.getBufDataUsage()),this.m_gpuBufsTotal=1,this.m_sizeList=[i.byteLength],null==this.m_verList&&(this.m_verList=[0]),null==this.m_typeList){this.m_bufIVS=e.getLocationIVS(),this.m_wholeStride=0,this.m_typeList=new Array(this.m_attribsTotal),this.m_offsetList=new Array(this.m_attribsTotal);let t=s.getBufTypeList(),i=s.getBufSizeList();if(null!=t)for(let e=0;e<this.m_attribsTotal;++e)this.m_offsetList[e]=this.m_wholeStride,this.m_wholeStride+=4*i[e],this.m_typeList[e]=t[e];else for(let s=0;s<this.m_attribsTotal;++s)this.m_offsetList[s]=this.m_wholeStride,this.m_wholeStride+=4*e.getLocationSizeByIndex(s),this.m_typeList[s]=e.getLocationTypeByIndex(s)}}uploadSeparated(t,e){let s=this.m_vtx,i=0,r=null,a=s.getBufDataUsage();if(this.m_gpuBufsTotal=this.m_vtx.getBuffersTotal(),this.m_sizeList=new Array(this.m_attribsTotal),this.m_bufIVS=e.getLocationIVS(),null==this.m_verList&&(this.m_verList=new Array(this.m_attribsTotal),this.m_verList.fill(0)),null==s.bufData)for(;i<this.m_attribsTotal;++i)r=t.createBuf(),this.m_gpuBufs.push(r),t.bindArrBuf(r),t.arrBufData(s.getF32DataAt(i),a),this.m_sizeList[i]=s.getF32DataAt(i).byteLength;else{let e=null,n=0,l=0,h=0;for(;i<this.m_attribsTotal;++i){for(r=t.createBuf(),this.m_gpuBufs.push(r),t.bindArrBuf(r),t.arrBufDataMem(s.bufData.getAttributeDataTotalBytesAt(i),a),h=0,l=s.bufData.getAttributeDataTotalAt(i),n=0;n<l;++n)e=s.bufData.getAttributeDataAt(i,n),t.arrBufSubData(e,h),h+=e.byteLength;this.m_sizeList[i]=h}}if(null==this.m_typeList){this.m_typeList=new Array(this.m_attribsTotal),this.m_offsetList=new Array(this.m_attribsTotal);let t=s.getBufTypeList(),i=s.getBufSizeList();if(null!=t)for(let e=0;e<this.m_attribsTotal;++e)this.m_offsetList[e]=this.m_wholeStride,this.m_wholeStride+=4*i[e],this.m_typeList[e]=t[e];else{const t=4;for(let s=0;s<this.m_attribsTotal;++s)this.m_offsetList[s]=this.m_wholeStride,this.m_wholeStride+=e.getLocationSizeByIndex(s)*t,this.m_typeList[s]=e.getLocationTypeByIndex(s)}this.m_wholeStride=0}}initialize(t,e,s){if(this.m_gpuBufs.length<1&&null!=s){this.version=s.vertexVer,this.m_vtx=s,this.m_vtxUid=s.getUid(),this.m_type=s.getType();let i=s.getBufTypeList();if(this.m_attribsTotal=null!=i?i.length:e.getLocationsTotal(),e.getLocationsTotal()!=s.getAttribsTotal()){let t="shdp.getLocationsTotal() is "+e.getLocationsTotal()+" != vtx.getAttribsTotal(), shdp has "+e.getLocationsTotal()+", vtx has "+s.getAttribsTotal();t+="\n vtx buffers"}this.m_type<1?this.uploadCombined(t,e):this.uploadSeparated(t,e);let r=s.getBufSortFormat();if(r>0){let t=new Array(12),e=0;for(let s=0;s<10;++s){const i=1<<s;(i&r)>0&&(t[s+1]=e++)}this.m_bufIVS=t}}}getVROMid(t,e,s,i){let r=(131+t.getRCUid())*this.m_vtxUid;return s&&(r=131*r+1),r=131*r+e.getMid(),r=131*r+i,r}createVRO(t,e,s,i){let n=e.getLocationsTotal();if(this.m_attribsTotal*n>0&&n<=this.m_attribsTotal){let l=this.getVROMid(t,e,s,i.getUid()),h=0,_=a.default.GetByMid(l);if(null!=_)return _;const o=this.m_bufIVS;if(s){let s=a.default.Create(t,l,this.m_vtx.getUid());if(s.indicesRes=i,s.vao=t.createVertexArray(),t.bindVertexArray(s.vao),this.m_type<1){t.bindArrBuf(this.m_gpuBufs[0]);const s=e.getLocationTypes();for(h=0;h<s.length;++h){const t=o[s[h]];e.vertexAttribPointerTypeFloat(this.m_typeList[t],this.m_wholeStride,this.m_offsetList[t])}}else{const s=e.getLocationTypes();for(h=0;h<s.length;++h){const i=o[s[h]];t.bindArrBuf(this.m_gpuBufs[i]),e.vertexAttribPointerTypeFloat(this.m_typeList[i],0,0)}}_=s,t.bindVertexArray(null)}else{let s=r.default.Create(t,l,this.m_vtx.getUid());for(s.indicesRes=i,s.shdp=e,s.attribTypes=[],s.wholeOffsetList=[],s.wholeStride=this.m_wholeStride,this.m_type<1?s.vbuf=this.m_gpuBufs[0]:s.vbufs=this.m_gpuBufs,h=0;h<n;++h)e.testVertexAttribPointerType(this.m_typeList[h])&&(s.attribTypes.push(this.m_typeList[h]),s.wholeOffsetList.push(0));s.attribTypesLen=s.attribTypes.length,_=s}return this.m_vroList.push(_),++this.m_vroListLen,_}return null}destroy(t){if(this.m_attachCount<1){if(this.m_gpuBufs.length>0){this.m_bufIVS=null,this.m_type=-1;let e=0;for(;e<this.m_vroListLen;++e)this.m_vroList[e].restoreThis();for(this.m_vroList=[],this.m_vroListLen=0,e=0;e<this.m_attribsTotal;++e)t.deleteBuf(this.m_gpuBufs[e]),this.m_gpuBufs[e]=null;this.m_attribsTotal=0,this.m_gpuBufs=[]}this.m_vtxUid>=0&&(n.s_map.delete(this.m_vtxUid),this.m_vtxUid=-1)}}}n.s_map=new Map,e.ROVertexRes=n},"4d4b":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73"));e.RendererDevice=r.default;const a=i(s("29ef"));e.RendererState=a.default;const n=s("0e01");e.RendererInstanceContextParam=n.RendererInstanceContextParam,e.RendererInstanceContext=n.RendererInstanceContext;const l=i(s("d958"));e.RendererInstance=l.default;const h=s("e08e");function _(){return new l.default}e.RenderDrawMode=h.RenderDrawMode,e.RenderBlendMode=h.RenderBlendMode,e.GLStencilFunc=h.GLStencilFunc,e.GLStencilOp=h.GLStencilOp,e.GLBlendMode=h.GLBlendMode,e.GLBlendEquation=h.GLBlendEquation,e.CullFaceMode=h.CullFaceMode,e.DepthTestMode=h.DepthTestMode,e.createRendererInstance=_},"4f27":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=s("d53d"),n=i(s("2560")),l=i(s("83d1")),h=i(s("a7ed")),_=i(s("857b")),o=i(s("e87b"));class d extends a.ShaderUniform{use(t){}useByLocation(t,e,s,i){}useByShd(t,e){}updateData(){}destroy(){}}d.EmptyUniform=new d;class u{constructor(){this.m_initFlag=!0,this.m_uniformDict=new Map,this.m_builders=[],this.m_buildersTot=0,this.m_emptyUniform=new a.ShaderUniform}clear(){this.m_uniformDict.clear()}appendUniformBuilder(t){this.m_uniformDict.has(t.getIDNS())||(this.m_builders.push(t),this.m_uniformDict.set(t.getIDNS(),t),this.m_buildersTot=this.m_builders.length)}initialize(){this.m_initFlag&&(this.m_initFlag=!1,this.appendUniformBuilder(new n.default),this.appendUniformBuilder(new h.default),this.appendUniformBuilder(new _.default),this.appendUniformBuilder(new l.default),this.appendUniformBuilder(new o.default))}addSharedUniformBuilder(t){null==t||this.m_uniformDict.has(t.getIDNS())||(this.m_builders.push(t),this.m_uniformDict.set(t.getIDNS(),t),++this.m_buildersTot)}removeSharedUniformBuilder(t){if(null!=t&&this.m_uniformDict.has(t.getIDNS())){for(let e=0;e<this.m_buildersTot;++e)if(t==this.m_builders[e]){this.m_builders.splice(e,1),--this.m_buildersTot;break}this.m_uniformDict.delete(t.getIDNS())}}removeSharedUniformBuilderByName(t){if(this.m_uniformDict.has(t)){let e=this.m_uniformDict.get(t);for(let t=0;t<this.m_buildersTot;++t)if(e==this.m_builders[t]){this.m_builders.splice(t,1),--this.m_buildersTot;break}this.m_uniformDict.delete(t)}}buildShared(t,e,s){let i,r=null,a=null,n=this.m_builders,l=0,h=this.m_buildersTot,_=null;for(;l<h;++l)_=n[l].create(e,s),null!=_&&(null!=a?a.next=_:null==r&&(r=_),a=_);if(null==t)i=r;else if(null!=r){for(let e=0;e<t.length;++e)a.next=t[e],a=a.next;i=r}if(null==i)i=d.EmptyUniform;else{let t=i,e=0;while(null!=t){if(null!=t.uniformNameList&&null==t.locations)for(t.types=[],t.locations=[],t.uniformSize=t.uniformNameList.length,e=0;e<t.uniformSize;++e)t.types.push(s.getUniformTypeByNS(t.uniformNameList[e])),t.locations.push(s.getUniformLocationByNS(t.uniformNameList[e]));t=t.next}}return i}buildLocalFromTransformV(t,e){if(null!=t){let s;return s=new a.ShaderMat4Uniform,s.uniformSize=0,s.uniformNameList=[],s.types=[],s.locations=[],s.dataList=[],s.dataSizeList=[],s.uniformSize+=1,s.uniformNameList.push("u_objMat"),s.types.push(e.getUniformTypeByNS("u_objMat")),s.locations.push(e.getUniformLocationByNS("u_objMat")),s.dataList.push(t),s.dataSizeList.push(1),s}return this.m_emptyUniform}updateLocalFromTransformV(t,e,s){if(null!=e){let i,r=t;return null==r?(r=new a.ShaderMat4Uniform,i=r,i.uniformSize=0,i.uniformNameList=[],i.types=[],i.locations=[],i.dataList=[],i.dataSizeList=[],i.uniformSize+=1,i.uniformNameList.push("u_objMat"),i.types.push(s.getUniformTypeByNS("u_objMat")),i.locations.push(s.getUniformLocationByNS("u_objMat")),i.dataList.push(e),i.dataSizeList.push(1)):(i=r,i.locations=[],i.locations.push(s.getUniformLocationByNS("u_objMat"))),i}return this.m_emptyUniform}buildLocalFromData(t,e){if(null!=t){let s;s=r.default.IsWebGL1()?new a.ShaderUniformV1:new a.ShaderUniformV2,s.uns=t.uns,s.uniformNameList=[],s.types=[],s.locations=[],s.dataList=[],s.dataSizeList=[],s.uniformSize=0;let i=t,n=0;while(null!=i){if(null!=i.uniformNameList&&null==i.locations)for(s.uniformSize+=i.uniformNameList.length,n=0;n<s.uniformSize;++n)s.uniformNameList.push(i.uniformNameList[n]),s.types.push(e.getUniformTypeByNS(i.uniformNameList[n])),s.locations.push(e.getUniformLocationByNS(i.uniformNameList[n])),s.dataList.push(i.dataList[n]),s.dataSizeList.push(e.getUniformLengthByNS(i.uniformNameList[n]));i=i.next}return s}return d.EmptyUniform}}e.default=u},5326:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t,e=256){this.m_total=256,this.m_rcuid=0,this.index=0,this.dataList=null,this.flagList=null,this.m_rcuid=t,this.m_total=e,this.flagList=new Uint16Array(this.m_total),this.dataList=new Array(this.m_total);for(let s=0;s<this.m_total;++s)this.dataList[s]=null,this.flagList[s]=0}getRCUid(){return this.m_rcuid}}e.UniformDataSlot=i},"53d3":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t){let e=this;e.NORMAL_STATE=t.NORMAL_STATE,e.BACK_CULLFACE_NORMAL_STATE=t.BACK_CULLFACE_NORMAL_STATE,e.FRONT_CULLFACE_NORMAL_STATE=t.FRONT_CULLFACE_NORMAL_STATE,e.NONE_CULLFACE_NORMAL_STATE=t.NONE_CULLFACE_NORMAL_STATE,e.ALL_CULLFACE_NORMAL_STATE=t.ALL_CULLFACE_NORMAL_STATE,e.BACK_NORMAL_ALWAYS_STATE=t.BACK_NORMAL_ALWAYS_STATE,e.BACK_TRANSPARENT_STATE=t.BACK_TRANSPARENT_STATE,e.BACK_TRANSPARENT_ALWAYS_STATE=t.BACK_TRANSPARENT_ALWAYS_STATE,e.NONE_TRANSPARENT_STATE=t.NONE_TRANSPARENT_STATE,e.NONE_TRANSPARENT_ALWAYS_STATE=t.NONE_TRANSPARENT_ALWAYS_STATE,e.FRONT_CULLFACE_GREATER_STATE=t.FRONT_CULLFACE_GREATER_STATE,e.BACK_ADD_BLENDSORT_STATE=t.BACK_ADD_BLENDSORT_STATE,e.BACK_ADD_ALWAYS_STATE=t.BACK_ADD_ALWAYS_STATE,e.BACK_ALPHA_ADD_ALWAYS_STATE=t.BACK_ALPHA_ADD_ALWAYS_STATE,e.NONE_ADD_ALWAYS_STATE=t.NONE_ADD_ALWAYS_STATE,e.NONE_ADD_BLENDSORT_STATE=t.NONE_ADD_BLENDSORT_STATE,e.NONE_ALPHA_ADD_ALWAYS_STATE=t.NONE_ALPHA_ADD_ALWAYS_STATE,e.FRONT_ADD_ALWAYS_STATE=t.FRONT_ADD_ALWAYS_STATE,e.FRONT_TRANSPARENT_STATE=t.FRONT_TRANSPARENT_STATE,e.FRONT_TRANSPARENT_ALWAYS_STATE=t.FRONT_TRANSPARENT_ALWAYS_STATE,e.NONE_CULLFACE_NORMAL_ALWAYS_STATE=t.NONE_CULLFACE_NORMAL_ALWAYS_STATE,e.BACK_ALPHA_ADD_BLENDSORT_STATE=t.BACK_ALPHA_ADD_BLENDSORT_STATE}}e.RenderingState=i},"56c5":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("030e"));class a{static SetRenderer(t){a.m_rc=t.getRC(),a.m_webGLVer=t.getWebGLVersion();let e=a;1==a.m_webGLVer&&null!=r.default.WEBGL_draw_buffers?e.COLOR_ATTACHMENT0=r.default.WEBGL_draw_buffers.COLOR_ATTACHMENT0_WEBGL:e.COLOR_ATTACHMENT0=a.m_rc.COLOR_ATTACHMENT0}static DrawBuffers(t){2==a.m_webGLVer?a.m_rc.drawBuffers(t):null!=r.default.WEBGL_draw_buffers&&r.default.WEBGL_draw_buffers.drawBuffersWEBGL(t)}}a.m_rc=null,a.m_webGLVer=2,a.COLOR_ATTACHMENT0=0,e.default=a},"5deb":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static GetValue(t,e){switch(e){case i.TEXTURE_2D:return t.TEXTURE_2D;case i.TEXTURE_2D_ARRAY:return t.TEXTURE_2D_ARRAY;case i.TEXTURE_CUBE:return t.TEXTURE_CUBE_MAP;case i.TEXTURE_3D:return t.TEXTURE_3D;default:break}return t.TEXTURE_2D}}i.TEXTURE_2D=20,i.TEXTURE_2D_ARRAY=22,i.TEXTURE_SHADOW_2D=23,i.TEXTURE_CUBE=25,i.TEXTURE_3D=30,e.default=i},"5f3c":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=s("f571");class n extends a.SortNodeLinkerNode{constructor(t){super(),this.m_uid=-1,this.m_shader=null,this.m_sorter=null,this.index=-1,this.shdUid=-1,this.procuid=-1,this.batchEnabled=!0,this.fixedState=!0,this.runMode=0,this.rpoNodeBuilder=null,this.rpoUnitBuilder=null,this.vtxResource=null,this.sortEnabled=!0,this.m_shader=t,this.m_uid=n.s_uid++}showInfo(){}getType(){return-1}setSorter(t){this.m_sorter=t}sort(){}addNode(t){}rejoinNode(t){}removeNode(t){}isEmpty(){return!0}run(t){}runLockMaterial(t){}drawUnit(t,e,s){e.updateVtx(),e.drawing&&(this.m_shader.bindToGpu(e.shdUid),e.updateVtx(),e.run(t),e.draw(t))}drawLockMaterialByUnit(t,e,s,i,a){if(e.updateVtx(),e.drawing){a&&this.m_shader.resetUniform();let n=e.vro;r.default.IsMobileWeb()&&(n=this.vtxResource.getVROByResUid(s.getVtxResUid(),this.m_shader.getCurrentShd(),!0)),n.run(),e.runLockMaterial2(i?this.m_shader.__$globalUniform:null),e.draw(t)}}reset(){this.index=-1,this.shdUid=-1,this.procuid=-1,this.rpoNodeBuilder=null,this.rpoUnitBuilder=null,this.vtxResource=null}clear(){}destroy(){this.reset()}getUid(){return this.m_uid}}n.s_uid=0,e.default=n},"644c":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static GetTypeByTypeNS(t){const e=i;switch(t){case"mat4":return e.SHADER_MAT4;case"mat3":return e.SHADER_MAT3;case"mat2":return e.SHADER_MAT2;case"float":return e.SHADER_FLOAT;case"int":return e.SHADER_INT;case"vec4":return e.SHADER_VEC4;case"vec3":return e.SHADER_VEC3;case"vec2":return e.SHADER_VEC2;case"vec4[]":return e.SHADER_VEC4FV;case"vec3[]":return e.SHADER_VEC3FV;case"vec2[]":return e.SHADER_VEC2FV;case"sampler2D":return e.SHADER_SAMPLER2D;case"sampler3D":return e.SHADER_SAMPLER3D;case"samplerCube":return e.SHADER_SAMPLERCUBE;default:break}return i.SHADER_UNDEFINED}static GetTypeNSByType(t){const e=i;switch(t){case e.SHADER_MAT4:return"mat4";case e.SHADER_MAT3:return"mat3";case e.SHADER_MAT2:return"mat2";case e.SHADER_FLOAT:return"float";case e.SHADER_VEC4:return"vec4";case e.SHADER_VEC3:return"vec3";case e.SHADER_VEC2:return"vec2";case e.SHADER_SAMPLER2D:return"sampler2D";case e.SHADER_SAMPLER3D:return"sampler3D";case e.SHADER_SAMPLERCUBE:return"samplerCube";case e.SHADER_UNDEFINED:return"undefined";default:break}return""}}i.ATTRINS_VTX_VS="a_vs",i.ATTRINS_VTX_UVS="a_uvs",i.ATTRINS_VTX_NVS="a_nvs",i.ATTRINS_VTX_CVS="a_cvs",i.UNIFORMNS_OBJ_MAT_NS="u_objMat",i.UNIFORMNS_VIEW_MAT_NS="u_viewMat",i.UNIFORMNS_PROJ_MAT_NS="u_projMat",i.SHADER_UNDEFINED=3010,i.SHADER_VEC2=3011,i.SHADER_VEC3=3012,i.SHADER_VEC4=3013,i.SHADER_VEC2FV=3014,i.SHADER_VEC3FV=3015,i.SHADER_VEC4FV=3016,i.SHADER_MAT2=3017,i.SHADER_MAT3=3018,i.SHADER_MAT4=3019,i.SHADER_FLOAT=3020,i.SHADER_INT=3021,i.SHADER_MAT2FV=3022,i.SHADER_MAT3FV=3023,i.SHADER_MAT4FV=3024,i.SHADER_SAMPLER2D=3031,i.SHADER_SAMPLERCUBE=3032,i.SHADER_SAMPLER3D=3033,i.SHADER_PRECISION_LOWP=3101,i.SHADER_PRECISION_MEDIUMP=3111,i.SHADER_PRECISION_HIGHP=3121,i.UNIFORM_TEX_SAMPLER2D="sampler2D",i.UNIFORM_TEX_SAMPLERCUBE="samplerCube",i.UNIFORM_TEX_SAMPLER3D="sampler3D",i.UNIFORMNS_TEX_SAMPLER_0="u_sampler0",i.UNIFORMNS_TEX_SAMPLER_1="u_sampler1",i.UNIFORMNS_TEX_SAMPLER_2="u_sampler2",i.UNIFORMNS_TEX_SAMPLER_3="u_sampler3",i.UNIFORMNS_TEX_SAMPLER_4="u_sampler4",i.UNIFORMNS_TEX_SAMPLER_5="u_sampler5",i.UNIFORMNS_TEX_SAMPLER_6="u_sampler6",i.UNIFORMNS_TEX_SAMPLER_7="u_sampler7",i.UNIFORMNS_TEX_SAMPLER_LIST=[i.UNIFORMNS_TEX_SAMPLER_0,i.UNIFORMNS_TEX_SAMPLER_1,i.UNIFORMNS_TEX_SAMPLER_2,i.UNIFORMNS_TEX_SAMPLER_3,i.UNIFORMNS_TEX_SAMPLER_4,i.UNIFORMNS_TEX_SAMPLER_5,i.UNIFORMNS_TEX_SAMPLER_6,i.UNIFORMNS_TEX_SAMPLER_7],e.default=i},"670e":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("45db"),r=s("8ae4");class a{constructor(){this.m_uid=a.s_uid++,this.m_attachCount=0,this.version=-1,this.waitDelTimes=0,this.rcuid=0,this.resUid=0,this.vertex=null,this.indices=new r.ROIndicesRes}createVertex(t,e,s){this.vertex=i.ROVertexRes.create(t,e,s),this.vertex.__$attachThis()}__$attachThis(){++this.m_attachCount}__$detachThis(){--this.m_attachCount,this.m_attachCount<1&&(this.m_attachCount=0)}getAttachCount(){return this.m_attachCount}createVRO(t,e,s){let i=this.vertex.createVRO(t,e,s,this.indices);return i}updateToGpu(t){this.indices.updateToGpu(t),this.vertex.updateToGpu(t)}destroy(t){this.getAttachCount()<1&&this.resUid>=0&&(null!=this.vertex&&(this.vertex.__$detachThis(),this.vertex.destroy(t),this.vertex=null),this.indices.destroy(t),this.resUid=-1)}}a.s_uid=0,e.GpuVtxObject=a},"6d49":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=i(s("baae")),n=i(s("ffc0")),l=i(s("5deb")),h=i(s("56c5"));class _{constructor(t,e,s){this.m_uid=-1,this.m_rcuid=0,this.m_texRes=null,this.m_COLOR_ATTACHMENT0=0,this.m_fbo=null,this.m_depthStencilRBO=null,this.m_depthRBO=null,this.m_colorRBO=null,this.m_width=512,this.m_height=512,this.m_bufferLType=0,this.m_gl=null,this.m_fboTarget=0,this.m_texTargetTypes=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.m_attachmentMaskList=[!0,!0,!0,!0,!0,!0,!0,!0],this.m_preAttachTotal=0,this.m_preAttachIndex=0,this.m_activeAttachmentTotal=0,this.m_attachmentIndex=0,this.m_clearDepthArr=new Float32Array(1),this.m_clearColorArr=new Float32Array(4),this.m_stencilValueArr=new Int16Array(4),this.m_fboSizeChanged=!1,this.textureLevel=0,this.sizeFixed=!1,this.writeDepthEnabled=!0,this.writeStencilEnabled=!1,this.multisampleEnabled=!1,this.multisampleLevel=0,this.m_preAttachments=new Uint32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),this.m_preTragets=new Uint32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),this.m_preFTIndex=0,this.m_haveDepthTex=!1,this.m_resizeW=2,this.m_resizeH=2;let i=_.s_bindFT;null==i&&(i=new Array(128),i.fill(null)),null==i[t]&&(i[t]=new Int16Array(4),i[t].fill(-9)),_.s_bindFT=i,this.m_rcuid=t,this.m_texRes=e,this.m_bufferLType=s,this.m_uid=_.s_uid++}getUid(){return this.m_uid}resetAttachmentMask(t){let e=this.m_attachmentMaskList.length-1;while(e>=0)this.m_attachmentMaskList[e]=t,--e}setAttachmentMaskAt(t,e){this.m_attachmentMaskList[t]=e}getActiveAttachmentTotal(){return this.m_haveDepthTex?this.m_activeAttachmentTotal-1:this.m_activeAttachmentTotal}getAttachmentTotal(){return this.m_attachmentMaskList.length}getFBO(){return this.m_fbo}getDepthStencilRBO(){return this.m_depthStencilRBO}getDepthRBO(){return this.m_depthRBO}getWidth(){return this.m_width}getHeight(){return this.m_height}getFramebufferType(){return this.m_bufferLType}renderToTexAt(t,e,s){let i=null!=e?e.internalFormat:-1;this.m_gl=t,0==s&&(this.m_preFTIndex=0,this.m_haveDepthTex=!1,this.bind(this.m_bufferLType),i!=n.default.DEPTH_COMPONENT&&i!=n.default.DEPTH_STENCIL&&(this.m_activeAttachmentTotal=0,this.m_attachmentIndex=0));let r=-1,a=null;null!=e?(r=e.getTargetType(),e.uploadFromFbo(this.m_texRes,this.m_width,this.m_height),a=this.m_texRes.getGpuBuffer(e.getResUid())):r=this.m_texTargetTypes[this.m_activeAttachmentTotal],this.framebufferTextureBind(t,r,i,a)}glFramebufferTex2D(t,e){let s=this.m_gl;s.framebufferTexture2D(this.m_fboTarget,t,s.TEXTURE_2D,e,0),this.m_preAttachments[this.m_preFTIndex]=t,this.m_preTragets[this.m_preFTIndex]=s.TEXTURE_2D,this.m_preFTIndex++}glFramebufferTexCube(t,e,s){let i=this.m_gl;i.framebufferTexture2D(this.m_fboTarget,t,i.TEXTURE_CUBE_MAP_POSITIVE_X+e,s,0),this.m_preAttachments[this.m_preFTIndex]=t,this.m_preTragets[this.m_preFTIndex]=i.TEXTURE_CUBE_MAP_POSITIVE_X+e,this.m_preFTIndex++}framebufferTexture2D(t,e,s,i){let r=-1;switch(s){case n.default.DEPTH_COMPONENT:this.m_haveDepthTex=!0,r=this.m_gl.DEPTH_ATTACHMENT;break;case n.default.DEPTH_STENCIL:this.m_haveDepthTex=!0,r=this.m_gl.DEPTH_STENCIL_ATTACHMENT;break;default:r=this.m_COLOR_ATTACHMENT0+this.m_attachmentIndex;break}r>0&&(this.m_attachmentMaskList[this.m_activeAttachmentTotal]?(this.glFramebufferTex2D(r,i),++this.m_attachmentIndex,this.m_texTargetTypes[this.m_activeAttachmentTotal]=null!=i?e:0):this.m_texTargetTypes[this.m_activeAttachmentTotal]=0,++this.m_activeAttachmentTotal)}framebufferTextureBind(t,e,s,i){switch(e){case l.default.TEXTURE_2D:this.framebufferTexture2D(t,e,s,i);break;case l.default.TEXTURE_CUBE:let r=0;for(let t=0;t<6;++t)this.m_attachmentMaskList[t]?(this.glFramebufferTexCube(this.m_COLOR_ATTACHMENT0+this.m_attachmentIndex,t,i),++this.m_attachmentIndex,this.m_texTargetTypes[this.m_activeAttachmentTotal+t]=null!=i?e:0,r++):this.m_texTargetTypes[this.m_activeAttachmentTotal+t]=0;r=r>0?r:6,this.m_activeAttachmentTotal+=r;break;case l.default.TEXTURE_SHADOW_2D:this.m_attachmentMaskList[this.m_activeAttachmentTotal]?(this.glFramebufferTex2D(this.m_gl.DEPTH_ATTACHMENT,i),this.m_texTargetTypes[this.m_activeAttachmentTotal]=null!=i?e:0):this.m_texTargetTypes[this.m_activeAttachmentTotal]=0,++this.m_activeAttachmentTotal;break;default:break}}reset(){this.m_preAttachTotal=-1,this.m_preAttachIndex=-1}use(t){if(this.m_gl=t,this.m_fbo){if(this.m_activeAttachmentTotal>1){if(this.m_preAttachIndex!=this.m_attachmentIndex){let t=[],e=0;for(;e<this.m_attachmentIndex;++e)t.push(this.m_COLOR_ATTACHMENT0+e);if(this.m_preAttachIndex>this.m_attachmentIndex)for(;e<this.m_preAttachIndex;++e)this.m_gl.framebufferTexture2D(this.m_fboTarget,this.m_preAttachments[e],this.m_preTragets[e],null,0);h.default.DrawBuffers(t),this.m_preAttachIndex=this.m_attachmentIndex}}else if(this.m_preAttachIndex!=this.m_attachmentIndex){if(this.m_preAttachIndex>this.m_attachmentIndex)for(let e=1;e<this.m_preAttachIndex;++e)this.m_gl.framebufferTexture2D(this.m_fboTarget,this.m_preAttachments[e],this.m_preTragets[e],null,0);let t=[this.m_COLOR_ATTACHMENT0];h.default.DrawBuffers(t),this.m_preAttachIndex=this.m_attachmentIndex}this.m_preAttachTotal=this.m_activeAttachmentTotal}}clearOnlyColor(t){if(null!=this.m_fbo)if(r.default.IsWebGL2())if(this.m_clearColorArr[0]=t[0],this.m_clearColorArr[1]=t[1],this.m_clearColorArr[2]=t[2],this.m_clearColorArr[3]=t[3],this.m_preAttachTotal>1)for(let e=0;e<this.m_preAttachTotal;++e)this.m_gl.clearBufferfv(this.m_gl.COLOR,e,this.m_clearColorArr);else this.m_gl.clearBufferfv(this.m_gl.COLOR,0,this.m_clearColorArr);else this.m_gl.clearColor(t[0],t[1],t[2],t[3])}clearOnlyDepth(t=1){r.default.IsWebGL2()?(this.m_clearDepthArr[0]=t,this.m_gl.clearBufferfv(this.m_gl.DEPTH,0,this.m_clearDepthArr)):this.m_gl.clearDepth(t)}clearOnlyStencil(t){this.m_stencilValueArr[0]=t,this.m_gl.clearBufferuiv(this.m_gl.STENCIL,0,this.m_stencilValueArr)}clearOnlyDepthAndStencil(t,e){this.m_gl.clearBufferfi(this.m_gl.DEPTH_STENCIL,0,t,e)}invalidateFramebuffer(){}resize(t,e){this.m_resizeW==t&&this.m_resizeH==e||(this.m_fboSizeChanged=!0,this.m_resizeW=t,this.m_resizeH=e)}initialize(t,e,s){this.m_gl=t,this.m_COLOR_ATTACHMENT0=h.default.COLOR_ATTACHMENT0,this.m_fboSizeChanged&&(e=this.m_resizeW,s=this.m_resizeH),null==this.m_fbo?this.createNewFBO(t,e,s):this.m_width==e&&this.m_height==s||this.createNewFBO(t,e,s),this.m_fboSizeChanged=!1}isSizeChanged(){return this.m_fboSizeChanged}destroy(t){null!=this.m_fbo&&(null!=this.m_depthStencilRBO&&(t.deleteFramebuffer(this.m_depthStencilRBO),this.m_depthStencilRBO=null),null!=this.m_depthRBO&&(t.deleteFramebuffer(this.m_depthRBO),this.m_depthRBO=null),null!=this.m_colorRBO&&(t.deleteFramebuffer(this.m_colorRBO),this.m_colorRBO=null),t.deleteFramebuffer(this.m_fbo),this.m_fbo=null),this.m_gl=null,this.m_fboTarget=0,this.m_fboSizeChanged=!1}buildDepthStencilRBO(t,e,s){null==this.m_depthStencilRBO&&(this.m_depthStencilRBO=t.createRenderbuffer()),this.multisampleEnabled?(t.bindRenderbuffer(t.RENDERBUFFER,this.m_depthStencilRBO),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.DEPTH_STENCIL,e,s),t.framebufferRenderbuffer(this.m_fboTarget,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,this.m_depthStencilRBO),null==this.m_colorRBO&&(this.m_colorRBO=t.createRenderbuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.m_colorRBO),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.RGBA8,e,s),t.framebufferRenderbuffer(this.m_fboTarget,this.m_COLOR_ATTACHMENT0,t.RENDERBUFFER,this.m_colorRBO)):(t.bindRenderbuffer(t.RENDERBUFFER,this.m_depthStencilRBO),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,e,s),t.framebufferRenderbuffer(this.m_fboTarget,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,this.m_depthStencilRBO))}buildDepthRBO(t,e,s){null==this.m_depthRBO&&(this.m_depthRBO=t.createRenderbuffer()),this.multisampleEnabled?(t.bindRenderbuffer(t.RENDERBUFFER,this.m_depthRBO),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.DEPTH_COMPONENT24,e,s),t.framebufferRenderbuffer(this.m_fboTarget,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.m_depthRBO),null==this.m_colorRBO&&(this.m_colorRBO=t.createRenderbuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.m_colorRBO),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.RGBA8,e,s),t.framebufferRenderbuffer(this.m_fboTarget,this.m_COLOR_ATTACHMENT0,t.RENDERBUFFER,this.m_colorRBO)):(t.bindRenderbuffer(t.RENDERBUFFER,this.m_depthRBO),r.default.IsWebGL2()?t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT24,e,s):t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,e,s),t.framebufferRenderbuffer(this.m_fboTarget,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.m_depthRBO))}buildStencilRBO(t,e,s){null==this.m_depthStencilRBO&&(null==this.m_depthStencilRBO&&(this.m_depthStencilRBO=t.createRenderbuffer()),this.multisampleEnabled?(t.bindRenderbuffer(t.RENDERBUFFER,this.m_depthStencilRBO),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.STENCIL_INDEX8,e,s),t.framebufferRenderbuffer(this.m_fboTarget,t.STENCIL_ATTACHMENT,t.RENDERBUFFER,this.m_depthStencilRBO),null==this.m_colorRBO&&(this.m_colorRBO=t.createRenderbuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.m_colorRBO),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.RGBA8,e,s),t.framebufferRenderbuffer(this.m_fboTarget,this.m_COLOR_ATTACHMENT0,t.RENDERBUFFER,this.m_colorRBO)):(t.bindRenderbuffer(t.RENDERBUFFER,this.m_depthStencilRBO),t.renderbufferStorage(t.RENDERBUFFER,t.STENCIL_INDEX8,e,s),t.framebufferRenderbuffer(this.m_fboTarget,t.STENCIL_ATTACHMENT,t.RENDERBUFFER,this.m_depthStencilRBO)))}buildColorRBO(t,e,s){null==this.m_colorRBO&&(this.m_colorRBO=t.createRenderbuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.m_colorRBO),this.multisampleEnabled?t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.RGBA8,e,s):t.renderbufferStorage(t.RENDERBUFFER,t.RGBA8,e,s),t.framebufferRenderbuffer(this.m_fboTarget,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,this.m_colorRBO)}createNewFBO(t,e,s){let i=null==this.m_fbo;if(this.m_preAttachTotal=this.m_activeAttachmentTotal=0,this.m_preAttachIndex=this.m_attachmentIndex=0,this.m_width=e,this.m_height=s,this.m_resizeW=e,this.m_resizeH=s,i&&(this.m_fbo=t.createFramebuffer()),this.m_fboTarget=this.bind(this.m_bufferLType),this.writeDepthEnabled?this.writeStencilEnabled?null==this.m_depthStencilRBO&&this.buildDepthStencilRBO(t,e,s):this.buildDepthRBO(t,e,s):this.writeStencilEnabled?this.buildStencilRBO(t,e,s):this.buildColorRBO(t,e,s),i){t.checkFramebufferStatus(this.m_fboTarget);t.FRAMEBUFFER_COMPLETE}_.BindToBackbuffer(t,this.m_bufferLType,this.m_rcuid)}bind(t){if(this.m_fbo){const e=_.s_bindFT[this.m_rcuid],s=this.m_gl;let i=s.FRAMEBUFFER,r=1;switch(t){case a.default.DRAW_FRAMEBUFFER:r=2,i=s.DRAW_FRAMEBUFFER;break;case a.default.READ_FRAMEBUFFER:r=3,i=s.READ_FRAMEBUFFER;break;default:break}return e[r]!=this.m_uid&&(e[r]=this.m_uid,s.bindFramebuffer(i,this.m_fbo)),i}return 0}static BindToBackbuffer(t,e,s){const i=_.s_bindFT[s];switch(e){case a.default.DRAW_FRAMEBUFFER:i[2]=-9,t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null);break;case a.default.READ_FRAMEBUFFER:i[3]=-9,t.indFramebuffer(t.READ_FRAMEBUFFER,null);break;default:i[1]=-9,t.bindFramebuffer(t.FRAMEBUFFER,null);break}}static IsFBORunning(t){if(_.s_bindFT){const e=_.s_bindFT[t];if(e)return e[1]>=0||e[2]>=0||e[3]>=0}return!1}}_.s_uid=0,_.s_bindFT=null,e.default=_},"722e":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.NEAREST=4001,i.LINEAR=4002,i.LINEAR_MIPMAP_LINEAR=4003,i.NEAREST_MIPMAP_NEAREST=4004,i.LINEAR_MIPMAP_NEAREST=4005,i.NEAREST_MIPMAP_LINEAR=4006,e.default=i},7279:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=i(s("d53d"));class n extends a.default{constructor(t){super(),this.m_slot=null,this.m_slotFlags=null,this.m_slotDatas=null,this.slotId=0,this.slotIndex=0,this.uniformsTotal=0,this.locationIndexList=null,this.locations=null,this.rst=0,this.always=!1,this.m_slot=t,this.m_slotFlags=this.m_slot.flagList,this.m_slotDatas=this.m_slot.dataList}applyData(){}clone(){let t=new n(this.m_slot);return t.types=this.types.slice(0),t.uniformNameList=this.uniformNameList.slice(0),t.dataSizeList=this.dataSizeList.slice(0),t.slotIndex=this.slotIndex,t.uniformsTotal=this.uniformsTotal,t.slotId=this.slotId,t.always=this.always,t.rst=this.rst,t}copyDataFromProbe(t){this.types=t.uniformTypes.slice(0),this.dataSizeList=t.dataSizeList.slice(0),this.slotIndex=t.getSlotBeginIndex(),this.uniformsTotal=t.uniformsTotal,this.slotId=t.getRCUid()}copyDataFromProbeAt(t,e){null==this.types&&(this.types=[],this.dataSizeList=[]),this.slotIndex=e.getSlotBeginIndex()+t,this.uniformsTotal=1,this.slotId=e.getRCUid(),this.types[0]=e.uniformTypes[t],this.dataSizeList[0]=e.dataSizeList[t]}use(t){if(this.always||this.rst!=this.m_slotFlags[this.slotIndex]){this.rst=this.m_slotFlags[this.slotIndex];let e=0,s=this.m_slotDatas;if(r.default.IsWebGL1())for(;e<this.uniformsTotal;++e)t.useUniformV1(this.locations[e],this.types[e],s[this.slotIndex+e],this.dataSizeList[e]);else for(;e<this.uniformsTotal;++e)t.useUniformV2(this.locations[e],this.types[e],s[this.slotIndex+e],this.dataSizeList[e],0)}}destroy(){this.types=null,this.dataSizeList=null,this.slotIndex=-1,this.uniformsTotal=0,this.m_slot=null,this.m_slotFlags=null,this.m_slotDatas=null}}e.default=n},"72bb":function(t,e,s){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t["NOT_IN_RENDERER"]=-1]="NOT_IN_RENDERER",t[t["GO_TO_RENDERER"]=1]="GO_TO_RENDERER",t[t["LIVE_IN_RENDERER"]=2]="LIVE_IN_RENDERER"}(i||(i={})),e.DisplayRenderSign=i},"744d":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.rdp=null}destroy(){null!=this.rdp&&(this.rdp.clear(),this.rdp=null)}lock(){}unlock(){}isUnlock(){return!1}setInstanceCount(t){}setWireframe(t){}applyIvsDataAt(t){}setIvsParam(t=-1,e=-1){}reset(){}__$$copyToRDP(){return!1}}e.default=i},7499:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.m_dispBuilder=null,this.m_shader=null,this.m_texRes=null}setDispBuilder(t){null==this.m_dispBuilder&&(this.m_dispBuilder=t,this.m_shader=t.getRenderShader(),this.m_texRes=t.getTextureResource())}unlockMaterial(){this.m_shader.unlock(),this.m_texRes.unlocked=!0}lockMaterial(){this.m_shader.lock(),this.m_texRes.unlocked=!1}isUnlockMatrial(){return this.m_texRes.unlocked}unlockTexture(){this.m_shader.textureUnlock()}lockTexture(){this.m_shader.textureLock()}renderBegin(){this.m_shader.renderBegin(),this.m_texRes.renderBegin()}resetUniform(){this.m_shader.resetUniform()}useGlobalMaterial(t,e=!1){null!=t&&this.m_dispBuilder.updateGlobalMaterial(t,e)}updateMaterialUniform(t){this.m_shader.updateUniform(t.__$uniform)}}e.default=i},"74c3":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t,e,s){this.m_resMap=new Map,this.m_freeMap=new Map,this.m_updateIds=[],this.m_vtxResTotal=0,this.m_attachTotal=0,this.m_delay=128,this.m_haveDeferredUpdate=!1,this.m_vtxUpdateTotal=16,this.m_rcuid=0,this.m_gl=null,this.m_vtxBuilder=null,this.unlocked=!0,this.m_rcuid=t,this.m_gl=e,this.m_vtxBuilder=s}setGLCtx(t){this.m_gl=t,this.m_vtxBuilder.setGLCtx(t)}setVtxUpdateTimesTotal(t){this.m_vtxUpdateTotal=t>4?t:4}createResByParams3(t,e,s,i){return!1}getRCUid(){return this.m_rcuid}getRC(){return this.m_gl}hasResUid(t){return this.m_resMap.has(t)}bindToGpu(t){}getGpuBuffer(t){return null}renderBegin(){this.m_vtxBuilder.renderBegin()}getVertexResTotal(){return this.m_vtxResTotal}updateDataToGpu(t,e){e?(this.m_updateIds.push(t),this.m_haveDeferredUpdate=!0):this.m_resMap.has(t)&&this.m_resMap.get(t).updateToGpu(this.m_vtxBuilder)}addVertexRes(t){this.m_resMap.has(t.resUid)||(t.waitDelTimes=0,this.m_resMap.set(t.resUid,t),this.m_vtxResTotal++)}getVertexRes(t){return this.m_resMap.get(t)}destroyRes(t){this.m_resMap.has(t)&&this.m_resMap.get(t).destroy(this.m_vtxBuilder)}__$attachRes(t){if(this.m_resMap.has(t)){this.m_attachTotal++;let e=this.m_resMap.get(t);e.getAttachCount()<1&&this.m_freeMap.has(t)&&this.m_freeMap.delete(t),e.waitDelTimes=0,e.__$attachThis()}}__$detachRes(t){if(this.m_resMap.has(t)&&this.m_resMap.has(t)){let e=this.m_resMap.get(t);e.getAttachCount()>0&&(this.m_attachTotal--,e.__$detachThis(),e.getAttachCount()<1&&this.m_freeMap.set(t,e))}}getVROByResUid(t,e,s){let i=this.m_resMap.get(t);return null!=i?i.createVRO(this.m_vtxBuilder,e,s):null}update(){if(this.m_haveDeferredUpdate){let t=this.m_updateIds.length;if(t>0){let e;t>this.m_vtxUpdateTotal&&(t=this.m_vtxUpdateTotal);for(let s=0;s<t;++s)e=this.m_updateIds.shift(),this.m_resMap.has(e)&&this.m_resMap.get(e).updateToGpu(this.m_vtxBuilder)}else this.m_haveDeferredUpdate=!1}if(this.m_delay--,this.m_delay<1){this.m_delay=128;for(const[t,e]of this.m_freeMap)e.waitDelTimes++,e.getAttachCount()<1?e.waitDelTimes>5&&(this.m_resMap.delete(e.resUid),this.m_freeMap.delete(e.resUid),e.destroy(this.m_vtxBuilder),this.m_vtxResTotal--):this.m_freeMap.delete(e.resUid)}}}e.ROVertexResource=i,e.default=i},7696:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("264c")),a=i(s("3420")),n=s("f571"),l=i(s("91da"));class h{constructor(t,e,s,i,r,a){this.m_rcuid=-1,this.m_rpIndex=-1,this.m_nodesLen=0,this.m_enabled=!0,this.m_blockList=[],this.m_blockListLen=0,this.m_blockFList=new Int8Array(h.s_max_shdTotal),this.m_blockFListLen=h.s_max_shdTotal,this.m_containerBlocks=[],this.m_scTotal=0,this.m_shader=null,this.m_rpoNodeBuilder=null,this.m_rpoUnitBuilder=null,this.m_vtxResource=null,this.m_fixBlock=null,this.m_sortBlock=null,this.m_sorter=null,this.m_blockLinker=new n.SortNodeLinker,this.m_batchEnabled=!0,this.m_fixedState=!0,this.m_sortEnabled=!1,this.m_version=0,this.uid=-1,this.m_shader=t,this.m_rpoNodeBuilder=e,this.m_rpoUnitBuilder=s,this.m_vtxResource=i,this.m_fixBlock=this.createBlock(),this.m_batchEnabled=r,this.m_fixedState=a;for(let n=0;n<this.m_blockFListLen;++n)this.m_blockFList[n]=-1}createBlock(){let t=new a.default(this.m_shader);return t.rpoNodeBuilder=this.m_rpoNodeBuilder,t.rpoUnitBuilder=this.m_rpoUnitBuilder,t.vtxResource=this.m_vtxResource,t}setRenderParam(t,e){this.m_blockListLen<1&&(this.m_batchEnabled=t,this.m_fixedState=e)}setRendererParam(t,e){this.m_rc=t,this.m_rcuid=t.getRCUid(),this.m_rpIndex=e}getUid(){return this.uid}getRCUid(){return this.m_rcuid}getRPIndex(){return this.m_rpIndex}hasSorter(){return null!=this.m_sorter}setSorter(t){this.m_sorter=t,this.m_sortBlock&&this.m_sortBlock.setSorter(t)}setSortEnabled(t){this.m_nodesLen<1?this.m_sortEnabled=t:this.m_sortBlock&&(this.m_sortBlock.sortEnabled=t)}getSortEnabled(){return this.m_sortEnabled}getUnitsTotal(){return this.m_nodesLen}addNodeToBlock(t){let e=null;if(t.shdUid>=h.s_max_shdTotal)throw Error("Shader uid >= "+h.s_max_shdTotal);this.m_blockFList[t.shdUid]<0?(e=this.createBlock(),e.batchEnabled=this.m_batchEnabled,e.fixedState=this.m_fixedState,e.batchEnabled?e.fixedState?e.runMode=2:e.runMode=1:e.runMode=0,e.shdUid=t.shdUid,e.index=this.m_blockListLen,e.procuid=this.m_rpIndex,this.m_blockList.push(e),this.m_blockFList[t.shdUid]=this.m_blockListLen,++this.m_blockListLen,this.m_blockLinker.addNode(e)):e=this.m_blockList[this.m_blockFList[t.shdUid]],t.index=e.index,e.addNode(t)}rejoinRunitForTro(t){if(!this.m_sortBlock){let e=this.m_rpoNodeBuilder.getNodeByUid(t.__$rpuid);e&&(e.tro=t.tro,e.texMid=e.unit.texMid,this.m_blockList[e.index].rejoinNode(e))}}rejoinRunitForVro(t){if(!this.m_sortBlock){let e=this.m_rpoNodeBuilder.getNodeByUid(t.__$rpuid);e&&(e.vtxUid=t.vtxUid,e.vro=t.vro,this.m_blockList[e.index].rejoinNode(e),this.m_version++)}}addContainer(t){if(this.createSortBlock(),this.m_sortBlock)this.m_sortBlock.addContainer(t)&&this.m_scTotal++;else{const e=this.m_containerBlocks;let s=e.length-1,i=e.length>0;for(;s>=0;--s){if(e[s].isEmpty()&&i){e[s].addContainer(t),i=!0;break}if(i=!1,e[s].hasContainer(t))break}if(-1==s&&!i){let s=new l.default(this.m_shader);s.addContainer(t),this.m_blockLinker.addNode(s),e.push(s)}}}removeContainer(t){if(this.m_sortBlock)this.m_sortBlock.removeContainer(t)&&this.m_scTotal--;else{const e=this.m_containerBlocks;let s=0;for(;s<e.length;++s)e[s].hasContainer(t)&&e[s].removeContainer(t)}}createSortBlock(){this.m_sortEnabled&&!this.m_sortBlock&&(this.m_sortBlock=new r.default(this.m_shader),this.m_sortBlock.setSorter(this.m_sorter),this.m_blockLinker.addNode(this.m_sortBlock))}addDisp(t){if(null!=t&&t.__$$runit&&t.__$$runit.getRPROUid()<0){const e=t.__$$runit.rentity;let s=e.__$getParent();while(s){if(!s.hasParent()&&s.getREType()>=20)return;s=s.getParent()}if(t.__$$runit.getRPROUid()!=this.uid){let e=this.m_rpoNodeBuilder.create();e.unit=this.m_rpoUnitBuilder.getNodeByUid(t.__$ruid),e.unit.__$rprouid=this.uid,t.__$rpuid=e.uid,e.__$ruid=t.__$ruid,e.unit.__$rpuid=e.uid,e.updateData(),++this.m_nodesLen,this.m_rpoUnitBuilder.setRPNodeParam(t.__$ruid,this.getUid(),e.uid),this.m_sortEnabled?(this.createSortBlock(),this.m_sortBlock.addNode(e)):this.addNodeToBlock(e),this.m_version++}}}updateDispMateiral(t){if(t.__$$runit&&!this.m_sortBlock){let e=t.__$$runit.getRPOUid(),s=this.m_rpoNodeBuilder.getNodeByUid(e);s.shdUid=s.unit.shdUid,s.texMid=s.unit.texMid,s.tro=s.unit.tro;let i=this.m_blockList[s.index];i.removeNode(s),this.addNodeToBlock(s)}}removeDisp(t){if(t&&t.__$$runit){let e=t.__$$runit.getRPOUid(),s=this.m_rpoNodeBuilder.getNodeByUid(e);if(s){let e=s.unit,i=e.transUniform;if(i&&this.m_rc.rdataBuilder.transPool.removeTransUniform(i.key),this.m_sortBlock)this.m_sortBlock.removeNode(s);else{let t=this.m_blockList[s.index];t.removeNode(s)}this.m_rpoUnitBuilder.setRPNodeParam(t.__$ruid,this.getUid(),-1),--this.m_nodesLen,this.m_rpoNodeBuilder.restore(s)&&this.m_rpoUnitBuilder.restore(e),this.m_vtxResource.__$detachRes(t.getVtxResUid()),t.__$$runit=null,t.__$ruid=-1,this.m_version++}}}forceRemoveDisp(t){if(t&&t.__$$runit){let e=t.__$$runit,s=e.transUniform;s&&this.m_rc.rdataBuilder.transPool.removeTransUniform(s.key),this.m_rpoUnitBuilder.setRPNodeParam(t.__$ruid,this.getUid(),-1),this.m_rpoUnitBuilder.restore(e),this.m_vtxResource.__$detachRes(t.getVtxResUid()),t.__$$runit=null,t.__$ruid=-1,this.m_version++}}getStatus(){return this.m_version}removeDispUnit(t){if(t&&t.__$ruid>-1){let e=t.__$$runit.getRPOUid(),s=this.m_rpoNodeBuilder.getNodeByUid(e);s&&(this.m_sortBlock?this.m_sortBlock.removeNode(s):this.m_blockList[s.index].removeNode(s),this.m_rpoUnitBuilder.setRPNodeParam(t.__$ruid,this.m_rpIndex,-1),s.unit.__$rprouid=-1,--this.m_nodesLen,this.m_rpoNodeBuilder.restore(s))}}update(){const t=this.m_nodesLen+this.m_containerBlocks.length+this.m_scTotal;this.m_enabled&&t>0&&this.m_sortBlock&&this.m_sortBlock.update()}run(){const t=this.m_nodesLen+this.m_containerBlocks.length+this.m_scTotal;if(this.m_enabled&&t>0){const t=this.m_rc,e=this.m_blockLinker;let s=e.getBegin();if(this.m_shader.isUnLocked())while(s)s.run(t),s=s.next;else while(s)s.runLockMaterial(t),s=s.next}}drawDisp(t,e=!1,s=!0){if(t){let i=t.__$$runit;i&&(this.m_shader.isUnLocked()?(s&&this.m_shader.resetUniform(),this.m_fixBlock.drawUnit(this.m_rc,i,t)):this.m_fixBlock.drawLockMaterialByUnit(this.m_rc,i,t,e,s))}}reset(){this.m_sortEnabled=!1,this.m_nodesLen=0,this.uid=-1,this.m_rpIndex=-1,this.m_rcuid=-1,this.m_rpIndex=-1;for(let t=0;t<this.m_blockListLen;++t)this.m_blockList[t].reset();this.m_blockListLen=0,this.m_blockList=[],this.m_rpoNodeBuilder=null,this.m_rpoUnitBuilder=null,this.m_vtxResource=null,this.m_rc=null,null!=this.m_sortBlock&&(this.m_sortBlock.clear(),this.m_sortBlock=null)}showInfo(){for(let t=0;t<this.m_blockListLen;++t)this.m_blockList[t].showInfo()}destroy(){this.reset()}setEnabled(t){this.m_enabled=t}isEnabled(){return this.m_enabled}}h.s_max_shdTotal=1024,e.default=h},"7f1c":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("34cd"));class a{constructor(){this.passProc=new r.default,this.shdUpdate=!1,this.shader=null}runContainer(t,e){const s=e.getEntities(),i=s.length;if(i>0){const e=this.passProc;e.shader=this.shader;for(let r=0;r<i;++r){const i=s[r];if(i.isPolyhedral()&&i.isVisible()&&i.isInRenderer()){const s=i.getDisplay().__$$runit;s&&s.rendering&&(this.shader.bindToGpu(s.shdUid),s.updateVtx(),s.drawing&&(s.rgraph&&s.rgraph.isEnabled()?(e.units=[s],e.rc=t,e.vtxFlag=!0,e.texFlag=!0,s.rgraph.run(e),this.shdUpdate=!0):(this.shdUpdate&&(s.applyShader(!0),this.shdUpdate=!1),s.run(t),s.draw(t))))}}}const r=e.getContainers(),a=r.length;if(a>0)for(let n=0;n<a;++n)this.runContainer(t,r[n])}runContainerLock(t,e){const s=e.getEntities(),i=s.length;if(i>0){const e=this.passProc;e.shader=this.shader;for(let r=0;r<i;++r){const e=s[r];if(e.isPolyhedral()&&e.isVisible()&&e.isInRenderer()){const s=e.getDisplay().__$$runit;s&&s.rendering&&(this.shader.bindToGpu(s.shdUid),s.updateVtx(),s.drawing&&(s.vro.run(),s.runLockMaterial2(null),s.draw(t)))}}}const r=e.getContainers(),a=r.length;if(a>0)for(let n=0;n<a;++n)this.runContainerLock(t,r[n])}}e.default=a},8333:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.COLOR_BUFFER_BIT=131,i.DEPTH_BUFFER_BIT=132,i.STENCIL_BUFFER_BIT=133,e.default=i},"83d1":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("ab73"));class a{create(t,e){let s=r.default.StageParam;return e.hasUniformByName(s.name)?t.uniformContext.createShaderGlobalUniformFromProbe(t.getStage3D().uProbe,s.name,[s.name]):null}getIDNS(){return"StageParamUniformBuilder"}}e.default=a},8414:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.FLAT=210,i.GOURAND=310,e.default=i},"857b":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("ab73"));class a{create(t,e){let s=r.default.CameraPosParam;return e.hasUniformByName(s.name)?t.uniformContext.createShaderGlobalUniformFromProbe(t.getCamera().ucameraPosProbe,s.name,[s.name]):null}getIDNS(){return"CameraPosUniformBuilder"}}e.default=a},8875:function(t,e,s){var i,r,a;(function(s,n){r=[],i=n,a="function"===typeof i?i.apply(e,r):i,void 0===a||(t.exports=a)})("undefined"!==typeof self&&self,(function(){function t(){var e=Object.getOwnPropertyDescriptor(document,"currentScript");if(!e&&"currentScript"in document&&document.currentScript)return document.currentScript;if(e&&e.get!==t&&document.currentScript)return document.currentScript;try{throw new Error}catch(m){var s,i,r,a=/.*at [^(]*\((.*):(.+):(.+)\)$/gi,n=/@([^@]*):(\d+):(\d+)\s*$/gi,l=a.exec(m.stack)||n.exec(m.stack),h=l&&l[1]||!1,_=l&&l[2]||!1,o=document.location.href.replace(document.location.hash,""),d=document.getElementsByTagName("script");h===o&&(s=document.documentElement.outerHTML,i=new RegExp("(?:[^\\n]+?\\n){0,"+(_-2)+"}[^<]*<script>([\\d\\D]*?)<\\/script>[\\d\\D]*","i"),r=s.replace(i,"$1").trim());for(var u=0;u<d.length;u++){if("interactive"===d[u].readyState)return d[u];if(d[u].src===h)return d[u];if(h===o&&d[u].innerHTML&&d[u].innerHTML.trim()===r)return d[u]}return null}}return t}))},"899a":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){}static Reset(){i.Flag_0=0}}i.Flag_0=0,e.default=i},"8a0a":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("ca6c")),a=i(s("8414"));e.VtxNormalType=a.default;class n{static ToGL(t,e){const s=n;switch(e){case s.VTX_STATIC_DRAW:return t.STATIC_DRAW;case s.VTX_DYNAMIC_DRAW:return t.DYNAMIC_DRAW;case s.VTX_STREAM_DRAW:return t.STREAM_DRAW;case s.VTX_STATIC_READ:return t.STATIC_READ;case s.VTX_DYNAMIC_READ:return t.DYNAMIC_READ;case s.VTX_STREAM_READ:return t.STREAM_READ;case s.VTX_STATIC_COPY:return t.STATIC_COPY;case s.VTX_DYNAMIC_COPY:return t.DYNAMIC_COPY;case s.VTX_STREAM_COPY:return t.STREAM_COPY;default:break}return t.STATIC_DRAW}static GetVBufTypeByNS(t){const e=n;switch(t){case e.VBUF_VS_NS:return e.VBUF_VS;case e.VBUF_UVS_NS:return e.VBUF_UVS;case e.VBUF_NVS_NS:return e.VBUF_NVS;case e.VBUF_CVS_NS:return e.VBUF_CVS;case e.VBUF_VS2_NS:return e.VBUF_VS2;case e.VBUF_UVS2_NS:return e.VBUF_UVS2;case n.VBUF_NVS2_NS:return n.VBUF_NVS2;case e.VBUF_CVS2_NS:return e.VBUF_CVS2;case e.VBUF_TVS_NS:return e.VBUF_TVS;case e.VBUF_TVS2_NS:return e.VBUF_TVS2;default:}return-1}static GetVBufNSByType(t){const e=n;switch(t){case e.VBUF_VS:return e.VBUF_VS_NS;case e.VBUF_UVS:return e.VBUF_UVS_NS;case e.VBUF_NVS:return e.VBUF_NVS_NS;case e.VBUF_CVS:return e.VBUF_CVS_NS;case e.VBUF_VS2:return e.VBUF_VS2_NS;case e.VBUF_UVS2:return e.VBUF_UVS2_NS;case e.VBUF_NVS2:return e.VBUF_NVS2_NS;case e.VBUF_CVS2:return e.VBUF_CVS2_NS;case e.VBUF_TVS:return e.VBUF_TVS_NS;case e.VBUF_TVS2:return e.VBUF_TVS2_NS;default:}return""}static GetVBufAttributeTypeByNS(t){return n.GetVBufTypeByNS(t)-3e3}static GetVBufAttributeTypeByVBufType(t){return t-3e3}}n.VTXTYPE_GL_POINTS=101,n.VTXTYPE_GL_LINES=102,n.VTXTYPE_GL_LINE_STRIP=103,n.VTXTYPE_GL_TRIANGLES=111,n.VTX_STATIC_DRAW=0,n.VTX_DYNAMIC_DRAW=1,n.VTX_STREAM_DRAW=2,n.VTX_STATIC_READ=3,n.VTX_DYNAMIC_READ=4,n.VTX_STREAM_READ=5,n.VTX_STATIC_COPY=6,n.VTX_DYNAMIC_COPY=7,n.VTX_STREAM_COPY=8,n.VBUF_VS=3001,n.VBUF_UVS=3002,n.VBUF_NVS=3003,n.VBUF_CVS=3004,n.VBUF_TVS=3005,n.VBUF_VS2=3006,n.VBUF_UVS2=3007,n.VBUF_NVS2=3008,n.VBUF_CVS2=3009,n.VBUF_TVS2=3010,n.VBUF_VS_INDEX=r.default.BIT_ONE_0,n.VBUF_UVS_INDEX=r.default.BIT_ONE_1,n.VBUF_NVS_INDEX=r.default.BIT_ONE_2,n.VBUF_CVS_INDEX=r.default.BIT_ONE_3,n.VBUF_TVS_INDEX=r.default.BIT_ONE_4,n.VBUF_VS2_INDEX=r.default.BIT_ONE_5,n.VBUF_UVS2_INDEX=r.default.BIT_ONE_6,n.VBUF_NVS2_INDEX=r.default.BIT_ONE_7,n.VBUF_CVS2_INDEX=r.default.BIT_ONE_8,n.VBUF_TVS2_INDEX=r.default.BIT_ONE_9,n.VBUF_VS_NS="a_vs",n.VBUF_VS2_NS="a_vs2",n.VBUF_UVS_NS="a_uvs",n.VBUF_UVS2_NS="a_uvs2",n.VBUF_NVS_NS="a_nvs",n.VBUF_NVS2_NS="a_nvs2",n.VBUF_CVS_NS="a_cvs",n.VBUF_CVS2_NS="a_cvs2",n.VBUF_TVS_NS="a_tvs",n.VBUF_TVS2_NS="a_tvs2",e.default=n},"8ae4":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("13b1")),a=s("1f32");e.IROIvsRDP=a.IROIvsRDP;const n=r.default;class l{constructor(){this.m_uid=l.s_uid++,this.m_common=!0,this.rc=null,this.buf=null,this.ivsSize=0,this.ivsInitSize=0,this.ivsIndex=0,this.stride=2,this.initDrawMode=n.ELEMENTS_TRIANGLES,this.drawMode=n.ELEMENTS_TRIANGLES,this.bufType=0,this.ivsOffset=0,this.rdpIndex=0,this.trisNumber=0,this.insCount=0,this.bytesSize=0,this.gldm=0}getUid(){return this.m_uid}clone(){let t=new l;return t.buf=this.buf,t.ivsIndex=this.ivsIndex,t.ivsSize=this.ivsSize,t.ivsInitSize=this.ivsInitSize,t.stride=this.stride,t.drawMode=this.drawMode,t.gldm=this.gldm,t.ivsOffset=this.ivsOffset,t.trisNumber=this.trisNumber,t.insCount=this.insCount,t.m_common=this.m_common,t.bufType=this.bufType,t.rdpIndex=this.rdpIndex,t.bytesSize=this.bytesSize,t}hasIvs(){return this.ivsInitSize>0}isCommon(){return this.m_common}updateDrawMode(){if(this.hasIvs()){const t=this.initDrawMode,e=t==n.ELEMENTS_TRIANGLES||t==n.ELEMENTS_LINES,s=t==n.ELEMENTS_TRIANGLE_STRIP||t==n.ELEMENTS_LINES_STRIP;if(e||s){const t=this.rc;if(null==t)throw Error("illegal operations ...");const e=this.m_common;this.gldm=s?e?t.TRIANGLE_STRIP:t.LINE_STRIP:e?t.TRIANGLES:t.LINES,this.insCount<1?this.drawMode=s?e?n.ELEMENTS_TRIANGLES:n.ELEMENTS_LINES:e?n.ELEMENTS_TRIANGLE_STRIP:n.ELEMENTS_LINES_STRIP:this.drawMode=s?e?n.ELEMENTS_INSTANCED_TRIANGLES_STRIP:n.ELEMENTS_INSTANCED_LINES_STRIP:e?n.ELEMENTS_INSTANCED_TRIANGLES:n.ELEMENTS_INSTANCED_LINES}}}setCommon(t){this.m_common=t,this.updateDrawMode()}setInsCount(t){this.insCount!=t&&(this.insCount=t,this.updateDrawMode())}setIvsParam(t,e){let s=this.ivsIndex,i=this.ivsSize;t>=0&&(s=t),e>=0&&(i=e),t=s,e=i;const r=this;r.ivsIndex=r.isCommon()?t:2*t,r.ivsIndex<0?r.ivsIndex=0:r.ivsIndex>=this.ivsInitSize&&(r.ivsIndex=this.ivsInitSize-1),r.ivsOffset=r.ivsIndex*r.stride,r.isCommon()||(e*=2),e+r.ivsIndex>=this.ivsInitSize&&(e=this.ivsInitSize-r.ivsIndex),this.ivsSize=e,this.trisNumber=Math.floor(e/3)}destroy(t){this.rc=null,null!=this.buf&&(t.deleteBuf(this.buf),this.buf=null)}clear(){this.buf=null,this.rc=null}}l.s_uid=0;class h{constructor(t){this.m_uid=h.s_uid++,this.m_rdpVer=0,this.m_st=101,this.m_tst=0,this.m_rdpIndex=0,this.r0=null,this.r1=null,this.rd=null,this.buf=null,this.roiRes=null,this.ivdVer=0,this.ver=0,this.lifeTime=0,this.m_rdpIndex=t}getRDPIndex(){return this.m_rdpIndex}getUid(){return this.m_uid}destroy(t){this.r0=null,this.r1=null,this.rd=null,this.buf=null,this.roiRes=null}clearBuf(){if(0==this.lifeTime)throw Error("illegal operation!!!");null!=this.r0&&(this.r0.clear(),this.r1.clear(),this.roiRes=null,this.r0=null,this.r1=null,this.rd=null,this.buf=null)}clear(){this.clearBuf()}updateStatus(){this.m_st++,this.m_tst=131*(131*this.m_st+this.m_rdpVer)+this.m_uid}setIvsParam(t,e){this.updateStatus();let s=this.roiRes.getRDPDataAt(this.m_rdpIndex);this.r0.ivsInitSize=s.r0.ivsInitSize,this.r0.setIvsParam(t,e),this.r0!=this.r1&&(this.r1.ivsInitSize=s.r1.ivsInitSize,this.r1.setIvsParam(t,e))}applyRDPAt(t){if(null!=this.roiRes&&this.m_rdpIndex!=t){let e=this.rd,s=this.roiRes.getRDPDataAt(t);s&&(this.updateStatus(),this.clearBuf(),this.m_rdpIndex=s.getRDPIndex(),this.copyFrom(s,!0,!1),e=this.rd)}}setInsCount(t){this.rd.setInsCount(t)}getVersion(){return this.m_tst}toWireframe(){this.m_rdpVer=1,this.rd=this.r1,this.buf=this.rd.buf,this.roiRes.rdp=this,this.updateStatus()}toShape(){this.m_rdpVer=0,this.rd=this.r0,this.buf=this.rd.buf,this.roiRes.rdp=this,this.updateStatus()}toCommon(){this.toShape()}isCommon(){return 0==this.m_rdpVer}test(){return this.roiRes.rdp=this,this.roiRes.test()}copyFrom(t,e=!0,s=!0){this.roiRes=t.roiRes,s&&(this.m_rdpVer=t.m_rdpVer),this.r0=t.r0.clone(),t.r0!=t.r1?this.r1=t.r1.clone():this.r1=this.r0,e&&(this.isCommon()?this.toCommon():this.toWireframe())}copyTo(t,e=!0,s=!0){t.roiRes=this.roiRes,s&&(t.m_rdpVer=this.m_rdpVer),t.r0=this.r0.clone(),this.r0!=this.r1?t.r1=this.r1.clone():t.r1=t.r0,e&&(t.isCommon()?t.toCommon():t.toWireframe())}clone(){let t=new h(this.getRDPIndex());return t.lifeTime=this.lifeTime+1,this.copyTo(t),t}}h.s_uid=0,e.BufRDataPair=h;class _{constructor(){this.m_uid=_.s_uid++,this.m_vtx=null,this.m_vtxUid=0,this.m_disp=null,this.m_ivsData=null,this.m_rdps=[],this.m_rdpVer=-2,this.rdp=null,this.initRdp=null,this.version=-1,this.m_rdps.fill(null)}getUid(){return this.m_uid}getVtxUid(){return this.m_vtxUid}getRDPDataAt(t){return t>=0&&t<this.m_rdps.length?this.m_rdps[t]:null}test(){return this.m_rdpVer!=this.rdp.getVersion()}bindToGPU(t=!1){t=t||this.m_rdpVer!=this.rdp.getVersion(),(this.m_vrc.testRIOUid(this.m_vtxUid)||t)&&(this.m_vrc.bindEleBuf(this.rdp.buf),this.m_rdpVer=this.rdp.getVersion())}updateToGpu(t){const e=this.initRdp;if(null!=t)if(null!=e.buf){const e=this.m_vtx,s=this.m_rc;if(this.version!=e.indicesVer&&s){let i=this.m_disp;for(let r=0;r<e.getIvsDataTotal();++r){const a=e.getIvsDataAt(r),n=this.m_rdps[r];n.ivdVer!=a.version&&(n.r0==n.r1?n.r0=this.createBuf(n.r0,n.getRDPIndex(),s,t,e,i,!n.r0.isCommon()):(n.r0=this.createBuf(n.r0,n.getRDPIndex(),s,t,e,i,!n.r0.isCommon()),n.r1=this.createBuf(n.r1,n.getRDPIndex(),s,t,e,i,!n.r1.isCommon())),n.ivdVer=a.version)}this.version=e.indicesVer}}else{const t=e.rd;t.ivsSize=this.m_disp.ivsCount,t.ivsInitSize=t.ivsSize}}initialize(t,e,s,i){this.m_vrc=e,this.m_rc=t;let r=null;if(this.m_rdps.length<1&&null!=s.getIvsDataAt())this.version=s.indicesVer,this.m_vtx=s,this.m_vtxUid=s.getUid(),r=this.createRDPAt(0,t,e,i);else{r=new h(0);let e=new l;e.buf=null,e.rc=t,e.ivsSize=i.ivsCount,e.ivsInitSize=e.ivsSize,e.ivsIndex=i.ivsIndex,e.stride=2,e.drawMode=i.drawMode,e.initDrawMode=i.drawMode,r.r0=e,r.r1=e}this.m_disp=i,this.rdp=this.m_rdps[0]=r,this.initRdp=r,r.roiRes=this,r.toShape();let a=s.getIvsDataTotal();for(let n=1;n<a;++n)r=this.createRDPAt(n,t,e,i),this.m_rdps.push(r)}createRDPAt(t,e,s,i){let r=new h(t);r.roiRes=this;const a=this.m_vtx;let n=a.getIvsDataAt(t);this.m_ivsData=n;let l=n.wireframe,_=n.shape,o=null,d=null;return _&&(o=this.createBuf(null,t,e,s,a,i,!1)),l&&(d=this.createBuf(null,t,e,s,a,i,l)),null==o&&null==d&&(o=this.createBuf(null,t,e,s,a,i,!1)),null==o?o=d:null==d&&(d=o),r.r0=o,r.r1=d,r.ivdVer=n.version,r}createBuf(t,e,s,i,r,a,n=!1){let h=r.getIvsDataAt(e),_=h.ivs,o=0,d=_.byteLength,u=0,m=null==t;m||(u=t.bytesSize);let c=a.ivsIndex,f=2,p=null!=t?t.buf:null;if(null==p&&(p=i.createBuf()),i.bindEleBuf(p),null==r.bufData)n&&(_=this.createWireframeIvs(_)),d>u?i.eleBufData(_,r.getBufDataUsage()):i.eleBufSubData(_,r.getBufDataUsage()),o=_.length,f=o>65536?4:2,u=d;else{let t=0,e=[];for(let s=0,i=r.bufData.getIndexDataTotal();s<i;++s){const t=r.bufData.getIndexDataAt(s);_=t.ivs,n&&(_=this.createWireframeIvs(_)),e[s]=_,o+=_.length}if(o>65536){f=4;for(let t=0,s=e.length;t<s;++t)_=e[t],e[t]=_ instanceof Uint32Array?_:new Uint32Array(_)}else{f=2;for(let t=0,s=e.length;t<s;++t)_=e[t],e[t]=_ instanceof Uint16Array?_:new Uint16Array(_)}o=0;for(let s=0,i=e.length;s<i;++s)o+=e[s].byteLength;u=o,i.eleBufDataMem(o,r.getBufDataUsage()),t=0,o=0;for(let s=0,r=e.length;s<r;++s)_=e[s],i.eleBufSubData(_,t),t+=_.byteLength,o+=_.length}if(t=null==t?new l:t,t.rc=s,null==s)throw Error("illegal operations !!!");return t.buf=p,t.rdpIndex=e,t.ivsSize=o,t.ivsInitSize=o,t.stride=f,t.trisNumber=Math.floor(o/3),t.initDrawMode=a.drawMode,t.setCommon(!n),t.ivsIndex=t.isCommon()?c:2*c,t.ivsOffset=t.ivsIndex*t.stride,t.bytesSize=u,t.bufType=4!=f?s.UNSIGNED_SHORT:s.UNSIGNED_INT,t}destroy(t){if(this.m_rc=null,this.m_vrc=null,this.m_disp=null,this.m_rdps.length>0){this.m_vtx=null;for(let e=0;e<this.m_rdps.length;++e)this.m_rdps[e].destroy(t);this.m_ivsData=null,this.initRdp=null,this.rdp=null}}createWireframeIvs(t){if(null!==t){const e=2*t.length,s=e>65536?new Uint32Array(e):new Uint16Array(e);let i,r,a,n=0;for(let l=0,h=t.length;l<h;l+=3)i=t[l+0],r=t[l+1],a=t[l+2],s[n]=i,s[n+1]=r,s[n+2]=r,s[n+3]=a,s[n+4]=a,s[n+5]=i,n+=6;return s}return t}}_.s_uid=0,e.ROIndicesRes=_},"8def":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("919c")),a=i(s("899a"));class n extends r.default{constructor(){super(),this.shdp=null,this.vbufs=null,this.vbuf=null,this.attribTypes=null,this.wholeOffsetList=null,this.attribTypesLen=0,this.updateUnlocked=!0,this.wholeStride=0,this.m_uid=n.s_uid++}run(){(this.m_rc.testVROUid(this.m_uid)||this.indicesRes.test())&&(a.default.Flag_0,null!=this.vbuf?this.m_rc.useVtxAttribsPtrTypeFloat(this.shdp,this.vbuf,this.attribTypes,this.attribTypesLen,this.wholeOffsetList,this.wholeStride):this.m_rc.useVtxAttribsPtrTypeFloatMulti(this.shdp,this.vbufs,this.attribTypes,this.attribTypesLen,this.wholeOffsetList,this.wholeStride),this.indicesRes.bindToGPU())}__$destroy(){r.default.s_midMap.delete(this.m_mid),this.m_mid=0,this.m_vtxUid=-1,this.m_rc=null,this.shdp=null,this.vbufs=null,this.vbuf=null,this.indicesRes=null,this.attribTypes=null,this.attribTypesLen=0,this.wholeStride=0}restoreThis(){n.Restore(this)}static HasMid(t){return r.default.s_midMap.has(t)}static GetByMid(t){return r.default.s_midMap.get(t)}static GetFreeId(){return n.s_freeIdList.length>0?n.s_freeIdList.pop():-1}static Create(t,e,s){let i=null,a=n.GetFreeId();return a>=0?(i=n.s_unitList[a],n.s_flags[a]=n.s_FLAG_BUSY,i.setMidAndBufUid(e,s)):(i=new n,i.setMidAndBufUid(e,s),n.s_unitList.push(i),n.s_flags.push(n.s_FLAG_BUSY),n.s_unitListLen++),i.setRC(t),r.default.s_midMap.set(e,i),i}static Restore(t){if(null!=t&&t.m_attachCount<1&&n.s_flags[t.getUid()]==n.s_FLAG_BUSY){let e=t.getUid();n.s_freeIdList.push(e),n.s_flags[e]=n.s_FLAG_FREE,t.__$destroy()}}}n.s_uid=0,n.s_FLAG_BUSY=1,n.s_FLAG_FREE=0,n.s_flags=[],n.s_unitListLen=0,n.s_unitList=[],n.s_freeIdList=[],e.default=n},9156:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.m_transMap=new Map}setTransUniform(t,e,s){let i=131*(t.getUid()+1)+s.getUid();this.m_transMap.has(i)||(this.m_transMap.set(i,e),e.key=i)}getTransUniform(t,e){if(t.getUid()<0)throw Error("mat.getUid() < 0");let s=131*(t.getUid()+1)+e.getUid();return this.m_transMap.has(s)?this.m_transMap.get(s):null}hasTransUniform(t,e){let s=131*(t.getUid()+1)+e.getUid();return this.m_transMap.has(s)}removeTransUniform(t){this.m_transMap.has(t)&&this.m_transMap.delete(t)}clear(){this.m_transMap.clear()}}e.default=i},"919c":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.m_uid=0,this.m_mid=0,this.m_vtxUid=0,this.m_rc=null,this.indicesRes=null,this.m_attachCount=0}setRC(t){this.m_rc=t}setMidAndBufUid(t,e){this.m_mid=t,this.m_vtxUid=e,this.m_attachCount=0}getUid(){return this.m_uid}getVtxUid(){return this.m_vtxUid}getMid(){return this.m_mid}run(){}__$attachThis(){++this.m_attachCount}__$detachThis(){--this.m_attachCount,this.m_attachCount<1&&(this.m_attachCount=0)}__$destroy(){i.s_midMap.delete(this.m_mid),this.m_mid=0,this.m_vtxUid=-1,this.m_rc=null,this.indicesRes=null}restoreThis(){}static HasMid(t){return i.s_midMap.has(t)}static GetByMid(t){return i.s_midMap.get(t)}__$resetVRO(){i.s_mid=-1}}i.s_mid=0,i.s_midMap=new Map,e.default=i},"91da":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("5f3c")),a=i(s("34cd")),n=i(s("7f1c"));class l extends r.default{constructor(t){super(t),this.m_unitsTotal=0,this.m_container=null,this.m_cr=new n.default,this.m_passProc=new a.default}resetCR(){const t=this.m_cr;t.passProc=this.m_passProc,t.shdUpdate=!1,t.shader=this.m_shader}showInfo(){}clear(){this.m_shader&&(this.m_shader=null,this.m_container=null)}update(){this.sortEnabled&&this.sort()}addContainer(t){this.m_container=t}removeContainer(t){t==this.m_container&&(this.m_container=null)}hasContainer(t){return this.m_container==t}isEmpty(){return null==this.m_container}run(t){const e=this.m_container;e&&e.isVisible()&&(this.resetCR(),this.m_cr.runContainer(t,e))}runLockMaterial(t){const e=this.m_container;e&&e.isVisible()&&(this.resetCR(),this.m_cr.runContainerLock(t,e))}getNodesTotal(){return this.m_unitsTotal}addNode(t){}removeNode(t){}}e.default=l},"984e":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.waitDelTimes=0,this.rcuid=0,this.resUid=0,this.width=0,this.height=0,this.depth=0,this.sampler=0,this.texBuf=null,this.m_attachCount=0}__$attachThis(){++this.m_attachCount}__$detachThis(){--this.m_attachCount,this.m_attachCount<1&&(this.m_attachCount=0)}bindToGpu(t){t.bindTexture(this.sampler,this.texBuf)}getAttachCount(){return this.m_attachCount}}class r{constructor(t,e){this.m_resMap=new Map,this.m_freeMap=new Map,this.m_texResTotal=0,this.m_attachTotal=0,this.m_delay=128,this.m_rcuid=0,this.m_gl=null,this.texMid=-1,this.unlocked=!0,this.m_rcuid=t,this.m_gl=e}setGLCtx(t){this.m_gl=t,this.m_resMap.clear(),this.m_freeMap.clear()}createBuf(){return this.m_gl.createTexture()}createResByParams3(t,e,s,r){if(!this.m_resMap.has(t)){let a=new i;return a.rcuid=this.getRCUid(),a.resUid=t,a.width=e,a.height=s,a.sampler=r,a.texBuf=this.createBuf(),a.texBuf.resUid=t,this.addTextureRes(a),!0}return!1}getRCUid(){return this.m_rcuid}getRC(){return this.m_gl}hasResUid(t){return this.m_resMap.has(t)}renderBegin(){this.texMid=-1}getTextureResTotal(){return this.m_texResTotal}addTextureRes(t){this.m_resMap.has(t.resUid)||(t.waitDelTimes=0,this.m_resMap.set(t.resUid,t),this.m_texResTotal++)}getGpuBuffer(t){return this.m_resMap.has(t)?this.m_resMap.get(t).texBuf:null}bindToGpu(t){this.m_resMap.has(t)&&this.m_resMap.get(t).bindToGpu(this.m_gl)}getAttachTotal(){return this.m_attachTotal}__$attachRes(t){if(this.m_resMap.has(t)){this.m_attachTotal++;let e=this.m_resMap.get(t);e.getAttachCount()<1&&this.m_freeMap.has(t)&&this.m_freeMap.delete(t),e.waitDelTimes=0,e.__$attachThis()}}__$detachRes(t){if(this.m_resMap.has(t)&&this.m_resMap.has(t)){let e=this.m_resMap.get(t);e.getAttachCount()>0&&(this.m_attachTotal--,e.__$detachThis(),e.getAttachCount()<1&&this.m_freeMap.set(t,e))}}update(){if(this.m_delay--,this.m_delay<1){this.m_delay=128;for(const[t,e]of this.m_freeMap)e.waitDelTimes++,e.waitDelTimes>5&&(this.m_resMap.delete(e.resUid),this.m_freeMap.delete(e.resUid),this.m_gl.deleteTexture(e.texBuf),e.texBuf=null,this.m_texResTotal--)}}}e.default=r},"9f82":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.sdkVer=0,this.version=0,this.drawCallTimes=0,this.drawTrisNumber=0,this.povNumber=0}reset(){this.drawCallTimes=0,this.drawTrisNumber=0,this.povNumber=0}}e.RPStatus=i},a4f8:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t){this.m_rstate=null,this.m_rstate=t}isEnabled(){return!0}setDepthTestEnable(t){return this.m_rstate&&this.m_rstate.setDepthTestEnable(t),this}setStencilFunc(t,e,s){return this.m_rstate.setStencilFunc(t,e,s),this}setStencilMask(t){return this.m_rstate.setStencilMask(t),this}setStencilOp(t,e,s){return this.m_rstate.setStencilOp(t,e,s),this}}e.RenderingStencil=i},a5ba:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("e08e");class r{constructor(t,e,s){this.m_uid=-1,this.m_cullFaceMode=0,this.m_blendMode=0,this.m_depthTestMode=0,this.m_shadowMode=0,this.m_uid=r.s_uid++,this.m_cullFaceMode=t,this.m_blendMode=e,this.m_depthTestMode=s}getUid(){return this.m_uid}getCullFaceMode(){return this.m_cullFaceMode}getDepthTestMode(){return this.m_depthTestMode}getBlendMode(){return this.m_blendMode}use(){if(r.s_state!=this.m_uid){r.Rstate.setCullFaceMode(this.m_cullFaceMode);r.s_blendModes[r.m_blendMode];r.m_blendMode<0?r.Rstate.setBlendMode(this.m_blendMode,r.s_blendModes[this.m_blendMode]):r.Rstate.setBlendMode(r.m_blendMode,r.s_blendModes[r.m_blendMode]),r.s_depthTestMode<0?r.Rstate.setDepthTestMode(this.m_depthTestMode):r.Rstate.setDepthTestMode(r.s_depthTestMode),r.s_state=this.m_uid}}static CreateBlendModeSeparate(t,e,s,a,n,l=0,h=0){if(null!=t&&""!=t){let _;if(r.s_blendModeNameMap.has(t))return _=r.s_blendModeNameMap.get(t),r.s_blendModeIndexMap.get(_);l<1&&(l=i.GLBlendEquation.FUNC_ADD),h<1&&(h=i.GLBlendEquation.FUNC_ADD);let o=1;if(_=31,_=131*_+e,_=131*_+s,a>0&&n>0&&(_=131*_+a,_=131*_+n,o=1),r.s_blendModeIndexMap.has(_))return r.s_blendModeNameMap.set(t,_),r.s_blendModeIndexMap.get(_);let d=++r.s_blendModeIndex;r.s_blendModeNameMap.set(t,_),r.s_blendModeIndexMap.set(_,d);let u=[o,l,h,e,s,a,n];return r.s_blendModes[d]=u,d}return 0}static CreateBlendMode(t,e,s,a=0){if(null!=t&&""!=t){let n;if(r.s_blendModeNameMap.has(t))return n=r.s_blendModeNameMap.get(t),r.s_blendModeIndexMap.get(n);a<1&&(a=i.GLBlendEquation.FUNC_ADD);let l=0;if(n=31,n=131*n+e,n=131*n+s,r.s_blendModeIndexMap.has(n))return r.s_blendModeIndexMap.get(n);let h=++r.s_blendModeIndex;r.s_blendModeNameMap.set(t,n),r.s_blendModeIndexMap.set(n,h);let _=[l,a,0,e,s,0,0];return r.s_blendModes[h]=_,h}return 0}static Create(t,e,s,i){if(r.s_stsNameMap.has(t)){let e=r.s_stsNameMap.get(t);return e.getUid()}let a=31;if(a=131*a+i,a=131*a+s,a=131*a+e,r.s_stsMap.has(a)){let e=r.s_stsMap.get(a);a=e.getUid(),""!=t&&r.s_stsNameMap.set(t,e)}else{""==t&&(t="sys_rst_"+a);let n=new r(e,s,i);a=n.getUid(),r.s_stsMap.set(a,n),r.s_stsNameMap.set(t,n),r.s_states.push(n),++r.s_statesLen}return a}static GetRenderStateByName(t){if(r.s_stsNameMap.has(t)){let e=r.s_stsNameMap.get(t);return e.getUid()}return-1}static UseRenderState(t){r.s_unlocked&&r.s_state!=t&&t>-1&&t<r.s_statesLen&&r.s_states[t].use()}static UseRenderStateByName(t){if(r.s_unlocked){let e=r.GetRenderStateByName(t);r.s_state!=e&&e>-1&&e<r.s_statesLen&&r.s_states[e].use()}}static UnlockBlendMode(){r.m_blendMode=r.s_preBlendMode}static LockBlendMode(t){r.s_preBlendMode=r.m_blendMode,r.m_blendMode=t}static UnlockDepthTestMode(){r.s_depthTestMode=r.s_preDepthTestMode}static LockDepthTestMode(t){r.s_preDepthTestMode=r.s_depthTestMode,r.s_depthTestMode=t}static Lock(){r.s_unlocked=!1}static Unlock(){r.s_unlocked=!0}static Reset(){r.s_state=-1}}r.s_uid=0,r.s_state=-1,r.s_states=[],r.s_statesLen=1,r.m_blendMode=-1,r.s_depthTestMode=-1,r.s_stsMap=new Map,r.s_stsNameMap=new Map,r.s_blendModeNameMap=new Map,r.s_blendModeIndexMap=new Map,r.s_blendModeIndex=0,r.s_blendModes=new Array(256),r.s_unlocked=!0,r.Rstate=null,r.s_preBlendMode=-1,r.s_preDepthTestMode=-1,e.RenderStateObject=r},a7ed:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("ab73"));class a{create(t,e){let s=r.default.FrustumParam;return e.hasUniformByName(s.name)?t.uniformContext.createShaderGlobalUniformFromProbe(t.getCamera().ufrustumProbe,s.name,[s.name]):null}getIDNS(){return"FrustumUniformBuilder"}}e.default=a},ab73:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.type="vec4",this.data=null,this.name="u_vsmParams",this.arrayLength=3}}class r{constructor(){this.type="vec4",this.data=new Float32Array([.1,.1,.1,1,1,.1,600,3500,.3,0,.9,5e-4,0,0,800,800,-500,-500,1e3,1e3]),this.name="u_envLightParams",this.arrayLength=5}}class a{constructor(){this.type="mat4",this.data=null,this.name="u_shadowMat",this.arrayLength=0}}class n{constructor(){this.type="vec4",this.data=null,this.name="u_stageParam",this.arrayLength=0}}class l{constructor(){this.type="vec4",this.data=null,this.name="u_viewParam",this.arrayLength=0}}class h{constructor(){this.type="vec4",this.data=null,this.name="u_frustumParam",this.arrayLength=0}}class _{constructor(){this.type="vec4",this.data=null,this.name="u_cameraPosition",this.arrayLength=0}}class o{constructor(){this.type="vec4",this.positionName="u_lightPositions",this.colorName="u_lightColors"}}class d{}d.LocalTransformMatUNS="u_objMat",d.CameraViewMatUNS="u_viewMat",d.CameraProjectiveMatUNS="u_projMat",d.FrustumParam=new h,d.CameraPosParam=new _,d.StageParam=new n,d.ViewportParam=new l,d.ShadowMatrix=new a,d.ShadowVSMParams=new i,d.GlobalLight=new o,d.EnvLightParams=new r,e.default=d},b02c:function(t,e,s){"use strict";function i(t){let e=1;while(e<t)e<<=1;return e}Object.defineProperty(e,"__esModule",{value:!0});class r{constructor(t,e){this.m_uid=-1,this.m_mid=-1,this.m_texTotal=0,this.m_gtexList=null,this.m_samplers=null,this.m_texList=null,this.m_rcuid=0,this.m_texRes=null,this.direct=!0,this.m_attachCount=0,this.m_rcuid=t,this.m_uid=r.s_uid++,this.m_mid=e}__$setParam(t,e){this.m_rcuid=t,this.m_mid=e}getRCUid(){return this.m_rcuid}getMid(){return this.m_mid}getTexTotal(){return this.m_texTotal}collectTexList(t,e,s){this.m_texRes=t;let r=0;if(this.direct)if(this.m_texTotal<1&&e.length>0){let a,n=i(e.length);this.m_samplers=new Uint16Array(n),this.m_gtexList=new Array(n),this.m_texList=e;while(r<s)a=e[r],a.__$attachThis(),a.__$$upload(t),this.m_samplers[r]=a.getSampler(),this.m_gtexList[r]=this.m_texRes.getGpuBuffer(a.getResUid()),this.m_texRes.__$attachRes(a.getResUid()),r++;this.m_texTotal=r}else this.m_texTotal=0;else this.m_texTotal=s;while(r<e.length)e[r++].__$attachThis()}run(){if(this.m_texRes.unlocked&&this.m_texRes.texMid!=this.m_mid){this.m_texRes.texMid=this.m_mid;let t=this.m_texRes.getRC(),e=t.TEXTURE0;if(this.direct)for(let s=0;s<this.m_texTotal;++s)t.activeTexture(e++),t.bindTexture(this.m_samplers[s],this.m_gtexList[s]);else{let s=this.m_texList;for(let i=0;i<this.m_texTotal;++i)t.activeTexture(e++),s[i].__$$use(this.m_texRes)}}}getUid(){return this.m_uid}__$attachThis(){++this.m_attachCount}__$detachThis(){--this.m_attachCount,this.m_attachCount<1&&(this.m_attachCount=0,r.Restore(this))}reset(){if(null!=this.m_texList)for(let t=0,e=this.m_texList.length;t<e;++t)this.m_texList[t].__$detachThis(),this.m_texRes.__$detachRes(this.m_texList[t].getResUid()),this.m_gtexList[t]=null;this.m_texTotal=0,this.m_texList=null,this.m_texRes=null}static Create(t,e,s){let i=e.length;if(i>0&&s>0){if(i<s)throw Error("There are fewer textures than in the shader : (need "+s+",but only have "+i+") !!!");let a=31,n=0,l=!0;while(n<s)a=131*a+e[n].getUid(),e[n].isDirect()||(l=!1),++n;let h=r.s_troMaps[t.getRCUid()],_=null;if(h.has(a))_=h.get(a);else{const i=r.s_freeTROList;_=i.length<1?new r(t.getRCUid(),a):i.pop(),_.collectTexList(t,e,s),h.set(a,_)}return _.__$setParam(t.getRCUid(),a),_.direct=l,_}return null}static Restore(t){t.getMid()>-1&&(r.s_troMaps[t.getRCUid()].delete(t.getMid()),t.__$setParam(0,0),r.s_freeTROList.push(t),t.reset())}static GetByMid(t,e){return r.s_troMaps[t].get(e)}static Clear(t){let e=r.s_troMaps;e[t].clear()}}r.s_uid=0,r.s_troMaps=[new Map,new Map,new Map,new Map,new Map,new Map,new Map,new Map],r.s_freeTROList=[],r.s_unloacked=!0,r.s_preMid=-1,e.TextureRenderObj=r;class a{constructor(t){this.m_texRes=null,this.m_texRes=t}run(){this.m_texRes.renderBegin()}getMid(){return 1}__$attachThis(){}__$detachThis(){}}e.EmptyTexRenderObj=a,e.default=r},b0ef:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.m_canvas=null,this.m_div=null,this.m_divW=-1,this.m_divH=-1,this.resized=!0}setDiv(t){this.m_div=t}getCSSHEXRGB(t,e,s){let i="#",r=Math.floor(255*t);return i+=r<15?"0"+r.toString(16):""+r.toString(16),r=Math.floor(255*e),i+=r<15?"0"+r.toString(16):""+r.toString(16),r=Math.floor(255*s),i+=r<15?"0"+r.toString(16):""+r.toString(16),i}createViewEle(t,e,s,i,r,a){null==this.m_div&&(this.m_div=document.getElementById("voxEngineDiv")),null==this.m_div&&(this.m_div=t.createElement("div"),r&&document.body.appendChild(this.m_div));const n=this.m_div.style;n.display="bolck",n.position="absolute",""==n.left&&(n.left="0px",n.top="0px"),e?(n.width="100%",n.height="100%"):(this.m_div.style.width=s+"px",this.m_div.style.height=i+"px"),null==this.m_canvas&&(this.m_canvas=document.createElement("canvas"),this.m_div.appendChild(this.m_canvas),a?(this.m_canvas.width=s,this.m_canvas.height=i):(this.m_canvas.width=800,this.m_canvas.height=600),this.m_canvas.style.display="bolck",this.m_canvas.style.left="0px",this.m_canvas.style.top="0px",this.m_canvas.style.position="absolute")}setDivStyleLeftAndTop(t,e){this.m_div.style.left=t+"px",this.m_div.style.top=e+"px"}setDivStyleSize(t,e){this.m_divW==t&&this.m_divH==e||(this.m_div.style.width=t+"px",this.m_div.style.height=e+"px",this.resized=!0)}getDiv(){return this.m_div}getCanvas(){return this.m_canvas}setCanvas(t){t&&this.m_canvas!=t&&(this.m_div.removeChild(this.m_canvas),this.m_canvas=t,this.m_div.appendChild(this.m_canvas))}}e.default=i},b30a:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("644c"));class a{constructor(t,e,s,i){this.m_sharedUniformList=[],this.m_unlocked=!0,this.m_texUnlocked=!1,this.m_preuid=-1,this.m_currShd=null,this.m_fragOutputTotal=1,this.m_rcuid=-1,this.m_rc=null,this.m_gpuProgram=null,this.m_adapter=null,this.m_guniform=null,this.m_uniform=null,this.m_trsu=null,this.m_shdPB=null,this.drawFlag=-1,this.__$globalUniform=null,this.m_rcuid=t,this.m_rc=e,this.m_adapter=s,this.m_shdPB=i}createResByParams3(t,e,s,i){return!1}setGLCtx(t){this.m_rc=t,this.m_sharedUniformList=[]}getRC(){return this.m_rc}getGPUProgram(){return this.m_gpuProgram}getRCUid(){return this.m_rcuid}useTransUniform(t){this.m_trsu!=t&&(this.m_trsu=t,t.use(this))}useUniform(t){this.m_uniform!=t&&(this.m_uniform=t,t.use(this))}updateUniform(t){null!=t&&t.use(this)}unlock(){this.m_unlocked=!0,this.__$globalUniform=null}isUnLocked(){return this.m_unlocked}lock(){this.m_unlocked=!1}textureUnlock(){this.m_texUnlocked=!0}isTextureUnLocked(){return this.m_texUnlocked}textureLock(){this.m_texUnlocked=!1}setSharedUniformByShd(t,e){this.m_sharedUniformList[t.getUid()]=e}getSharedUniformByShd(t){return this.m_sharedUniformList[t.getUid()]}getCurrFragOutputTotal(){return this.m_fragOutputTotal}hasResUid(t){return this.m_shdPB.hasUid(t)}bindToGpu(t){if(this.m_unlocked&&this.m_shdPB.containsUid(t))if(this.m_preuid!=t){this.m_preuid=t;let e=this.m_shdPB.findShdProgramByUid(t);this.m_fragOutputTotal=e.getFragOutputTotal(),this.m_fragOutputTotal,this.getActiveAttachmentTotal(),this.m_gpuProgram=e.getGPUProgram(),this.m_rc.useProgram(this.m_gpuProgram),e.useTexLocation();let s=this.m_sharedUniformList[e.getUid()];this.m_guniform=s;while(null!=s)s.use(this),s=s.next;this.m_currShd=e}else if(null==this.m_guniform&&null!=this.m_currShd){let t=this.m_sharedUniformList[this.m_currShd.getUid()];this.m_guniform=t;while(null!=t)t.use(this),t=t.next}}getGpuBuffer(t){return null}getCurrentShd(){return this.m_currShd}getCurrentShdUid(){return this.m_preuid}resetTransUniform(){this.m_trsu=null}resetUniform(){this.m_uniform=null,this.m_trsu=null,this.m_guniform=null}resetRenderState(){this.drawFlag=-1}renderBegin(){this.m_fragOutputTotal=1,this.m_preuid=-1,this.m_currShd=null,this.drawFlag=-1}update(){}destroy(){this.m_rc=null,this.m_adapter=null}useUniformToCurrentShd(t){this.m_uniform!=t&&(this.m_uniform,t.useByShd(this,this.m_currShd))}useUniform2ToCurrentShd(t,e){this.m_uniform!=t&&(this.m_uniform,t.useByShd(this,this.m_currShd)),this.m_trsu!=e&&(this.m_trsu,e.useByShd(this,this.m_currShd))}useUniformMat4(t,e){this.m_rc.uniformMatrix4fv(t,!1,e)}useUniformV2(t,e,s,i,a){const n=r.default,l=this.m_rc;switch(e){case n.SHADER_MAT4:l.uniformMatrix4fv(t,!1,s,a,16*i);break;case n.SHADER_MAT3:l.uniformMatrix3fv(t,!1,s,0,9*i);break;case n.SHADER_VEC4FV:l.uniform4fv(t,s,a,4*i);break;case n.SHADER_VEC3FV:l.uniform3fv(t,s,a,3*i);break;case n.SHADER_VEC4:l.uniform4f(t,s[0],s[1],s[2],s[3]);break;case n.SHADER_VEC3:l.uniform3f(t,s[0],s[1],s[2]);break;case n.SHADER_VEC2:l.uniform2f(t,s[0],s[1]);break;default:break}}useUniformV1(t,e,s,i){const a=r.default,n=this.m_rc;switch(e){case a.SHADER_MAT4:n.uniformMatrix4fv(t,!1,s);break;case a.SHADER_MAT3:n.uniformMatrix3fv(t,!1,s);break;case a.SHADER_VEC4FV:n.uniform4fv(t,s,4*i);break;case a.SHADER_VEC3FV:n.uniform3fv(t,s,3*i);break;case a.SHADER_VEC4:n.uniform4f(t,s[0],s[1],s[2],s[3]);break;case a.SHADER_VEC3:n.uniform3f(t,s[0],s[1],s[2]);break;case a.SHADER_VEC2:n.uniform2f(t,s[0],s[1]);break;default:break}}getActiveAttachmentTotal(){return this.m_adapter.getActiveAttachmentTotal()}}e.default=a},baae:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.FRAMEBUFFER=71,i.DRAW_FRAMEBUFFER=72,i.READ_FRAMEBUFFER=73,e.default=i},c62b:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("e08e"),r=s("070b"),a=s("a5ba");class n{constructor(){this.rentity=null,this.retype=0,this.uid=-1,this.value=-1,this.__$rpuid=-1,this.__$rprouid=-1,this.shader=null,this.pos=null,this.bounds=null,this.partTotal=0,this.partGroup=null,this.visible=!0,this.drawing=!0,this.rendering=!0,this.renderState=0,this.rcolorMask=0,this.drawFlag=0,this.vro=null,this.transUniform=null,this.uniform=null,this.shdUid=-1,this.vtxUid=-1,this.tro=null,this.texMid=-1,this.ubo=null,this.polygonOffset=null,this.rdp=null,this.vdrInfo=null,this.rgraph=null,this.m_ver=0}testDrawFlag(){this.drawFlag=(this.rcolorMask<<10)+this.renderState,this.shader.drawFlag!=this.drawFlag&&(this.shader.drawFlag=this.drawFlag,a.RenderStateObject.UseRenderState(this.renderState),r.RenderColorMask.UseRenderState(this.rcolorMask))}copyMaterialFrom(t){this.tro=t.tro,this.uniform=t.uniform,this.ubo=t.ubo,this.texMid=t.texMid,this.shdUid=t.shdUid,this.transUniform=t.transUniform}applyShader(t=!1){this.shader.bindToGpu(this.shdUid),t&&this.shader.resetUniform()}getUid(){return this.uid}getRPOUid(){return this.__$rpuid}getRPROUid(){return this.__$rprouid}getShaderUid(){return this.shdUid}setIvsParam(t,e){throw Error("illegal operation !!!")}testVisible(){if(!this.rdp.rd)throw Error("illegal operation !!!");this.drawing=this.visible&&this.rdp.rd.ivsSize>0}setVisible(t){this.visible=t,this.testVisible()}setDrawFlag(t,e){this.renderState=t,this.rcolorMask=e,this.drawFlag=(this.rcolorMask<<10)+this.renderState}updateVtx(){if(this.vdrInfo.isUnlock()){const t=this.rdp;t.ver=this.m_ver;const e=this.vdrInfo.__$$copyToRDP(t);return this.m_ver=t.ver,t.ver=0,this.testVisible(),e}return!1}draw(t){throw Error("illegal operation !!!")}__$$drawThis(t){const e=t.status;e.drawCallTimes++;const s=t.RContext,r=this.rdp.rd;e.drawTrisNumber+=r.trisNumber;let a=r.ivsSize;switch(null!=this.polygonOffset?t.setPolygonOffset(this.polygonOffset[0],this.polygonOffset[1]):t.resetPolygonOffset(),r.drawMode){case i.RenderDrawMode.ELEMENTS_TRIANGLES:case i.RenderDrawMode.ELEMENTS_LINES:case i.RenderDrawMode.ELEMENTS_TRIANGLE_STRIP:case i.RenderDrawMode.ELEMENTS_LINES_STRIP:s.drawElements(r.gldm,a,r.bufType,r.ivsOffset);break;case i.RenderDrawMode.ELEMENTS_INSTANCED_TRIANGLES:case i.RenderDrawMode.ELEMENTS_INSTANCED_LINES:case i.RenderDrawMode.ELEMENTS_INSTANCED_TRIANGLES_STRIP:case i.RenderDrawMode.ELEMENTS_INSTANCED_LINES_STRIP:s.drawElementsInstanced(r.gldm,a,r.bufType,r.ivsOffset,r.insCount);break;case i.RenderDrawMode.ELEMENTS_TRIANGLE_FAN:s.drawElements(t.TRIANGLE_FAN,a,r.bufType,r.ivsOffset);break;case i.RenderDrawMode.ARRAYS_LINES:s.drawArrays(t.LINES,r.ivsIndex,a);break;case i.RenderDrawMode.ARRAYS_LINE_STRIP:s.drawArrays(t.LINE_STRIP,r.ivsIndex,a);break;default:break}}__$$drawPart(t){const e=t.status;e.drawCallTimes++;const s=this.rdp.rd;e.drawTrisNumber+=s.trisNumber;let r=s.ivsSize;null!=this.polygonOffset?t.setPolygonOffset(this.polygonOffset[0],this.polygonOffset[1]):t.resetPolygonOffset();let a=0,n=t.RContext;switch(s.drawMode){case i.RenderDrawMode.ELEMENTS_TRIANGLES:case i.RenderDrawMode.ELEMENTS_LINES:case i.RenderDrawMode.ELEMENTS_TRIANGLE_STRIP:case i.RenderDrawMode.ELEMENTS_LINES_STRIP:for(;a<this.partTotal;)n.drawElements(s.gldm,this.partGroup[a++],s.bufType,this.partGroup[a++]);break;case i.RenderDrawMode.ELEMENTS_INSTANCED_TRIANGLES:case i.RenderDrawMode.ELEMENTS_INSTANCED_LINES:case i.RenderDrawMode.ELEMENTS_INSTANCED_TRIANGLES_STRIP:case i.RenderDrawMode.ELEMENTS_INSTANCED_LINES_STRIP:n.drawElementsInstanced(s.gldm,r,s.bufType,s.ivsOffset,s.insCount);break;case i.RenderDrawMode.ELEMENTS_TRIANGLE_FAN:n.drawElements(t.TRIANGLE_FAN,r,s.bufType,s.ivsOffset);break;case i.RenderDrawMode.ARRAYS_LINES:n.drawArrays(t.LINES,s.ivsIndex,r);break;case i.RenderDrawMode.ARRAYS_LINE_STRIP:n.drawArrays(t.LINE_STRIP,s.ivsIndex,r);break;default:break}}run2(t){null!=this.ubo&&this.ubo.run(t),this.shader.useTransUniform(this.transUniform),this.shader.useUniform(this.uniform),this.testDrawFlag()}run(t){null!=this.ubo&&this.ubo.run(t),this.vro.run(),this.tro.run(),this.shader.useTransUniform(this.transUniform),this.shader.useUniform(this.uniform),this.testDrawFlag()}runLockMaterial2(t){this.testDrawFlag(),this.shader.useUniform2ToCurrentShd(null==t?this.uniform:t,this.transUniform)}runLockMaterial(){this.vro.run(),this.testDrawFlag(),this.shader.useUniform2ToCurrentShd(this.uniform,this.transUniform)}reset(){this.vdrInfo&&(this.indicesRes=null,this.polygonOffset=null,this.vro.__$detachThis(),this.vro=null,this.tro.__$detachThis(),this.tro=null,this.texMid=-1,this.__$rprouid=-1,this.ubo=null,this.shdUid=-1,this.vtxUid=-1,this.uniform=null,this.transUniform=null,this.partGroup=null,this.partTotal=0,this.drawFlag=0,this.renderState=0,this.rcolorMask=0,this.drawing=!0,this.rendering=!0,this.shader=null,this.bounds=null,this.pos=null,this.rdp&&(this.rdp.lifeTime>0&&this.rdp.clear(),this.rdp=null),this.vdrInfo=null,this.rgraph=null,this.rentity=null)}destroy(){this.reset()}}e.default=n},ca6c:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static PushThreeBitValueToInt(t,e){return(t<<3)+e}static PopThreeBitValueFromInt(t){return i.value=7&t,t>>3}static ContainsBit(t,e){return(e&t)>0}static RemoveBit(t,e){return~e&t}static AddBit(t,e){return e|t}static AssembleFromIntArray(t){let e=0,s=t.length;for(let i=0;i<s;++i)t[i]>0&&(e|=1<<i);return e}}i.BIT_ZERO=0,i.BIT_ONE_0=1,i.BIT_ONE_1=2,i.BIT_ONE_2=4,i.BIT_ONE_3=8,i.BIT_ONE_4=16,i.BIT_ONE_5=32,i.BIT_ONE_6=64,i.BIT_ONE_7=128,i.BIT_ONE_8=256,i.BIT_ONE_9=512,i.BIT_ONE_10=1024,i.BIT_ONE_11=2048,i.value=0,e.default=i},d53d:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.uns="",this.key=-1,this.program=null,this.types=null,this.uniformSize=0,this.uniformNameList=null,this.locations=null,this.dataSizeList=null,this.dataList=null,this.calcModels=null,this.always=!0,this.next=null}getDataRefFromUniformName(t){if(null!=this.uniformNameList){let e=this.uniformNameList,s=e.length;for(let i=0;i<s;++i)if(t==e[i])return this.dataList[i]}return null}setDataRefFromUniformName(t,e){if(null!=this.uniformNameList){let s=this.uniformNameList,i=s.length;for(let r=0;r<i;++r)if(t==s[r]){this.dataList[r]=e;break}}}copyDataFromProbe(t){this.types=[],this.dataSizeList=[];for(let e=0;e<t.uniformsTotal;++e)this.types.push(t.uniformTypes[e]),this.dataSizeList.push(t.dataSizeList[e]);this.uniformSize=t.uniformsTotal}useByLocation(t,e,s,i){}useByShd(t,e){}use(t){}updateData(){}destroy(){}}e.ShaderUniform=i;class r extends i{constructor(){super()}use(t){let e=0;for(;e<this.uniformSize;++e)t.useUniformV1(this.locations[e],this.types[e],this.dataList[e],this.dataSizeList[e])}useByLocation(t,e,s,i){t.useUniformV1(s,e,this.dataList[i],this.dataSizeList[i])}useByShd(t,e){let s=0;for(;s<this.uniformSize;++s)t.useUniformV1(e.getUniformLocationByNS(this.uniformNameList[s]),this.types[s],this.dataList[s],this.dataSizeList[s])}updateData(){if(null!=this.calcModels){let t=this.calcModels.length,e=null;for(let s=0;s<t;++s)e=this.calcModels[s],e.buildData(),e.updateMaterialDataList(this.dataList),e.initializeParam()}}destroy(){let t=0,e=this.dataList.length;for(;t<e;++t)this.dataList[t]=null;if(null!=this.calcModels)for(e=this.calcModels.length,t=0;t<e;++t)this.calcModels[t].destroy(),this.calcModels[t]=null;this.dataList=null,this.types=null,this.locations=null,this.dataSizeList=null,this.calcModels=null}}e.ShaderUniformV1=r;class a extends i{constructor(){super()}use(t){let e=0;for(;e<this.uniformSize;++e)t.useUniformV2(this.locations[e],this.types[e],this.dataList[e],this.dataSizeList[e],0)}useByLocation(t,e,s,i){t.useUniformV2(s,e,this.dataList[i],this.dataSizeList[i],0)}useByShd(t,e){let s=0;for(;s<this.uniformSize;++s)t.useUniformV2(e.getUniformLocationByNS(this.uniformNameList[s]),this.types[s],this.dataList[s],this.dataSizeList[s],0)}updateData(){if(null!=this.calcModels){let t=this.calcModels.length,e=null;for(let s=0;s<t;++s)e=this.calcModels[s],e.buildData(),e.updateMaterialDataList(this.dataList),e.initializeParam()}}destroy(){let t=0,e=this.dataList.length;for(;t<e;++t)this.dataList[t]=null;if(null!=this.calcModels)for(e=this.calcModels.length,t=0;t<e;++t)this.calcModels[t].destroy(),this.calcModels[t]=null;this.dataList=null,this.types=null,this.locations=null,this.dataSizeList=null,this.calcModels=null,this.program=null}}e.ShaderUniformV2=a;class n extends i{constructor(){super()}use(t){t.useUniformMat4(this.locations[0],this.dataList[0])}useByLocation(t,e,s,i){t.useUniformMat4(s,this.dataList[0])}useByShd(t,e){t.useUniformMat4(e.getUniformLocationByNS(this.uniformNameList[0]),this.dataList[0])}destroy(){this.dataList[0]=null,this.dataList=null,this.types=null,this.locations=null,this.dataSizeList=null}}e.ShaderMat4Uniform=n,e.default=i},d872:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("5326"),a=i(s("3077")),n=i(s("3024")),l=i(s("7279"));class h{constructor(t,e=256){this.m_rcuid=0,this.m_udSlot=null,this.m_rcuid=t,this.m_udSlot=new r.UniformDataSlot(t,e)}getRCUid(){return this.m_rcuid}createShaderUniformProbe(){let t=new a.default(this.m_udSlot);return t}createUniformVec4Probe(t){let e=new n.default(this.m_udSlot,t);return e}createGlobalUinformFromProbe(t,e=null){let s=this.createShaderGlobalUniform();return this.updateGlobalUinformDataFromProbe(s,t,e),s}updateGlobalUinformDataFromProbe(t,e,s=null){let i=t;i.uniformNameList=null!=s?s:e.uniformNames,i.copyDataFromProbe(e),e.update()}createShaderGlobalUniform(){let t=new l.default(this.m_udSlot);return t}createShaderGlobalUniformFromProbe(t,e,s=null){let i=new l.default(this.m_udSlot);return i.uns=e,i.uniformNameList=null!=s?s:t.uniformNames,i.copyDataFromProbe(t),t.update(),i}createShaderGlobalUniformFromProbeAt(t,e,s=null,i){let r=new l.default(this.m_udSlot);return r.uns=e,r.uniformNameList=null!=s?s:t.uniformNames,i<0?r.copyDataFromProbe(t):r.copyDataFromProbeAt(i,t),t.update(),r}cloneShaderGlobalUniform(t){let e=t;return e.clone()}}e.ShaderUniformContext=h},d958:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("11e6")),a=s("d872"),n=i(s("36cb")),l=i(s("3c81")),h=i(s("1e15")),_=s("0e01"),o=s("eca0"),d=i(s("442e")),u=i(s("1264"));class m{constructor(){this.___$$$$$$$Author="VilyLei(vily313@126.com)",this.m_uid=-1,this.m_entity3DMana=null,this.m_processes=[],this.m_processesLen=0,this.m_sprocesses=[],this.m_sprocessesLen=0,this.m_renderProxy=null,this.m_adapter=null,this.m_dataBuilder=null,this.m_renderInsContext=null,this.m_batchEnabled=!0,this.m_processFixedState=!0,this.m_rpoUnitBuilder=new o.RPOUnitBuilder,this.m_rpoNodeBuilder=new d.default,this.m_processBuider=new l.default,this.m_roVtxBuilder=null,this.m_stage3D=null,this.m_fixProcess=null,this.textureBlock=null,this.m_shdProgramBuider=null,this.m_uid=m.s_uid++,this.m_renderInsContext=new _.RendererInstanceContext(this.m_uid)}__$setStage3D(t){null!=t&&null==this.m_stage3D&&(this.m_stage3D=t)}getUid(){return this.m_uid}getRCUid(){return this.m_uid}getRPONodeBuilder(){return this.m_rpoNodeBuilder}getDataBuilder(){return this.m_dataBuilder}getRendererContext(){return this.m_renderInsContext}getRenderProxy(){return null!=this.m_renderProxy||(this.m_renderProxy=this.m_renderInsContext.getRenderProxy()),this.m_renderProxy}getStage3D(){return this.m_renderProxy.getStage3D()}getViewX(){return this.m_adapter.getViewportX()}getViewY(){return this.m_adapter.getViewportY()}getViewWidth(){return this.m_adapter.getViewportWidth()}getViewHeight(){return this.m_adapter.getViewportHeight()}getCamera(){return this.m_renderInsContext.getCamera()}createCamera(){return null}useCamera(t,e=!1){}useMainCamera(){}updateCamera(){null!=this.m_renderProxy&&this.m_renderProxy.updateCamera()}setCanvas(t){return!!this.m_renderProxy.setCanvas(t)&&(this.m_shdProgramBuider.clear(),this.m_dataBuilder.setGLCtx(this.m_renderProxy.RContext),!0)}initialize(t=null,e=null,s=null){if(null==this.m_dataBuilder&&null!=e){this.m_batchEnabled=t.batchEnabled,this.m_processFixedState=t.processFixedState,this.m_renderProxy=this.m_renderInsContext.getRenderProxy(),this.m_uid=this.m_renderProxy.getUid(),this.m_shdProgramBuider=s,this.m_dataBuilder=new n.default(s),this.m_roVtxBuilder=new h.default,this.m_renderInsContext.setCameraParam(t.camProjParam.x,t.camProjParam.y,t.camProjParam.z);let i=new _.RendererInstanceContextParam;i.uniformContext=new a.ShaderUniformContext(this.m_renderProxy.getRCUid()),i.camera=e,i.stage=this.m_stage3D,i.builder=this.m_dataBuilder,i.vtxBuilder=this.m_roVtxBuilder,i.shaderProgramBuilder=s,this.m_renderInsContext.initialize(t,e,i),this.m_adapter=this.m_renderProxy.getRenderAdapter(),this.m_dataBuilder.initialize(this.m_renderProxy,this.m_rpoUnitBuilder,this.m_processBuider,this.m_roVtxBuilder),this.m_renderInsContext.initManager(this.m_dataBuilder),this.m_entity3DMana=new u.default(this.m_uid,this.m_dataBuilder,this.m_rpoUnitBuilder,this.m_processBuider),this.m_fixProcess=this.createSeparatedProcess(),this.appendProcess(this.m_batchEnabled,this.m_processFixedState)}}getRendererStatus(){return this.m_entity3DMana.version}update(){this.m_renderProxy.Texture.update(),this.m_renderProxy.Vertex.update(),this.m_entity3DMana.update()}updateAllProcess(){for(let t=0;t<this.m_processesLen;++t)this.m_processes[t].update()}updateProcessAt(t){t>-1&&t<this.m_processesLen&&this.m_processes[t].update()}setEntityManaListener(t){this.m_entity3DMana.setListener(t)}addContainer(t,e=0){t&&e>-1&&e<this.m_processesLen&&this.m_entity3DMana.addContainer(t,this.m_processes[e].getUid())}removeContainer(t,e=0){t&&e>-1&&e<this.m_processesLen&&this.m_entity3DMana.removeContainer(t,this.m_processes[e].getUid())}addEntity(t,e=0,s=!0){t&&t.__$testRendererEnabled()&&e>-1&&e<this.m_processesLen&&this.m_entity3DMana.addEntity(t,this.m_processes[e].getUid(),s)}addEntityToProcess(t,e,s=!0){e&&t&&t.__$testRendererEnabled()&&e.getRCUid()==this.m_uid&&this.m_entity3DMana.addEntity(t,e.getUid(),s)}moveEntityToProcessAt(t,e){if(t&&t.getRendererUid()==this.m_uid&&t.isInRendererProcess()&&e>-1&&e<this.m_processesLen){let s=t.getDisplay().__$$runit.getRPROUid(),i=this.m_processBuider.getNodeByUid(s),a=this.m_processes[e];i!=a&&(i.removeDispUnit(t.getDisplay()),t.__$rseFlag=a.getSortEnabled()?r.default.AddSortEnabled(t.__$rseFlag):r.default.RemoveSortEnabled(t.__$rseFlag),a.addDisp(t.getDisplay()))}}moveEntityToProcess(t,e){if(e&&t&&t.getRendererUid()==this.m_uid&&t.isInRendererProcess()){let s=t.getDisplay().__$$runit.getRPROUid(),i=this.m_processBuider.getNodeByUid(s);if(i!=e){let s=e;i.removeDispUnit(t.getDisplay()),t.__$rseFlag=e.getSortEnabled()?r.default.AddSortEnabled(t.__$rseFlag):r.default.RemoveSortEnabled(t.__$rseFlag),s.addDisp(t.getDisplay())}}}removeEntity(t){t&&t.getRendererUid()==this.m_uid&&(this.m_entity3DMana.removeEntity(t),t.__$setRenderProxy(null))}removeEntityFromProcess(t,e){e&&e.getRCUid()==this.m_uid&&t&&t.getRendererUid()==this.m_uid&&(e.removeDisp(t.getDisplay()),t.__$setRenderProxy(null))}removeEntityByProcessIndex(t,e){e>=0&&e<this.m_processesLen&&t&&t.getRendererUid()==this.m_uid&&(this.m_processes[e].removeDisp(t.getDisplay()),t.__$setRenderProxy(null))}setProcessSortEnabledAt(t,e){t>=0&&t<this.m_processesLen&&this.m_processes[t].setSortEnabled(e)}setProcessSortEnabled(t,e){t&&t.getRCUid()==this.m_uid&&t.setSortEnabled(e)}getRenderProcessAt(t){return this.m_processes[t]}appendProcess(t=!0,e=!1){this.m_processBuider.setCreateParams(this.m_dataBuilder.getRenderShader(),this.m_rpoNodeBuilder,this.m_rpoUnitBuilder,this.m_renderProxy.Vertex,t,e);let s=this.m_processBuider.create();return this.m_processes.push(s),s.setRendererParam(this.m_renderProxy,this.m_processesLen),++this.m_processesLen,s}createSeparatedProcess(t=!0,e=!1){this.m_processBuider.setCreateParams(this.m_dataBuilder.getRenderShader(),this.m_rpoNodeBuilder,this.m_rpoUnitBuilder,this.m_renderProxy.Vertex,t,e);let s=this.m_processBuider.create();return this.m_sprocesses.push(s),s.setRendererParam(this.m_renderProxy,this.m_sprocessesLen),s}setRendererProcessParam(t,e,s){t>-1&&t<this.m_processesLen&&this.m_processes[t].setRenderParam(e,s)}setProcessEnabledAt(t,e){t>-1&&t<this.m_processesLen&&this.m_processes[t].setEnabled(e)}getProcessAt(t){return t>-1&&t<this.m_processesLen?this.m_processes[t]:null}showInfoAt(t){t>-1&&t<this.m_processesLen&&this.m_processes[t].showInfo()}getProcessesTotal(){return this.m_processesLen}updateMaterialUniformToCurrentShd(t){this.m_dataBuilder.getRenderShader().useUniformToCurrentShd(t.__$uniform)}drawEntity(t,e=!1,s=!0){t&&t.getVisible()&&!this.m_renderProxy.isContextLost()&&(t.getRendererUid()==this.m_uid?this.m_fixProcess.drawDisp(t.getDisplay(),e,s):t.__$testRendererEnabled()&&this.m_entity3DMana.addEntity(t,this.m_fixProcess.getUid(),!1))}runAt(t){this.m_renderProxy.isContextLost()||this.m_processes[t].run()}runProcess(t){t.getRCUid()!=this.m_uid||this.m_renderProxy.isContextLost()||t.run()}runFromIndexTo(t){if(!this.m_renderProxy.isContextLost())for(let e=t;e<this.m_processesLen;++e)this.m_processes[e].run()}run(){if(this.m_entity3DMana.isHaveEntity()&&!this.m_renderProxy.isContextLost())for(let t=0;t<this.m_processesLen;++t)this.m_processes[t].run()}getRenderUnitsTotal(){let t=0;for(let e=0;e<this.m_processesLen;++e)t+=this.m_processes[e].getUnitsTotal();return t}renderflush(){this.m_renderProxy.flush()}prependRenderNode(t){}appendRenderNode(t){}removeRenderNode(t){}}m.s_uid=0,e.RendererInstance=m,e.default=m},de9d:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("e2fe")),a=i(s("722e")),n=i(s("8333")),l=s("e7f2"),h=s("070b"),_=s("a5ba"),o=i(s("090c")),d=i(s("1216")),u=i(s("56c5")),m=i(s("030e")),c=i(s("74c3")),f=i(s("984e")),p=i(s("e035")),R=i(s("29ef")),E=s("a4f8"),g=i(s("919c")),T=s("e602"),S=s("53d3"),b=s("9f82");class A{constructor(){this.materialUpdater=null,this.vtxBufUpdater=null,this.vtxBuilder=null,this.uniformContext=null}}e.RenderProxyParam=A;class L{constructor(t){this.RGBA=0,this.UNSIGNED_BYTE=0,this.TRIANGLE_STRIP=0,this.TRIANGLE_FAN=0,this.TRIANGLES=0,this.LINES=0,this.LINE_STRIP=0,this.UNSIGNED_SHORT=0,this.UNSIGNED_INT=0,this.COLOR=0,this.DEPTH=0,this.STENCIL=0,this.DEPTH_STENCIL=0,this.MAX=0,this.MIN=0,this.RContext=null,this.RDrawState=null,this.Vertex=null,this.Texture=null,this.VtxBufUpdater=null,this.MaterialUpdater=null,this.uniformContext=null,this.adapter=null,this.stencil=null,this.renderingState=null,this.colorMask=null,this.rshader=null,this.rdataBuilder=null,this.status=new b.RPStatus,this.m_uid=0,this.m_camUBO=null,this.m_adapter=null,this.m_actx=new o.default,this.m_rc=null,this.m_perspectiveEnabled=!0,this.m_viewPortRect=new r.default(0,0,800,600),this.m_cameraNear=.1,this.m_cameraFar=5e3,this.m_cameraFov=45,this.m_maxWebGLVersion=2,this.m_WEBGL_VER=2,this.m_cam=null,this.m_camSwitched=!1,this.m_autoSynViewAndStage=!0,this.m_initMainCamera=!0,this.m_uid=t}applyStencil(t){t.apply(this.RDrawState)}getRC(){return this.m_rc}getUid(){return this.m_uid}getRCUid(){return this.m_uid}isAutoSynViewAndStage(){return this.m_autoSynViewAndStage}enableSynViewAndStage(){this.m_autoSynViewAndStage=!0}lockViewport(){this.m_adapter.lockViewport()}unlockViewport(){this.m_adapter.unlockViewport()}getDiv(){return this.m_adapter.getDiv()}getCanvas(){return this.m_adapter.getCanvas()}cameraLock(){this.m_cam.lock()}cameraUnlock(){this.m_cam.unlock()}getCamera(){return this.m_cam}updateCamera(){return this.m_cam.update()}createCameraUBO(t){}updateCameraDataFromCamera(t){null!=t&&(this.m_camSwitched||t!=this.m_cam)&&(this.m_camSwitched=t!=this.m_cam,t.updateCamMatToUProbe(this.m_cam.matUProbe),null!=this.m_camUBO&&(this.m_camUBO.setSubDataArrAt(0,t.matUProbe.getFS32At(0)),this.m_camUBO.setSubDataArrAt(16,t.matUProbe.getFS32At(1))))}useCameraData(){null!=this.m_camUBO&&this.m_camUBO.run()}getActiveAttachmentTotal(){return this.m_adapter.getActiveAttachmentTotal()}drawInstanced(t,e,s){this.isWebGL2()?this.m_rc.drawElementsInstanced(this.TRIANGLES,t,this.UNSIGNED_SHORT,e,s):m.default.ANGLE_instanced_arrays.drawElementsInstancedANGLE(this.TRIANGLES,t,e,s)}createUBOBufferByBytesCount(t){let e=this.m_rc.createBuffer();return this.m_rc.bindBuffer(this.m_rc.UNIFORM_BUFFER,e),this.m_rc.bufferData(this.m_rc.UNIFORM_BUFFER,t,this.m_rc.DYNAMIC_DRAW),e}createUBOBufferByDataArray(t){let e=this.m_rc.createBuffer();return this.m_rc.bindBuffer(this.m_rc.UNIFORM_BUFFER,e),this.m_rc.bufferData(this.m_rc.UNIFORM_BUFFER,t,this.m_rc.DYNAMIC_DRAW),e}bindUBOBuffer(t){this.m_rc.bindBuffer(this.m_rc.UNIFORM_BUFFER,t)}deleteUBOBuffer(t){this.m_rc.deleteBuffer(t)}bufferDataUBOBuffer(t){this.m_rc.bufferData(this.m_rc.UNIFORM_BUFFER,t,this.m_rc.STATIC_DRAW)}bindBufferBaseUBOBuffer(t,e){this.m_rc.bindBufferBase(this.m_rc.UNIFORM_BUFFER,t,e)}setWebGLMaxVersion(t){1!=t&&2!=t||(this.m_maxWebGLVersion=t)}getContext(){return this.m_actx}getStage3D(){return this.m_actx.getStage()}getRenderAdapter(){return this.m_adapter}getRenderContext(){return this.m_adapter.getRenderContext()}setCameraParam(t,e,s){this.m_cameraFov=t,this.m_cameraNear=e,this.m_cameraFar=s}getMouseXYWorldRay(t,e){let s=this.m_actx.getStage();this.m_cam.getWorldPickingRayByScreenXY(s.mouseX,s.mouseY,t,e)}testViewPortChanged(t,e,s,i){return this.m_viewPortRect.testEqualWithParams(t,e,s,i)}testRCViewPortChanged(t,e,s,i){return this.m_actx.testViewPortChanged(t,e,s,i)}getDevicePixelRatio(){return this.adapter.getDevicePixelRatio()}getViewX(){return this.m_viewPortRect.x}getViewY(){return this.m_viewPortRect.y}getViewWidth(){return this.m_viewPortRect.width}getViewHeight(){return this.m_viewPortRect.height}setViewPort(t,e,s,i){this.m_autoSynViewAndStage=!1,this.m_viewPortRect.setTo(t,e,s,i);let r=this.m_actx.getStage();r&&(r.setViewPort(s,e,s,i),this.updateCameraView()),this.m_actx.setViewport(t,e,s,i)}setRCViewPort(t,e,s,i,r=!1){this.m_autoSynViewAndStage=r,this.m_actx.setViewport(t,e,s,i)}reseizeRCViewPort(){this.m_adapter.unlockViewport(),this.m_adapter.reseizeViewPort()}updateCameraView(){if(this.m_cam){let t=this.m_viewPortRect;this.m_cam.setViewXY(t.x,t.y),this.m_cam.setViewSize(t.width,t.height)}}resizeCallback(){if(this.m_autoSynViewAndStage){let t=this.m_viewPortRect;t.setSize(this.m_actx.getRCanvasWidth(),this.m_actx.getRCanvasHeight()),this.createMainCamera(),this.m_actx.setViewport(t.x,t.y,t.width,t.height),this.updateCameraView()}}createMainCamera(){if(this.m_initMainCamera){this.m_initMainCamera=!1,this.m_cam.uniformEnabled=!0;let t=this.m_viewPortRect;this.m_perspectiveEnabled?this.m_cam.perspectiveRH(Math.PI*this.m_cameraFov/180,t.width/t.height,this.m_cameraNear,this.m_cameraFar):this.m_cam.orthoRH(this.m_cameraNear,this.m_cameraFar,-.5*t.height,.5*t.height,-.5*t.width,.5*t.width),this.updateCameraView()}}readPixels(t,e,s,i,r,a,n){this.m_adapter.readPixels(t,e,s,i,r,a,n)}getGLVersion(){return this.m_WEBGL_VER}isWebGL2(){return 2==this.m_WEBGL_VER}isWebGL1(){return 1==this.m_WEBGL_VER}buildCameraParam(){let t=this.m_cam;null==t.matUProbe&&(t.matUProbe=this.uniformContext.createShaderUniformProbe(),t.matUProbe.addMat4Data(new Float32Array(16),1),t.matUProbe.addMat4Data(new Float32Array(16),1)),null==t.ufrustumProbe&&(t.ufrustumProbe=this.uniformContext.createShaderUniformProbe(),t.ufrustumProbe.addVec4Data(new Float32Array([t.getZNear(),t.getZFar(),.5*t.getNearPlaneWidth(),.5*t.getNearPlaneHeight()]),1)),null==t.ucameraPosProbe&&(t.ucameraPosProbe=this.uniformContext.createShaderUniformProbe(),t.ucameraPosProbe.addVec4Data(new Float32Array([500,500,500,1]),1))}setCanvas(t){if(this.m_actx.setCanvas(t)){this.m_rc=this.m_actx.getRC();let t=this.m_rc,e=this;return e.adapter.updateGLCtx(),e.Vertex.setGLCtx(t),e.Texture.setGLCtx(t),e.rshader.setGLCtx(t),e.rshader.renderBegin(),e.RDrawState.updateGLCtx(),e.RContext=this.m_rc,!0}return!1}initialize(t,e,s,i){if(null!=this.m_rc)return;this.m_cam=e;let r=t.camPosition,h=t.camLookAtPos,_=t.camUpDirect;null!=s&&(s.uProbe=i.uniformContext.createUniformVec4Probe(1)),this.m_perspectiveEnabled=t.cameraPerspectiveEnabled,this.m_actx.autoSyncRenderBufferAndWindowSize=t.autoSyncRenderBufferAndWindowSize,this.m_actx.offscreenRenderEnabled=t.offscreenRenderEnabled,this.m_actx.setResizeCallback(()=>{this.resizeCallback()}),this.m_actx.setWebGLMaxVersion(this.m_maxWebGLVersion),this.m_actx.initialize(this.m_uid,s,t),this.m_WEBGL_VER=this.m_actx.getWebGLVersion(),this.m_rc=this.m_actx.getRC();let o=this,b=this.m_rc,A=new c.default(this.m_uid,b,i.vtxBuilder),L=new f.default(this.m_uid,b);this.m_vtxRes=A,o.Vertex=A,o.Texture=L,o.MaterialUpdater=i.materialUpdater,o.VtxBufUpdater=i.vtxBufUpdater,o.uniformContext=i.uniformContext;let x=new l.RODrawState;x.setRenderContext(this.m_actx);let B=R.default;(new p.default).initialize(B,x,new g.default),o.RDrawState=x,o.RContext=this.m_rc,o.stencil=new E.RenderingStencil(x),o.renderingState=new S.RenderingState(R.default),o.colorMask=new T.RenderingColorMask(R.default),this.buildCameraParam();let M=this.m_viewPortRect;if(M.setSize(this.m_actx.getRCanvasWidth(),this.m_actx.getRCanvasHeight()),this.m_adapter=new d.default(this.m_uid,L),this.m_adapter.initialize(this.m_actx,t,x,this.uniformContext.createUniformVec4Probe(1)),o.adapter=this.m_adapter,this.m_autoSynViewAndStage){let t=this.m_actx.getStage();null!=t&&M.setSize(M.width,M.height)}this.createMainCamera(),this.m_actx.setViewport(M.x,M.y,M.width,M.height),this.m_cam.lookAtRH(r,h,_),this.m_cam.update(),o.RGBA=b.RGBA,o.UNSIGNED_BYTE=b.UNSIGNED_BYTE,o.TRIANGLE_STRIP=b.TRIANGLE_STRIP,o.TRIANGLE_FAN=b.TRIANGLE_FAN,o.TRIANGLES=b.TRIANGLES,o.LINES=this.m_rc.LINES,o.LINE_STRIP=b.LINE_STRIP,o.UNSIGNED_SHORT=b.UNSIGNED_SHORT,o.UNSIGNED_INT=b.UNSIGNED_INT,o.COLOR=b.COLOR,o.DEPTH=b.DEPTH,o.STENCIL=b.STENCIL,o.DEPTH_STENCIL=b.DEPTH_STENCIL,this.m_WEBGL_VER>1?(o.MIN=b.MIN,o.MAX=b.MAX):(o.MIN=m.default.EXT_blend_minmax.MIN_EXT,o.MAX=m.default.EXT_blend_minmax.MAX_EXT);let N=a.default;N.NEAREST=b.NEAREST,N.LINEAR=b.LINEAR,N.LINEAR_MIPMAP_LINEAR=b.LINEAR_MIPMAP_LINEAR,N.NEAREST_MIPMAP_NEAREST=b.NEAREST_MIPMAP_NEAREST,N.LINEAR_MIPMAP_NEAREST=b.LINEAR_MIPMAP_NEAREST,N.NEAREST_MIPMAP_LINEAR=b.NEAREST_MIPMAP_LINEAR;let U=n.default;U.COLOR_BUFFER_BIT=b.COLOR_BUFFER_BIT,U.DEPTH_BUFFER_BIT=b.DEPTH_BUFFER_BIT,U.STENCIL_BUFFER_BIT=b.STENCIL_BUFFER_BIT,u.default.SetRenderer(this.m_actx)}flush(){this.m_rc.flush()}setClearRGBColor3f(t,e,s){let i=this.m_adapter.bgColor;i[0]=t,i[1]=e,i[2]=s,this.adapter.syncHtmlBodyColor()}setClearColor(t){t.toArray4(this.m_adapter.bgColor),this.adapter.syncHtmlBodyColor()}setClearUint24Color(t,e=1){let s=this.m_adapter.bgColor;s[0]=(t>>16&255)/255,s[1]=(t>>8&255)/255,s[2]=(255&t)/255,s[3]=e,this.adapter.syncHtmlBodyColor()}setClearRGBAColor4f(t,e,s,i){let r=this.m_adapter.bgColor;r[0]=t,r[1]=e,r[2]=s,r[3]=i,this.adapter.syncHtmlBodyColor()}getClearRGBAColor4f(t){t.fromArray4(this.m_adapter.bgColor)}getViewportWidth(){return this.m_adapter.getViewportWidth()}getViewportHeight(){return this.m_adapter.getViewportHeight()}setRenderToBackBuffer(){this.m_adapter.setRenderToBackBuffer()}clearBackBuffer(){this.m_adapter.clear()}clearDepth(t=1){this.m_adapter.clearDepth(t)}renderBegin(){this.m_cam.update(),this.m_adapter.renderBegin()}renderEnd(){}useRenderStateByName(t){_.RenderStateObject.UseRenderStateByName(t)}setScissorEnabled(t){this.m_actx.setScissorEnabled(t)}setScissorRect(t,e,s,i){this.m_actx.setScissorRect(t,e,s,i)}useRenderColorMask(t){h.RenderColorMask.UseRenderState(t)}unlockRenderColorMask(){h.RenderColorMask.Unlock()}lockRenderColorMask(){h.RenderColorMask.Lock()}useRenderState(t){_.RenderStateObject.UseRenderState(t)}unlockRenderState(){_.RenderStateObject.Unlock()}lockRenderState(){_.RenderStateObject.Lock()}setVtxUpdateTimesTotal(t){this.m_vtxRes.setVtxUpdateTimesTotal(t)}setFrontFaceFlipped(t){this.m_adapter.setFrontFaceFlipped(t)}enabledPolygonOffset(){this.m_adapter.enabledPolygonOffset()}disabledPolygonOffset(){this.m_adapter.disabledPolygonOffset()}setPolygonOffset(t,e=0){this.m_adapter.setPolygonOffset(t,e)}resetPolygonOffset(){this.m_adapter.resetPolygonOffset()}loseContext(){this.m_adapter.loseContext()}isContextLost(){return this.m_adapter.isContextLost()}setViewProbeValue(t,e,s,i){this.m_adapter.setViewProbeValue(t,e,s,i)}}e.RenderProxy=L,e.default=L},df9d:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.m_uid=i.s_uid++,this.m_begin=null,this.m_end=null,this.m_unitMap=new Map,this.m_unitTexMap=new Map,this.m_FLAG_BUSY=1,this.m_FLAG_FREE=0,this.m_vtxFlagList=[],this.m_vtxIndexFlagList=[],this.m_vtxfreeIList=[],this.m_vtxList=[],this.m_vtxListLen=0,this.m_texFlagList=[],this.m_texIndexFlagList=[],this.m_texfreeIList=[],this.m_texList=[],this.m_texListLen=0}getFreeVtxId(){return this.m_vtxfreeIList.length>0?this.m_vtxfreeIList.pop():-1}getVtxIndex(){let t=-1,e=this.getFreeVtxId();return e>=0?(t=e,this.m_vtxList[e]=0,this.m_vtxFlagList[e]=this.m_FLAG_BUSY):(t=this.m_vtxListLen,this.m_vtxList.push(0),this.m_vtxIndexFlagList.push(this.m_FLAG_FREE),this.m_vtxFlagList.push(this.m_FLAG_BUSY),this.m_vtxListLen++),t}restoreVtxIndex(t){this.m_vtxFlagList[t]==this.m_FLAG_BUSY&&(this.m_vtxfreeIList.push(t),this.m_vtxFlagList[t]=this.m_FLAG_FREE,this.m_vtxList[t]=0)}attachVtxAt(t){++this.m_vtxList[t]}detachVtxAt(t){this.m_vtxList[t]>0&&(--this.m_vtxList[t],this.m_vtxList[t]<1&&this.restoreVtxIndex(t))}getVtxTotalAt(t){return this.m_vtxList[t]}getFreeTexId(){return this.m_texfreeIList.length>0?this.m_texfreeIList.pop():-1}getTexIndex(){let t=-1,e=this.getFreeTexId();return e>=0?(t=e,this.m_texList[e]=0,this.m_texFlagList[e]=this.m_FLAG_BUSY):(t=this.m_texListLen,this.m_texList.push(0),this.m_texIndexFlagList.push(this.m_FLAG_FREE),this.m_texFlagList.push(this.m_FLAG_BUSY),this.m_texListLen++),t}restoreTexIndex(t){this.m_texFlagList[t]==this.m_FLAG_BUSY&&(this.m_texfreeIList.push(t),this.m_texFlagList[t]=this.m_FLAG_FREE,this.m_texList[t]=0)}attachTexAt(t){++this.m_texList[t]}detachTexAt(t){this.m_texList[t]>0&&(--this.m_texList[t],this.m_texList[t]<1&&this.restoreTexIndex(t))}getTexTotalAt(t){return this.m_texList[t]}destroy(){this.clear()}clear(){this.m_begin=this.m_end=null,this.m_unitMap=new Map,this.m_unitTexMap=new Map,this.m_vtxFlagList=[],this.m_vtxIndexFlagList=[],this.m_vtxList=[],this.m_vtxfreeIList=[],this.m_vtxListLen=0,this.m_texFlagList=[],this.m_texIndexFlagList=[],this.m_texList=[],this.m_texfreeIList=[],this.m_texListLen=0}getBegin(){return this.m_begin}containsNode(t){let e=this.m_unitMap.get(t.vtxUid);if(null!=e){let s=131*(31+e.rvroI);return s*=s+e.texMid,t.rtokey==s}return!1}addNodeAndSort(t){let e=this.m_unitMap.get(t.vtxUid);if(null==e){this.m_unitMap.set(t.vtxUid,t),t.rvroI=this.getVtxIndex(),this.attachVtxAt(t.rvroI);let e=131*(31+t.rvroI);e*=e+t.texMid,t.rtokey=e,t.rtroI=this.getTexIndex(),this.m_unitTexMap.set(e,t.rtroI),this.attachTexAt(t.rtroI)}else{t.rvroI=e.rvroI,this.attachVtxAt(t.rvroI);let s=131*(31+t.rvroI);if(s*=s+t.texMid,this.m_unitTexMap.has(s)?t.rtroI=this.m_unitTexMap.get(s):(t.rtroI=this.getTexIndex(),this.m_unitTexMap.set(s,t.rtroI)),t.rtokey=s,this.attachTexAt(t.rtroI),e!=this.m_end)if(e.texMid==t.texMid)e.next.prev=t,t.next=e.next,t.prev=e,e.next=t;else while(null!=e){if(e.vtxUid!=t.vtxUid){e=e.prev,e.next.prev=t,t.next=e.next,t.prev=e,e.next=t;break}if(e.texMid==t.texMid){e.next.prev=t,t.next=e.next,t.prev=e,e.next=t;break}if(e.next==this.m_end){this.m_end.vtxUid!=t.vtxUid?(e.next.prev=t,t.next=e.next,t.prev=e,e.next=t):e=null;break}e=e.next}else e=null}null==e&&(null==this.m_begin?this.m_end=this.m_begin=t:null!=this.m_end.prev?(this.m_end.next=t,t.prev=this.m_end,this.m_end=t):(this.m_begin.next=t,t.prev=this.m_end,this.m_end=t),this.m_end.next=null)}showInfo(){let t=this.getBegin();if(null!=t){let e="",s="",i="";while(null!=t)e+=t.vtxUid+",",s+=t.texMid+",",i+=t.unit.indicesRes.rdp.rd.ivsSize+",",t=t.next}}removeNodeAndSort(t){let e=this.m_unitMap.get(t.vtxUid);e!=t?e=null:(this.m_unitMap.set(t.vtxUid,null),null!=t.next&&t.next.vtxUid==t.vtxUid?this.m_unitMap.set(t.vtxUid,t.next):null!=t.prev&&t.prev.vtxUid==t.vtxUid?this.m_unitMap.set(t.vtxUid,t.prev):this.m_unitMap.delete(t.vtxUid)),t==this.m_begin?t==this.m_end?this.m_begin=this.m_end=null:(this.m_begin=t.next,this.m_begin.prev=null):t==this.m_end?(this.m_end=t.prev,this.m_end.next=null):(t.next.prev=t.prev,t.prev.next=t.next),this.detachVtxAt(t.rvroI),this.detachTexAt(t.rtroI),t.prev=null,t.next=null}addNode(t){null==this.m_begin?this.m_end=this.m_begin=t:null!=this.m_end.prev?(this.m_end.next=t,t.prev=this.m_end,this.m_end=t):(this.m_begin.next=t,t.prev=this.m_end,this.m_end=t),this.m_end.next=null}removeNode(t){t==this.m_begin?t==this.m_end?this.m_begin=this.m_end=null:(this.m_begin=t.next,this.m_begin.prev=null):t==this.m_end?(this.m_end=t.prev,this.m_end.next=null):(t.next.prev=t.prev,t.prev.next=t.next),t.prev=null,t.next=null}}i.s_uid=0,e.default=i},e035:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("070b"),r=s("a5ba"),a=s("e08e");class n{constructor(){this.m_inited=!0}buildToRST(t){let e=new n;e.initialize(t,this.m_Rstate,this.m_VRO)}initialize(t,e,s){if(this.m_inited&&null==t.rstb){t.rstb=this,this.m_inited=!1,this.m_Rstate=e,this.m_VRO=s;const l=r.RenderStateObject,h=i.RenderColorMask,_=a.GLBlendMode,o=a.GLBlendEquation,d=a.CullFaceMode,u=a.DepthTestMode,m=a.RenderBlendMode;t.Rstate=e,t.VRO=s,h.Rstate=e,l.Rstate=e,t.COLOR_MASK_ALL_TRUE=h.Create("all_true",!0,!0,!0,!0),t.COLOR_MASK_ALL_FALSE=h.Create("all_false",!1,!1,!1,!1),t.COLOR_MASK_RED_TRUE=h.Create("red_true",!0,!1,!1,!1),t.COLOR_MASK_GREEN_TRUE=h.Create("green_true",!1,!0,!1,!1),t.COLOR_MASK_BLUE_TRUE=h.Create("blue_true",!1,!1,!0,!1),t.COLOR_MASK_ALPHA_TRUE=h.Create("alpha_true",!1,!1,!1,!0),t.COLOR_MASK_RED_FALSE=h.Create("red_false",!1,!0,!0,!0),t.COLOR_MASK_GREEN_FALSE=h.Create("green_false",!0,!1,!0,!0),t.COLOR_MASK_BLUE_FALSE=h.Create("blue_false",!0,!0,!1,!0),t.COLOR_MASK_ALPHA_FALSE=h.Create("alpha_false",!0,!0,!0,!1),n.m_rbmInited&&(n.m_rbmInited=!1,m.NORMAL=l.CreateBlendMode("NORMAL",_.ONE,_.ZERO,o.FUNC_ADD),m.OPAQUE=l.CreateBlendMode("OPAQUE",_.ONE,_.ZERO,o.FUNC_ADD),m.TRANSPARENT=l.CreateBlendMode("TRANSPARENT",_.SRC_ALPHA,_.ONE_MINUS_SRC_ALPHA,o.FUNC_ADD),m.ALPHA_ADD=l.CreateBlendMode("ALPHA_ADD",_.ONE,_.ONE_MINUS_SRC_ALPHA,o.FUNC_ADD),m.ADD=l.CreateBlendMode("ADD",_.SRC_ALPHA,_.ONE,o.FUNC_ADD),m.ADD_LINEAR=l.CreateBlendMode("ADD_LINEAR",_.ONE,_.ONE,o.FUNC_ADD),m.INVERSE_ALPHA=l.CreateBlendMode("INVERSE_ALPHA",_.ONE,_.SRC_ALPHA,o.FUNC_ADD),m.BLAZE=l.CreateBlendMode("BLAZE",_.SRC_COLOR,_.ONE,o.FUNC_ADD),m.OVERLAY=l.CreateBlendMode("OVERLAY",_.DST_COLOR,_.DST_ALPHA,o.FUNC_ADD),m.OVERLAY2=l.CreateBlendMode("OVERLAY2",_.DST_COLOR,_.SRC_ALPHA,o.FUNC_ADD)),t.NORMAL_STATE=l.Create("normal",d.BACK,m.NORMAL,u.OPAQUE),t.BACK_CULLFACE_NORMAL_STATE=t.NORMAL_STATE,t.FRONT_CULLFACE_NORMAL_STATE=l.Create("front_normal",d.FRONT,m.NORMAL,u.OPAQUE),t.NONE_CULLFACE_NORMAL_STATE=l.Create("none_normal",d.NONE,m.NORMAL,u.OPAQUE),t.ALL_CULLFACE_NORMAL_STATE=l.Create("all_cull_normal",d.FRONT_AND_BACK,m.NORMAL,u.OPAQUE),t.BACK_NORMAL_ALWAYS_STATE=l.Create("back_normal_always",d.BACK,m.NORMAL,u.ALWAYS),t.BACK_TRANSPARENT_STATE=l.Create("back_transparent",d.BACK,m.TRANSPARENT,u.TRANSPARENT_SORT),t.BACK_TRANSPARENT_ALWAYS_STATE=l.Create("back_transparent_always",d.BACK,m.TRANSPARENT,u.ALWAYS),t.NONE_TRANSPARENT_STATE=l.Create("none_transparent",d.NONE,m.TRANSPARENT,u.TRANSPARENT_SORT),t.NONE_TRANSPARENT_ALWAYS_STATE=l.Create("none_transparent_always",d.NONE,m.TRANSPARENT,u.ALWAYS),t.FRONT_CULLFACE_GREATER_STATE=l.Create("front_greater",d.FRONT,m.NORMAL,u.TRUE_GREATER),t.BACK_ADD_BLENDSORT_STATE=l.Create("back_add_blendSort",d.BACK,m.ADD,u.TRANSPARENT_SORT),t.BACK_ADD_ALWAYS_STATE=l.Create("back_add_always",d.BACK,m.ADD,u.ALWAYS),t.BACK_ALPHA_ADD_ALWAYS_STATE=l.Create("back_alpha_add_always",d.BACK,m.ALPHA_ADD,u.ALWAYS),t.NONE_ADD_ALWAYS_STATE=l.Create("none_add_always",d.NONE,m.ADD,u.ALWAYS),t.NONE_ADD_BLENDSORT_STATE=l.Create("none_add_blendSort",d.NONE,m.ADD,u.TRANSPARENT_SORT),t.NONE_ALPHA_ADD_ALWAYS_STATE=l.Create("none_alpha_add_always",d.NONE,m.ALPHA_ADD,u.ALWAYS),t.FRONT_ADD_ALWAYS_STATE=l.Create("front_add_always",d.FRONT,m.ADD,u.ALWAYS),t.FRONT_TRANSPARENT_STATE=l.Create("front_transparent",d.FRONT,m.TRANSPARENT,u.TRANSPARENT_SORT),t.FRONT_TRANSPARENT_ALWAYS_STATE=l.Create("front_transparent_always",d.FRONT,m.TRANSPARENT,u.ALWAYS),t.NONE_CULLFACE_NORMAL_ALWAYS_STATE=l.Create("none_normal_always",d.NONE,m.NORMAL,u.ALWAYS),t.BACK_ALPHA_ADD_BLENDSORT_STATE=l.Create("back_alpha_add_blendSort",d.BACK,m.ALPHA_ADD,u.TRANSPARENT_SORT)}}createBlendMode(t,e,s,i=0){return r.RenderStateObject.CreateBlendMode(t,e,s,i)}createBlendModeSeparate(t,e,s,i=0,a=0,n=0){return r.RenderStateObject.CreateBlendModeSeparate(t,e,s,i,a,n)}createRenderState(t,e,s,i){return r.RenderStateObject.Create(t,e,s,i)}createRenderColorMask(t,e,s,r,a){return i.RenderColorMask.Create(t,e,s,r,a)}getRenderStateByName(t){return r.RenderStateObject.GetRenderStateByName(t)}getRenderColorMaskByName(t){return i.RenderColorMask.GetColorMaskByName(t)}unlockBlendMode(){r.RenderStateObject.UnlockBlendMode()}lockBlendMode(t){r.RenderStateObject.LockBlendMode(t)}unlockDepthTestMode(){r.RenderStateObject.UnlockDepthTestMode()}lockDepthTestMode(t){r.RenderStateObject.LockDepthTestMode(t)}resetState(){i.RenderColorMask.Reset(),r.RenderStateObject.Reset(),this.m_Rstate.reset(),this.m_VRO.__$resetVRO()}reset(t){i.RenderColorMask.Reset(),r.RenderStateObject.Reset(),this.m_Rstate.setRenderContext(t),this.m_Rstate.reset()}resetInfo(){}setDepthTestEnable(t){this.m_Rstate.setDepthTestEnable(t)}setBlendEnable(t){this.m_Rstate.setBlendEnable(t)}}n.m_rbmInited=!0,e.default=n},e08e:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("13b1"));e.RenderDrawMode=r.default;const a=s("72bb");e.DisplayRenderSign=a.DisplayRenderSign;class n{}n.NORMAL=1,n.OPAQUE=1,n.TRANSPARENT=2,n.ALPHA_ADD=3,n.ADD=4,n.ADD_LINEAR=5,n.INVERSE_ALPHA=6,n.BLAZE=7,n.OVERLAY=8,n.OVERLAY2=8,n.DISABLE=0,e.RenderBlendMode=n;class l{}l.NEVER=1,l.LESS=1,l.EQUAL=1,l.GREATER=1,l.NOTEQUAL=1,l.GEQUAL=1,l.ALWAYS=1,e.GLStencilFunc=l;class h{}h.KEEP=1,h.ZERO=1,h.REPLACE=1,h.INCR=1,h.INCR_WRAP=1,h.DECR=1,h.DECR_WRAP=1,h.INVERT=1,e.GLStencilOp=h;class _{}_.ZERO=1,_.ONE=1,_.SRC_COLOR=1,_.DST_COLOR=1,_.SRC_ALPHA=1,_.DST_ALPHA=1,_.ONE_MINUS_SRC_ALPHA=1,e.GLBlendMode=_;class o{}o.FUNC_ADD=1,o.FUNC_SUBTRACT=1,o.FUNC_REVERSE_SUBTRACT=1,o.MIN_EXT=1,o.MAX_EXT=1,o.MIN=1,o.MAX=1,e.GLBlendEquation=o;class d{}d.BACK=1,d.FRONT=2,d.FRONT_AND_BACK=3,d.NONE=0,d.DISABLE=0,e.CullFaceMode=d;class u{}u.NEVER=1,u.ALWAYS=2,u.SKY=3,u.TRUE_LESS_EQUAL=3,u.OPAQUE=4,u.TRUE_LESS=4,u.OPAQUE_OVERHEAD=5,u.FALSE_EQUAL=5,u.FALSE_LESS=6,u.BLEND=6,u.BLEND_SORT=6,u.TRANSPARENT_SORT=6,u.TRUE_LEQUAL=7,u.WIRE_FRAME=7,u.FALSE_LEQUAL=8,u.DECALS=8,u.NEXT_LAYER=11,u.WIRE_FRAME_NEXT=12,u.TRUE_EQUAL=13,u.TRUE_GREATER=14,u.TRUE_GEQUAL=15,u.DISABLE=0,e.DepthTestMode=u},e2fe:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t=0,e=0,s=100,i=100){this.m_right=100,this.m_top=100,this.m_cx=0,this.m_cy=0,this.x=0,this.y=0,this.width=100,this.height=100,this.x=t,this.y=e,this.width=s,this.height=i,this.update()}getCenterX(){return this.m_cx}getCenterY(){return this.m_cy}moveCenterTo(t,e){return this.x+=t-this.m_cx,this.y+=e-this.m_cy,this.update(),this}scaleBy(t){return this.x*=t,this.y*=t,this.width*=t,this.height*=t,this.m_right=this.x+this.width,this.m_top=this.y+this.height,this.m_cx=this.x+.5*this.width,this.m_cy=this.y+.5*this.height,this}union(t){return this.addXY(t.x,t.y),this.addXY(t.getRight(),t.getTop()),this}addXY(t,e){return this.x>t&&(this.x=t),this.m_right<t&&(this.m_right=t),this.y>e&&(this.y=e),this.m_top<e&&(this.m_top=e),this.width=this.m_right-this.x,this.height=this.m_top-this.y,this.m_cx=this.x+.5*this.width,this.m_cy=this.y+.5*this.height,this}reset(){return this.x=this.y=268435455,this.m_right=this.m_top=-268435455,this.width=this.height=0,this.m_cx=0,this.m_cy=0,this}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.m_right=t.getRight(),this.m_top=t.getTop(),this.m_cx=t.getCenterX(),this.m_cy=t.getCenterY(),this}clone(){return new i(this.x,this.y,this.width,this.height)}containsXY(t,e){return!(t<this.x||t>this.m_right)&&!(e<this.y||e>this.m_top)}contains(t){return t.x>=this.x&&t.getRight()<=this.m_right&&t.y>=this.y&&(t.getTop(),this.m_top),!0}intersect(t){return!(t.x>this.m_right)&&(!(t.getRight()<this.x)&&(!(t.y>this.m_top)&&!(t.getTop()<this.y)))}setTo(t,e,s,i){return this.x=t,this.y=e,this.width=s,this.height=i,this.m_right=this.width+this.x,this.m_top=this.height+this.y,this.m_cx=this.x+.5*this.width,this.m_cy=this.y+.5*this.height,this}setSize(t,e){return this.width=t,this.height=e,this.m_right=this.width+this.x,this.m_top=this.height+this.y,this.m_cx=this.x+.5*this.width,this.m_cy=this.y+.5*this.height,this}testEqual(t){return this.x!=t.x||this.y!=t.y||this.width!=t.width||this.height!=t.height}testEqualWithParams(t,e,s,i){return this.x!=t||this.y!=e||this.width!=s||this.height!=i}update(){return this.m_right=this.width+this.x,this.m_top=this.height+this.y,this.m_cx=this.x+.5*this.width,this.m_cy=this.y+.5*this.height,this}flipY(t){return this.y=t-this.y,this.update(),this}getX(){return this.x}getY(){return this.y}getRight(){return this.m_right}getTop(){return this.m_top}}e.default=i},e39a:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("c62b")),a=i(s("34cd")),n=i(s("7f1c"));class l extends r.default{constructor(){super(),this.m_passProc=new a.default,this.m_cr=new n.default}resetCR(){const t=this.m_cr;t.passProc=this.m_passProc,t.shdUpdate=!1,t.shader=this.shader}run(t){const e=this.rentity;e&&e.isVisible()&&(this.resetCR(),this.m_cr.runContainer(t,e))}runLockMaterial2(t){const e=this.rentity;e&&e.isVisible()&&(this.resetCR(),this.m_cr.runContainerLock(this.shader.getRC(),e))}reset(){this.shader=null,this.rentity=null,this.bounds=null,this.pos=null}}e.default=l},e602:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t){let e=this;e.ALL_TRUE=t.COLOR_MASK_ALL_TRUE,e.ALL_FALSE=t.COLOR_MASK_ALL_FALSE,e.RED_TRUE=t.COLOR_MASK_RED_TRUE,e.GREEN_TRUE=t.COLOR_MASK_GREEN_TRUE,e.BLUE_TRUE=t.COLOR_MASK_BLUE_TRUE,e.ALPHA_TRUE=t.COLOR_MASK_ALPHA_TRUE,e.RED_FALSE=t.COLOR_MASK_RED_FALSE,e.GREEN_FALSE=t.COLOR_MASK_GREEN_FALSE,e.BLUE_FALSE=t.COLOR_MASK_BLUE_FALSE,e.ALPHA_FALSE=t.COLOR_MASK_ALPHA_FALSE}}e.RenderingColorMask=i},e7f2:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("e08e");class r{constructor(){this.stencilMask=-1}}class a{constructor(){this.m_units=new Array(128),this.m_unit=null,this.m_blendMode=i.RenderBlendMode.NORMAL,this.m_cullMode=i.CullFaceMode.NONE,this.m_depthTestType=i.DepthTestMode.DISABLE,this.m_cullDisabled=!0,this.m_context=null,this.m_gl=null,this.roColorMask=-11}reset(){this.roColorMask=-11}updateGLCtx(){this.m_gl=this.m_context.getRC()}setRenderContext(t){this.m_context=t,this.m_gl=this.m_context.getRC();let e=this.m_gl.rcuid;this.m_unit=this.m_units[e],null==this.m_unit&&(this.m_unit=this.m_units[e]=new r)}setColorMask(t,e,s,i){this.m_gl.colorMask(t,e,s,i)}setStencilFunc(t,e,s){this.m_gl.stencilFunc(t,e,s)}setStencilMask(t){this.m_unit.stencilMask!=t&&t>=0&&(this.m_unit.stencilMask=t,this.m_gl.stencilMask(t))}setStencilOp(t,e,s){this.m_gl.stencilOp(t,e,s)}setDepthTestEnable(t){t?this.m_gl.enable(this.m_gl.DEPTH_TEST):this.m_gl.disable(this.m_gl.DEPTH_TEST)}setCullFaceEnable(t){t?this.m_gl.enable(this.m_gl.CULL_FACE):this.m_gl.disable(this.m_gl.CULL_FACE)}setBlendEnable(t){t?this.m_gl.enable(this.m_gl.BLEND):this.m_gl.disable(this.m_gl.BLEND)}setCullFaceMode(t){this.m_cullMode!=t&&(this.m_cullMode=t,t!=i.CullFaceMode.NONE?(this.m_cullDisabled&&(this.m_cullDisabled=!1,this.m_gl.enable(this.m_gl.CULL_FACE)),this.m_gl.cullFace(t)):this.m_cullDisabled||(this.m_cullDisabled=!0,this.m_gl.disable(this.m_gl.CULL_FACE)))}setBlendMode(t,e){this.m_blendMode!=t&&(this.m_blendMode=t,t>0?e[0]<1?(this.m_gl.blendEquation(e[1]),this.m_gl.blendFunc(e[3],e[4])):(this.m_gl.blendEquationSeparate(e[1],e[2]),this.m_gl.blendFuncSeparate(e[3],e[4],e[5],e[6])):this.m_gl.disable(this.m_gl.BLEND))}getDepthTestMode(){return this.m_depthTestType}setDepthTestMode(t){if(this.m_depthTestType!=t){const e=this.m_gl,s=i.DepthTestMode;switch(this.m_depthTestType=t,t){case s.ALWAYS:e.depthMask(!1),e.depthFunc(e.ALWAYS);break;case s.SKY:e.depthMask(!0),e.depthFunc(e.LEQUAL);break;case s.OPAQUE:e.depthMask(!0),e.depthFunc(e.LESS);break;case s.OPAQUE_OVERHEAD:e.depthMask(!1),e.depthFunc(e.EQUAL);break;case s.DECALS:e.depthMask(!1),e.depthFunc(e.LEQUAL);break;case s.BLEND:e.depthMask(!1),e.depthFunc(e.LESS);break;case s.WIRE_FRAME:e.depthMask(!0),e.depthFunc(e.LEQUAL);break;case s.NEXT_LAYER:e.depthMask(!1),e.depthFunc(e.ALWAYS);break;case s.TRUE_EQUAL:e.depthMask(!0),e.depthFunc(e.EQUAL);break;case s.TRUE_GREATER:e.depthMask(!0),e.depthFunc(e.GREATER);break;case s.TRUE_GEQUAL:e.depthMask(!0),e.depthFunc(e.GEQUAL);break;case s.WIRE_FRAME_NEXT:break;default:break}}}}e.RODrawState=a},e87b:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("ab73"));class a{create(t,e){let s=r.default.ViewportParam;return e.hasUniformByName(s.name)?t.uniformContext.createShaderGlobalUniformFromProbe(t.getRenderAdapter().uViewProbe,s.name,[s.name]):null}getIDNS(){return"ViewParamUniformBuilder"}}e.default=a},eca0:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("2be1")),a=i(s("c62b"));class n{constructor(){this.idsFlag=0,this.count=0,this.rprocessUid=-1}reset(){this.idsFlag=0}}n.RenerProcessMaxTotal=16,e.RCRPObj=n;class l extends r.default{constructor(){super(...arguments),this.m_rcpoList=[]}createNode(){let t=new n;return t.reset(),this.m_rcpoList.push(t),new a.default}restoreUid(t){this.m_rcpoList[t].reset()}testRPNodeExists(t,e){return(this.m_rcpoList[t].idsFlag&1<<e)>0}testRPNodeNotExists(t,e){return(this.m_rcpoList[t].idsFlag&1<<e)<1}setRPNodeParam(t,e,s){let i=this.m_rcpoList[t],r=1<<e;return s>-1?(i.idsFlag&r)<1&&(++i.count,i.rprocessUid=e,i.idsFlag=i.idsFlag|r):(i.idsFlag&r)>0&&(--i.count,i.idsFlag=i.idsFlag&~r),i.count}getRCRPObj(t){return this.m_rcpoList[t]}}e.RPOUnitBuilder=l},f571:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.value=0,this.uid=-1,this.prev=null,this.next=null}}e.SortNodeLinkerNode=i;class r{constructor(){this.m_begin=null,this.m_end=null,this.m_next=null,this.m_node=null,this.m_nodes=[],this.m_nodesTotal=0}showInfo(){let t="",e=this.m_begin;while(null!=e)t+="("+e.value+","+e.uid+"),",e=e.next}clear(){this.m_nodes=[];let t=this.m_begin,e=null;while(null!=t)e=t,t=t.next,e.prev=null,e.next=null;this.m_begin=this.m_end=null,this.m_nodesTotal=0}sort(){if(this.m_nodesTotal>0){let t=this.m_begin;this.m_nodes.length<this.m_nodesTotal&&(this.m_nodes=new Array(Math.round(1.1*this.m_nodesTotal)+1));let e=0;while(null!=t)this.m_nodes[e]=t,t=t.next,++e;this.snsort(0,this.m_nodesTotal-1),this.m_begin=this.m_nodes[0],this.m_begin.uid=2,this.m_begin.next=null,this.m_begin.prev=null;let s=this.m_begin;for(e=1;e<this.m_nodesTotal;++e)t=this.m_nodes[e],t.uid=2+e,t.prev=s,s.next=t,t.next=null,s=t;this.m_end=this.m_nodes[this.m_nodesTotal-1],this.m_next=this.m_begin}}sorting(t,e){let s=this.m_nodes;this.m_node=s[t];while(t<e){while(t<e&&s[e].value>=this.m_node.value)--e;s[t]=s[e];while(t<e&&s[t].value<=this.m_node.value)++t;s[e]=s[t]}return s[t]=this.m_node,t}snsort(t,e){if(t<e){let s=this.sorting(t,e);this.snsort(t,s-1),this.snsort(s+1,e)}}getNodesTotal(){return this.m_nodesTotal}getBegin(){return this.m_next=this.m_begin,this.m_begin}getNext(){return null!=this.m_next&&(this.m_next=this.m_next.next),this.m_next}isEmpty(){return this.m_nodesTotal<1}addNode(t){null==t.prev&&null==t.next&&(null==this.m_begin?this.m_end=this.m_begin=t:null!=this.m_end.prev?(this.m_end.next=t,t.prev=this.m_end,this.m_end=t):(this.m_begin.next=t,t.prev=this.m_end,this.m_end=t),this.m_end.next=null,this.m_nodesTotal++)}removeNode(t){null==t.prev&&null==t.next||(t==this.m_begin?t==this.m_end?this.m_begin=this.m_end=null:(this.m_begin=t.next,this.m_begin.prev=null):t==this.m_end?(this.m_end=t.prev,this.m_end.next=null):(t.next.prev=t.prev,t.prev.next=t.next),t.prev=null,t.next=null,this.m_nodesTotal--)}}e.SortNodeLinker=r,e.default=r},fa60:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("919c"));class a extends r.default{constructor(){super(),this.vao=null,this.m_uid=a.s_uid++}run(){(this.m_rc.testVROUid(this.m_uid)||this.indicesRes.test())&&(this.m_rc.bindVertexArray(this.vao),this.indicesRes.bindToGPU(r.default.s_mid!=this.m_mid),r.default.s_mid=this.m_mid)}__$destroy(){r.default.s_midMap.delete(this.m_mid),this.m_mid=0,this.m_vtxUid=-1,this.vao=null,this.m_rc=null,this.indicesRes=null}restoreThis(){null!=this.vao&&this.m_rc.deleteVertexArray(this.vao),a.Restore(this)}static HasMid(t){return r.default.s_midMap.has(t)}static GetByMid(t){return r.default.s_midMap.get(t)}static GetFreeId(){return a.s_freeIdList.length>0?a.s_freeIdList.pop():-1}static Create(t,e,s){let i=null,n=a.GetFreeId();return n>=0?(i=a.s_unitList[n],a.s_unitFlagList[n]=a.s_FLAG_BUSY,i.setMidAndBufUid(e,s)):(i=new a,i.setMidAndBufUid(e,s),a.s_unitList.push(i),a.s_unitFlagList.push(a.s_FLAG_BUSY),a.s_unitListLen++),i.setRC(t),r.default.s_midMap.set(e,i),i}static Restore(t){if(null!=t&&t.m_attachCount<1&&a.s_unitFlagList[t.getUid()]==a.s_FLAG_BUSY){let e=t.getUid();a.s_freeIdList.push(e),a.s_unitFlagList[e]=a.s_FLAG_FREE,t.__$destroy()}}}a.s_uid=0,a.s_FLAG_BUSY=1,a.s_FLAG_FREE=0,a.s_unitFlagList=[],a.s_unitListLen=0,a.s_unitList=[],a.s_freeIdList=[],e.default=a},fae3:function(t,e,s){"use strict";s.r(e);s("1eb2");var i=s("4d4b");for(var r in i)["default"].indexOf(r)<0&&function(t){s.d(e,t,(function(){return i[t]}))}(r)},fd5e:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.m_mt=null,this.m_build=!1,this.rdataBuilder=null,this.unit=null,this.hostUnit=null}isEnabled(){if(this.m_build){let t=this.m_mt;this.m_mt=null,this.build(t),this.m_build=!t.hasShaderData(),this.m_build&&(this.m_mt=t)}return this.m_mt&&this.m_mt.hasShaderData()}build(t){if(t.hasShaderData()&&this.m_mt!=t){this.m_mt&&this.m_mt.__$detachThis(),this.m_mt=t;const e=this.rdataBuilder;if(this.m_mt){this.m_mt.__$attachThis(),null==this.unit&&(this.unit=e.createRPOUnit());let t=this.hostUnit.rentity;t.getREType()<12&&e.updateDispMaterial(this.unit,this.m_mt,t.getDisplay())}else this.unit&&(this.unit.destroy(),e.restoreRPOUnit(this.unit),this.unit=null)}}bindMaterial(t){null!=t&&(t.initializeByCodeBuf(null!=t.getTextureAt(0)),this.m_build=!0,t.hasShaderData()?this.build(t):this.m_mt=t)}destroy(){null!=this.unit&&(this.unit.destroy(),this.rdataBuilder.restoreRPOUnit(this.unit),this.unit=null),this.m_build=!1,this.hostUnit=null,this.rdataBuilder=null,null!=this.m_mt&&(this.m_mt=null)}}e.default=i},ffc0:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73"));class a{static ToGL(t,e){const s=a;switch(e){case s.RGBA:break;case s.R8:return t.R8;case s.R16F:return t.R16F;case s.R32F:return t.R32F;case s.RGB:return t.RGB;case s.RGB8:return t.RGB8;case s.RGBA8:return t.RGBA8;case s.ALPHA:return t.ALPHA;case s.RGB16F:return r.default.IsWebGL2()?t.RGB16F:t.RGB;case s.RGBA16F:return r.default.IsWebGL2()?t.RGBA16F:t.RGBA;case s.RGB32F:return r.default.IsWebGL2()&&t.RGB32F,t.RGB;case s.RGBA32F:return r.default.IsWebGL2()&&t.RGBA32F,t.RGBA;case a.RED:return t.RED;case s.DEPTH_COMPONENT:return t.DEPTH_COMPONENT;case s.DEPTH_STENCIL:return t.DEPTH_STENCIL;default:break}return t.RGBA}}a.R8=101,a.R16F=102,a.R32F=102,a.RGB=110,a.RED=111,a.RGBA=121,a.RGB8=122,a.RGBA8=123,a.ALPHA=132,a.RGB16F=331,a.RGBA16F=332,a.RGB32F=341,a.RGBA32F=342,a.DEPTH_COMPONENT=351,a.DEPTH_STENCIL=352,e.default=a}})}));