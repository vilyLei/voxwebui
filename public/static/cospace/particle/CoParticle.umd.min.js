(function(t,e){"object"===typeof exports&&"object"===typeof module?module.exports=e():"function"===typeof define&&define.amd?define([],e):"object"===typeof exports?exports["CoParticle"]=e():t["CoParticle"]=e()})("undefined"!==typeof self?self:this,(function(){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var l=e[s]={i:s,l:!1,exports:{}};return t[s].call(l.exports,l,l.exports,i),l.l=!0,l.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var l in t)i.d(s,l,function(e){return t[e]}.bind(null,l));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s="fae3")}({"0002":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const l=s(i("561f")),a=i("4175");class r{constructor(){this.m_billMaterial=null,this.m_billMesh=null,this.m_brightnessEnabled=!0,this.m_alphaEnabled=!1,this.m_playOnce=!1,this.m_direcEnabled=!1,this.m_clipEnabled=!1,this.m_clipMixEnabled=!1,this.m_spdScaleEnabled=!1,this.entity=CoRScene.createDisplayEntity(),this.vbWholeDataEnabled=!1,this.flipVerticalUV=!1,this.premultiplyAlpha=!1,this.entity.setRenderState(CoRScene.RendererState.BACK_ADD_BLENDSORT_STATE)}createGroup(t){t>0&&null==this.m_billMesh&&(this.m_billMesh=new l.default,this.m_billMesh.createData(t))}setSizeAndScaleAt(t,e,i,s,l){null!=this.m_billMesh&&this.m_billMesh.setSizeAndScaleAt(t,e,i,s,l)}setPositionAt(t,e,i,s){null!=this.m_billMesh&&this.m_billMesh.setPositionAt(t,e,i,s)}setVelocityAt(t,e,i,s){null!=this.m_billMesh&&this.m_billMesh.setVelocityAt(t,e,i,s)}setAccelerationAt(t,e,i,s){null!=this.m_billMesh&&this.m_billMesh.setAccelerationAt(t,e,i,s)}setUVRectAt(t,e,i,s,l){null!=this.m_billMesh&&this.m_billMesh.setUVRectAt(t,e,i,s,l)}setTimeAt(t,e,i,s,l=0){null!=this.m_billMesh&&this.m_billMesh.setTimeAt(t,e,i,s,l)}setTimeSpeedAt(t,e){null!=this.m_billMesh&&this.m_billMesh.setTimeSpeedAt(t,e)}setTimeSpeed(t,e){null!=this.m_billMesh&&this.m_billMesh.setTimeSpeedAt(t,e)}setAlphaAt(t,e){null!=this.m_billMesh&&this.m_billMesh.setAlphaAt(t,e)}setBrightnessAt(t,e){null!=this.m_billMesh&&this.m_billMesh.setBrightnessAt(t,e)}setRGBA4f(t,e,i,s){null!=this.m_billMaterial&&this.m_billMaterial.setRGBA4f(t,e,i,s)}setRGB3f(t,e,i){null!=this.m_billMaterial&&this.m_billMaterial.setRGB3f(t,e,i)}setRGBAOffset4f(t,e,i,s){null!=this.m_billMaterial&&this.m_billMaterial.setRGBAOffset4f(t,e,i,s)}setRGBOffset3f(t,e,i){null!=this.m_billMaterial&&this.m_billMaterial.setRGBOffset3f(t,e,i)}setAlpha(t){null!=this.m_billMaterial&&this.m_billMaterial.setAlpha(t)}getAlpha(){return this.m_billMaterial.getAlpha()}setBrightness(t){this.m_billMaterial.setBrightness(t)}getBrightness(){return this.m_billMaterial.getBrightness()}setAcceleration(t,e,i){null!=this.m_billMaterial&&this.m_billMaterial.setAcceleration(t,e,i)}setSpdScaleMax(t,e=1){null!=this.m_billMaterial&&this.m_billMaterial.setSpdScaleMax(t,e)}setClipUVParam(t,e,i,s){this.m_clipEnabled&&null!=this.m_billMaterial&&this.m_billMaterial.setClipUVParam(t,e,i,s)}getTime(){return this.m_billMaterial.getTime()}setTime(t){this.m_billMaterial.setTime(t)}setDepthOffset(t){this.m_billMaterial.setDepthOffset(t)}updateTime(t){this.m_billMaterial.updateTime(t)}getScaleX(){return this.m_billMaterial.getScaleX()}getScaleY(){return this.m_billMaterial.getScaleY()}setScaleX(t){this.m_billMaterial.setScaleX(t)}setScaleY(t){this.m_billMaterial.setScaleY(t)}setScaleXY(t,e){this.m_billMaterial.setScaleXY(t,e)}createMaterial(t){null==this.m_billMaterial&&(this.m_billMaterial=new a.BillboardFlowMaterial(this.m_brightnessEnabled,this.m_alphaEnabled,this.m_clipEnabled),this.m_billMaterial.setPlayParam(this.m_playOnce,this.m_direcEnabled,this.m_clipMixEnabled,this.m_spdScaleEnabled),this.m_billMaterial.diffuseMap=t[0],this.m_billMaterial.premultiplyAlpha=this.premultiplyAlpha,this.m_billMaterial.initialize(),this.entity.setMaterial(this.m_billMaterial.material),this.m_billMaterial.material.initializeByCodeBuf(t.length>0))}toTransparentBlend(t=!1){t?this.entity.setRenderState(CoRScene.RendererState.BACK_TRANSPARENT_ALWAYS_STATE):this.entity.setRenderState(CoRScene.RendererState.BACK_TRANSPARENT_STATE)}toBrightnessBlend(t=!1){t?this.entity.setRenderState(CoRScene.RendererState.BACK_ADD_ALWAYS_STATE):this.entity.setRenderState(CoRScene.RendererState.BACK_ADD_BLENDSORT_STATE)}setPlayParam(t,e,i=!1,s=!1){this.m_playOnce=t,this.m_direcEnabled=e,this.m_clipMixEnabled=i,this.m_spdScaleEnabled=s}initialize(t,e,i,s){this.m_clipEnabled=i,this.m_brightnessEnabled=t,this.m_alphaEnabled=e,null!=this.m_billMesh&&(this.createMaterial(s),this.activeMesh(this.m_billMaterial.material))}createBounds(){}activeMesh(t){let e=this.m_billMesh.mesh;e.vbWholeDataEnabled=this.vbWholeDataEnabled,this.m_billMesh.flipVerticalUV=this.flipVerticalUV,e.setBufSortFormat(t.getBufSortFormat()),this.m_billMesh.initialize(),this.entity.setMesh(e)}setUV(t,e,i,s){null!=this.m_billMesh&&this.m_billMesh.setUV(t,e,i,s)}update(){this.entity.update()}isAwake(){return this.m_playOnce&&this.m_billMaterial.getTime()<this.m_billMesh.getEndTime()}destroy(){null!=this.entity&&(this.entity.destroy(),this.entity=null),null!=this.m_billMesh&&(this.m_billMesh.destroy(),this.m_billMesh=null),null!=this.m_billMaterial&&(this.m_billMaterial.destroy(),this.m_billMaterial=null)}}e.default=r},"0ea1":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("2856");class l{constructor(){this.m_material=null,this.m_mesh=null,this.m_blendType=0,this.m_blendAlways=!1,this.m_rz=0,this.m_bw=0,this.m_bh=0,this.brightnessEnabled=!0,this.alphaEnabled=!1,this.rotationEnabled=!1,this.fogEnabled=!1,this.entity=null}initEntity(){if(null==this.m_material){this.m_uniformData=new Float32Array([1,1,0,0,1,1,1,1,0,0,0,0]);let t=this.m_material=new s.BillboardLineMaterial;t.brightnessEnabled=this.brightnessEnabled,t.alphaEnabled=this.alphaEnabled,t.rotationEnabled=this.rotationEnabled,t.fogEnabled=this.fogEnabled,t.initialize(!1);let e=t.material;e.addUniformDataAt("u_billParam",this.m_uniformData);let i=CoEntity.createDisplayEntity();i.setMaterial(e),i.setMesh(this.m_mesh),this.entity=i;const l=CoRScene.RendererState;i.setRenderState(l.BACK_ADD_BLENDSORT_STATE),1==this.m_blendType?this.m_blendAlways?this.entity.setRenderState(l.BACK_TRANSPARENT_STATE):this.entity.setRenderState(l.BACK_TRANSPARENT_ALWAYS_STATE):2==this.m_blendType&&(this.m_blendAlways,this.entity.setRenderState(l.BACK_ADD_BLENDSORT_STATE))}}toTransparentBlend(t=!1){this.brightnessEnabled=!1,this.alphaEnabled=!0,this.m_blendType=1,this.m_blendAlways=t}toBrightnessBlend(t=!1){this.brightnessEnabled=!0,this.alphaEnabled=!1,this.m_blendType=2}initializeSquareXOY(t){this.m_bw=t,this.m_bh=t;let e=CoMesh.line;e.dynColorEnabled=!0,this.m_mesh=e.createRectXOY(-.5*t,-.5*t,t,t),this.initEntity()}initializeRectXOY(t,e){this.m_bw=t,this.m_bh=e;let i=CoMesh.line;i.dynColorEnabled=!0,this.m_mesh=i.createRectXOY(-.5*t,-.5*e,t,e),this.initEntity()}initializeCircleXOY(t,e,i=null){this.m_bw=t,this.m_bh=t;let s=CoMesh.line;s.dynColorEnabled=!0,this.m_mesh=s.createCircleXOY(t,e,i),this.initEntity()}setRGBA4f(t,e,i,s){this.m_uniformData[4]=t,this.m_uniformData[5]=e,this.m_uniformData[6]=i,this.m_uniformData[7]=s}setRGB3f(t,e,i){this.m_uniformData[4]=t,this.m_uniformData[5]=e,this.m_uniformData[6]=i}setFadeFactor(t){this.m_uniformData[7]=t}getFadeFactor(){return this.m_uniformData[7]}setRGBAOffset4f(t,e,i,s){this.m_uniformData[8]=t,this.m_uniformData[9]=e,this.m_uniformData[10]=i,this.m_uniformData[11]=s}setRGBOffset3f(t,e,i){this.m_uniformData[8]=t,this.m_uniformData[9]=e,this.m_uniformData[10]=i}getRotationZ(){return this.m_rz}setRotationZ(t){this.m_rz=t,this.m_uniformData[2]=t*(t*Math.PI/180)}getScaleX(){return this.m_uniformData[0]}getScaleY(){return this.m_uniformData[1]}setScaleX(t){this.m_uniformData[0]=t}setScaleY(t){this.m_uniformData[1]=t}setScaleXY(t,e){this.m_uniformData[0]=t,this.m_uniformData[1]=e}setXYZ(t,e,i){this.entity.setXYZ(t,e,i)}setPosition(t){this.entity.setPosition(t)}setVisible(t){this.entity.setVisible(t)}getVisible(){return this.entity.getVisible()}setDepthOffset(t){this.m_uniformData[3]=t}getUniformData(){return this.m_uniformData}update(){this.entity.update()}destroy(){null!=this.entity&&(this.entity.destroy(),this.entity=null),null!=this.m_material&&(this.m_material.destroy(),this.m_material=null),this.m_mesh=null,this.m_uniformData=null}}e.BillboardLine=l},"1c4a":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const l=i("f65f"),a=i("0ea1"),r=s(i("2a08")),n=s(i("0002"));function h(){return new l.Billboard}function o(){return new a.BillboardLine}function m(){return new r.default}function _(){return new n.default}e.createBillboard=h,e.createBillboardLine=o,e.createBillboardFlareGroup=m,e.createBillboardFlowGroup=_},"1eb2":function(t,e,i){"use strict";if("undefined"!==typeof window){var s=window.document.currentScript,l=i("8875");s=l(),"currentScript"in document||Object.defineProperty(document,"currentScript",{get:l});var a=s&&s.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);a&&(i.p=a[1])}},2856:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const l=s(i("67f4"));class a{constructor(){this.material=null,this.fogEnabled=!1,this.brightnessEnabled=!0,this.alphaEnabled=!1,this.rotationEnabled=!1}buildShader(t){let e=t.getShaderCodeBuilder();if(this.rotationEnabled&&e.addDefine("VOX_ROTATION"),this.brightnessEnabled){const e=CoRScene.MaterialPipeType;let i=t.fogEnabled,s=t.pipeline;null!=s&&(i=i||s.hasPipeByType(e.FOG_EXP2),i=i||s.hasPipeByType(e.FOG)),t.brightnessOverlayEnabeld=i}e.addVertLayout("vec3","a_vs"),e.addVarying("vec4","v_colorMult"),e.addVarying("vec4","v_colorOffset"),e.addVertUniform("vec4","u_billParam",3),e.addDefine("FADE_VAR","fv4");let i="\n    vec4 color = vec4(1.0);\n    vec3 offsetColor = v_colorOffset.rgb;\n    vec4 fv4 = v_colorMult.wwww;\n",s=a.s_billFS.getBrnAndAlphaCode(),l="\n    FragColor0 = color;\n";e.addFragMainCode(i+s+l),e.addVertMainCode("\n    vec4 temp = u_billParam[0];\n    float cosv = cos(temp.z);\n    float sinv = sin(temp.z);\n    vec2 vtx = a_vs.xy * temp.xy;\n    vec2 vtx_pos = vec2(vtx.x * cosv - vtx.y * sinv, vtx.x * sinv + vtx.y * cosv);\n    viewPosition = u_viewMat * u_objMat * vec4(0.0,0.0,0.0,1.0);\n    viewPosition.xy += vtx_pos.xy;\n    gl_Position =  u_projMat * viewPosition;\n    gl_Position.z = ((gl_Position.z / gl_Position.w) + temp.w) * gl_Position.w;\n    v_colorMult = u_billParam[1];\n    v_colorOffset = u_billParam[2];\n")}initialize(t){if(null==this.material){let e="co_billboard_line_entity_material";this.rotationEnabled&&(e+="Rot"),e+=this.brightnessEnabled?"Brn":"Alp";let i=CoRScene.createShaderMaterial(e);i.fogEnabled=this.fogEnabled,i.setShaderBuilder(t=>{this.buildShader(t)}),i.initializeByCodeBuf(t),this.material=i}}destroy(){null!=this.material&&(this.material.destroy(),this.material=null)}}a.s_billFS=new l.default,e.BillboardLineMaterial=a},"2a08":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const l=s(i("85e1")),a=i("c7c6");class r{constructor(){this.m_billMaterial=null,this.m_billMesh=null,this.m_brightnessEnabled=!0,this.m_alphaEnabled=!1,this.m_clipEnabled=!1,this.m_clipMixEnabled=!1,this.entity=CoRScene.createDisplayEntity(),this.vbWholeDataEnabled=!1,this.flipVerticalUV=!1,this.premultiplyAlpha=!1,this.entity.setRenderState(CoRScene.RendererState.BACK_ADD_BLENDSORT_STATE)}createGroup(t){t>0&&null==this.m_billMesh&&(this.m_billMesh=new l.default,this.m_billMesh.createData(t))}createMaterial(t){null==this.m_billMaterial&&(this.m_billMaterial=new a.BillboardFlareMaterial(this.m_brightnessEnabled,this.m_alphaEnabled,this.m_clipEnabled),this.m_billMaterial.diffuseMap=t[0],this.m_billMaterial.premultiplyAlpha=this.premultiplyAlpha,this.m_billMaterial.initialize(),this.entity.setMaterial(this.m_billMaterial.material),this.m_billMaterial.material.initializeByCodeBuf(t.length>0))}activeMesh(t){let e=this.m_billMesh.mesh;e.vbWholeDataEnabled=this.vbWholeDataEnabled,this.m_billMesh.flipVerticalUV=this.flipVerticalUV,e.setBufSortFormat(t.getBufSortFormat()),this.m_billMesh.initialize(),this.entity.setMesh(e)}initialize(t,e,i,s){this.m_clipEnabled=i,this.m_brightnessEnabled=t,this.m_alphaEnabled=e,null!=this.m_billMesh&&(this.createMaterial(s),this.activeMesh(this.m_billMaterial.material))}setDepthOffset(t){this.m_billMaterial.setDepthOffset(t)}setSizeAndScaleAt(t,e,i,s,l){null!=this.m_billMesh&&this.m_billMesh.setSizeAndScaleAt(t,e,i,s,l)}setPositionAt(t,e,i,s){null!=this.m_billMesh&&this.m_billMesh.setPositionAt(t,e,i,s)}setUVRectAt(t,e,i,s,l){null!=this.m_billMesh&&this.m_billMesh.setUVRectAt(t,e,i,s,l)}setTimeAt(t,e,i,s,l=1){null!=this.m_billMesh&&this.m_billMesh.setTimeAt(t,e,i,s,l)}setAlphaAt(t,e){null!=this.m_billMesh&&this.m_billMesh.setAlphaAt(t,e)}setBrightnessAt(t,e){null!=this.m_billMesh&&this.m_billMesh.setBrightnessAt(t,e)}setRGBA4f(t,e,i,s){null!=this.m_billMaterial&&this.m_billMaterial.setRGBA4f(t,e,i,s)}setRGB3f(t,e,i){null!=this.m_billMaterial&&this.m_billMaterial.setRGB3f(t,e,i)}setRGBAOffset4f(t,e,i,s){null!=this.m_billMaterial&&this.m_billMaterial.setRGBAOffset4f(t,e,i,s)}setRGBOffset3f(t,e,i){null!=this.m_billMaterial&&this.m_billMaterial.setRGBOffset3f(t,e,i)}setAlpha(t){null!=this.m_billMaterial&&this.m_billMaterial.setAlpha(t)}getAlpha(){return this.m_billMaterial.getAlpha()}setBrightness(t){this.m_billMaterial.setBrightness(t)}getBrightness(){return this.m_billMaterial.getBrightness()}setClipUVParam(t,e,i,s){this.m_clipEnabled&&null!=this.m_billMaterial&&this.m_billMaterial.setClipUVParam(t,e,i,s)}getTime(){return this.m_billMaterial.getTime()}setTime(t){this.m_billMaterial.setTime(t)}updateTime(t){this.m_billMaterial.updateTime(t)}getScaleX(){return this.m_billMaterial.getScaleX()}getScaleY(){return this.m_billMaterial.getScaleY()}setScaleX(t){this.m_billMaterial.setScaleX(t)}setScaleY(t){this.m_billMaterial.setScaleY(t)}setScaleXY(t,e){this.m_billMaterial.setScaleXY(t,e)}setPlayParam(t){this.m_clipMixEnabled=t}toTransparentBlend(t=!1){t?this.entity.setRenderState(CoRScene.RendererState.BACK_TRANSPARENT_ALWAYS_STATE):this.entity.setRenderState(CoRScene.RendererState.BACK_TRANSPARENT_STATE)}toBrightnessBlend(t=!1){t?this.entity.setRenderState(CoRScene.RendererState.BACK_ADD_ALWAYS_STATE):this.entity.setRenderState(CoRScene.RendererState.BACK_ADD_BLENDSORT_STATE)}setUV(t,e,i,s){null!=this.m_billMesh&&this.m_billMesh.setUV(t,e,i,s)}update(){this.entity.update()}destroy(){null!=this.entity&&(this.entity.destroy(),this.entity=null),null!=this.m_billMesh&&(this.m_billMesh.destroy(),this.m_billMesh=null),null!=this.m_billMaterial&&(this.m_billMaterial.destroy(),this.m_billMaterial=null)}}e.default=r},"2a55":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("8af9");class l extends s.BillboardGroupDcrBase{constructor(){super()}initialize(t){super.initialize(t),this.m_uniqueName="flare_"+this.m_uniqueName}buildVertShd(t){t.addDefine("VOX_PARTICLE_FLARE","1"),t.addVertLayout("vec4","a_vs"),t.addVertLayout("vec2","a_uvs"),t.addVertLayout("vec4","a_vs2"),t.addVertLayout("vec4","a_uvs2");let e=this.m_clipEnabled?4:3;t.addVertUniform("vec4","u_billParam",e),this.m_clipEnabled&&t.addDefine("BILL_PARAM_INDEX","3")}}e.BillboardFlareDcr=l},4175:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const l=i("af51"),a=s(i("b3bd"));class r{constructor(t=!0,e=!1,i=!1){this.m_brightnessEnabled=!0,this.m_alphaEnabled=!1,this.m_clipEnabled=!1,this.m_clipMixEnabled=!1,this.m_playOnce=!1,this.m_direcEnabled=!1,this.m_spdScaleEnabled=!1,this.m_time=0,this.m_uniformData=null,this.m_color=CoRScene.createColor4(1,1,1,1),this.m_brightness=1,this.m_dcr=new l.BillboardFlowDcr,this.diffuseMap=null,this.premultiplyAlpha=!1,this.material=null,this.m_brightnessEnabled=t,this.m_alphaEnabled=e,this.m_clipEnabled=i}initialize(){this.m_clipEnabled?this.m_uniformData=new Float32Array([1,1,0,0,1,1,1,1,0,0,0,0,0,0,0,2,2,4,.5,.5]):this.m_uniformData=new Float32Array([1,1,0,0,1,1,1,0,0,0,0,0,0,0,0,2]),this.buildDcr()}setPlayParam(t,e,i=!1,s=!1){this.m_playOnce=t,this.m_direcEnabled=e,this.m_clipMixEnabled=i,this.m_spdScaleEnabled=s}buildDcr(){let t=this.m_dcr;t.diffuseMap=this.diffuseMap,t.playOnce=this.m_playOnce,t.direcEnabled=this.m_direcEnabled,t.clipMixEnabled=this.m_clipMixEnabled,t.spdScaleEnabled=this.m_spdScaleEnabled,t.premultiplyAlpha=this.premultiplyAlpha,t.brightnessEnabled=this.m_brightnessEnabled,t.setParam(this.m_brightnessEnabled,this.m_alphaEnabled,this.m_clipEnabled,null!=t.diffuseMap),t.setUniformData(this.createSelfUniformData()),this.material=CoRScene.createMaterial(t)}createSelfUniformData(){let t=new a.default;return t.uniformNameList=["u_billParam"],t.dataList=[this.m_uniformData],t}setRGBA4f(t,e,i,s){this.m_color.r=t,this.m_color.g=e,this.m_color.b=i,this.m_color.a=s,this.m_uniformData[4]=t*this.m_brightness,this.m_uniformData[5]=e*this.m_brightness,this.m_uniformData[6]=i*this.m_brightness}setRGB3f(t,e,i){this.m_color.r=t,this.m_color.g=e,this.m_color.b=i,this.m_uniformData[4]=t*this.m_brightness,this.m_uniformData[5]=e*this.m_brightness,this.m_uniformData[6]=i*this.m_brightness}setAlpha(t){this.m_uniformData[7]=t}getAlpha(){return this.m_uniformData[6]}setBrightness(t){this.m_brightness=t,this.m_uniformData[4]=this.m_color.r*t,this.m_uniformData[5]=this.m_color.g*t,this.m_uniformData[6]=this.m_color.b*t}getBrightness(){return this.m_brightness}setRGBAOffset4f(t,e,i,s){this.m_uniformData[8]=t,this.m_uniformData[9]=e,this.m_uniformData[10]=i,this.m_uniformData[11]=s}setRGBOffset3f(t,e,i){this.m_uniformData[8]=t,this.m_uniformData[9]=e,this.m_uniformData[10]=i}setAcceleration(t,e,i){this.m_uniformData[12]=t,this.m_uniformData[13]=e,this.m_uniformData[14]=i}setSpdScaleMax(t,e=1){t<1&&(t=1),t>10&&(t=10),e<.1&&(e=.1),e>5&&(e=5),this.m_uniformData[15]=t,this.m_uniformData[7]=e}setClipUVParam(t,e,i,s){this.m_clipEnabled&&(this.m_uniformData[16]=t,this.m_uniformData[17]=e,this.m_uniformData[18]=i,this.m_uniformData[19]=s)}getTime(){return this.m_time}setTime(t){this.m_time=t,this.m_uniformData[2]=t}updateTime(t){this.m_time+=t,this.m_uniformData[2]=this.m_time}getScaleX(){return this.m_uniformData[0]}getScaleY(){return this.m_uniformData[1]}setScaleX(t){this.m_uniformData[0]=t}setScaleY(t){this.m_uniformData[1]=t}setScaleXY(t,e){this.m_uniformData[0]=t,this.m_uniformData[1]=e}setDepthOffset(t){this.m_uniformData[3]=t}getUniformData(){return this.m_uniformData}destroy(){this.m_uniformData=null,this.diffuseMap=null,null!=this.material&&(this.material.destroy(),this.material=null)}}e.BillboardFlowMaterial=r},"561f":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.m_ivs=null,this.m_vs=null,this.m_vs2=null,this.m_uvs=null,this.m_uvs2=null,this.m_nvs=null,this.m_nvs2=null,this.m_total=0,this.m_endTime=0,this.flipVerticalUV=!1,this.mesh=CoRScene.createRawMesh()}setUVSFloatArr(t){null==this.m_uvs&&(this.m_uvs=new Float32Array(8)),this.m_uvs.set(t,0)}setUVSArr(t){null==this.m_uvs&&(this.m_uvs=new Float32Array(8)),this.m_uvs.set(t,0)}createData(t){if(null==this.m_vs&&t>0){this.m_endTime=0,this.m_total=t;let e=0,i=0,s=[0,1,2,0,2,3],l=new Uint16Array(6*t),a=6*t;for(e=0;e<a;)l[e++]=s[0]+i,l[e++]=s[1]+i,l[e++]=s[2]+i,l[e++]=s[3]+i,l[e++]=s[4]+i,l[e++]=s[5]+i,i+=4;this.m_ivs=l,this.m_vs=new Float32Array(16*t),this.m_vs2=new Float32Array(16*t),this.m_vs2.fill(1),this.m_uvs=new Float32Array(8*t),this.m_uvs2=new Float32Array(16*t),this.m_nvs=new Float32Array(16*t),this.m_nvs2=new Float32Array(16*t);let r=[0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1];for(e=0;e<t;++e)this.m_nvs.set(r,16*e);let n=[];for(n=this.flipVerticalUV?[0,0,1,0,1,1,0,1]:[0,1,1,1,1,0,0,0],e=0;e<t;++e)this.m_uvs.set(n,8*e);this.bounds=CoRScene.createAABB()}}setSizeAndScaleAt(t,e,i,s,l){if(t>=0&&t<this.m_total){let a=.5*e,r=.5*i,n=-a,h=-r,o=l-s;t*=16,this.m_vs[t++]=n,this.m_vs[t++]=h,this.m_vs[t++]=s,this.m_vs[t++]=o,this.m_vs[t++]=a,this.m_vs[t++]=h,this.m_vs[t++]=s,this.m_vs[t++]=o,this.m_vs[t++]=a,this.m_vs[t++]=r,this.m_vs[t++]=s,this.m_vs[t++]=o,this.m_vs[t++]=n,this.m_vs[t++]=r,this.m_vs[t++]=s,this.m_vs[t++]=o,this.bounds.addXYZ(n,h,n),this.bounds.addXYZ(a,r,a)}}setPositionAt(t,e,i,s){if(t>=0&&t<this.m_total){t*=16;for(let l=0;l<4;++l)this.m_vs2[t++]=e,this.m_vs2[t++]=i,this.m_vs2[t++]=s,t++}}setVelocityAt(t,e,i,s){if(t>=0&&t<this.m_total){t*=16;for(let l=0;l<4;++l)this.m_nvs[t++]=e,this.m_nvs[t++]=i,this.m_nvs[t++]=s,t++}}setAccelerationAt(t,e,i,s){if(t>=0&&t<this.m_total){t*=16;for(let l=0;l<4;++l)this.m_nvs2[t++]=e,this.m_nvs2[t++]=i,this.m_nvs2[t++]=s,t++}}setAlphaAt(t,e){if(t>=0&&t<this.m_total){t=16*t+3;for(let i=0;i<4;++i)this.m_vs2[t]=e,t+=4}}setBrightnessAt(t,e){if(t>=0&&t<this.m_total){t=16*t+3;for(let i=0;i<4;++i)this.m_vs2[t]=e,t+=4}}setUVRectAt(t,e,i,s,l){t>=0&&t<this.m_total&&(t*=8,this.flipVerticalUV?(this.m_uvs[t++]=e,this.m_uvs[t++]=i,this.m_uvs[t++]=e+s,this.m_uvs[t++]=i,this.m_uvs[t++]=e+s,this.m_uvs[t++]=i+l,this.m_uvs[t++]=e,this.m_uvs[t]=i+l):(this.m_uvs[t++]=e,this.m_uvs[t++]=i+l,this.m_uvs[t++]=e+s,this.m_uvs[t++]=i+l,this.m_uvs[t++]=e+s,this.m_uvs[t++]=i,this.m_uvs[t++]=e,this.m_uvs[t]=i))}setTimeAt(t,e,i,s,l=0){if(t>=0&&t<this.m_total){e<.1&&(e=.1),i>.9&&(i=.9),s<i&&(s=i),t*=16;for(let a=0;a<4;++a)this.m_uvs2[t++]=e,this.m_uvs2[t++]=i,this.m_uvs2[t++]=s,this.m_uvs2[t++]=l;this.m_endTime<l+e&&(this.m_endTime=l+e)}}setTimeSpeedAt(t,e){if(t>=0&&t<this.m_total){t=16*t+3;for(let i=0;i<4;++i)this.m_nvs[t]=e,t+=4}}getEndTime(){return this.m_endTime}initialize(){let t=this.mesh;t.autoBuilding=!1,t.reset(),t.addFloat32Data(this.m_vs,4),t.addFloat32Data(this.m_uvs,2),t.addFloat32Data(this.m_nvs,4),t.addFloat32Data(this.m_vs2,4),t.addFloat32Data(this.m_uvs2,4),t.addFloat32Data(this.m_nvs2,4),t.setIVS(this.m_ivs),t.bounds=this.bounds,t.initialize(),t.vtxTotal=4*this.m_total,t.trisNumber=2*this.m_total}setUV(t,e,i,s){let l=this.mesh;null!=l&&(l.setBufData2fAt(0,1,t,e+s),l.setBufData2fAt(1,1,t+i,e+s),l.setBufData2fAt(2,1,t+i,e),l.setBufData2fAt(3,1,t,e))}destroy(){this.m_vs=null,this.m_vs2=null,this.m_uvs=null,this.m_uvs2=null,this.m_nvs=null,this.m_nvs2=null,this.m_ivs=null,this.bounds=null,this.mesh=null}}e.default=s},"67f4":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.m_brnAStatus=0}getBrnAlphaStatus(){return this.m_brnAStatus}setBrightnessAndAlpha(t,e){this.m_brnAStatus=10*Number(t)+Number(e)}getBrnAndAlphaCode(){let t;return t=11==this.m_brnAStatus?"\ncolor.rgb = color.rgb * v_colorMult.xyz + color.aaa * offsetColor;\ncolor *= FADE_VAR.zzzz;\n":10==this.m_brnAStatus?"\ncolor.rgb = min(color.rgb * v_colorMult.xyz + color.rgb * offsetColor, vec3(1.0));\ncolor.rgb *= FADE_VAR.zzz;\n":1==this.m_brnAStatus?"\ncolor.rgb = color.rgb * v_colorMult.xyz + color.aaa * offsetColor;\ncolor.a *= FADE_VAR.z;\n":"\ncolor.rgb = color.rgb * v_colorMult.xyz + offsetColor;\ncolor.a *= FADE_VAR.z;\n",t}getMixThreeColorsCode(){let t="\nvec4 mixThreeColors(vec4 color0,vec4 color1,vec4 color2,float t)\n{\n    float k0 = max(1.0 - 2.0 * t, 0.0);\n    float k = max(t - 0.5, 0.0);\n    float k1 = (1.0 - (2.0 * k)) * step(-0.00001,k);\n    k = step(0.00001,k0);\n    return mix(mix(color2,color1,k1), mix(color1,color0,k0), k);\n}\n";return t}getOffsetColorCode(t,e=!1){let i;return i=t?e?"\nvec3 offsetColor = clamp(v_colorOffset.xyz + texture(VOX_OFFSET_COLOR_MAP, v_uv.xy).xyz,vec3(0.0),vec3(1.0));\n":"\nvec3 offsetColor = clamp(v_colorOffset.xyz + texture(VOX_OFFSET_COLOR_MAP, v_texUV.xy).xyz,vec3(0.0),vec3(1.0));\n":"\nvec3 offsetColor = v_colorOffset.xyz;\n",i}}e.default=s},"85e1":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.m_ivs=null,this.m_vs=null,this.m_vs2=null,this.m_uvs=null,this.m_uvs2=null,this.m_total=0,this.flipVerticalUV=!1,this.mesh=CoRScene.createRawMesh()}setUVSFloatArr(t){null==this.m_uvs&&(this.m_uvs=new Float32Array(8)),this.m_uvs.set(t,0)}setUVSArr(t){null==this.m_uvs&&(this.m_uvs=new Float32Array(8)),this.m_uvs.set(t,0)}createData(t){if(null==this.m_vs&&t>0){this.m_total=t;let e=0,i=0,s=[0,1,2,0,2,3],l=new Uint16Array(6*t),a=6*t;for(e=0;e<a;)l[e++]=s[0]+i,l[e++]=s[1]+i,l[e++]=s[2]+i,l[e++]=s[3]+i,l[e++]=s[4]+i,l[e++]=s[5]+i,i+=4;this.m_ivs=l,this.m_vs=new Float32Array(16*t),this.m_vs2=new Float32Array(16*t),this.m_vs2.fill(1),this.m_uvs=new Float32Array(8*t),this.m_uvs2=new Float32Array(16*t);let r=[];for(r=this.flipVerticalUV?[0,0,1,0,1,1,0,1]:[0,1,1,1,1,0,0,0],e=0;e<t;++e)this.m_uvs.set(r,8*e);this.bounds=CoRScene.createAABB()}}setSizeAndScaleAt(t,e,i,s,l){if(t>=0&&t<this.m_total){let a=.5*e,r=.5*i,n=-a,h=-r,o=l-s;t*=16,this.m_vs[t++]=n,this.m_vs[t++]=h,this.m_vs[t++]=s,this.m_vs[t++]=o,this.m_vs[t++]=a,this.m_vs[t++]=h,this.m_vs[t++]=s,this.m_vs[t++]=o,this.m_vs[t++]=a,this.m_vs[t++]=r,this.m_vs[t++]=s,this.m_vs[t++]=o,this.m_vs[t++]=n,this.m_vs[t++]=r,this.m_vs[t++]=s,this.m_vs[t++]=o,this.bounds.addXYZ(n,h,n),this.bounds.addXYZ(a,r,a)}}setPositionAt(t,e,i,s){if(t>=0&&t<this.m_total){t*=16;for(let l=0;l<4;++l)this.m_vs2[t++]=e,this.m_vs2[t++]=i,this.m_vs2[t++]=s,t++}}setAlphaAt(t,e){if(t>=0&&t<this.m_total){t=16*t+3;for(let i=0;i<4;++i)this.m_vs2[t]=e,t+=4}}setBrightnessAt(t,e){if(t>=0&&t<this.m_total){t=16*t+3;for(let i=0;i<4;++i)this.m_vs2[t]=e,t+=4}}setUVRectAt(t,e,i,s,l){t>=0&&t<this.m_total&&(t*=8,this.flipVerticalUV?(this.m_uvs[t++]=e,this.m_uvs[t++]=i,this.m_uvs[t++]=e+s,this.m_uvs[t++]=i,this.m_uvs[t++]=e+s,this.m_uvs[t++]=i+l,this.m_uvs[t++]=e,this.m_uvs[t]=i+l):(this.m_uvs[t++]=e,this.m_uvs[t++]=i+l,this.m_uvs[t++]=e+s,this.m_uvs[t++]=i+l,this.m_uvs[t++]=e+s,this.m_uvs[t++]=i,this.m_uvs[t++]=e,this.m_uvs[t]=i))}setTimeAt(t,e,i,s,l=1){if(t>=0&&t<this.m_total){e<.1&&(e=.1),i>.9&&(i=.9),s<i&&(s=i),t*=16;for(let a=0;a<4;++a)this.m_uvs2[t++]=e,this.m_uvs2[t++]=i,this.m_uvs2[t++]=s,this.m_uvs2[t++]=l}}initialize(){let t=this.mesh;t.autoBuilding=!1,t.reset(),t.addFloat32Data(this.m_vs,4),t.addFloat32Data(this.m_uvs,2),t.addFloat32Data(this.m_vs2,4),t.addFloat32Data(this.m_uvs2,4),t.setIVS(this.m_ivs),t.bounds=this.bounds,t.initialize(),t.vtxTotal=4*this.m_total,t.trisNumber=2*this.m_total}setUV(t,e,i,s){let l=this.mesh;null!=l&&(l.setBufData2fAt(0,1,t,e+s),l.setBufData2fAt(1,1,t+i,e+s),l.setBufData2fAt(2,1,t+i,e),l.setBufData2fAt(3,1,t,e))}destroy(){this.m_vs=null,this.m_vs2=null,this.m_uvs=null,this.m_uvs2=null,this.m_ivs=null,this.bounds=null,this.mesh=null}}e.default=s},8875:function(t,e,i){var s,l,a;(function(i,r){l=[],s=r,a="function"===typeof s?s.apply(e,l):s,void 0===a||(t.exports=a)})("undefined"!==typeof self&&self,(function(){function t(){var e=Object.getOwnPropertyDescriptor(document,"currentScript");if(!e&&"currentScript"in document&&document.currentScript)return document.currentScript;if(e&&e.get!==t&&document.currentScript)return document.currentScript;try{throw new Error}catch(f){var i,s,l,a=/.*at [^(]*\((.*):(.+):(.+)\)$/gi,r=/@([^@]*):(\d+):(\d+)\s*$/gi,n=a.exec(f.stack)||r.exec(f.stack),h=n&&n[1]||!1,o=n&&n[2]||!1,m=document.location.href.replace(document.location.hash,""),_=document.getElementsByTagName("script");h===m&&(i=document.documentElement.outerHTML,s=new RegExp("(?:[^\\n]+?\\n){0,"+(o-2)+"}[^<]*<script>([\\d\\D]*?)<\\/script>[\\d\\D]*","i"),l=i.replace(s,"$1").trim());for(var u=0;u<_.length;u++){if("interactive"===_[u].readyState)return _[u];if(_[u].src===h)return _[u];if(h===m&&_[u].innerHTML&&_[u].innerHTML.trim()===l)return _[u]}return null}}return t}))},"8af9":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const l=i("f3a2"),a=s(i("67f4")),r=i("fba3");class n{constructor(){this.m_clipEnabled=!1,this.m_hasOffsetColorTex=!1,this.m_useRawUVEnabled=!1,this.m_brightnessEnabled=!1,this.m_udata=null,this.vertColorEnabled=!1,this.premultiplyAlpha=!1,this.shadowReceiveEnabled=!1,this.lightEnabled=!1,this.fogEnabled=!1,this.envAmbientLightEnabled=!1,this.brightnessOverlayEnabeld=!1,this.glossinessEnabeld=!0,this.clipMixEnabled=!1,this.brightnessEnabled=!1}initialize(t){this.m_uniqueName="BillboardGroupShader",this.clipMixEnabled&&(this.m_uniqueName+="Mix"),this.m_uniqueName+=this.brightnessEnabled?"Brn":"Alp"}setParam(t,e,i,s){this.m_brightnessEnabled=t,n.s_billFS.setBrightnessAndAlpha(t,e),this.m_clipEnabled=i,this.m_hasOffsetColorTex=s}buildVertShd(t){}getShaderCodeObject(){return r.BillboardGroupShaderCode}buildShader(t){t.autoBuildHeadCodeEnabled=!1,this.buildFragShd(t),this.buildVertShd(t)}buildFragShd(t){this.brightnessEnabled&&(this.brightnessOverlayEnabeld=this.fogEnabled),this.m_hasOffsetColorTex&&this.m_useRawUVEnabled&&(t.addDefine("VOX_USE_RAW_UV"),t.addVarying("vec4","v_uv")),t.addVarying("vec4","v_colorMult"),t.addVarying("vec4","v_colorOffset"),t.addVarying("vec4","v_texUV"),t.addVarying("vec4","v_factor"),this.m_clipEnabled&&(t.addDefine("VOX_USE_CLIP"),this.clipMixEnabled&&t.addDefine("VOX_USE_CLIP_MIX")),t.addDefine("FADE_VAR","v_factor"),t.addDefine("FADE_STATUS",""+n.s_billFS.getBrnAlphaStatus())}buildBufParams(){}buildTextureList(t){t.addDiffuseMap(this.diffuseMap),this.m_hasOffsetColorTex&&t.add2DMap(this.offsetColorMap,"VOX_OFFSET_COLOR_MAP")}setUniformData(t){this.m_udata=t}createUniformData(){return this.m_udata}getShaderCodeObjectUUID(){return l.ShaderCodeUUID.None}getUniqueName(){let t=this.m_uniqueName+"_"+n.s_billFS.getBrnAlphaStatus();return this.m_hasOffsetColorTex&&this.m_clipEnabled&&(t+="ClipColorTex"),this.premultiplyAlpha&&(t+="PreMAlpha"),t}}n.s_billFS=new a.default,e.BillboardGroupDcrBase=n},af51:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("8af9");class l extends s.BillboardGroupDcrBase{constructor(){super(),this.playOnce=!1,this.direcEnabled=!1,this.spdScaleEnabled=!1}initialize(t){super.initialize(t),this.m_uniqueName="flow_"+this.m_uniqueName,this.playOnce&&this.direcEnabled?this.m_uniqueName+="_OD":this.playOnce?this.m_uniqueName+="_O":this.direcEnabled&&(this.m_uniqueName+="_D",this.spdScaleEnabled&&(this.m_uniqueName+="SpdScale")),this.premultiplyAlpha&&(this.m_uniqueName+="PreMAlpha")}buildVertShd(t){t.addVertLayout("vec4","a_vs"),t.addVertLayout("vec2","a_uvs"),t.addVertLayout("vec4","a_nvs"),t.addVertLayout("vec4","a_vs2"),t.addVertLayout("vec4","a_uvs2"),t.addVertLayout("vec4","a_nvs2");let e=this.m_clipEnabled?5:4;t.addVertUniform("vec4","u_billParam",e),this.direcEnabled&&t.addDefine("ROTATION_DIRECT"),this.playOnce&&t.addDefine("PLAY_ONCE"),this.spdScaleEnabled&&t.addDefine("SPEED_SCALE"),this.m_clipEnabled&&t.addDefine("BILL_PARAM_INDEX","4")}}e.BillboardFlowDcr=l},b3bd:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.uns="",this.types=null,this.uniformSize=0,this.uniformNameList=null,this.locations=null,this.dataList=null,this.calcModels=null,this.always=!0,this.next=null}getDataRefFromUniformName(t){if(null!=this.uniformNameList){let e=this.uniformNameList,i=e.length;for(let s=0;s<i;++s)if(t==e[s])return this.dataList[s]}return null}setDataRefFromUniformName(t,e){if(null!=this.uniformNameList){let i=this.uniformNameList,s=i.length;for(let l=0;l<s;++l)if(t==i[l]){this.dataList[l]=e;break}}}copyDataFromProbe(t){this.types=[];for(let e=0;e<t.uniformsTotal;++e)this.types.push(t.uniformTypes[e]);this.uniformSize=t.uniformsTotal}destroy(){let t=0,e=this.dataList.length;for(;t<e;++t)this.dataList[t]=null;if(null!=this.calcModels)for(e=this.calcModels.length,t=0;t<e;++t)this.calcModels[t].destroy(),this.calcModels[t]=null;this.dataList=null,this.types=null,this.locations=null,this.calcModels=null}}e.default=s},c7c6:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const l=i("2a55"),a=s(i("b3bd"));class r{constructor(t=!0,e=!1,i=!1,s=!1){this.m_brightnessEnabled=!0,this.m_alphaEnabled=!1,this.m_clipEnabled=!1,this.m_clipMixEnabled=!1,this.m_uniformData=null,this.m_time=0,this.m_color=CoRScene.createColor4(1,1,1,1),this.m_brightness=1,this.m_dcr=new l.BillboardFlareDcr,this.diffuseMap=null,this.premultiplyAlpha=!1,this.material=null,this.m_brightnessEnabled=t,this.m_alphaEnabled=e,this.m_clipEnabled=i,this.m_clipMixEnabled=s}initialize(){this.m_clipEnabled?this.m_uniformData=new Float32Array([1,1,0,0,1,1,1,0,0,0,0,0,2,4,.5,.5]):this.m_uniformData=new Float32Array([1,1,0,0,1,1,1,0,0,0,0,0]),this.buildDcr()}buildDcr(){let t=this.m_dcr;t.diffuseMap=this.diffuseMap,t.clipMixEnabled=this.m_clipMixEnabled,t.premultiplyAlpha=this.premultiplyAlpha,t.brightnessEnabled=this.m_brightnessEnabled,t.setParam(this.m_brightnessEnabled,this.m_alphaEnabled,this.m_clipEnabled,null!=t.diffuseMap),t.setUniformData(this.createSelfUniformData()),this.material=CoRScene.createMaterial(t),this.material.setDecorator(t)}createSelfUniformData(){let t=new a.default;return t.uniformNameList=["u_billParam"],t.dataList=[this.m_uniformData],t}setDepthOffset(t){this.m_uniformData[3]=t}setRGBA4f(t,e,i,s){this.m_color.r=t,this.m_color.g=e,this.m_color.b=i,this.m_uniformData[4]=t*this.m_brightness,this.m_uniformData[5]=e*this.m_brightness,this.m_uniformData[6]=i*this.m_brightness,this.m_uniformData[7]=s}setRGB3f(t,e,i){this.m_color.r=t,this.m_color.g=e,this.m_color.b=i,this.m_uniformData[4]=t*this.m_brightness,this.m_uniformData[5]=e*this.m_brightness,this.m_uniformData[6]=i*this.m_brightness}setAlpha(t){this.m_uniformData[7]=t}getAlpha(){return this.m_uniformData[6]}setBrightness(t){this.m_brightness=t,this.m_uniformData[4]=this.m_color.r*t,this.m_uniformData[5]=this.m_color.g*t,this.m_uniformData[6]=this.m_color.b*t}getBrightness(){return this.m_brightness}setRGBAOffset4f(t,e,i,s){this.m_uniformData[8]=t,this.m_uniformData[9]=e,this.m_uniformData[10]=i,this.m_uniformData[11]=s}setRGBOffset3f(t,e,i){this.m_uniformData[8]=t,this.m_uniformData[9]=e,this.m_uniformData[10]=i}setClipUVParam(t,e,i,s){this.m_clipEnabled&&(this.m_uniformData[12]=t,this.m_uniformData[13]=e,this.m_uniformData[14]=i,this.m_uniformData[15]=s)}getTime(){return this.m_time}setTime(t){this.m_time=t,this.m_uniformData[2]=t}updateTime(t){this.m_time+=t,this.m_uniformData[2]=this.m_time}getScaleX(){return this.m_uniformData[0]}getScaleY(){return this.m_uniformData[1]}setScaleX(t){this.m_uniformData[0]=t}setScaleY(t){this.m_uniformData[1]=t}setScaleXY(t,e){this.m_uniformData[0]=t,this.m_uniformData[1]=e}destroy(){this.m_uniformData=null,this.diffuseMap=null,null!=this.material&&(this.material.destroy(),this.material=null)}}e.BillboardFlareMaterial=r},dfe4:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.m_vs=null,this.m_uvs=null,this.m_ivs=null,this.flipVerticalUV=!1,this.vtxUVEnabled=!0}initialize(t,e){if(null!=this.m_vs)return;let i=.5*t,s=.5*e,l=-i,a=-s;this.m_ivs=new Uint16Array([1,2,0,3]),this.m_vs=new Float32Array([l,a,i,a,i,s,l,s]),this.vtxUVEnabled&&null==this.m_uvs&&(this.flipVerticalUV?this.m_uvs=new Float32Array([0,0,1,0,1,1,0,1]):this.m_uvs=new Float32Array([0,1,1,1,1,0,0,0]));let r=CoRScene.createDataMesh();r.autoBuilding=!1,r.vtxTotal=4,r.trisNumber=2,r.drawMode=CoRScene.RenderDrawMode.ELEMENTS_TRIANGLE_STRIP,r.bounds=CoRScene.createAABB(),r.bounds.min.setXYZ(l,a,l),r.bounds.max.setXYZ(i,s,i),r.bounds.updateFast(),r.setVS(this.m_vs,2),r.setUVS(this.m_uvs),r.setIVS(this.m_ivs),this.mesh=r}destroy(){this.m_vs=null,this.m_uvs=null,this.m_ivs=null}}e.BillboardMesh=s},f3a2:function(t,e,i){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t["None"]="",t["Default"]="pbr",t["Lambert"]="lambert",t["PBR"]="pbr"}(s||(s={})),e.ShaderCodeUUID=s},f65f:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("fb23"),l=i("dfe4");class a{constructor(){this.m_material=null,this.m_mesh=null,this.m_blendType=0,this.m_blendAlways=!1,this.m_rz=0,this.m_bw=0,this.m_bh=0,this.brightnessEnabled=!0,this.alphaEnabled=!1,this.rotationEnabled=!1,this.fogEnabled=!1,this.entity=null}initEntity(t){if(null==this.m_material){this.m_uniformData=new Float32Array([1,1,0,0,1,1,1,1,0,0,0,0]);let e=this.m_material=new s.BillboardMaterial;e.brightnessEnabled=this.brightnessEnabled,e.alphaEnabled=this.alphaEnabled,e.rotationEnabled=this.rotationEnabled,e.fogEnabled=this.fogEnabled,e.initialize();let i=e.material;i.setTextureList(t),i.addUniformDataAt("u_billParam",this.m_uniformData);let a=this.m_mesh=new l.BillboardMesh;a.initialize(this.m_bw,this.m_bh);let r=a.mesh,n=this.entity=CoRScene.createDisplayEntityWithDataMesh(r,i,!0);const h=CoRScene.RendererState;n.setRenderState(h.BACK_ADD_BLENDSORT_STATE),1==this.m_blendType?this.m_blendAlways?this.entity.setRenderState(h.BACK_TRANSPARENT_STATE):this.entity.setRenderState(h.BACK_TRANSPARENT_ALWAYS_STATE):2==this.m_blendType&&(this.m_blendAlways,this.entity.setRenderState(h.BACK_ADD_BLENDSORT_STATE))}}toTransparentBlend(t=!1){this.brightnessEnabled=!1,this.alphaEnabled=!0,this.m_blendType=1,this.m_blendAlways=t}toBrightnessBlend(t=!1){this.brightnessEnabled=!0,this.alphaEnabled=!1,this.m_blendType=2}initializeSquare(t,e){this.m_bw=t,this.m_bh=t,this.initEntity(e)}initialize(t,e,i){this.m_bw=t,this.m_bh=e,this.initEntity(i)}setRGBA4f(t,e,i,s){this.m_uniformData[4]=t,this.m_uniformData[5]=e,this.m_uniformData[6]=i,this.m_uniformData[7]=s}setRGB3f(t,e,i){this.m_uniformData[4]=t,this.m_uniformData[5]=e,this.m_uniformData[6]=i}setFadeFactor(t){this.m_uniformData[7]=t}getFadeFactor(){return this.m_uniformData[7]}setRGBAOffset4f(t,e,i,s){this.m_uniformData[8]=t,this.m_uniformData[9]=e,this.m_uniformData[10]=i,this.m_uniformData[11]=s}setRGBOffset3f(t,e,i){this.m_uniformData[8]=t,this.m_uniformData[9]=e,this.m_uniformData[10]=i}getRotationZ(){return this.m_rz}setRotationZ(t){this.m_rz=t,this.m_uniformData[2]=t*(t*Math.PI/180)}getScaleX(){return this.m_uniformData[0]}getScaleY(){return this.m_uniformData[1]}setScaleX(t){this.m_uniformData[0]=t}setScaleY(t){this.m_uniformData[1]=t}setScaleXY(t,e){this.m_uniformData[0]=t,this.m_uniformData[1]=e}setXYZ(t,e,i){this.entity.setXYZ(t,e,i)}setPosition(t){this.entity.setPosition(t)}setVisible(t){this.entity.setVisible(t)}getVisible(){return this.entity.getVisible()}setDepthOffset(t){this.m_uniformData[3]=t}getUniformData(){return this.m_uniformData}update(){this.entity.update()}destroy(){null!=this.entity&&(this.entity.destroy(),this.entity=null),null!=this.m_material&&(this.m_material.destroy(),this.m_material=null),null!=this.m_mesh&&(this.m_mesh.destroy(),this.m_mesh=null),this.m_uniformData=null}}e.Billboard=a},fae3:function(t,e,i){"use strict";i.r(e);i("1eb2");var s=i("1c4a");for(var l in s)["default"].indexOf(l)<0&&function(t){i.d(e,t,(function(){return s[t]}))}(l)},fb23:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const l=s(i("67f4"));class a{constructor(){this.material=null,this.fogEnabled=!1,this.brightnessEnabled=!0,this.alphaEnabled=!1,this.rotationEnabled=!1}buildShader(t){let e=t.getShaderCodeBuilder();if(this.rotationEnabled&&e.addDefine("VOX_ROTATION"),this.brightnessEnabled){const e=CoRScene.MaterialPipeType;let i=t.fogEnabled,s=t.pipeline;null!=s&&(i=i||s.hasPipeByType(e.FOG_EXP2),i=i||s.hasPipeByType(e.FOG)),t.brightnessOverlayEnabeld=i}let i=t.getUniform();i.addDiffuseMap(),e.addVertLayout("vec2","a_vs"),e.addVertLayout("vec2","a_uvs"),e.addVarying("vec4","v_colorMult"),e.addVarying("vec4","v_colorOffset"),e.addVarying("vec2","v_uv"),e.addVertUniform("vec4","u_billParam",3),e.addDefine("FADE_VAR","fv4");let s="\n    vec4 color = VOX_Texture2D(VOX_DIFFUSE_MAP, v_uv);\n    vec3 offsetColor = v_colorOffset.rgb;\n    vec4 fv4 = v_colorMult.wwww;\n",l=a.s_billFS.getBrnAndAlphaCode(),r="\n    FragColor0 = color;\n";e.addFragMainCode(s+l+r),e.addVertMainCode("\n    vec4 temp = u_billParam[0];\n    float cosv = cos(temp.z);\n    float sinv = sin(temp.z);\n    vec2 vtx = a_vs.xy * temp.xy;\n    vec2 vtx_pos = vec2(vtx.x * cosv - vtx.y * sinv, vtx.x * sinv + vtx.y * cosv);\n    viewPosition = u_viewMat * u_objMat * vec4(0.0,0.0,0.0,1.0);\n    viewPosition.xy += vtx_pos.xy;\n    gl_Position =  u_projMat * viewPosition;\n    gl_Position.z = ((gl_Position.z / gl_Position.w) + temp.w) * gl_Position.w;\n    v_uv = a_uvs;\n    v_colorMult = u_billParam[1];\n    v_colorOffset = u_billParam[2];\n")}initialize(){if(null==this.material){let t="co_billboard_entity_material";this.rotationEnabled&&(t+="Rot"),t+=this.brightnessEnabled?"Brn":"Alp";let e=CoRScene.createShaderMaterial(t);e.fogEnabled=this.fogEnabled,e.setShaderBuilder(t=>{this.buildShader(t)}),e.initializeByCodeBuf(!0),this.material=e}}destroy(){null!=this.material&&(this.material.destroy(),this.material=null)}}a.s_billFS=new l.default,e.BillboardMaterial=a},fba3:function(t,e,i){"use strict";i.r(e),i.d(e,"BillboardGroupShaderCode",(function(){return n}));var s="    vec4 color = VOX_Texture2D(VOX_DIFFUSE_MAP, v_texUV.xy);\r\n\t#ifdef VOX_BRN_TO_ALPHA\r\n\t\tcolor = vec4(color.xyz, max(length(color.xyz) - 0.03, 0.0));\r\n\t#endif\r\n    #ifdef VOX_USE_CLIP_MIX\r\n\t\tvec4 c1 = VOX_Texture2D(VOX_DIFFUSE_MAP, v_texUV.zw);\r\n\t\t#ifdef VOX_BRN_TO_ALPHA\r\n\t\t\tc1 = vec4(c1.xyz, max(length(c1.xyz) - 0.03, 0.0));\r\n\t\t#endif\r\n\t\tcolor = mix(color, c1,v_factor.x);\r\n    #endif\r\n\r\n    vec3 offsetColor = getOffsetColor();\r\n\r\n    blendBrightnessORAlpha( color, offsetColor );\r\n\r\n    #ifdef VOX_PREMULTIPLY_ALPHA\r\n        color.xyz *= color.aaa;\r\n    #endif\r\n    #ifdef VOX_VERTEX_COLOR\r\n\t\t#ifdef VOX_BRIGHTNESS\r\n        \tcolor.xyz *= v_vtxColor.xyz;\r\n        \tcolor.xyz *= v_vtxColor.www;\r\n\t\t#else\r\n        \tcolor *= v_vtxColor;\r\n\t\t#endif\r\n    #endif\r\n    FragColor0 = color;\r\n    // for test\r\n    // FragColor0 = vec4(vec3(0.3), 1.0);",l="vec3 getOffsetColor() {\r\n    #ifdef VOX_OFFSET_COLOR_MAP\r\n        #ifdef VOX_USE_RAW_UV\r\n            vec3 offsetColor = clamp(v_colorOffset.xyz + VOX_Texture2D(VOX_OFFSET_COLOR_MAP, v_uv.xy).xyz,vec3(0.0),vec3(1.0));\r\n        #else\r\n            vec3 offsetColor = clamp(v_colorOffset.xyz + VOX_Texture2D(VOX_OFFSET_COLOR_MAP, v_texUV.xy).xyz,vec3(0.0),vec3(1.0));\r\n        #endif\r\n    #else\r\n        vec3 offsetColor = v_colorOffset.xyz;\r\n    #endif\r\n    return offsetColor;\r\n}\r\n\r\nvoid blendBrightnessORAlpha(inout vec4 color, in vec3 offsetColor) {\r\n\r\n    #if FADE_STATUS == 11\r\n        color.rgb = color.rgb * v_colorMult.xyz + color.aaa * offsetColor;\r\n        color *= FADE_VAR.zzzz;\r\n    #elif FADE_STATUS == 10\r\n        color.rgb = min(color.rgb * v_colorMult.xyz + color.rgb * offsetColor, vec3(1.0));\r\n        color.rgb *= FADE_VAR.zzz;\r\n    #elif FADE_STATUS == 1\r\n        color.rgb = color.rgb * v_colorMult.xyz + color.aaa * offsetColor;\r\n        color.a *= FADE_VAR.z;\r\n    #else\r\n        color.rgb = color.rgb * v_colorMult.xyz + offsetColor;\r\n        color.a *= FADE_VAR.z;\r\n    #endif\r\n}",a="    vec4 temp = u_billParam[0];\r\n    float zfk = 0.0;\r\n    #ifndef VOX_PARTICLE_FLARE\r\n        float time = max(a_nvs.w * temp.z - a_uvs2.w, 0.0);\r\n        #ifdef PLAY_ONCE\r\n            time = min(time, a_uvs2.x);\r\n        #endif\r\n        float kf = fract(time/a_uvs2.x);\r\n        // discard invisible vtx in the z-space.\r\n        zfk = 1.0 - max(sign(kf - 0.001), 0.0);\r\n        time = kf * a_uvs2.x;\r\n    #else\r\n        float kf = fract(a_uvs2.w * temp.z/a_uvs2.x);\r\n    #endif\r\n\r\n    float fi = kf;\r\n    kf = min(kf/a_uvs2.y,1.0) * (1.0 - max((kf - a_uvs2.z)/(1.0 - a_uvs2.z), 0.0));\r\n    // scale\r\n    vec2 vtx = a_vs.xy * temp.xy * vec2(a_vs.z + kf * a_vs.w);\r\n    #ifndef VOX_PARTICLE_FLARE\r\n        viewPosition = motionCalc(time, vtx);\r\n    #else\r\n        viewPosition = u_viewMat * u_objMat * vec4(a_vs2.xyz,1.0);\r\n    #endif\r\n\r\n    viewPosition.xy += vtx.xy;\r\n    gl_Position =  u_projMat * viewPosition;\r\n    temp = u_billParam[0];\r\n    // use depth offset\r\n    gl_Position.z = ((gl_Position.z / gl_Position.w) + temp.w) * gl_Position.w;\r\n    gl_Position.z -= zfk * 999999.0;\r\n\r\n    v_factor = vec4(0.0,0.0, kf * a_vs2.w, fi);\r\n\r\n\tvec2 uv = a_uvs.xy;\r\n\tvec4 r4;\r\n    #ifdef VOX_VTX_CLIP_RECT\r\n\t\tr4 = a_tvs;\r\n        uv = uv * r4.zw + r4.xy;\r\n    #endif\r\n    #ifdef VOX_CLIP_RECT_INDEX\r\n\t\tr4 = u_billParam[VOX_CLIP_RECT_INDEX];\r\n        uv = uv * r4.zw + r4.xy;\r\n    #endif\r\n    #ifdef VOX_USE_RAW_UV\r\n        v_uv = vec4(uv,0.0,0.0);\r\n    #endif\r\n\r\n    #ifdef VOX_USE_CLIP\r\n        calculateClipUV( fi, a_uvs.xy );\r\n\t\t#ifdef VOX_VTX_CLIP_RECT\r\n\t\t\tv_texUV *= r4.zwzw;\r\n\t\t\tv_texUV += r4.xyxy;\r\n\t\t#endif\r\n\t\t#ifdef VOX_CLIP_RECT_INDEX\r\n\t\t\tv_texUV *= r4.zwzw;\r\n\t\t\tv_texUV += r4.xyxy;\r\n\t\t#endif\r\n    #else\r\n        v_texUV = vec4(uv.xy, uv.xy);\r\n    #endif\r\n\r\n    #ifdef VOX_VERTEX_COLOR\r\n        v_vtxColor = a_cvs;\r\n    #endif\r\n    v_colorMult = u_billParam[1];\r\n    v_colorOffset = u_billParam[2];\r\n",r="#ifdef ROTATION_DIRECT\r\n\r\n// 4.71238898038469\r\n#define MATH_3PER2PI 4.71238898\r\n// 1.5707963267948966\r\n#define MATH_1PER2PI 1.57079633\r\n\r\nfloat getRadianByXY(float dx, float dy) {\r\n\r\n    if(abs(dx) < 0.00001) {\r\n        return (dy >= 0.0) ? MATH_1PER2PI : MATH_3PER2PI;\r\n    }\r\n    float rad = atan(dy/dx);\r\n    return dx >= 0.0 ? rad: (PI + rad);\r\n}\r\n#endif\r\n\r\nconst vec3 biasV3 = vec3(0.1);\r\n\r\n#ifdef VOX_USE_CLIP\r\nvoid calculateClipUV(float fi, in vec2 uv) {\r\n\r\n    #ifdef VOX_USE_CLIP_MIX\r\n        // calculate clip uv\r\n        vec4 temp = u_billParam[ BILL_PARAM_INDEX ];//(x:cn,y:total,z:du,w:dv)\r\n        float clipf0 = floor(fi * temp.y);\r\n        float clipf1 = min(clipf0 + 1.0, temp.y - 1.0);\r\n        clipf0 /= temp.x;\r\n        // vec2(floor(fract(clipf0) * temp.x), floor(clipf0)) -> vec2(cn u,rn v)\r\n        v_texUV.xy = (vec2(floor(fract(clipf0) * temp.x), floor(clipf0)) + uv.xy) * temp.zw;\r\n\r\n        v_factor.x = fract(fi * temp.y);\r\n\r\n        clipf1 /= temp.x;\r\n        v_texUV.zw = (vec2(floor(fract(clipf1) * temp.x), floor(clipf1)) + uv.xy) * temp.zw;\r\n    #else\r\n        // calculate clip uv\r\n        vec4 temp = u_billParam[ BILL_PARAM_INDEX ];//(x:cn,y:total,z:du,w:dv)\r\n        float clipf = floor(fi * temp.y);\r\n        clipf /= temp.x;\r\n        // vec2(floor(fract(clipf) * temp.x), floor(clipf)) -> vec2(cn u,rn v)\r\n        v_texUV.xy = (vec2(floor(fract(clipf) * temp.x), floor(clipf)) + uv.xy) * temp.zw;\r\n    #endif\r\n}\r\n#endif\r\n#ifndef VOX_PARTICLE_FLARE\r\nvec4 motionCalc(float time, inout vec2 vtx) {\r\n    vec3 timeV = vec3(time);\r\n    vec3 acc3 = u_billParam[3].xyz + a_nvs2.xyz;\r\n    #ifdef ROTATION_DIRECT\r\n        #ifdef SPEED_SCALE\r\n            float v0scale = clamp(length(a_nvs.xyz + acc3 * timeV)/u_billParam[1].w,1.0,u_billParam[3].w);\r\n            vtx *= vec2(v0scale, 1.0);\r\n        #endif\r\n\r\n        vec3 pv0 = a_vs2.xyz + (a_nvs.xyz + acc3 * timeV) * timeV;\r\n        timeV += biasV3;\r\n        vec3 pv1 = a_vs2.xyz + (a_nvs.xyz + acc3 * timeV) * timeV;\r\n\r\n        mat4 voMat = u_viewMat * u_objMat;\r\n        vec4 pos = voMat * vec4(pv0,1.0);\r\n        vec4 pos1 = voMat * vec4(pv1,1.0);\r\n        float rad = getRadianByXY(pos1.x - pos.x, pos1.y - pos.y);\r\n        float cosv = cos(rad);\r\n        float sinv = sin(rad);\r\n\r\n        // rotate\r\n        vtx = vec2(vtx.x * cosv - vtx.y * sinv, vtx.x * sinv + vtx.y * cosv);\r\n    #else\r\n        vec4 pos = u_viewMat * u_objMat * vec4(a_vs2.xyz + (a_nvs.xyz + acc3 * timeV) * timeV,1.0);\r\n    #endif\r\n    return pos;\r\n}\r\n#endif";const n={vert:"",vert_head:r,vert_body:a,frag:"",frag_head:l,frag_body:s,uuid:"lambert"}}})}));