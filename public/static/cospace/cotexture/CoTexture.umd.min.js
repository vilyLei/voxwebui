(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t():"function"===typeof define&&define.amd?define([],t):"object"===typeof exports?exports["CoTexture"]=t():e["CoTexture"]=t()})("undefined"!==typeof self?self:this,(function(){return function(e){var t={};function i(r){if(t[r])return t[r].exports;var l=t[r]={i:r,l:!1,exports:{}};return e[r].call(l.exports,l,l.exports,i),l.l=!0,l.exports}return i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var l in e)i.d(r,l,function(t){return e[t]}.bind(null,l));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s="fae3")}({"1ae8":function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=r(i("aeac"));class s extends l.default{constructor(e,t,i,r,l=!1,s=!1){super(t,i),this.m_canvas=null,this.m_canvas2D=null,this.m_rscene=null,this.m_texture=null,this.m_transparent=!1,this.m_fillColor=null;let n=document.createElement("canvas");n.width=t,n.height=i,n.style.display="bolck",n.style.left="0px",n.style.top="0px",n.style.position="absolute",n.style.pointerEvents="none",this.m_transparent=l,l&&(n.style.backgroundColor="transparent"),this.m_fillColor=r,this.m_rscene=e,this.m_canvas=n,this.m_canvas2D=n.getContext("2d"),this.m_canvas2D.fillStyle=l?r.getCSSDecRGBAColor():r.getCSSHeXRGBColor(),this.m_canvas2D.fillRect(0,0,t,i),this.m_uvFlipY=!0,this.m_texture=this.m_rscene.textureBlock.createImageTex2D(32,32,!1),this.m_texture.__$setRenderProxy(this.m_rscene.getRenderProxy()),this.m_texture.setDataFromImage(this.m_canvas,0,0,0,!1),this.m_texture.premultiplyAlpha=!0,s&&(this.m_texture.minFilter=CoRScene.TextureConst.LINEAR,this.m_texture.magFilter=CoRScene.TextureConst.NEAREST),this.m_texture.__$attachThis()}clone(){let e=new s(this.m_rscene,this.m_width,this.m_height,this.m_fillColor,this.m_transparent);return e}getTexture(){return this.m_texture}getCanvas(){return this.m_canvas}addSubImage(e,t){let i=this.getAreaByName(e);if(null!=i)return i;if(i=this.addSubTexArea(e,t.width,t.height),null!=i){let e=i.texRect;this.m_canvas2D.drawImage(t,e.x,e.y,e.width,e.height),this.m_texture.setDataFromImage(this.m_canvas,0,0,0,!1),this.m_texture.updateDataToGpu(null,!0)}return i}setFontName(e){s.s_fontName=e}static CreateCanvas(e,t,i=null,r=!0){let l=document.createElement("canvas");if(l.width=e,l.height=t,l.style.display="bolck",l.style.left="0px",l.style.top="0px",l.style.position="absolute",r&&(l.style.backgroundColor="transparent"),null!=i){let r=l.getContext("2d");r.fillStyle=i.getCSSDecRGBAColor(),r.fillRect(0,0,e,t)}return l}static CreateCharsCanvasWithSize(e,t,i,r,l,n,u=null,a=null){null==u&&(u=CoMaterial.createColor4(0,0,0,1)),null==a&&(a=CoMaterial.createColor4()),e|=0,t|=0;let h=s.CreateCharsCanvas(l,n,u,a);if(e==h.width&&t==h.height)return h;e<h.width&&(e=Math.round(h.width)+i),t<h.height&&(t=Math.round(h.height)+r);let o=Math.round(.5*(e-h.width)),c=Math.round(.5*(t-h.height)),d=s.CreateCanvas(e,t,null),f=d.getContext("2d");return f.fillStyle=a.getCSSDecRGBAColor(),f.fillRect(0,0,e,t),f.drawImage(h,o,c,h.width,h.height),d}static CreateCharsCanvasFixSize(e,t,i,r,l=null,n=null){null==l&&(l=CoMaterial.createColor4(0,0,0,1)),null==n&&(n=CoMaterial.createColor4()),e|=0,t|=0;let u=s.CreateCharsCanvas(i,r,l,n);if(e==u.width&&t==u.height)return u;if(e<u.width)throw Error("width < texImg.width");if(t<u.height)throw Error("height < texImg.height");let a=Math.round(.5*(e-u.width)),h=Math.round(.5*(t-u.height)),o=s.CreateCanvas(e,t,null),c=o.getContext("2d");return c.fillStyle=n.getCSSDecRGBAColor(),c.fillRect(0,0,e,t),c.drawImage(u,a,h,u.width,u.height),o}static CreateCharsCanvas(e,t,i=null,r=null){if(null==e||""==e||t<8)return null;null==i&&(i=CoMaterial.createColor4(0,0,0,1)),null==r&&(r=CoMaterial.createColor4());let l=i.getCSSDecRGBAColor(),n=r.getCSSDecRGBAColor(),u=e+"_"+t+"_"+l+"_"+n,a=s.s_imgMap;if(a.has(u))return a.get(u);let h=t,o=t+2;e.length>1&&(h=t*e.length);let c=s.CreateCanvas(h,o),d=c.getContext("2d");d.font=t-4+"px "+s.s_fontName,d.textBaseline="top";var f=d.measureText(e);let m=f.width;e.length>1&&(h=Math.round(m+8),c.width=h,d=c.getContext("2d"),d.font=t-4+"px "+s.s_fontName,d.textBaseline="top"),d.fillStyle=n,d.fillRect(0,0,h,o),d.textAlign="left",d.fillStyle=l;const _=CoRScene.RendererDevice;return _.IsMobileWeb()&&_.IsIOS()?d.fillText(e,.5*(h-m),-4):d.fillText(e,.5*(h-m),4),a.set(u,c),c}}s.s_imgMap=new Map,s.s_fontName="Verdana",s.s_inputTF=null,t.default=s},"1eb2":function(e,t,i){"use strict";if("undefined"!==typeof window){var r=window.document.currentScript,l=i("8875");r=l(),"currentScript"in document||Object.defineProperty(document,"currentScript",{get:l});var s=r&&r.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);s&&(i.p=s[1])}},"3a65":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i("d101");class l{constructor(e=0,t=0,i=100,l=100){this.rect=null,this.subNodes=null,this.uniqueNS="TexAreaNode",this.subIndex=0,this.m_fillType=r.TexAreaFillType.NONE,this.rect=CoMath.createAABB2D(e,t,i,l)}isFull(){if(null==this.subNodes)return!1;let e=null,t=this.subNodes;if(1==t.length)return!0;for(let i=0;i<t.length;++i)if(e=t[i],!e.isFull())return!1;return!0}fillFour(e,t){let i=!1;if(null==this.subNodes){let t=this.rect,s=.5*this.rect.width,n=.5*this.rect.height,u=new l(t.x,t.y,s,n),a=new l(t.x+s,t.y,s,n),h=new l(t.x+s,t.y+n,s,n),o=new l(t.x,t.y+n,s,n);this.subNodes=[u,a,h,o];for(let e=0;e<this.subNodes.length;++e)this.subNodes[e].subIndex=e;let c=this.subNodes[0];this.subNodes.sort((e,t)=>e.rect.width*e.rect.height-t.rect.width*t.rect.height),this.m_fillType=r.TexAreaFillType.FOUR,i=c.fillOne(e)}else{let t=null,r=this.subNodes;for(let l=0;l<r.length;++l)if(t=r[l],!t.isFull()&&(i=t.addTexArea(e),i))break}return i}fillThree(e){let t=!1;if(null==this.subNodes){let t,i,s=this.rect,n=e.rect,u=new l(s.x,s.y,n.width,n.height);n.width>n.height?(t=new l(s.x+n.width,s.y,this.rect.width-n.width,this.rect.height),i=new l(s.x,s.y+n.height,n.width,this.rect.height-n.height)):(t=new l(s.x+n.width,s.y,this.rect.width-n.width,n.height),i=new l(s.x,s.y+n.height,this.rect.width,this.rect.height-n.height)),this.subNodes=[u,t,i];for(let e=0;e<this.subNodes.length;++e)this.subNodes[e].subIndex=e;let a=this.subNodes[1],h=this.subNodes[2];return a.rect.width*a.rect.height>h.rect.width*h.rect.height&&(this.subNodes[1]=h,this.subNodes[2]=a),this.m_fillType=r.TexAreaFillType.THREE,this.subNodes[0].fillOne(e)}{let i=null,r=this.subNodes;for(let l=0;l<r.length;++l)if(i=r[l],!i.isFull()&&(t=i.addTexArea(e),t))break}return t}fillTwoH(e){if(null==this.subNodes){let t=e.rect.width,i=this.rect.width-e.rect.width,s=this.rect.height,n=this.rect,u=new l(n.x,n.y,t,s),a=new l(n.x+t,n.y,i,s);return this.subNodes=[u,a],this.m_fillType=r.TexAreaFillType.TWO_H,u.fillOne(e)}return!this.subNodes[1].isFull()&&this.subNodes[1].addTexArea(e)}fillTwoV(e){if(null==this.subNodes){let t=this.rect.width,i=e.rect.height,s=this.rect.height-e.rect.height,n=this.rect,u=new l(n.x,n.y,t,i),a=new l(n.x,n.y+i,t,s);return this.subNodes=[u,a],this.m_fillType=r.TexAreaFillType.TWO_V,u.fillOne(e)}return!this.subNodes[1].isFull()&&this.subNodes[1].addTexArea(e)}fillOne(e){let t=!0;return null==this.subNodes&&(this.subNodes=[this],this.m_fillType=r.TexAreaFillType.ONE,e.rect.x=this.rect.x,e.rect.y=this.rect.y,e.update(),this.uniqueNS=e.uniqueNS),t}findByXY(e,t){if(this.rect.containsXY(e,t)&&null!=this.subNodes){if(this.m_fillType==r.TexAreaFillType.ONE)return this;let i;for(let r=0;r<this.subNodes.length;++r)if(i=this.subNodes[r].findByXY(e,t),null!=i)return i}return null}addTexArea(e){let t=e.rect.width,i=e.rect.height;if(this.rect.width<=e.minSize&&this.rect.height<=e.minSize)return t<=this.rect.width&&i<=this.rect.height&&!this.isFull()&&this.fillOne(e);let l=this.rect.width>e.minSize?this.rect.width:e.minSize,s=this.rect.height>e.minSize?this.rect.height:e.minSize;if(t<=l&&i<=s){let n=.5*l,u=.5*s,a=this.m_fillType;if(this.m_fillType==r.TexAreaFillType.NONE)a=t<=n&&i<=u?r.TexAreaFillType.FOUR:t<=n?r.TexAreaFillType.TWO_H:i<=u?r.TexAreaFillType.TWO_V:r.TexAreaFillType.ONE;else if(a==r.TexAreaFillType.ONE)return!1;return!this.isFull()&&(a==r.TexAreaFillType.THREE||a==r.TexAreaFillType.FOUR?this.fillThree(e):a==r.TexAreaFillType.TWO_H?this.fillTwoH(e):a==r.TexAreaFillType.TWO_V?this.fillTwoV(e):this.fillOne(e))}return!1}}t.default=l},"4c79":function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=r(i("af0d")),s=r(i("1ae8"));function n(e,t,i=null,r=null){return null==e||""==e||t<8?null:s.default.CreateCharsCanvas(e,t,i,r)}function u(){return new l.default}function a(e,t,i,r,l=!1,n=!1){return new s.default(e,t,i,r,l,n)}t.ImageTexAtlas=s.default,t.createCharsImage=n,t.createCanvasTexAtlas=u,t.createImageTexAtlas=a},6958:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(e=0,t=0,i=100,r=100){this.uniqueNS="TexArea",this.listIndex=-1,this.atlasUid=0,this.rect=null,this.texRect=null,this.offset=2,this.minSize=32,this.uvs=new Float32Array(8),this.rect=CoMath.createAABB2D(e,t,i,r),this.texRect=CoMath.createAABB2D(e,t,i,r)}copyFrom(e){this.uniqueNS=e.uniqueNS,this.rect.copyFrom(e.rect),this.offset=e.offset,this.uvs.set(e.uvs,0)}update(){this.rect.update()}}t.default=r},8875:function(e,t,i){var r,l,s;(function(i,n){l=[],r=n,s="function"===typeof r?r.apply(t,l):r,void 0===s||(e.exports=s)})("undefined"!==typeof self&&self,(function(){function e(){var t=Object.getOwnPropertyDescriptor(document,"currentScript");if(!t&&"currentScript"in document&&document.currentScript)return document.currentScript;if(t&&t.get!==e&&document.currentScript)return document.currentScript;try{throw new Error}catch(f){var i,r,l,s=/.*at [^(]*\((.*):(.+):(.+)\)$/gi,n=/@([^@]*):(\d+):(\d+)\s*$/gi,u=s.exec(f.stack)||n.exec(f.stack),a=u&&u[1]||!1,h=u&&u[2]||!1,o=document.location.href.replace(document.location.hash,""),c=document.getElementsByTagName("script");a===o&&(i=document.documentElement.outerHTML,r=new RegExp("(?:[^\\n]+?\\n){0,"+(h-2)+"}[^<]*<script>([\\d\\D]*?)<\\/script>[\\d\\D]*","i"),l=i.replace(r,"$1").trim());for(var d=0;d<c.length;d++){if("interactive"===c[d].readyState)return c[d];if(c[d].src===a)return c[d];if(a===o&&c[d].innerHTML&&c[d].innerHTML.trim()===l)return c[d]}return null}}return e}))},aeac:function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=r(i("6958")),s=r(i("3a65"));class n{constructor(e,t){this.m_uid=0,this.m_texAreaNode=null,this.m_keyMap=new Map,this.m_area=new l.default,this.m_offset=2,this.m_minSize=32,this.m_width=32,this.m_height=32,this.m_uvFlipY=!1,e<128&&(e=128),t<128&&(t=128),this.m_width=e,this.m_height=t,this.m_texAreaNode=new s.default(0,0,e,t),this.m_uid=n.s_uid++}getUid(){return this.m_uid}getWidth(){return this.m_width}getHeight(){return this.m_height}setMinSize(e){this.m_minSize=Math.max(e,4)}getAreaByName(e){return this.m_keyMap.has(e)?this.m_keyMap.get(e):null}getTexAreaByXY(e,t){let i=this.m_texAreaNode.findByXY(e,t);return null!=i&&this.m_keyMap.has(i.uniqueNS)?this.m_keyMap.get(i.uniqueNS):null}addSubTexArea(e,t,i){if(this.m_keyMap.has(e))return this.m_keyMap.get(e);{let r=this.m_area;r.offset=this.m_offset,r.minSize=this.m_minSize,r.uniqueNS=e,r.rect.width=t+2*r.offset,r.rect.height=i+2*r.offset;let s=this.m_texAreaNode.addTexArea(r);if(s){r=new l.default,r.copyFrom(this.m_area),this.m_keyMap.set(e,r),r.atlasUid=this.m_uid;let t=r.rect,i=r.texRect;i.copyFrom(t),i.x+=r.offset,i.y+=r.offset,i.width-=2*r.offset,i.height-=2*r.offset;let s=i.x/this.m_width,n=i.y/this.m_height,u=i.getRight()/this.m_width,a=i.getTop()/this.m_height;return this.m_uvFlipY?r.uvs.set([s,a,u,a,u,n,s,n],0):r.uvs.set([s,n,u,n,u,a,s,a],0),r}return null}}}n.s_uid=0,t.default=n},af0d:function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=r(i("1ae8"));class s{constructor(){this.uvs=null,this.texture=null,this.rect=null,this.clampUVRect=null,this.uniqueName=""}getWidth(){return null!=this.rect?this.rect.width:0}getHeight(){return null!=this.rect?this.rect.height:0}destroy(){this.uvs=null,this.texture=null,this.rect=null}}t.CanvasTexObject=s;class n{constructor(){this.m_sc=null,this.m_atlasList=[null,null,null,null],this.m_objMap=new Map,this.m_whiteTex=null,this.m_whiteImg=null}initialize(e,t,i,r=null,s=!1,n=!1){this.m_sc=e;let u=null;null==r&&(r=s?CoMaterial.createColor4(1,1,1,0):CoMaterial.createColor4()),null==this.m_atlasList[0]&&(u=new l.default(this.m_sc,t,i,r,s,n),this.m_atlasList[0]=u)}setFontName(e){this.m_atlasList[0].setFontName(e)}getTexture(e=0){return this.m_atlasList[e].getTexture()}getAtlasAt(e=0){return this.m_atlasList[e]}addcharsToAtlas(e,t,i,r){if(""!=e){let s=l.default.CreateCharsCanvas(e,t,i,r);return this.addImageToAtlas(e,s)}return null}getTextureObject(e){let t=this.m_atlasList[0],i=t.getAreaByName(e);if(null!=i){let e=new s;return e.texture=t.getTexture(),e.uvs=i.uvs.slice(0),e.rect=i.texRect.clone(),e.clampUVRect=i.texRect.clone(),e.clampUVRect.x/=t.getWidth(),e.clampUVRect.y/=t.getHeight(),e.clampUVRect.width/=t.getWidth(),e.clampUVRect.height/=t.getHeight(),e.uniqueName=i.uniqueNS,e}return null}addImageToAtlas(e,t){let i=this.m_atlasList[0],r=i.addSubImage(e,t);if(null!=r){let t=new s;return t.texture=i.getTexture(),t.uvs=r.uvs,t.rect=r.texRect,t.clampUVRect=r.texRect.clone(),t.clampUVRect.x/=i.getWidth(),t.clampUVRect.y/=i.getHeight(),t.clampUVRect.width/=i.getWidth(),t.clampUVRect.height/=i.getHeight(),t.uniqueName=r.uniqueNS,this.m_objMap.set(e,t),t}return null}getTexObjFromAtlas(e){return this.m_objMap.get(e)}createTexObjWithStr(e,t,i=null,r=null){if(null==i&&(i=CoMaterial.createColor4(0,0,0,1)),null==r&&(r=CoMaterial.createColor4()),null==e||""==e||t<8)return null;let s=l.default.CreateCharsCanvas(e,t,i,r),n=e+"-"+t+"-"+i.getCSSDecRGBAColor()+"-"+r.getCSSDecRGBAColor();return this.addImageToAtlas(n,s)}createCanvas(e,t,i=null,r=!0){return l.default.CreateCanvas(e,t,i,r)}createCharsCanvasWithSize(e,t,i,r,s,n,u=null,a=null){return l.default.CreateCharsCanvasWithSize(e,t,i,r,s,n,u,a)}createCharsCanvasFixSize(e,t,i,r,s=null,n=null){return l.default.CreateCharsCanvasFixSize(e,t,i,r,s,n)}createCharsImage(e,t,i=null,r=null){return null==e||""==e||t<8?null:l.default.CreateCharsCanvas(e,t,i,r)}createWhiteTex(){if(null!=this.m_whiteTex)return this.m_whiteTex;let e=16,t=document.createElement("canvas");t.width=e,t.height=e,this.m_whiteImg=t;let i=t.getContext("2d");i.fillStyle="white",i.fillRect(0,0,e,e);let r=this.m_sc.textureBlock.createImageTex2D(32,32,!1);return r.setDataFromImage(t,0,0,0,!1),this.m_whiteTex=r,r.premultiplyAlpha=!0,r}}t.CanvasTexAtlas=n,t.default=n},d101:function(e,t,i){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e["NONE"]=0]="NONE",e[e["ONE"]=1]="ONE",e[e["TWO_H"]=2]="TWO_H",e[e["TWO_V"]=3]="TWO_V",e[e["THREE"]=4]="THREE",e[e["FOUR"]=5]="FOUR"}(r||(r={})),t.TexAreaFillType=r},fae3:function(e,t,i){"use strict";i.r(t);i("1eb2");var r=i("4c79");for(var l in r)["default"].indexOf(l)<0&&function(e){i.d(t,e,(function(){return r[e]}))}(l)}})}));