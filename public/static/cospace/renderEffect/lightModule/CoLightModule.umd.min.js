(function(t,i){"object"===typeof exports&&"object"===typeof module?module.exports=i():"function"===typeof define&&define.amd?define([],i):"object"===typeof exports?exports["CoLightModule"]=i():t["CoLightModule"]=i()})("undefined"!==typeof self?self:this,(function(){return function(t){var i={};function s(e){if(i[e])return i[e].exports;var r=i[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,s),r.l=!0,r.exports}return s.m=t,s.c=i,s.d=function(t,i,e){s.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:e})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,i){if(1&i&&(t=s(t)),8&i)return t;if(4&i&&"object"===typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(s.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var r in t)s.d(e,r,function(i){return t[i]}.bind(null,r));return e},s.n=function(t){var i=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(i,"a",i),i},s.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},s.p="",s(s.s="fae3")}({"05f8":function(t,i,s){"use strict";Object.defineProperty(i,"__esModule",{value:!0});class e{constructor(t){this.m_uid=-1,this.m_uniformParam=null,this.m_dirty=!1,this.m_shdCtx=null,this.m_shdCtx=t,this.m_uid=e.s_uid++}getUid(){return this.m_uid}update(){null!=this.m_uniformParam&&this.m_dirty&&(this.m_dirty=!1,this.m_uniformParam.uProbe.update())}getGlobalUinform(){return null!=this.m_uniformParam?this.m_uniformParam.cloneUniform():null}destroy(){null!=this.m_uniformParam&&this.m_uniformParam.destroy(),this.m_uniformParam=null,this.m_shdCtx=null}}e.s_uid=0,i.MaterialPipeBase=e},"084e":function(t,i,s){"use strict";Object.defineProperty(i,"__esModule",{value:!0});class e{constructor(t,i=!0){this.m_shdCtx=null,this.uProbe=null,this.uniform=null,this.m_shdCtx=t,i&&(this.uProbe=t.createShaderUniformProbe(),this.uniform=t.createShaderGlobalUniform())}getNames(){return[]}cloneUniform(){return this.m_shdCtx.cloneShaderGlobalUniform(this.uniform)}buildData(){this.m_shdCtx.updateGlobalUinformDataFromProbe(this.uniform,this.uProbe,this.getNames()),this.uProbe.update()}destroy(){this.uProbe=null,this.uniform=null,this.m_shdCtx=null}}i.GlobalUniformParamBase=e},"1eb2":function(t,i,s){"use strict";if("undefined"!==typeof window){var e=window.document.currentScript,r=s("8875");e=r(),"currentScript"in document||Object.defineProperty(document,"currentScript",{get:r});var h=e&&e.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);h&&(s.p=h[1])}},3930:function(t,i,s){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const e=1e-5;class r{constructor(t=1,i=1,s=1,e=1){this.r=t,this.g=i,this.b=s,this.a=e}clone(){return new r(this.r,this.g,this.b,this.a)}fromArray4(t,i=0){return this.r=t[i],this.g=t[i+1],this.b=t[i+2],this.a=t[i+3],this}toArray4(t,i=0){return t[i]=this.r,t[i+1]=this.g,t[i+2]=this.b,t[i+3]=this.a,this}fromArray3(t,i=0){return this.r=t[i],this.g=t[i+1],this.b=t[i+2],this}toArray3(t,i=0){return t[i]=this.r,t[i+1]=this.g,t[i+2]=this.b,this}fromBytesArray3(t,i=0){return this.setRGB3Bytes(t[i],t[i+1],t[i+2]),this}toBytesArray3(t,i=0){return t[i]=Math.round(255*this.r),t[i+1]=Math.round(255*this.g),t[i+2]=Math.round(255*this.b),this}setRGB3f(t,i,s){return this.r=t,this.g=i,this.b=s,this}setRGB3Bytes(t,i,s){const e=1/255;return this.r=t*e,this.g=i*e,this.b=s*e,this}setRGBUint24(t){return this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this}getRGBUint24(){return(Math.round(255*this.r)<<16)+(Math.round(255*this.g)<<8)+Math.round(255*this.b)}setRGBA4f(t,i,s,e){return this.r=t,this.g=i,this.b=s,this.a=e,this}copyFrom(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this}copyFromRGB(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}scaleBy(t){return this.r*=t,this.g*=t,this.b*=t,this}inverseRGB(){return this.r=1-this.r,this.g=1-this.g,this.b=1-this.b,this}randomRGB(t=1,i=0){return this.r=Math.random()*t,this.g=Math.random()*t,this.b=Math.random()*t,this.r+=i,this.g+=i,this.b+=i,this}normalizeRandom(t=1,i=0){this.r=Math.random(),this.g=Math.random(),this.b=Math.random();let s=Math.sqrt(this.r*this.r+this.g*this.g+this.b*this.b);return s>e&&(this.r=t*this.r/s,this.g=t*this.g/s,this.b=t*this.b/s),this.r+=i,this.g+=i,this.b+=i,this}normalize(t){void 0==t&&(t=1);let i=Math.sqrt(this.r*this.r+this.g*this.g+this.b*this.b);return i>e&&(this.r=t*this.r/i,this.g=t*this.g/i,this.b=t*this.b/i),this}getCSSDecRGBAColor(){let t=Math.floor(255*this.r),i=Math.floor(255*this.g),s=Math.floor(255*this.b),e=this.a;return"rgba("+t+","+i+","+s+","+e+")"}getCSSHeXRGBColor(){let t="#",i=Math.floor(255*this.r);return t+=i<15?"0"+i.toString(16):""+i.toString(16),i=Math.floor(255*this.g),t+=i<15?"0"+i.toString(16):""+i.toString(16),i=Math.floor(255*this.b),t+=i<15?"0"+i.toString(16):""+i.toString(16),t}toString(){return"[Color4(r="+this.r+", g="+this.g+",b="+this.b+",a="+this.a+")]"}}i.default=r},5216:function(t,i,s){"use strict";var e;Object.defineProperty(i,"__esModule",{value:!0}),function(t){t[t["ENV_LIGHT_PARAM"]=0]="ENV_LIGHT_PARAM",t[t["ENV_AMBIENT_LIGHT"]=1]="ENV_AMBIENT_LIGHT",t[t["FOG"]=2]="FOG",t[t["FOG_EXP2"]=3]="FOG_EXP2",t[t["VSM_SHADOW"]=4]="VSM_SHADOW",t[t["GLOBAL_LIGHT"]=5]="GLOBAL_LIGHT"}(e||(e={})),i.MaterialPipeType=e},5479:function(t,i,s){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const e=s("e753");i.LightModule=e.LightModule;const r=s("8602");i.PointLight=r.PointLight;const h=s("6a30");i.DirectionLight=h.DirectionLight;const o=s("f043");function n(t){let i=t.getRenderProxy().uniformContext;return new e.LightModule(i)}i.SpotLight=o.SpotLight,i.createLightModule=n},6390:function(t,i,s){"use strict";var e=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(i,"__esModule",{value:!0});const r=e(s("ab73")),h=s("084e");class o extends h.GlobalUniformParamBase{getNames(){return[r.default.GlobalLight.positionName,r.default.GlobalLight.colorName]}buildUniformData(t,i,s,e){this.uProbe.addVec4Data(t,i),this.uProbe.addVec4Data(s,e),this.buildData()}use(t,i=1,s=1){t.uniform.useCameraPosition(!1,!0),t.addFragUniform(r.default.GlobalLight.type,r.default.GlobalLight.positionName,i),t.addFragUniform(r.default.GlobalLight.type,r.default.GlobalLight.colorName,s)}}i.GlobalLightUniformParam=o},"6a30":function(t,i,s){"use strict";var e=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(i,"__esModule",{value:!0});const r=e(s("8e17")),h=e(s("3930"));class o{constructor(t=16777215,i=null){this.direction=new r.default(0,-1,0,0),this.color=new h.default(1,1,1,1),this.attenuationFactor1=0,this.attenuationFactor2=0,this.color.setRGBUint24(t),null!=i&&this.direction.copyFrom(i)}setParams(t,i,s,e,r,h,o,n){this.direction.setXYZ(t,i,s),this.color.setRGB3f(e,r,h),this.attenuationFactor1=o,this.attenuationFactor2=n}}i.DirectionLight=o},8602:function(t,i,s){"use strict";var e=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(i,"__esModule",{value:!0});const r=e(s("8e17")),h=e(s("3930"));class o{constructor(t=16777215,i=null){this.position=new r.default(0,100,0),this.color=new h.default(1,1,1,1),this.attenuationFactor1=1e-4,this.attenuationFactor2=5e-4,this.color.setRGBUint24(t),null!=i&&this.position.copyFrom(i)}setParams(t,i,s,e,r,h,o,n){this.position.setXYZ(t,i,s),this.color.setRGB3f(e,r,h),this.attenuationFactor1=o,this.attenuationFactor2=n}}i.PointLight=o},8875:function(t,i,s){var e,r,h;(function(s,o){r=[],e=o,h="function"===typeof e?e.apply(i,r):e,void 0===h||(t.exports=h)})("undefined"!==typeof self&&self,(function(){function t(){var i=Object.getOwnPropertyDescriptor(document,"currentScript");if(!i&&"currentScript"in document&&document.currentScript)return document.currentScript;if(i&&i.get!==t&&document.currentScript)return document.currentScript;try{throw new Error}catch(m){var s,e,r,h=/.*at [^(]*\((.*):(.+):(.+)\)$/gi,o=/@([^@]*):(\d+):(\d+)\s*$/gi,n=h.exec(m.stack)||o.exec(m.stack),a=n&&n[1]||!1,l=n&&n[2]||!1,u=document.location.href.replace(document.location.hash,""),c=document.getElementsByTagName("script");a===u&&(s=document.documentElement.outerHTML,e=new RegExp("(?:[^\\n]+?\\n){0,"+(l-2)+"}[^<]*<script>([\\d\\D]*?)<\\/script>[\\d\\D]*","i"),r=s.replace(e,"$1").trim());for(var g=0;g<c.length;g++){if("interactive"===c[g].readyState)return c[g];if(c[g].src===a)return c[g];if(a===u&&c[g].innerHTML&&c[g].innerHTML.trim()===r)return c[g]}return null}}return t}))},"8e17":function(t,i,s){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const e=180/Math.PI,r=1e-7;class h{constructor(t=0,i=0,s=0,e=1){this.x=0,this.y=0,this.z=0,this.w=0,this.x=t,this.y=i,this.z=s,this.w=e}clone(){return new h(this.x,this.y,this.z,this.w)}setTo(t,i,s,e=1){return this.x=t,this.y=i,this.z=s,this.w=e,this}fromArray(t,i=0){return this.x=t[i],this.y=t[i+1],this.z=t[i+2],this}toArray(t,i=0){return t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,this}fromArray4(t,i=0){return this.x=t[i],this.y=t[i+1],this.z=t[i+2],this.w=t[i+3],this}toArray4(t,i=0){return t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w,this}setXYZ(t,i,s){return this.x=t,this.y=i,this.z=s,this}copyFrom(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}multBy(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}normalize(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return t>r&&(this.x/=t,this.y/=t,this.z/=t),this}normalizeTo(t){let i=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);i>r?(t.x=this.x/i,t.y=this.y/i,t.z=this.z/i):(t.x=this.x,t.y=this.y,t.z=this.z)}scaleVector(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}scaleBy(t){return this.x*=t,this.y*=t,this.z*=t,this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}equalsXYZ(t){return Math.abs(this.x-t.x)<r&&Math.abs(this.y-t.y)<r&&Math.abs(this.z-t.z)<r}equalsAll(t){return Math.abs(this.x-t.x)<r&&Math.abs(this.y-t.y)<r&&Math.abs(this.z-t.z)<r&&Math.abs(this.w-t.w)<r}project(){let t=1/this.w;this.x*=t,this.y*=t,this.z*=t}getLength(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}getLengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z}addBy(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}subtractBy(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subtract(t){return new h(this.x-t.x,this.y-t.y,this.z-t.z)}add(t){return new h(this.x+t.x,this.y+t.y,this.z+t.z)}crossProduct(t){return new h(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}crossBy(t){let i=this.y*t.z-this.z*t.y,s=this.z*t.x-this.x*t.z,e=this.x*t.y-this.y*t.x;return this.x=i,this.y=s,this.z=e,this}reflectBy(t){let i=2*(this.x*t.x+this.y*t.y+this.z*t.z);return this.x=this.x-i*t.x,this.y=this.y-i*t.y,this.z=this.z-i*t.z,this}scaleVecTo(t,i){return this.x=t.x*i,this.y=t.y*i,this.z=t.z*i,this}subVecsTo(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this}addVecsTo(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this}crossVecsTo(t,i){return this.x=t.y*i.z-t.z*i.y,this.y=t.z*i.x-t.x*i.z,this.z=t.x*i.y-t.y*i.x,this}toString(){return"Vector3D("+this.x+this.y+this.z+")"}static Cross(t,i,s){s.x=t.y*i.z-t.z*i.y,s.y=t.z*i.x-t.x*i.z,s.z=t.x*i.y-t.y*i.x}static CrossSubtract(t,i,s,e,r){o.x=i.x-t.x,o.y=i.y-t.y,o.z=i.z-t.z,n.x=e.x-s.x,n.y=e.y-s.y,n.z=e.z-s.z,t=o,s=n,r.x=t.y*s.z-t.z*s.y,r.y=t.z*s.x-t.x*s.z,r.z=t.x*s.y-t.y*s.x}static Subtract(t,i,s){s.x=t.x-i.x,s.y=t.y-i.y,s.z=t.z-i.z}static DistanceSquared(t,i){return o.x=t.x-i.x,o.y=t.y-i.y,o.z=t.z-i.z,o.getLengthSquared()}static DistanceXYZ(t,i,s,e,r,h){return o.x=t-e,o.y=i-r,o.z=s-h,o.getLength()}static Distance(t,i){return o.x=t.x-i.x,o.y=t.y-i.y,o.z=t.z-i.z,o.getLength()}static AngleBetween(t,i){return t.normalizeTo(o),i.normalizeTo(n),Math.acos(o.dot(n))*e}static RadianBetween(t,i){return t.normalizeTo(o),i.normalizeTo(n),Math.acos(o.dot(n))}static RadianBetween2(t,i){let s=t.getLengthSquared(),e=i.getLengthSquared();return o.x=t.x-i.x,o.y=t.y-i.y,o.z=t.z-i.z,Math.acos((s+e-o.getLengthSquared())/(2*Math.sqrt(s)*Math.sqrt(e)))}static Reflect(t,i,s){let e=2*(t.x*i.x+t.y*i.y+t.z*i.z);s.x=t.x-e*i.x,s.y=t.y-e*i.y,s.z=t.z-e*i.z}static VerticalCCWOnXOY(t){const i=t.x;t.x=-t.y,t.y=i}static VerticalCWOnXOY(t){const i=t.y;t.y=-t.x,t.x=i}}h.X_AXIS=new h(1,0,0),h.Y_AXIS=new h(0,1,0),h.Z_AXIS=new h(0,0,1),h.ZERO=new h(0,0,0),h.ONE=new h(1,1,1),i.default=h;const o=new h,n=new h},ab73:function(t,i,s){"use strict";Object.defineProperty(i,"__esModule",{value:!0});class e{constructor(){this.type="vec4",this.data=null,this.name="u_vsmParams",this.arrayLength=3}}class r{constructor(){this.type="vec4",this.data=new Float32Array([.1,.1,.1,1,1,.1,600,3500,.3,0,.9,5e-4,0,0,800,800,-500,-500,1e3,1e3]),this.name="u_envLightParams",this.arrayLength=5}}class h{constructor(){this.type="mat4",this.data=null,this.name="u_shadowMat",this.arrayLength=0}}class o{constructor(){this.type="vec4",this.data=null,this.name="u_stageParam",this.arrayLength=0}}class n{constructor(){this.type="vec4",this.data=null,this.name="u_viewParam",this.arrayLength=0}}class a{constructor(){this.type="vec4",this.data=null,this.name="u_frustumParam",this.arrayLength=0}}class l{constructor(){this.type="vec4",this.data=null,this.name="u_cameraPosition",this.arrayLength=0}}class u{constructor(){this.type="vec4",this.positionName="u_lightPositions",this.colorName="u_lightColors"}}class c{}c.LocalTransformMatUNS="u_objMat",c.CameraViewMatUNS="u_viewMat",c.CameraProjectiveMatUNS="u_projMat",c.FrustumParam=new a,c.CameraPosParam=new l,c.StageParam=new o,c.ViewportParam=new n,c.ShadowMatrix=new h,c.ShadowVSMParams=new e,c.GlobalLight=new u,c.EnvLightParams=new r,i.default=c},e753:function(t,i,s){"use strict";var e=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(i,"__esModule",{value:!0});const r=e(s("ab73")),h=s("5216"),o=s("05f8"),n=s("6390"),a=s("8602"),l=s("6a30"),u=s("f043");class c extends o.MaterialPipeBase{constructor(){super(...arguments),this.m_lightPosData=null,this.m_lightColors=null,this.m_lightPosDataVec4Total=0,this.m_lightsTotal=0,this.m_pointLightList=null,this.m_direcLightList=null,this.m_spotLightList=null}clamp(t,i,s){return Math.max(Math.min(t,s),i)}degreeToRadian(t){return 180*t/Math.PI}getPointLightsTotal(){return null!=this.m_pointLightList?this.m_pointLightList.length:0}getDirecLightsTotal(){return null!=this.m_direcLightList?this.m_direcLightList.length:0}getSpotLightsTotal(){return null!=this.m_spotLightList?this.m_spotLightList.length:0}getPointLightAt(t){return null!=this.m_pointLightList&&t>=0&&t<this.m_pointLightList.length?this.m_pointLightList[t]:null}getDirectionLightAt(t){return null!=this.m_direcLightList&&t>=0&&t<this.m_direcLightList.length?this.m_direcLightList[t]:null}getSpotLightAt(t){return null!=this.m_spotLightList&&t>=0&&t<this.m_spotLightList.length?this.m_spotLightList[t]:null}appendPointLight(){null==this.m_pointLightList&&(this.m_pointLightList=[]);let t=new a.PointLight;return this.m_pointLightList.push(t),this.m_lightsTotal++,t}appendDirectionLight(){null==this.m_direcLightList&&(this.m_direcLightList=[]);let t=new l.DirectionLight;return this.m_direcLightList.push(t),this.m_lightsTotal++,t}appendSpotLight(){null==this.m_spotLightList&&(this.m_spotLightList=[]);let t=new u.SpotLight;return this.m_spotLightList.push(t),this.m_lightsTotal++,t}updatePointLightData(){if(null!=this.m_pointLightList){let t,i=this.m_lightPosData,s=this.m_lightColors,e=0;for(let r=0;r<this.m_pointLightList.length;++r)t=this.m_pointLightList[r],e=4*r,i[e]=t.position.x,i[e+1]=t.position.y,i[e+2]=t.position.z,i[e+3]=t.attenuationFactor1,s[e]=t.color.r,s[e+1]=t.color.g,s[e+2]=t.color.b,s[e+3]=t.attenuationFactor2}}updateDirecLighttData(){if(null!=this.m_direcLightList){let t,i=this.m_lightPosData,s=this.m_lightColors,e=0,r=null!=this.m_pointLightList?this.m_pointLightList.length:0;r*=4;for(let h=0;h<this.m_direcLightList.length;++h)t=this.m_direcLightList[h],e=r+4*h,i[e]=t.direction.x,i[e+1]=t.direction.y,i[e+2]=t.direction.z,i[e+3]=t.attenuationFactor1,s[e]=t.color.r,s[e+1]=t.color.g,s[e+2]=t.color.b,s[e+3]=t.attenuationFactor2}}updateSpotLighttData(){if(null!=this.m_spotLightList){let t,i=this.m_lightPosData,s=this.m_lightColors,e=0,r=null!=this.m_pointLightList?this.m_pointLightList.length:0;r+=null!=this.m_direcLightList?this.m_direcLightList.length:0,r*=4;for(let h=0;h<this.m_spotLightList.length;++h)t=this.m_spotLightList[h],e=r+4*h,i[e]=t.position.x,i[e+1]=t.position.y,i[e+2]=t.position.z,i[e+3]=t.attenuationFactor1,s[e]=t.color.r,s[e+1]=t.color.g,s[e+2]=t.color.b,s[e+3]=t.attenuationFactor2;r+=4*this.m_spotLightList.length;for(let h=0;h<this.m_spotLightList.length;++h){t=this.m_spotLightList[h];let s=90-this.clamp(t.angleDegree,0,90);s=Math.cos(this.degreeToRadian(s)),e=r+4*h,i[e]=t.direction.x,i[e+1]=t.direction.y,i[e+2]=t.direction.z,i[e+3]=s}}}buildData(){if(null==this.m_uniformParam){let t=this.m_lightsTotal,i=this.m_lightsTotal,s=4*t;this.m_lightPosDataVec4Total=this.m_lightsTotal,null==this.m_spotLightList||(s+=4*this.m_spotLightList.length,this.m_lightPosDataVec4Total+=this.m_spotLightList.length),null==this.m_lightPosData&&(this.m_lightPosData=new Float32Array(s)),null==this.m_lightColors&&(this.m_lightColors=new Float32Array(4*i));let e=new n.GlobalLightUniformParam(this.m_shdCtx);e.buildUniformData(this.m_lightPosData,this.m_lightPosDataVec4Total,this.m_lightColors,i),this.m_uniformParam=e}this.updatePointLightData(),this.updateDirecLighttData(),this.updateSpotLighttData()}showInfo(){}resetPipe(){}getTextures(t,i,s){return null}useShaderPipe(t,i){if(null!=this.m_uniformParam){t.normalEnabled=!0;let i=this.getPointLightsTotal()+this.getDirecLightsTotal()+this.getSpotLightsTotal();i>0?(t.addDefine("VOX_LIGHTS_TOTAL",""+i),this.getPointLightsTotal()>0?t.addDefine("VOX_POINT_LIGHTS_TOTAL",""+this.getPointLightsTotal()):t.addDefine("VOX_POINT_LIGHTS_TOTAL","0"),this.getDirecLightsTotal()>0?t.addDefine("VOX_DIRECTION_LIGHTS_TOTAL",""+this.getDirecLightsTotal()):t.addDefine("VOX_DIRECTION_LIGHTS_TOTAL","0"),this.getSpotLightsTotal()>0?t.addDefine("VOX_SPOT_LIGHTS_TOTAL",""+this.getSpotLightsTotal()):t.addDefine("VOX_SPOT_LIGHTS_TOTAL","0")):t.addDefine("VOX_LIGHTS_TOTAL","0"),this.m_uniformParam.use(t,this.m_lightPosDataVec4Total,this.m_lightsTotal)}}getPipeTypes(){return[h.MaterialPipeType.GLOBAL_LIGHT]}getPipeKey(t){switch(t){case h.MaterialPipeType.GLOBAL_LIGHT:let i="";if(this.getPointLightsTotal()>0&&(i=""+this.getPointLightsTotal()),this.getDirecLightsTotal()>0&&(i+=""+this.getDirecLightsTotal()),this.getSpotLightsTotal()>0&&(i+=""+this.getSpotLightsTotal()),""!=i)return"["+t+":"+i+"]";break;default:break}return""}useUniforms(t){null!=this.m_uniformParam&&(t.addFragUniform(r.default.GlobalLight.type,r.default.GlobalLight.positionName,this.m_lightPosDataVec4Total),t.addFragUniform(r.default.GlobalLight.type,r.default.GlobalLight.colorName,this.m_lightsTotal))}update(){this.buildData(),null!=this.m_uniformParam&&this.m_uniformParam.uProbe.update()}destroy(){this.m_lightPosData=null,this.m_lightColors=null,this.m_lightsTotal=0,this.m_pointLightList=null,this.m_direcLightList=null,this.m_spotLightList=null,super.destroy()}}i.LightModule=c},f043:function(t,i,s){"use strict";var e=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(i,"__esModule",{value:!0});const r=e(s("8e17")),h=e(s("3930"));class o{constructor(){this.position=new r.default(0,100,0),this.direction=new r.default(0,-1,0,0),this.color=new h.default(1,1,1,1),this.angleDegree=30,this.attenuationFactor1=1e-4,this.attenuationFactor2=5e-4}setParams(t,i,s,e,r,h,o,n,a,l,u,c){this.position.setXYZ(t,i,s),this.direction.setXYZ(e,r,h),this.color.setRGB3f(o,n,a),this.angleDegree=l,this.attenuationFactor1=u,this.attenuationFactor2=c}}i.SpotLight=o},fae3:function(t,i,s){"use strict";s.r(i);s("1eb2");var e=s("5479");for(var r in e)["default"].indexOf(r)<0&&function(t){s.d(i,t,(function(){return e[t]}))}(r)}})}));