(function(t,a){"object"===typeof exports&&"object"===typeof module?module.exports=a():"function"===typeof define&&define.amd?define([],a):"object"===typeof exports?exports["PBREffect"]=a():t["PBREffect"]=a()})("undefined"!==typeof self?self:this,(function(){return function(t){var a={};function e(r){if(a[r])return a[r].exports;var s=a[r]={i:r,l:!1,exports:{}};return t[r].call(s.exports,s,s.exports,e),s.l=!0,s.exports}return e.m=t,e.c=a,e.d=function(t,a,r){e.o(t,a)||Object.defineProperty(t,a,{enumerable:!0,get:r})},e.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,a){if(1&a&&(t=e(t)),8&a)return t;if(4&a&&"object"===typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&a&&"string"!=typeof t)for(var s in t)e.d(r,s,function(a){return t[a]}.bind(null,s));return r},e.n=function(t){var a=t&&t.__esModule?function(){return t["default"]}:function(){return t};return e.d(a,"a",a),a},e.o=function(t,a){return Object.prototype.hasOwnProperty.call(t,a)},e.p="",e(e.s="fae3")}({"1eb2":function(t,a,e){"use strict";if("undefined"!==typeof window){var r=window.document.currentScript,s=e("8875");r=s(),"currentScript"in document||Object.defineProperty(document,"currentScript",{get:s});var i=r&&r.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);i&&(e.p=i[1])}},"2fe4":function(t,a,e){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(a,"__esModule",{value:!0});const s=r(e("b3bd")),i=e("f3a2");class n{constructor(){this.m_uniqueName="PBR",this.m_envMapWidth=128,this.m_envMapHeight=128,this.m_pbrParams=new Float32Array([0,0,1,.02,1,.1,1,1,.1,.1,.1,1,1,1,1,.07]),this.m_fragLocalParams=null,this.m_parallaxParams=null,this.m_mirrorParam=new Float32Array([0,0,-1,1,1,.3,0,0]),this.vertColorEnabled=!1,this.premultiplyAlpha=!1,this.shadowReceiveEnabled=!1,this.lightEnabled=!0,this.fogEnabled=!1,this.envAmbientLightEnabled=!1,this.brightnessOverlayEnabeld=!1,this.glossinessEnabeld=!0,this.specularEnvMap=null,this.diffuseMap=null,this.normalMap=null,this.mirrorMap=null,this.indirectEnvMap=null,this.parallaxMap=null,this.aoMap=null,this.roughnessMap=null,this.metalhnessMap=null,this.armMap=null,this.woolEnabled=!0,this.toneMappingEnabled=!0,this.scatterEnabled=!0,this.specularBleedEnabled=!0,this.metallicCorrection=!0,this.gammaCorrection=!0,this.absorbEnabled=!1,this.normalNoiseEnabled=!1,this.pixelNormalNoiseEnabled=!1,this.mirrorMapLodEnabled=!1,this.hdrBrnEnabled=!1,this.vtxFlatNormal=!1,this.texturesTotal=1,this.fragLocalParamsTotal=2,this.parallaxParamIndex=2,this.vertUniform=null}initialize(){this.fragLocalParamsTotal=2,this.parallaxParamIndex=2,null!=this.parallaxMap&&(this.fragLocalParamsTotal+=1),this.m_fragLocalParams=new Float32Array(4*this.fragLocalParamsTotal),this.m_fragLocalParams.set([0,0,0,1,.2,.2,.2,0],0),null!=this.parallaxMap&&(this.m_parallaxParams=this.m_fragLocalParams.subarray(4*this.parallaxParamIndex,4*(this.parallaxParamIndex+1)),this.m_parallaxParams.set([1,10,2,.1]))}seNormalMapIntensity(t){t=Math.min(Math.max(t,0),1),this.m_fragLocalParams[4]=t}setPixelNormalNoiseIntensity(t){t=Math.min(Math.max(t,0),2),this.m_pbrParams[3]=t}getPixelNormalNoiseIntensity(){return this.m_pbrParams[3]}setMirrorViewNV(t){this.m_mirrorParam[0]=t.x,this.m_mirrorParam[1]=t.y,this.m_mirrorParam[2]=t.z}setMirrorPlaneNV(t){}setMirrorMapLodLevel(t){this.m_mirrorParam[3]=t}setMirrorIntensity(t){this.m_mirrorParam[4]=Math.min(Math.max(t,.01),2)}setMirrorMixFactor(t){this.m_mirrorParam[5]=Math.min(Math.max(t,.01),2)}setEnvMapLodMipMapLevel(t,a=0){t=Math.min(Math.max(t,0),14),a=Math.min(Math.max(a,-7),12),this.m_pbrParams[15]=.01*Math.round(t)+a}log2(t){return Math.log(t)/Math.LN2}getMaxMipMapLevel(t,a){return Math.round(this.log2(Math.max(t,a))+1)}setEnvMapLodMipMapLevelWithSize(t,a,e=0){this.m_envMapWidth=t,this.m_envMapHeight=a,e=Math.min(Math.max(e,-7),12);Math.log(Math.max(t,a)),Math.LN2;this.m_pbrParams[15]=.01*this.getMaxMipMapLevel(t,a)+e}setScatterIntensity(t){this.m_pbrParams[11]=Math.min(Math.max(t,.01),512)}getScatterIntensity(){return this.m_pbrParams[11]}setToneMapingExposure(t){this.m_pbrParams[4]=Math.min(Math.max(t,.1),128)}getToneMapingExposure(){return this.m_pbrParams[4]}setReflectionIntensity(t){this.m_pbrParams[5]=Math.min(Math.max(t,.001),1)}getReflectionIntensity(){return this.m_pbrParams[5]}setSurfaceIntensity(t){this.m_pbrParams[6]=Math.min(Math.max(t,.001),32)}getSurfaceIntensity(){return this.m_pbrParams[6]}setSideIntensity(t){this.m_pbrParams[7]=Math.min(Math.max(t,.001),32)}getSideIntensity(){return this.m_pbrParams[7]}setEnvSpecularColorFactor(t,a,e){this.m_pbrParams[12]=t,this.m_pbrParams[13]=a,this.m_pbrParams[14]=e}getEnvSpecularColorFactor(t){t.r=this.m_pbrParams[12],t.g=this.m_pbrParams[13],t.b=this.m_pbrParams[14]}setAmbientFactor(t,a,e){this.m_pbrParams[8]=t,this.m_pbrParams[9]=a,this.m_pbrParams[10]=e}getAmbientFactor(t){t.r=this.m_pbrParams[8],t.g=this.m_pbrParams[9],t.b=this.m_pbrParams[10]}setMetallic(t){this.m_pbrParams[0]=Math.min(Math.max(t,.05),1)}getMetallic(){return this.m_pbrParams[0]}setRoughness(t){this.m_pbrParams[1]=Math.min(Math.max(t,.05),1)}getRoughness(){return this.m_pbrParams[1]}setAO(t){this.m_pbrParams[2]=t}getAO(){return this.m_pbrParams[2]}setF0(t,a,e){this.m_fragLocalParams[0]=t,this.m_fragLocalParams[1]=a,this.m_fragLocalParams[2]=e}getF0(t){t.r=this.m_fragLocalParams[0],t.g=this.m_fragLocalParams[1],t.b=this.m_fragLocalParams[2]}setAlbedoColor(t,a,e){this.m_fragLocalParams[4]=t,this.m_fragLocalParams[5]=a,this.m_fragLocalParams[6]=e}getAlbedoColor(t){t.r=this.m_fragLocalParams[4],t.g=this.m_fragLocalParams[5],t.b=this.m_fragLocalParams[6]}setParallaxParams(t=1,a=10,e=2,r=.1){null!=this.m_parallaxParams&&(this.m_parallaxParams[0]=t,this.m_parallaxParams[1]=a,this.m_parallaxParams[2]=e,this.m_parallaxParams[3]=r)}buildBufParams(){}buildTextureList(t){t.addSpecularEnvMap(this.specularEnvMap,!0),t.addDiffuseMap(this.diffuseMap),t.addNormalMap(this.normalMap),t.addParallaxMap(this.parallaxMap,this.parallaxParamIndex),t.addAOMap(this.aoMap),t.addRoughnessMap(this.roughnessMap),t.addMetalnessMap(this.metalhnessMap),t.addARMMap(this.armMap),t.add2DMap(this.mirrorMap,"VOX_MIRROR_PROJ_MAP",!0,!0,!1),t.addCubeMap(this.indirectEnvMap,"VOX_INDIRECT_ENV_MAP",!0,!1)}buildShader(t){t.normalMapEnabled=null!=this.normalMap,t.mapLodEnabled=!0,t.useHighPrecious();let a=null!=this.mirrorMap&&this.texturesTotal>0;this.normalNoiseEnabled&&t.addDefine("VOX_NORMAL_NOISE","1"),this.woolEnabled&&t.addDefine("VOX_WOOL","1"),this.toneMappingEnabled&&t.addDefine("VOX_TONE_MAPPING","1"),this.scatterEnabled&&t.addDefine("VOX_SCATTER","1"),this.specularBleedEnabled&&t.addDefine("VOX_SPECULAR_BLEED","1"),this.metallicCorrection&&t.addDefine("VOX_METALLIC_CORRECTION","1"),this.gammaCorrection&&t.addDefine("VOX_GAMMA_CORRECTION","1"),this.absorbEnabled&&t.addDefine("VOX_ABSORB","1"),this.pixelNormalNoiseEnabled&&t.addDefine("VOX_PIXEL_NORMAL_NOISE","1"),this.mirrorMapLodEnabled&&t.addDefine("VOX_MIRROR_MAP_LOD","1"),this.hdrBrnEnabled&&t.addDefine("VOX_HDR_BRN","1"),this.vtxFlatNormal&&t.addDefine("VOX_VTX_FLAT_NORMAL","1"),t.addFragUniform("vec4","u_fragLocalParams",this.fragLocalParamsTotal),t.addFragUniform("vec4","u_pbrParams",4),a&&(t.uniform.useStage(!1,!0),t.addFragUniform("vec4","u_mirrorParams",2)),t.vertMatrixInverseEnabled=!0}createUniformData(){let t=new s.default;return t.uniformNameList=["u_pbrParams","u_fragLocalParams","u_mirrorParams"],t.dataList=[this.m_pbrParams,this.m_fragLocalParams,this.m_mirrorParam],t}getShaderCodeObjectUUID(){return i.ShaderCodeUUID.PBR}getShaderCodeObject(){return null}getUniqueName(){let t=this.m_uniqueName;return this.woolEnabled&&(t+="_wl"),this.toneMappingEnabled&&(t+="TM"),this.scatterEnabled&&(t+="Sct"),this.specularBleedEnabled&&(t+="SpecBl"),this.metallicCorrection&&(t+="MetCorr"),this.gammaCorrection&&(t+="GmaCorr"),this.absorbEnabled&&(t+="Absorb"),this.pixelNormalNoiseEnabled&&(t+="PNNoise"),this.normalNoiseEnabled&&(t+="NNoise"),null!=this.indirectEnvMap&&(t+="IndirEnv"),this.shadowReceiveEnabled&&(t+="Shadow"),this.fogEnabled&&(t+="Fog"),this.hdrBrnEnabled&&(t+="HdrBrn"),this.vtxFlatNormal&&(t+="vtxFlagN"),this.mirrorMapLodEnabled&&(t+="MirLod"),this.m_uniqueName=t,this.m_uniqueName}destroy(){this.m_pbrParams=null,this.m_fragLocalParams=null,this.m_mirrorParam=null}}a.PBRDecorator=n},3221:function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});class r{constructor(){this.m_params=null,this.m_uniqueNSKeyString=""}initialize(){}use(t){}getTextures(t,a=null){return null}dataCopyFrom(t){}reset(){}destroy(){}getUniqueNSKeyString(){return this.m_uniqueNSKeyString}clone(){return null}getParams(){return this.m_params}getParamsTotal(){return null!=this.m_params?this.m_params.length>>2:0}buildShaderUniformData(t){}}a.UniformComp=r},8875:function(t,a,e){var r,s,i;(function(e,n){s=[],r=n,i="function"===typeof r?r.apply(a,s):r,void 0===i||(t.exports=i)})("undefined"!==typeof self&&self,(function(){function t(){var a=Object.getOwnPropertyDescriptor(document,"currentScript");if(!a&&"currentScript"in document&&document.currentScript)return document.currentScript;if(a&&a.get!==t&&document.currentScript)return document.currentScript;try{throw new Error}catch(d){var e,r,s,i=/.*at [^(]*\((.*):(.+):(.+)\)$/gi,n=/@([^@]*):(\d+):(\d+)\s*$/gi,l=i.exec(d.stack)||n.exec(d.stack),m=l&&l[1]||!1,o=l&&l[2]||!1,u=document.location.href.replace(document.location.hash,""),h=document.getElementsByTagName("script");m===u&&(e=document.documentElement.outerHTML,r=new RegExp("(?:[^\\n]+?\\n){0,"+(o-2)+"}[^<]*<script>([\\d\\D]*?)<\\/script>[\\d\\D]*","i"),s=e.replace(r,"$1").trim());for(var c=0;c<h.length;c++){if("interactive"===h[c].readyState)return h[c];if(h[c].src===m)return h[c];if(m===u&&h[c].innerHTML&&h[c].innerHTML.trim()===s)return h[c]}return null}}return t}))},"8d98":function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});class r{static GetConst(t,a){switch(a){case r.NEAREST:return t.NEAREST;case r.LINEAR:return t.LINEAR;case r.LINEAR_MIPMAP_LINEAR:return t.LINEAR_MIPMAP_LINEAR;case r.NEAREST_MIPMAP_NEAREST:return t.NEAREST_MIPMAP_NEAREST;case r.LINEAR_MIPMAP_NEAREST:return t.LINEAR_MIPMAP_NEAREST;case r.NEAREST_MIPMAP_LINEAR:return t.NEAREST_MIPMAP_LINEAR;case r.WRAP_REPEAT:return t.REPEAT;case r.WRAP_CLAMP_TO_EDGE:return t.CLAMP_TO_EDGE;case r.WRAP_MIRRORED_REPEAT:return t.MIRRORED_REPEAT;default:break}return-1}}r.WRAP_REPEAT=3001,r.WRAP_CLAMP_TO_EDGE=3002,r.WRAP_MIRRORED_REPEAT=3003,r.NEAREST=4001,r.LINEAR=4002,r.LINEAR_MIPMAP_LINEAR=4003,r.NEAREST_MIPMAP_NEAREST=4004,r.LINEAR_MIPMAP_NEAREST=4005,r.NEAREST_MIPMAP_LINEAR=4006,a.default=r},a273:function(t,a,e){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(a,"__esModule",{value:!0});const s=e("debe"),i=e("2fe4"),n=r(e("8d98"));class l{constructor(){this.hdrBrnEnabled=!1,this.width=128,this.height=128}createTexture(t,a){let e=a.textureBlock;return t?e.createBytesCubeTex(32,32):e.createFloatCubeTex(32,32)}createFloat(t,a,e){let r=0,s=this.width,i=this.height,l=3,m=new Float32Array(a),o=null,u=e;u.toRGBFormat(),u.minFilter=n.default.LINEAR_MIPMAP_LINEAR,u.magFilter=n.default.LINEAR;for(let n=0;n<9;n++){for(let t=0;t<6;t++){const a=s*i*l;o=m.subarray(r,r+a),u.setDataFromBytesToFaceAt(t,o,s,i,n),r+=a}s>>=1,i>>=1}return e}createHdrBrn(t,a,e){let r=new Uint16Array(a),s=new Uint8Array(a),i=0,l=r[4],m=r[5],o=r[6],u=0,h=s.subarray(32),c=e;c.mipmapEnabled=o<=1,c.minFilter=n.default.LINEAR_MIPMAP_LINEAR,c.magFilter=n.default.LINEAR;for(let n=0;n<o;n++){for(let t=0;t<6;t++)u=l*m*4,c.setDataFromBytesToFaceAt(t,h.subarray(i,i+u),l,m,n),i+=u;l>>=1,m>>=1}return e}}a.SpecularTextureBuilder=l;class m{constructor(){this.m_rscene=null}initialize(t){null==this.m_specularBuilder&&(this.m_rscene=t,this.m_specularBuilder=new l)}createTexture(t){return this.m_specularBuilder.createTexture(t,this.m_rscene)}createMaterial(t=!0){if(null!=this.m_rscene){let a=t?new s.VertUniformComp:null,e=new i.PBRDecorator;return e.vertUniform=a,this.m_rscene.materialBlock.createMaterial(e)}return null}createSpecularTex(t,a=!0,e=null){return null!=this.m_rscene?(null==e&&(e=this.m_specularBuilder.createTexture(a,this.m_rscene)),null!=t?a?this.m_specularBuilder.createHdrBrn(this.m_rscene,t,e):this.m_specularBuilder.createFloat(this.m_rscene,t,e):e):null}destroy(){this.m_rscene=null,this.m_specularBuilder=null}}function o(){return new m}a.PBREffectInstance=m,a.create=o},b3bd:function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});class r{constructor(){this.uns="",this.types=null,this.uniformSize=0,this.uniformNameList=null,this.locations=null,this.dataList=null,this.calcModels=null,this.always=!0,this.next=null}getDataRefFromUniformName(t){if(null!=this.uniformNameList){let a=this.uniformNameList,e=a.length;for(let r=0;r<e;++r)if(t==a[r])return this.dataList[r]}return null}setDataRefFromUniformName(t,a){if(null!=this.uniformNameList){let e=this.uniformNameList,r=e.length;for(let s=0;s<r;++s)if(t==e[s]){this.dataList[s]=a;break}}}copyDataFromProbe(t){this.types=[];for(let a=0;a<t.uniformsTotal;++a)this.types.push(t.uniformTypes[a]);this.uniformSize=t.uniformsTotal}destroy(){let t=0,a=this.dataList.length;for(;t<a;++t)this.dataList[t]=null;if(null!=this.calcModels)for(a=this.calcModels.length,t=0;t<a;++t)this.calcModels[t].destroy(),this.calcModels[t]=null;this.dataList=null,this.types=null,this.locations=null,this.calcModels=null}}a.default=r},debe:function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});const r=e("3221");class s extends r.UniformComp{constructor(){super(),this.m_uvs=null,this.m_cms=null,this.m_dps=null,this.m_uvTransformParamIndex=-1,this.m_curveMoveParamIndex=-1,this.m_displacementParamIndex=-1,this.uvTransformEnabled=!1,this.curveMoveMap=null,this.displacementMap=null}initialize(){if(null==this.m_params){this.m_uniqueNSKeyString="";let t=0;if(this.uvTransformEnabled&&(this.m_uvTransformParamIndex=t,t++,this.m_uniqueNSKeyString+="UV"),null!=this.curveMoveMap&&(this.m_curveMoveParamIndex=t,t++,this.m_uniqueNSKeyString+="CM"),null!=this.displacementMap&&(this.m_displacementParamIndex=t,t++,this.m_uniqueNSKeyString+="DC"),t>0){this.m_params=new Float32Array(4*t);let a=this.m_uvTransformParamIndex;a>=0&&(this.m_uvs=this.m_params.subarray(4*a,4*(a+1)),this.m_uvs.set([1,1,0,0])),a=this.m_curveMoveParamIndex,a>=0&&(this.m_cms=this.m_params.subarray(4*a,4*(a+1))),a=this.m_displacementParamIndex,a>=0&&(this.m_dps=this.m_params.subarray(4*a,4*(a+1)),this.m_dps.set([10,0,0,0]))}}}use(t){this.getParamsTotal()>0&&(t.addVertUniform("vec4","u_vertLocalParams",this.getParamsTotal()),this.m_curveMoveParamIndex>=0&&t.addVertLayout("vec4","a_vs"),this.m_uvTransformParamIndex>=0&&t.addDefine("VOX_VTX_TRANSFORM_PARAM_INDEX",""+this.m_uvTransformParamIndex))}reset(){}destroy(){}getTextures(t,a=null){return this.getParamsTotal()>0?(null==a&&(a=[]),this.m_curveMoveParamIndex>=0&&(a.push(this.curveMoveMap),t.uniform.add2DMap("VTX_CURVE_MOVE_MAP",!1,!1,!0),t.addDefine("VOX_VTX_CURVE_MOVE_PARAM_INDEX",""+this.m_curveMoveParamIndex)),this.m_displacementParamIndex>=0&&(a.push(this.displacementMap),t.uniform.addDisplacementMap(this.m_displacementParamIndex)),a):null}setCurveMoveParam(t,a){null!=this.m_cms&&(this.m_cms[0]=1/t,this.m_cms[2]=a)}setCurveMoveDistance(t){null!=this.m_cms&&(this.m_cms[1]=t)}setUVScale(t,a){null!=this.m_uvs&&(this.m_uvs[0]=t,this.m_uvs[1]=a)}getUVScale(t){null!=this.m_uvs&&(t.x=this.m_uvs[0],t.y=this.m_uvs[1])}setUVTranslation(t,a){null!=this.m_uvs&&(this.m_uvs[2]=t,this.m_uvs[3]=a)}setDisplacementParams(t,a){null!=this.m_dps&&(this.m_dps[0]=t,this.m_dps[1]=a)}dataCopyFrom(t){let a=t;a.m_uvs&&(this.m_uvs?this.m_uvs.set(a.m_uvs):this.m_uvs=a.m_uvs.slice()),a.m_cms&&(this.m_cms?this.m_cms.set(a.m_cms):this.m_cms=a.m_cms.slice()),a.m_dps&&(this.m_dps?this.m_dps.set(a.m_dps):this.m_dps=a.m_dps.slice())}clone(){let t=new s;return t.uvTransformEnabled=this.uvTransformEnabled,t.displacementMap=this.displacementMap,t.curveMoveMap=this.curveMoveMap,this.dataCopyFrom(this),t.m_uvTransformParamIndex=this.m_uvTransformParamIndex,t.m_curveMoveParamIndex=this.m_uvTransformParamIndex,t.m_displacementParamIndex=this.m_uvTransformParamIndex,t}buildShaderUniformData(t){this.getParamsTotal()>0&&(t.uniformNameList.push("u_vertLocalParams"),t.dataList.push(this.getParams()))}}a.VertUniformComp=s},f3a2:function(t,a,e){"use strict";var r;Object.defineProperty(a,"__esModule",{value:!0}),function(t){t["None"]="",t["Default"]="pbr",t["Lambert"]="lambert",t["PBR"]="pbr"}(r||(r={})),a.ShaderCodeUUID=r},fae3:function(t,a,e){"use strict";e.r(a);e("1eb2");var r=e("a273");for(var s in r)["default"].indexOf(s)<0&&function(t){e.d(a,t,(function(){return r[t]}))}(s)}})}));