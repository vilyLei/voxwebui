(function(a,t){"object"===typeof exports&&"object"===typeof module?module.exports=t():"function"===typeof define&&define.amd?define([],t):"object"===typeof exports?exports["PBREffect"]=t():a["PBREffect"]=t()})("undefined"!==typeof self?self:this,(function(){return function(a){var t={};function e(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return a[r].call(s.exports,s,s.exports,e),s.l=!0,s.exports}return e.m=a,e.c=t,e.d=function(a,t,r){e.o(a,t)||Object.defineProperty(a,t,{enumerable:!0,get:r})},e.r=function(a){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},e.t=function(a,t){if(1&t&&(a=e(a)),8&t)return a;if(4&t&&"object"===typeof a&&a&&a.__esModule)return a;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:a}),2&t&&"string"!=typeof a)for(var s in a)e.d(r,s,function(t){return a[t]}.bind(null,s));return r},e.n=function(a){var t=a&&a.__esModule?function(){return a["default"]}:function(){return a};return e.d(t,"a",t),t},e.o=function(a,t){return Object.prototype.hasOwnProperty.call(a,t)},e.p="",e(e.s="fae3")}({"1eb2":function(a,t,e){"use strict";if("undefined"!==typeof window){var r=window.document.currentScript,s=e("8875");r=s(),"currentScript"in document||Object.defineProperty(document,"currentScript",{get:s});var i=r&&r.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);i&&(e.p=i[1])}},"2fe4":function(a,t,e){"use strict";var r=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(e("b3bd")),i=e("f3a2");class n{constructor(){this.m_uniqueName="PBR",this.m_envMapWidth=128,this.m_envMapHeight=128,this.m_pbrParams=new Float32Array([0,0,1,.02,1,.1,1,1,.1,.1,.1,1,1,1,1,.07]),this.m_fragLocalParams=null,this.m_parallaxParams=null,this.m_mirrorParam=new Float32Array([0,0,-1,1,1,.3,0,0]),this.vertColorEnabled=!1,this.premultiplyAlpha=!1,this.shadowReceiveEnabled=!1,this.lightEnabled=!0,this.fogEnabled=!1,this.envAmbientLightEnabled=!1,this.brightnessOverlayEnabeld=!1,this.glossinessEnabeld=!0,this.specularEnvMap=null,this.diffuseMap=null,this.normalMap=null,this.mirrorMap=null,this.indirectEnvMap=null,this.parallaxMap=null,this.aoMap=null,this.roughnessMap=null,this.metalhnessMap=null,this.armMap=null,this.woolEnabled=!0,this.toneMappingEnabled=!0,this.scatterEnabled=!0,this.specularBleedEnabled=!0,this.metallicCorrection=!0,this.gammaCorrection=!0,this.absorbEnabled=!1,this.normalNoiseEnabled=!1,this.pixelNormalNoiseEnabled=!1,this.mirrorMapLodEnabled=!1,this.hdrBrnEnabled=!1,this.vtxFlatNormal=!1,this.texturesTotal=1,this.fragLocalParamsTotal=2,this.parallaxParamIndex=2,this.vertUniform=null}initialize(){this.fragLocalParamsTotal=2,this.parallaxParamIndex=2,null!=this.parallaxMap&&(this.fragLocalParamsTotal+=1),this.m_fragLocalParams=new Float32Array(4*this.fragLocalParamsTotal),this.m_fragLocalParams.set([0,0,0,1,.2,.2,.2,0],0),null!=this.parallaxMap&&(this.m_parallaxParams=this.m_fragLocalParams.subarray(4*this.parallaxParamIndex,4*(this.parallaxParamIndex+1)),this.m_parallaxParams.set([1,10,2,.1]))}seNormalMapIntensity(a){a=Math.min(Math.max(a,0),1),this.m_fragLocalParams[4]=a}setPixelNormalNoiseIntensity(a){a=Math.min(Math.max(a,0),2),this.m_pbrParams[3]=a}getPixelNormalNoiseIntensity(){return this.m_pbrParams[3]}setMirrorViewNV(a){this.m_mirrorParam[0]=a.x,this.m_mirrorParam[1]=a.y,this.m_mirrorParam[2]=a.z}setMirrorPlaneNV(a){}setMirrorMapLodLevel(a){this.m_mirrorParam[3]=a}setMirrorIntensity(a){this.m_mirrorParam[4]=Math.min(Math.max(a,.01),2)}setMirrorMixFactor(a){this.m_mirrorParam[5]=Math.min(Math.max(a,.01),2)}setEnvMapLodMipMapLevel(a,t=0){a=Math.min(Math.max(a,0),14),t=Math.min(Math.max(t,-7),12),this.m_pbrParams[15]=.01*Math.round(a)+t}log2(a){return Math.log(a)/Math.LN2}getMaxMipMapLevel(a,t){return Math.round(this.log2(Math.max(a,t))+1)}setEnvMapLodMipMapLevelWithSize(a,t,e=0){this.m_envMapWidth=a,this.m_envMapHeight=t,e=Math.min(Math.max(e,-7),12);Math.log(Math.max(a,t)),Math.LN2;this.m_pbrParams[15]=.01*this.getMaxMipMapLevel(a,t)+e}setScatterIntensity(a){this.m_pbrParams[11]=Math.min(Math.max(a,.01),512)}getScatterIntensity(){return this.m_pbrParams[11]}setToneMapingExposure(a){this.m_pbrParams[4]=Math.min(Math.max(a,.1),128)}getToneMapingExposure(){return this.m_pbrParams[4]}setReflectionIntensity(a){this.m_pbrParams[5]=Math.min(Math.max(a,.001),1)}getReflectionIntensity(){return this.m_pbrParams[5]}setSurfaceIntensity(a){this.m_pbrParams[6]=Math.min(Math.max(a,.001),32)}getSurfaceIntensity(){return this.m_pbrParams[6]}setSideIntensity(a){this.m_pbrParams[7]=Math.min(Math.max(a,.001),32)}getSideIntensity(){return this.m_pbrParams[7]}setEnvSpecularColorFactor(a,t,e){this.m_pbrParams[12]=a,this.m_pbrParams[13]=t,this.m_pbrParams[14]=e}getEnvSpecularColorFactor(a){a.r=this.m_pbrParams[12],a.g=this.m_pbrParams[13],a.b=this.m_pbrParams[14]}setAmbientFactor(a,t,e){this.m_pbrParams[8]=a,this.m_pbrParams[9]=t,this.m_pbrParams[10]=e}getAmbientFactor(a){a.r=this.m_pbrParams[8],a.g=this.m_pbrParams[9],a.b=this.m_pbrParams[10]}setMetallic(a){this.m_pbrParams[0]=Math.min(Math.max(a,.05),1)}getMetallic(){return this.m_pbrParams[0]}setRoughness(a){this.m_pbrParams[1]=Math.min(Math.max(a,.05),1)}getRoughness(){return this.m_pbrParams[1]}setAO(a){this.m_pbrParams[2]=a}getAO(){return this.m_pbrParams[2]}setF0(a,t,e){this.m_fragLocalParams[0]=a,this.m_fragLocalParams[1]=t,this.m_fragLocalParams[2]=e}getF0(a){a.r=this.m_fragLocalParams[0],a.g=this.m_fragLocalParams[1],a.b=this.m_fragLocalParams[2]}setAlbedoColor(a,t,e){this.m_fragLocalParams[4]=a,this.m_fragLocalParams[5]=t,this.m_fragLocalParams[6]=e}getAlbedoColor(a){a.r=this.m_fragLocalParams[4],a.g=this.m_fragLocalParams[5],a.b=this.m_fragLocalParams[6]}setParallaxParams(a=1,t=10,e=2,r=.1){null!=this.m_parallaxParams&&(this.m_parallaxParams[0]=a,this.m_parallaxParams[1]=t,this.m_parallaxParams[2]=e,this.m_parallaxParams[3]=r)}buildBufParams(){}buildTextureList(a){a.addSpecularEnvMap(this.specularEnvMap,!0),a.addDiffuseMap(this.diffuseMap),a.addNormalMap(this.normalMap),a.addParallaxMap(this.parallaxMap,this.parallaxParamIndex),a.addAOMap(this.aoMap),a.addRoughnessMap(this.roughnessMap),a.addMetalnessMap(this.metalhnessMap),a.addARMMap(this.armMap),a.add2DMap(this.mirrorMap,"VOX_MIRROR_PROJ_MAP",!0,!0,!1),a.addCubeMap(this.indirectEnvMap,"VOX_INDIRECT_ENV_MAP",!0,!1)}buildShader(a){a.normalMapEnabled=null!=this.normalMap,a.mapLodEnabled=!0,a.useHighPrecious();let t=null!=this.mirrorMap&&this.texturesTotal>0;this.normalNoiseEnabled&&a.addDefine("VOX_NORMAL_NOISE","1"),this.woolEnabled&&a.addDefine("VOX_WOOL","1"),this.toneMappingEnabled&&a.addDefine("VOX_TONE_MAPPING","1"),this.scatterEnabled&&a.addDefine("VOX_SCATTER","1"),this.specularBleedEnabled&&a.addDefine("VOX_SPECULAR_BLEED","1"),this.metallicCorrection&&a.addDefine("VOX_METALLIC_CORRECTION","1"),this.gammaCorrection&&a.addDefine("VOX_GAMMA_CORRECTION","1"),this.absorbEnabled&&a.addDefine("VOX_ABSORB","1"),this.pixelNormalNoiseEnabled&&a.addDefine("VOX_PIXEL_NORMAL_NOISE","1"),this.mirrorMapLodEnabled&&a.addDefine("VOX_MIRROR_MAP_LOD","1"),this.hdrBrnEnabled&&a.addDefine("VOX_HDR_BRN","1"),this.vtxFlatNormal&&a.addDefine("VOX_VTX_FLAT_NORMAL","1"),a.addFragUniform("vec4","u_fragLocalParams",this.fragLocalParamsTotal),a.addFragUniform("vec4","u_pbrParams",4),t&&(a.uniform.useStage(!1,!0),a.addFragUniform("vec4","u_mirrorParams",2)),a.vertMatrixInverseEnabled=!0}createUniformData(){let a=new s.default;return a.uniformNameList=["u_pbrParams","u_fragLocalParams","u_mirrorParams"],a.dataList=[this.m_pbrParams,this.m_fragLocalParams,this.m_mirrorParam],a}getShaderCodeObjectUUID(){return i.ShaderCodeUUID.PBR}getShaderCodeObject(){return null}getUniqueName(){let a=this.m_uniqueName;return this.woolEnabled&&(a+="_wl"),this.toneMappingEnabled&&(a+="TM"),this.scatterEnabled&&(a+="Sct"),this.specularBleedEnabled&&(a+="SpecBl"),this.metallicCorrection&&(a+="MetCorr"),this.gammaCorrection&&(a+="GmaCorr"),this.absorbEnabled&&(a+="Absorb"),this.pixelNormalNoiseEnabled&&(a+="PNNoise"),this.normalNoiseEnabled&&(a+="NNoise"),null!=this.indirectEnvMap&&(a+="IndirEnv"),this.shadowReceiveEnabled&&(a+="Shadow"),this.fogEnabled&&(a+="Fog"),this.hdrBrnEnabled&&(a+="HdrBrn"),this.vtxFlatNormal&&(a+="vtxFlagN"),this.mirrorMapLodEnabled&&(a+="MirLod"),this.m_uniqueName=a,this.m_uniqueName}destroy(){this.m_pbrParams=null,this.m_fragLocalParams=null,this.m_mirrorParam=null}}t.PBRDecorator=n},3221:function(a,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(){this.m_params=null,this.m_uniqueNSKeyString=""}initialize(){}use(a){}getTextures(a,t=null){return null}reset(){}destroy(){}getUniqueNSKeyString(){return this.m_uniqueNSKeyString}clone(){return null}getParams(){return this.m_params}getParamsTotal(){return null!=this.m_params?this.m_params.length>>2:0}buildShaderUniformData(a){}}t.UniformComp=r},8875:function(a,t,e){var r,s,i;(function(e,n){s=[],r=n,i="function"===typeof r?r.apply(t,s):r,void 0===i||(a.exports=i)})("undefined"!==typeof self&&self,(function(){function a(){var t=Object.getOwnPropertyDescriptor(document,"currentScript");if(!t&&"currentScript"in document&&document.currentScript)return document.currentScript;if(t&&t.get!==a&&document.currentScript)return document.currentScript;try{throw new Error}catch(d){var e,r,s,i=/.*at [^(]*\((.*):(.+):(.+)\)$/gi,n=/@([^@]*):(\d+):(\d+)\s*$/gi,l=i.exec(d.stack)||n.exec(d.stack),m=l&&l[1]||!1,o=l&&l[2]||!1,u=document.location.href.replace(document.location.hash,""),h=document.getElementsByTagName("script");m===u&&(e=document.documentElement.outerHTML,r=new RegExp("(?:[^\\n]+?\\n){0,"+(o-2)+"}[^<]*<script>([\\d\\D]*?)<\\/script>[\\d\\D]*","i"),s=e.replace(r,"$1").trim());for(var c=0;c<h.length;c++){if("interactive"===h[c].readyState)return h[c];if(h[c].src===m)return h[c];if(m===u&&h[c].innerHTML&&h[c].innerHTML.trim()===s)return h[c]}return null}}return a}))},"8d98":function(a,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{static GetConst(a,t){switch(t){case r.NEAREST:return a.NEAREST;case r.LINEAR:return a.LINEAR;case r.LINEAR_MIPMAP_LINEAR:return a.LINEAR_MIPMAP_LINEAR;case r.NEAREST_MIPMAP_NEAREST:return a.NEAREST_MIPMAP_NEAREST;case r.LINEAR_MIPMAP_NEAREST:return a.LINEAR_MIPMAP_NEAREST;case r.NEAREST_MIPMAP_LINEAR:return a.NEAREST_MIPMAP_LINEAR;case r.WRAP_REPEAT:return a.REPEAT;case r.WRAP_CLAMP_TO_EDGE:return a.CLAMP_TO_EDGE;case r.WRAP_MIRRORED_REPEAT:return a.MIRRORED_REPEAT;default:break}return-1}}r.WRAP_REPEAT=3001,r.WRAP_CLAMP_TO_EDGE=3002,r.WRAP_MIRRORED_REPEAT=3003,r.NEAREST=4001,r.LINEAR=4002,r.LINEAR_MIPMAP_LINEAR=4003,r.NEAREST_MIPMAP_NEAREST=4004,r.LINEAR_MIPMAP_NEAREST=4005,r.NEAREST_MIPMAP_LINEAR=4006,t.default=r},a273:function(a,t,e){"use strict";var r=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(t,"__esModule",{value:!0});const s=e("debe"),i=e("2fe4"),n=r(e("8d98"));class l{constructor(){this.hdrBrnEnabled=!1,this.width=128,this.height=128}createTexture(a,t){let e=t.textureBlock;return a?e.createBytesCubeTex(32,32):e.createFloatCubeTex(32,32)}createFloat(a,t,e){let r=0,s=this.width,i=this.height,l=3,m=new Float32Array(t),o=null,u=e;u.toRGBFormat(),u.minFilter=n.default.LINEAR_MIPMAP_LINEAR,u.magFilter=n.default.LINEAR;for(let n=0;n<9;n++){for(let a=0;a<6;a++){const t=s*i*l;o=m.subarray(r,r+t),u.setDataFromBytesToFaceAt(a,o,s,i,n),r+=t}s>>=1,i>>=1}return e}createHdrBrn(a,t,e){let r=new Uint16Array(t),s=new Uint8Array(t),i=0,l=r[4],m=r[5],o=r[6],u=0,h=s.subarray(32),c=e;c.mipmapEnabled=o<=1,c.minFilter=n.default.LINEAR_MIPMAP_LINEAR,c.magFilter=n.default.LINEAR;for(let n=0;n<o;n++){for(let a=0;a<6;a++)u=l*m*4,c.setDataFromBytesToFaceAt(a,h.subarray(i,i+u),l,m,n),i+=u;l>>=1,m>>=1}return e}}t.SpecularTextureBuilder=l;class m{constructor(){this.m_rscene=null}initialize(a){null==this.m_specularBuilder&&(this.m_rscene=a,this.m_specularBuilder=new l)}createTexture(a){return this.m_specularBuilder.createTexture(a,this.m_rscene)}createMaterial(a=!0){if(null!=this.m_rscene){let t=a?new s.VertUniformComp:null,e=new i.PBRDecorator;return e.vertUniform=t,this.m_rscene.materialBlock.createMaterial(e)}return null}createSpecularTex(a,t=!0,e=null){return null!=this.m_rscene?(null==e&&(e=this.m_specularBuilder.createTexture(t,this.m_rscene)),null!=a?t?this.m_specularBuilder.createHdrBrn(this.m_rscene,a,e):this.m_specularBuilder.createFloat(this.m_rscene,a,e):e):null}destroy(){this.m_rscene=null,this.m_specularBuilder=null}}function o(){return new m}t.PBREffectInstance=m,t.create=o},b3bd:function(a,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(){this.uns="",this.types=null,this.uniformSize=0,this.uniformNameList=null,this.locations=null,this.dataList=null,this.calcModels=null,this.always=!0,this.next=null}getDataRefFromUniformName(a){if(null!=this.uniformNameList){let t=this.uniformNameList,e=t.length;for(let r=0;r<e;++r)if(a==t[r])return this.dataList[r]}return null}setDataRefFromUniformName(a,t){if(null!=this.uniformNameList){let e=this.uniformNameList,r=e.length;for(let s=0;s<r;++s)if(a==e[s]){this.dataList[s]=t;break}}}copyDataFromProbe(a){this.types=[];for(let t=0;t<a.uniformsTotal;++t)this.types.push(a.uniformTypes[t]);this.uniformSize=a.uniformsTotal}destroy(){let a=0,t=this.dataList.length;for(;a<t;++a)this.dataList[a]=null;if(null!=this.calcModels)for(t=this.calcModels.length,a=0;a<t;++a)this.calcModels[a].destroy(),this.calcModels[a]=null;this.dataList=null,this.types=null,this.locations=null,this.calcModels=null}}t.default=r},debe:function(a,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=e("3221");class s extends r.UniformComp{constructor(){super(),this.m_uvTransParam=null,this.m_curveMoveParam=null,this.m_displacementParam=null,this.m_uvTransformParamIndex=-1,this.m_curveMoveParamIndex=-1,this.m_displacementParamIndex=-1,this.uvTransformEnabled=!1,this.curveMoveMap=null,this.displacementMap=null}initialize(){if(null==this.m_params){this.m_uniqueNSKeyString="";let a=0;if(this.uvTransformEnabled&&(this.m_uvTransformParamIndex=a,a++,this.m_uniqueNSKeyString+="UV"),null!=this.curveMoveMap&&(this.m_curveMoveParamIndex=a,a++,this.m_uniqueNSKeyString+="CM"),null!=this.displacementMap&&(this.m_displacementParamIndex=a,a++,this.m_uniqueNSKeyString+="DC"),a>0){this.m_params=new Float32Array(4*a);let t=this.m_uvTransformParamIndex;t>=0&&(this.m_uvTransParam=this.m_params.subarray(4*t,4*(t+1)),this.m_uvTransParam.set([1,1,0,0])),t=this.m_curveMoveParamIndex,t>=0&&(this.m_curveMoveParam=this.m_params.subarray(4*t,4*(t+1))),t=this.m_displacementParamIndex,t>=0&&(this.m_displacementParam=this.m_params.subarray(4*t,4*(t+1)),this.m_displacementParam.set([10,0,0,0]))}}}use(a){this.getParamsTotal()>0&&(a.addVertUniform("vec4","u_vertLocalParams",this.getParamsTotal()),this.m_curveMoveParamIndex>=0&&a.addVertLayout("vec4","a_vs"),this.m_uvTransformParamIndex>=0&&a.addDefine("VOX_VTX_TRANSFORM_PARAM_INDEX",""+this.m_uvTransformParamIndex))}reset(){}destroy(){}getTextures(a,t=null){return this.getParamsTotal()>0?(null==t&&(t=[]),this.m_curveMoveParamIndex>=0&&(t.push(this.curveMoveMap),a.uniform.add2DMap("VTX_CURVE_MOVE_MAP",!1,!1,!0),a.addDefine("VOX_VTX_CURVE_MOVE_PARAM_INDEX",""+this.m_curveMoveParamIndex)),this.m_displacementParamIndex>=0&&(t.push(this.displacementMap),a.uniform.addDisplacementMap(this.m_displacementParamIndex)),t):null}setCurveMoveParam(a,t){null!=this.m_curveMoveParam&&(this.m_curveMoveParam[0]=1/a,this.m_curveMoveParam[2]=t)}setCurveMoveDistance(a){null!=this.m_curveMoveParam&&(this.m_curveMoveParam[1]=a)}setUVScale(a,t){null!=this.m_uvTransParam&&(this.m_uvTransParam[0]=a,this.m_uvTransParam[1]=t)}getUVScale(a){null!=this.m_uvTransParam&&(a.x=this.m_uvTransParam[0],a.y=this.m_uvTransParam[1])}setUVTranslation(a,t){null!=this.m_uvTransParam&&(this.m_uvTransParam[2]=a,this.m_uvTransParam[3]=t)}setDisplacementParams(a,t){null!=this.m_displacementParam&&(this.m_displacementParam[0]=a,this.m_displacementParam[1]=t)}clone(){let a=new s;return a.uvTransformEnabled=this.uvTransformEnabled,a.displacementMap=this.displacementMap,a.curveMoveMap=this.curveMoveMap,a}buildShaderUniformData(a){this.getParamsTotal()>0&&(a.uniformNameList.push("u_vertLocalParams"),a.dataList.push(this.getParams()))}}t.VertUniformComp=s},f3a2:function(a,t,e){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(a){a["None"]="",a["Default"]="pbr",a["Lambert"]="lambert",a["PBR"]="pbr"}(r||(r={})),t.ShaderCodeUUID=r},fae3:function(a,t,e){"use strict";e.r(t);e("1eb2");var r=e("a273");for(var s in r)["default"].indexOf(s)<0&&function(a){e.d(t,a,(function(){return r[a]}))}(s)}})}));