(function(t,i){"object"===typeof exports&&"object"===typeof module?module.exports=i():"function"===typeof define&&define.amd?define([],i):"object"===typeof exports?exports["CoText"]=i():t["CoText"]=i()})("undefined"!==typeof self?self:this,(function(){return function(t){var i={};function e(s){if(i[s])return i[s].exports;var h=i[s]={i:s,l:!1,exports:{}};return t[s].call(h.exports,h,h.exports,e),h.l=!0,h.exports}return e.m=t,e.c=i,e.d=function(t,i,s){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:s})},e.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(e.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var h in t)e.d(s,h,function(i){return t[i]}.bind(null,h));return s},e.n=function(t){var i=t&&t.__esModule?function(){return t["default"]}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="",e(e.s="fae3")}({"045f":function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0});class s{constructor(){this.m_rz=0,this.m_data=new Float32Array([1,1,0,1,1,1,1,1]),this.m_color=null,this.m_brn=1}destroy(){this.material=null,this.m_data=null}setRGBA4f(t,i,e,s){this.m_color.r=t,this.m_color.g=i,this.m_color.b=e,this.m_data[4]=t*this.m_brn,this.m_data[5]=i*this.m_brn,this.m_data[6]=e*this.m_brn,this.m_data[7]=s}setRGB3f(t,i,e){this.m_color.r=t,this.m_color.g=i,this.m_color.b=e,this.m_data[4]=t*this.m_brn,this.m_data[5]=i*this.m_brn,this.m_data[6]=e*this.m_brn}setAlpha(t){this.m_data[7]=t}getAlpha(){return this.m_data[6]}setBrightness(t){this.m_brn=t,this.m_data[4]=this.m_color.r*t,this.m_data[5]=this.m_color.g*t,this.m_data[6]=this.m_color.b*t}getBrightness(){return this.m_brn}getRotationZ(){return this.m_rz}setRotationZ(t){this.m_rz=t,this.m_data[2]=t*(Math.PI/180)}getScaleX(){return this.m_data[0]}getScaleY(){return this.m_data[1]}setScaleX(t){this.m_data[0]=t}setScaleY(t){this.m_data[1]=t}setScaleXY(t,i){this.m_data[0]=t,this.m_data[1]=i}create(){if(null==this.material){this.m_color=CoRScene.createColor4();let t=!0,i=CoRScene.createShaderMaterial("co_3dBill_text_material");i.addUniformDataAt("u_params",this.m_data),i.setShaderBuilder(t=>{let i=t.getShaderCodeBuilder();i.uniform.addDiffuseMap(),i.addVertLayout("vec2","a_vs"),i.addVertLayout("vec2","a_uvs"),i.addVertUniform("vec4","u_params",2),i.addVarying("vec2","v_texUV"),i.addVarying("vec4","v_colorMult"),i.addFragOutputHighp("vec4","FragColor0"),i.addFragMainCode("\nFragColor0 = vec4(v_colorMult.xyz,v_colorMult.a * texture(u_sampler0, v_texUV).a);\n\t\t\t\t\t"),i.addVertMainCode("\nvec4 temp = u_params[0];\nfloat cosv = cos(temp.z);\nfloat sinv = sin(temp.z);\nvec2 vtx = vec2(a_vs.x * temp.x, a_vs.y * temp.y);\nvec2 vtx_pos = vec2(vtx.x * cosv - vtx.y * sinv, vtx.x * sinv + vtx.y * cosv);\nvec4 pos = u_viewMat * u_objMat * vec4(0.0,0.0,0.0,1.0);\npos.xy += vtx_pos.xy;\ngl_Position =  u_projMat * pos;\nv_texUV = a_uvs;\nv_colorMult = u_params[1];\n\t\t\t\t\t")}),i.initializeByCodeBuf(t),this.material=i}return this.material}}i.TextMaterial=s},"062b":function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e("62a0"),h=e("2155");function r(t,i,e=10,h=512,r=512){let a=new s.H5Text;return a.initialize(t,i,e,h,r),a}function a(t,i,e=null){let s=new h.TextEntity;return s.initialize(t,i,e),s}i.createH5Text=r,i.createStaticTextEntity=a},"1eb2":function(t,i,e){"use strict";if("undefined"!==typeof window){var s=window.document.currentScript,h=e("8875");s=h(),"currentScript"in document||Object.defineProperty(document,"currentScript",{get:h});var r=s&&s.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);r&&(e.p=r[1])}},2155:function(t,i,e){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(i,"__esModule",{value:!0});const h=s(e("968a")),r=e("045f");class a{constructor(t=!0){this.m_rentity=null,this.m_dynamicEnbaled=!0,this.m_material=new r.TextMaterial,this.m_width=0,this.m_height=0,this.m_text="",this.m_alignFactorX=.5,this.m_alignFactorY=.5,this.flipVerticalUV=!1,this.m_dynamicEnbaled=t}getREntity(){return this.m_rentity}getWidth(){return this.m_width}getHeight(){return this.m_height}setAlignFactor(t,i){this.m_alignFactorX=t,this.m_alignFactorY=i}alignLeftTop(){this.setAlignFactor(0,0)}alignCenter(){this.setAlignFactor(.5,.5)}alignLeftCenter(){this.setAlignFactor(0,.5)}setText(t){}setRGBA4f(t,i,e,s){null!=this.m_material&&this.m_material.setRGBA4f(t,i,e,s)}setRGB3f(t,i,e){null!=this.m_material&&this.m_material.setRGB3f(t,i,e)}setAlpha(t){this.m_material.setAlpha(t)}getAlpha(){return this.m_material.getAlpha()}setBrightness(t){this.m_material.setBrightness(t)}getBrightness(){return this.m_material.getBrightness()}getRotationZ(){return this.m_material.getRotationZ()}setRotationZ(t){this.m_material.setRotationZ(t)}getScaleX(){return this.m_material.getScaleX()}getScaleY(){return this.m_material.getScaleY()}setScaleX(t){this.m_material.setScaleX(t)}setScaleY(t){this.m_material.setScaleY(t)}setScaleXY(t,i){this.m_material.setScaleXY(t,i)}setXYZ(t,i,e){null!=this.m_rentity&&this.m_rentity.setXYZ(t,i,e)}setPosition(t){null!=this.m_rentity&&this.m_rentity.setPosition(t)}getPosition(t){if(null!=this.m_rentity)return this.m_rentity.getPosition(t)}createMaterial(t){this.m_material.create(),this.m_material.material.setTextureList(t)}initialize(t,i,e=null){null==this.m_rentity&&(this.m_rentity=CoRScene.createDisplayEntity(),this.m_text=t,this.m_h5Text=i,null==e?this.createMaterial([i.getTextureAt(0)]):this.createMaterial(e),this.m_mesh=this.createMesh(this.m_material.material),this.m_rentity.setMaterial(this.m_material.material),this.m_rentity.setMesh(this.m_mesh),this.m_rentity.setRenderState(CoRScene.RendererState.BACK_TRANSPARENT_STATE))}createBounds(){}createMesh(t){let i=new h.default;return i.vbWholeDataEnabled=!1,i.alignFactorX=this.m_alignFactorX,i.alignFactorY=this.m_alignFactorY,i.initialize(this.m_h5Text),this.m_width=i.getWidth(),this.m_height=i.getHeight(),i.create(this.m_text,t)}update(){null!=this.m_rentity&&(this.m_rentity.update(),null!=this.m_rentity.getTransform()&&this.m_dynamicEnbaled&&this.m_rentity.setIvsParam(0,this.m_mesh.vtCount))}destroy(){null!=this.m_rentity&&(this.m_rentity.destroy(),this.m_rentity=null,this.m_h5Text=null,this.m_material.destroy(),this.m_material=null)}}i.TextEntity=a},"62a0":function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0});class s{constructor(){this.width=4,this.height=4,this.x=0,this.y=0,this.uvs=new Float32Array(8)}toString(){return"FontTexCharGrid(x="+this.x+",y="+this.y+",width="+this.width+",height="+this.height+")"}}class h{constructor(){this.m_texWidth=512,this.m_texHeight=256,this.m_gridMp=new Map,this.layoutDataStr="",this.m_minX=0,this.m_minY=0,this.m_maxX=0,this.m_maxY=0}initialize(t,i){this.m_texWidth=t,this.m_texHeight=i}addCharsByRawData(t,i){let e=0,s=0,h=i.split(","),r=h.length/4;for(;e<r;++e)s=4*e,this.addUV8RawDataFromChar(t.charAt(e),parseInt(h[s]),parseInt(h[s+1]),parseInt(h[s+2]),parseInt(h[s+3]))}addUV8RawDataFromChar(t,i,e,h,r){if(null==this.m_gridMp.get(t)){let a=new s,n=a.uvs,m=this.m_texWidth,l=this.m_texHeight;this.m_minX=i/m,this.m_minY=e/l,this.m_maxX=(i+h)/m,this.m_maxY=(e+r)/l,n[0]=this.m_minX,n[1]=this.m_maxY,n[2]=this.m_maxX,n[3]=this.m_maxY,n[4]=this.m_maxX,n[5]=this.m_minY,n[6]=this.m_minX,n[7]=this.m_minY,a.x=i,a.y=e,a.width=h,a.height=r,this.m_gridMp.set(t,a)}}getGridByChar(t){return this.m_gridMp.get(t)}getUV8FromChar(t,i,e=0){let s=this.m_gridMp.get(t);null==s&&(s=this.m_gridMp.get("?")),i.set(s.uvs,e)}getVtxFromChar(t,i,e=0){let s=this.m_gridMp.get(t);null==s&&(s=this.m_gridMp.get("?"));let h=[0,0,0,s.width,0,0,s.width,s.height,0,0,s.height,0];i.set(h,e)}getUV8AndVtxFromChar(t,i,e,s=0,h=0){let r=this.m_gridMp.get(t);null==r&&(r=this.m_gridMp.get("?")),i.set(r.uvs,s);let a=[0,0,0,r.width,0,0,r.width,r.height,0,0,r.height,0];e.set(a,h)}getUV8AndSizeFromChar(t,i,e,s=0){let h=this.m_gridMp.get(t);null==h&&(h=this.m_gridMp.get("?")),i.set(h.uvs,s),e[0]=h.width,e[1]=h.height}getUV8AndOffsetXYVtxFromChar(t,i,e,s=0,h=0,r=0,a=0){let n=this.m_gridMp.get(t);null==n&&(n=this.m_gridMp.get("?")),i.set(n.uvs,r);let m=[s,h,0,s+n.width,h,0,s+n.width,h+n.height,0,s,h+n.height,0];e.set(m,a)}}i.FontTexCharTable=h;class r{constructor(){this.m_currPosX=0,this.m_currPosY=0,this.m_texText="",this.m_fontCharTable=null,this.pixMinPos={x:0,y:0},this.pixMaxPos={x:0,y:0},this.canvas=null,this.ctx2d=null,this.m_py=0,this.charTexWidth=0,this.px=0,this.py=0,this.ph=0,this.linedis=2,this.charHDis=1,this.tx=0,this.char="",this.meao=null}setFontCharTable(t){this.m_fontCharTable=t}textFilte(t){let i=t.length,e="",s="";for(let h=0;h<i;++h)s=t.charAt(h),this.m_texText.indexOf(s)<0&&e.indexOf(s)<0&&(e+=s);return e}crateTextUVData(t,i,e,s=18){this.m_texText+=t;let h=this.ctx2d;this.m_currPosY<2&&(this.m_currPosY=s),this.charTexWidth=0,h.textAlign="left",h.fillStyle="white",h.font=s+"px Arial";let r=t.length;this.pixMinPos.x=2e4,this.pixMinPos.y=2e4,this.pixMaxPos.x=-2e4,this.pixMaxPos.y=-2e4,this.ph=s+8;for(let a=0;a<r;a++)this.char=t.charAt(a),this.meao=h.measureText(this.char),this.charTexWidth=Math.floor(this.meao.width)+1,this.tx=this.m_currPosX+this.charTexWidth,this.tx<i?(h.fillText(this.char,this.m_currPosX,this.m_currPosY),this.m_py=this.m_currPosY-s,this.pixMinPos.x>this.m_currPosX&&(this.pixMinPos.x=this.m_currPosX),this.pixMinPos.y>this.m_py&&(this.pixMinPos.y=this.m_py),this.px=this.m_currPosX+this.charTexWidth,this.py=this.m_py+this.ph,this.pixMaxPos.x<this.px&&(this.pixMaxPos.x=this.px),this.pixMaxPos.y<this.py&&(this.pixMaxPos.y=this.py),this.m_fontCharTable.addUV8RawDataFromChar(this.char,this.m_currPosX,this.m_py+1,this.charTexWidth,this.ph),this.m_currPosX=this.tx+this.charHDis):(this.m_currPosX=0,this.m_currPosY+=this.ph+this.linedis,h.fillText(this.char,this.m_currPosX,this.m_currPosY),this.m_py=this.m_currPosY-s,this.pixMinPos.x>this.m_currPosX&&(this.pixMinPos.x=this.m_currPosX),this.pixMinPos.y>this.m_py&&(this.pixMinPos.y=this.m_py),this.px=this.m_currPosX+this.charTexWidth,this.py=this.m_py+this.ph,this.pixMaxPos.x<this.px&&(this.pixMaxPos.x=this.px),this.pixMaxPos.y<this.py&&(this.pixMaxPos.y=this.py),this.m_fontCharTable.addUV8RawDataFromChar(this.char,this.m_currPosX,this.m_py+1,this.charTexWidth,this.ph),this.m_currPosX+=this.charTexWidth)}}i.FontTexDataBuilder=r;class a{constructor(){this.m_texWidth=512,this.m_texHeight=512,this.m_preSW=0,this.m_preSH=0,this.m_canvas=null,this.m_ctx2D=null,this.m_tex=null,this.m_fontSize=18,this.m_fontCharTable=new h,this.m_fontTexDataBuilder=new r,this.m_rc=null,this.m_areaBytes=null}isEnabled(){return null!=this.m_canvas}getFontSize(){return this.m_fontSize}initialize(t,i,e=10,s=512,h=512,r=!1,a=!1){null==this.m_canvas&&(this.m_rc=t,s<32&&(s=32),h<32&&(h=32),this.m_texWidth=s,this.m_texHeight=h,e<10&&(e=10),this.m_fontSize=e,this.m_canvas=document.getElementById(i),null==this.m_canvas&&(this.m_canvas=document.createElement("canvas"),this.m_canvas.style.width="128px",this.m_canvas.style.height="128px",this.m_canvas.style.display="bolck",this.m_canvas.style.overflow="hidden",this.m_canvas.style.left="0px",this.m_canvas.style.top="0px",this.m_canvas.style.position="absolute",this.m_canvas.style.backgroundColor="transparent",this.m_canvas.style.pointerEvents="none"),this.m_canvas.width=s,this.m_canvas.height=h,r?(document.body.appendChild(this.m_canvas),this.m_canvas.style.visibility="visible"):this.m_canvas.style.visibility="hidden",this.m_ctx2D=this.m_canvas.getContext("2d"),this.m_fontTexDataBuilder.canvas=this.m_canvas,this.m_fontTexDataBuilder.ctx2d=this.m_ctx2D,this.m_fontTexDataBuilder.setFontCharTable(this.m_fontCharTable),this.m_fontCharTable.initialize(this.m_texWidth,this.m_texHeight),this.m_tex=this.m_rc.textureBlock.createBytesTex(this.m_texWidth,this.m_texHeight),this.m_tex.toAlphaFormat(),this.m_tex.mipmapEnabled=a,this.m_tex.minFilter=CoRScene.TextureConst.LINEAR,this.m_tex.magFilter=CoRScene.TextureConst.NEAREST,this.createInitTexAndChars())}setStyleSize(t,i){null!=this.m_canvas&&(this.m_preSW==t&&this.m_preSH==i||(this.m_preSW=t,this.m_preSH=i,this.m_canvas.style.width=t+"px",this.m_canvas.style.height=i+"px"))}setCanvasVisible(t){this.m_canvas.style.visibility=t?"visible":"hidden"}getUV8FromChar(t,i,e=0){this.m_fontCharTable.getUV8FromChar(t,i,e)}getCharTable(){return this.m_fontCharTable}createCharsTexFromStr(t){if(t=this.m_fontTexDataBuilder.textFilte(t),t.length<1)return;let i=t;this.m_fontTexDataBuilder.crateTextUVData(i,this.m_texWidth,this.m_texHeight,this.m_fontSize);let e=0,s=0,h=0,r=0,a=0,n=this.m_fontTexDataBuilder.pixMaxPos.x-this.m_fontTexDataBuilder.pixMinPos.x,m=this.m_fontTexDataBuilder.pixMaxPos.y-this.m_fontTexDataBuilder.pixMinPos.y,l=this.m_ctx2D.getImageData(this.m_fontTexDataBuilder.pixMinPos.x,this.m_fontTexDataBuilder.pixMinPos.y,n,m),o=l.data,_=new Uint8Array(n*m),c=this.m_fontTexDataBuilder.pixMinPos.x,u=this.m_fontTexDataBuilder.pixMinPos.y;for(s=0;s<m;++s)for(h=0;h<n;++h)a=(s+u)*this.m_texWidth+(c+h),e=4*(s*n+h),this.m_areaBytes[a]=o[e+3],_[r]=this.m_areaBytes[a],r++;this.m_tex.setPartDataFromeBytes(_,this.m_fontTexDataBuilder.pixMinPos.x,this.m_fontTexDataBuilder.pixMinPos.y,n,m),this.m_tex.updateDataToGpu()}createInitTexAndChars(){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz1234567890~`!@#$%^&*()_+-={}[]:\";\\|'<>,.?/\n ",i=t;this.m_fontTexDataBuilder.crateTextUVData(i,this.m_texWidth,this.m_texHeight,this.m_fontSize);let e=this.m_ctx2D.getImageData(0,0,this.m_texWidth,this.m_texHeight),s=e.data,h=0,r=0,a=0;this.m_areaBytes=new Uint8Array(this.m_texWidth*this.m_texHeight);let n=0;for(h=0;h<this.m_texHeight;++h)for(r=0;r<this.m_texWidth;++r)a=4*(h*this.m_texWidth+r),this.m_areaBytes[n]=s[a+3],n++;this.m_tex.setDataFromBytes(this.m_areaBytes,0,this.m_texWidth,this.m_texHeight)}getTextureAt(t=0){return this.m_tex}}i.H5Text=a},8875:function(t,i,e){var s,h,r;(function(e,a){h=[],s=a,r="function"===typeof s?s.apply(i,h):s,void 0===r||(t.exports=r)})("undefined"!==typeof self&&self,(function(){function t(){var i=Object.getOwnPropertyDescriptor(document,"currentScript");if(!i&&"currentScript"in document&&document.currentScript)return document.currentScript;if(i&&i.get!==t&&document.currentScript)return document.currentScript;try{throw new Error}catch(u){var e,s,h,r=/.*at [^(]*\((.*):(.+):(.+)\)$/gi,a=/@([^@]*):(\d+):(\d+)\s*$/gi,n=r.exec(u.stack)||a.exec(u.stack),m=n&&n[1]||!1,l=n&&n[2]||!1,o=document.location.href.replace(document.location.hash,""),_=document.getElementsByTagName("script");m===o&&(e=document.documentElement.outerHTML,s=new RegExp("(?:[^\\n]+?\\n){0,"+(l-2)+"}[^<]*<script>([\\d\\D]*?)<\\/script>[\\d\\D]*","i"),h=e.replace(s,"$1").trim());for(var c=0;c<_.length;c++){if("interactive"===_[c].readyState)return _[c];if(_[c].src===m)return _[c];if(m===o&&_[c].innerHTML&&_[c].innerHTML.trim()===h)return _[c]}return null}}return t}))},"968a":function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0});class s{constructor(){this.m_ivs=null,this.m_vs=null,this.m_uvs=null,this.m_h5Text=null,this.m_width=0,this.m_height=0,this.m_charsTotal=0,this.m_text="",this.flipVerticalUV=!1,this.vtxUVEnabled=!0,this.vertColorEnabled=!1,this.alignFactorX=.5,this.alignFactorY=.5,this.vbWholeDataEnabled=!0}getWidth(){return this.m_width}getHeight(){return this.m_height}createMesh(t,i){this.m_text=t;let e=t.length;if(this.m_charsTotal=e,e>0){let h=s,r=h.s_currIvs;if(r.set(h.s_initIvs,0),null==this.m_ivs){this.m_ivs=new Uint16Array(6*e);for(let t=0;t<e;++t)this.m_ivs.set(r,6*t),r[0]+=4,r[1]+=4,r[2]+=4,r[3]+=4,r[4]+=4,r[5]+=4}let a=!1,n=this.m_h5Text;n.createCharsTexFromStr(t),this.m_width=-1,this.m_height=0;let m=h.s_sizeArr,l=0,o=0,_=0,c=0,u=0;a=null!=this.m_vs&&8*e>this.m_vs.length;let d=n.getCharTable();if(a){let i=h.s_currIvs;for(i.set(h.s_initIvs,0),this.m_ivs=new Uint16Array(6*e),this.m_uvs=new Float32Array(8*e),this.m_vs=new Float32Array(8*e);l<e;++l)this.m_ivs.set(i,6*l),i[0]+=4,i[1]+=4,i[2]+=4,i[3]+=4,i[4]+=4,i[5]+=4,d.getUV8AndSizeFromChar(t.charAt(l),this.m_uvs,m,8*l),this.m_height<m[1]&&(this.m_height=m[1]),this.m_vs[8*l]=m[0],this.m_width+=m[0]}else for(null==this.m_vs&&(this.m_uvs=new Float32Array(8*e),this.m_vs=new Float32Array(8*e));l<e;++l)d.getUV8AndSizeFromChar(t.charAt(l),this.m_uvs,m,8*l),this.m_height<m[1]&&(this.m_height=m[1]),this.m_vs[8*l]=m[0],this.m_width+=m[0];let x=1;this.m_width+=e*x,c=-this.alignFactorX*this.m_width,u=-this.alignFactorY*this.m_height,_=u+this.m_height;let p=0;for(l=0;l<e;++l)o=c+this.m_vs[p],this.m_vs[p]=c,this.m_vs[p+1]=u,this.m_vs[p+2]=o,this.m_vs[p+3]=u,this.m_vs[p+4]=o,this.m_vs[p+5]=_,this.m_vs[p+6]=c,this.m_vs[p+7]=_,c=o+x,p+=8;let g=CoRScene.createRawMesh();return g.reset(),g.setBufSortFormat(i.getBufSortFormat()),g.setIVS(this.m_ivs),g.addFloat32Data(this.m_vs,2),g.addFloat32Data(this.m_uvs,2),g.vbWholeDataEnabled=this.vbWholeDataEnabled,g.initialize(),g.vtCount=6*e,g.vtxTotal=4*e,g.trisNumber=2*e,g}return null}initialize(t){this.m_h5Text=t}create(t,i){return this.createMesh(t,i)}destroy(){this.m_h5Text=null}}s.s_initIvs=new Uint8Array([0,1,2,0,2,3]),s.s_currIvs=new Uint8Array([0,1,2,0,2,3]),s.s_sizeArr=[0,0],i.default=s},fae3:function(t,i,e){"use strict";e.r(i);e("1eb2");var s=e("062b");for(var h in s)["default"].indexOf(h)<0&&function(t){e.d(i,t,(function(){return s[t]}))}(h)}})}));